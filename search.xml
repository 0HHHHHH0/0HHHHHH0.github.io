<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>爬取正方教务系统课程表</title>
    <url>/2021/07/04/006-ke-cheng-biao/</url>
    <content><![CDATA[<p>被一个学长布置下的任务…….有些地方可能不够完整…&nbsp;</p>
<p>思路：&nbsp; 首先你需要完成登录操作：&nbsp;</p>
<p>（1） 首先根据教务系统网站的审查元素， 发现了一个验证码的网址：<a href="http://210.40.2.253:8888/(fw5xjvfovnf3f4zg1ikero2a)/CheckCode.aspx">http://210.40.2.253:8888/(fw5xjvfovnf3f4zg1ikero2a)/CheckCode.aspx</a>&nbsp;进去后你会发现，这里面的验证码是会随着时间的变化而变化的，那这样子该怎么办呢？（果断百度一波！！）然后巴拉巴拉….. 大概就是说验证码的核对是与你的cookies有关的，那么这个东西要怎么获得呢，&nbsp;request第三方库中提供了一个session ， 这个就是相当于代码中的一个浏览器，在你请求http的时候会自动帮你保存你的cookies的值，这样子就可以完成验证码的匹配操作了 。&nbsp;具体一点：&nbsp;先创建一个session对象&nbsp;然后向验证码页面发送get请求（这时你的cookies就有了）&nbsp;然后向教务系统页面发送post请求（提交账号密码验证码）&nbsp;这时，你就登录成功了（前提是提交的东西要正确= =）</p>
<p>（2） 爬取课程表&nbsp;登录进去后，我们继续我们的审查元素，在其中找到了向课程表页面发送post请求的地址：<a href="http://210.40.2.253:8888/xskbcx.aspx?xh=1717000113&amp;xm=%D6%A3%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD&amp;gnmkdm=N121603">http://210.40.2.253:8888/xskbcx.aspx?xh=1717000113&amp;xm=%D6%A3%BC%CE%F3%DE&amp;gnmkdm=N121603</a>&nbsp;其中 xh 是 学号 ， xm 是学生姓名的url编码 ， gnmkdm是课程表页面的代码&nbsp;&nbsp;这些信息是获得课表页面的学生信息，会显示出你是哪里的学生，学号是什么，专业是什么等等之类的这些东西我们需要想办法获得，也就是说，只有得到了这些信息，我们才能方便向课表页面发送post请求&nbsp;那么应该怎么获得？</p>
<p>（1） 先发送一个get请求 <a href="http://210.40.2.253:8888/xskbcx.aspx?xh=%22+">http://210.40.2.253:8888/xskbcx.aspx?xh="+</a> user_name+ “&amp;gnmkdm=N121603&nbsp;</p>
<p>（2） 然后运用bs4库去提取http网页中的学生信息（参考代码）&nbsp;</p>
<p>（3）得到后向课表页面发送post请求（哪一年第几学期）</p>
<p>（4） 然后便得到了我们的课程表页面， 接下来就可以进行信息提取了&nbsp;其实只要登录进去了，里面的成绩，课表，选课什么的都是可以以一种模拟人的办法进行操作</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup

session <span class="token operator">=</span> <span class="token boolean">None</span>

checkcodePath <span class="token operator">=</span> <span class="token string">'./code.png'</span>  <span class="token comment">#验证码保存路径</span>

res <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>

Origin_url <span class="token operator">=</span> <span class="token string">"http://210.40.2.253:8888/(fw5xjvfovnf3f4zg1ikero2a)/"</span> <span class="token comment"># 教务系统网址</span>

url <span class="token operator">=</span> <span class="token string">"http://210.40.2.253:8888/default2.aspx"</span>

checkcodeURL <span class="token operator">=</span> Origin_url<span class="token operator">+</span><span class="token string">'CheckCode.aspx'</span>  <span class="token comment">#验证码网址</span>

head <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; WOW64; rv:63.0) Gecko/20100101 Firefox/63.0"</span><span class="token punctuation">,</span><span class="token string">"Connection"</span><span class="token punctuation">:</span> <span class="token string">"keep-alive"</span><span class="token punctuation">,</span>   <span class="token string">"Referer"</span><span class="token punctuation">:</span><span class="token string">"http://210.40.2.253:8888/default2.aspx"</span><span class="token punctuation">}</span>

post_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"__VIEWSTATE"</span><span class="token punctuation">:</span><span class="token string">"dDwtNTE2MjI4MTQ7Oz4I55DQ6KPcVdzTLmjGjlJPRWgYUQ=="</span><span class="token punctuation">,</span><span class="token string">"Textbox1"</span> <span class="token punctuation">:</span> <span class="token string">""</span> <span class="token punctuation">,</span><span class="token string">"txtSecretCode"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">"RadioButtonList1"</span><span class="token punctuation">:</span><span class="token string">"%D1%A7%C9%FA"</span><span class="token punctuation">,</span><span class="token string">"Button1"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">"lbLanguage"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">"hidPdrs"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token string">"hidsc"</span><span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">}</span>

<span class="token keyword">def</span> get_photo<span class="token punctuation">(</span>URL<span class="token punctuation">)</span><span class="token punctuation">:</span>

    checkcode <span class="token operator">=</span> res<span class="token punctuation">.</span>get<span class="token punctuation">(</span>checkcodeURL<span class="token punctuation">,</span> headers<span class="token operator">=</span>head<span class="token punctuation">)</span>

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>checkcodePath<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>  <span class="token comment">#保存验证码图片</span>

         fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>checkcode<span class="token punctuation">.</span>content<span class="token punctuation">)</span>

    post_data<span class="token punctuation">[</span><span class="token string">'txtSecretCode'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入图片中的验证码: （验证码图片保存在同级文件夹）"</span><span class="token punctuation">)</span>  


<span class="token keyword">def</span> login<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    user_name <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入您的学号："</span><span class="token punctuation">)</span>

    user_password <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入您的密码："</span><span class="token punctuation">)</span>

    post_data<span class="token punctuation">[</span><span class="token string">"txtUserName"</span><span class="token punctuation">]</span> <span class="token operator">=</span> user_name

    post_data<span class="token punctuation">[</span><span class="token string">"TextBox2"</span><span class="token punctuation">]</span><span class="token operator">=</span>  user_password 

    login_page_url <span class="token operator">=</span> Origin_url <span class="token operator">+</span> <span class="token string">"default2.aspx"</span>

    head<span class="token punctuation">[</span><span class="token string">'Referer'</span><span class="token punctuation">]</span> <span class="token operator">=</span> login_page_url

    get_photo<span class="token punctuation">(</span>url<span class="token punctuation">)</span>

    homePage <span class="token operator">=</span> res<span class="token punctuation">.</span>post<span class="token punctuation">(</span>login_page_url<span class="token punctuation">,</span> data<span class="token operator">=</span>post_data<span class="token punctuation">,</span> headers<span class="token operator">=</span>head<span class="token punctuation">)</span>  <span class="token comment">#在这里得到了主页面</span>

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'text1.html'</span><span class="token punctuation">,</span><span class="token string">'w'</span> <span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">'gb2312'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f <span class="token punctuation">:</span>

           f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>homePage<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

    <span class="token comment">#更改数据</span>

    <span class="token comment">#head["Referer"]="http://210.40.2.253:8888/(fw5xjvfovnf3f4zg1ikero2a)/default2.aspx"</span>

    exit_sys <span class="token operator">=</span> <span class="token string">"what should i do "</span>

    URL <span class="token operator">=</span> <span class="token string">"http://210.40.2.253:8888/xskbcx.aspx?xh="</span><span class="token operator">+</span> user_name<span class="token operator">+</span> <span class="token string">"&amp;gnmkdm=N121603"</span>

    <span class="token comment">#URL = "http://210.40.2.253:8888/xskbcx.aspx?xh=1717000113&amp;xm=%D6%A3%BC%CE%F3%DE&amp;gnmkdm=N121603</span>

    head<span class="token punctuation">[</span><span class="token string">"Referer"</span><span class="token punctuation">]</span><span class="token operator">=</span> URL


    page_home <span class="token operator">=</span> res<span class="token punctuation">.</span>get<span class="token punctuation">(</span>URL <span class="token punctuation">,</span> headers <span class="token operator">=</span> head<span class="token punctuation">)</span> 

    post_data<span class="token punctuation">[</span><span class="token string">"__VIEWSTATE"</span><span class="token punctuation">]</span> <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>page_home<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span>

    <span class="token comment">#xm = BeautifulSoup(res.get(URL , headers = head).text, 'html.parser').find_all('form')[0].get('action')</span>

    post_data<span class="token punctuation">[</span><span class="token string">"__EVENTTARGET"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"xqd"</span>

    <span class="token keyword">while</span> exit_sys <span class="token operator">!=</span> <span class="token string">"q"</span><span class="token punctuation">:</span>

        query_years <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入您要查询课表的年份：（2017-2018）"</span><span class="token punctuation">)</span>

        query_how <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入您要查询第几学期的课表："</span><span class="token punctuation">)</span> 


        <span class="token comment">#URL = "http://210.40.2.253:8888/" + xm</span>

        <span class="token comment">#print(URL)</span>

        post_data<span class="token punctuation">[</span><span class="token string">"xnd"</span><span class="token punctuation">]</span><span class="token operator">=</span> query_years

        post_data<span class="token punctuation">[</span><span class="token string">"xqd"</span><span class="token punctuation">]</span><span class="token operator">=</span>query_how


        learning <span class="token operator">=</span> res<span class="token punctuation">.</span>post<span class="token punctuation">(</span>URL <span class="token punctuation">,</span> data <span class="token operator">=</span> post_data <span class="token punctuation">,</span> headers <span class="token operator">=</span> head<span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>URL<span class="token punctuation">)</span>

        <span class="token keyword">if</span> query_years <span class="token operator">==</span> <span class="token string">"2018-2019"</span> <span class="token keyword">and</span> query_how <span class="token operator">==</span> <span class="token string">"1"</span> <span class="token punctuation">:</span>

                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span> query_years <span class="token operator">+</span> <span class="token string">'-'</span><span class="token operator">+</span> query_how <span class="token operator">+</span> <span class="token string">'.html'</span>  <span class="token punctuation">,</span><span class="token string">'w'</span> <span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">"gb2312"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f <span class="token punctuation">:</span>

                   f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>page_home<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

        <span class="token keyword">else</span> <span class="token punctuation">:</span> 

                <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span> query_years <span class="token operator">+</span> <span class="token string">'-'</span><span class="token operator">+</span> query_how <span class="token operator">+</span> <span class="token string">'.html'</span>  <span class="token punctuation">,</span><span class="token string">'w'</span> <span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">"gb2312"</span> <span class="token punctuation">,</span> errors <span class="token operator">=</span> <span class="token string">"ignore"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f <span class="token punctuation">:</span>

                   f<span class="token punctuation">.</span>write<span class="token punctuation">(</span> learning<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"您的课表已经保存为html的形式！"</span><span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"按q退出 按c继续"</span><span class="token punctuation">)</span>

        <span class="token keyword">while</span> <span class="token number">1</span> <span class="token punctuation">:</span>

            exit_sys <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token keyword">if</span> exit_sys <span class="token operator">==</span> <span class="token string">"c"</span> <span class="token keyword">or</span> exit_sys <span class="token operator">==</span> <span class="token string">'q'</span> <span class="token punctuation">:</span>

                <span class="token keyword">break</span>

            <span class="token keyword">else</span><span class="token punctuation">:</span>

                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"无效操作！"</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> learning

<span class="token keyword">def</span> class_table<span class="token punctuation">(</span>table_html<span class="token punctuation">)</span><span class="token punctuation">:</span>

      <span class="token keyword">pass</span> 


<span class="token keyword">def</span> main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    res <span class="token operator">=</span> login<span class="token punctuation">(</span><span class="token punctuation">)</span> 

    class_table<span class="token punctuation">(</span>res<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>

    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>爬虫</tag>
      </tags>
  </entry>
  <entry>
    <title>表达数据挖掘</title>
    <url>/2022/07/22/014-biao-da-shu-ju-wa-jue/</url>
    <content><![CDATA[<h1 id="第一步、关键基因和关键样本"><a href="#第一步、关键基因和关键样本" class="headerlink" title="第一步、关键基因和关键样本"></a>第一步、关键基因和关键样本</h1><h3 id="一、差异表达分析"><a href="#一、差异表达分析" class="headerlink" title="一、差异表达分析"></a>一、差异表达分析</h3><p>Sig genes：火山图</p>
<p>Sig genes：heatmap</p>
<h3 id="二、PCA分析"><a href="#二、PCA分析" class="headerlink" title="二、PCA分析"></a>二、PCA分析</h3><p>hub PC：biplot</p>
<p>hub PC：表型关联</p>
<p>hub genes：loadings plot</p>
<h3 id="三、聚类分析-WGCNA分析"><a href="#三、聚类分析-WGCNA分析" class="headerlink" title="三、聚类分析/WGCNA分析"></a>三、聚类分析/WGCNA分析</h3><p>hub modules</p>
<p>hub genes</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-06%2015-05-14_20220806070914044671.png"></p>
<h1 id="第二步、功能分析"><a href="#第二步、功能分析" class="headerlink" title="第二步、功能分析"></a>第二步、功能分析</h1><h3 id="一、富集分析"><a href="#一、富集分析" class="headerlink" title="一、富集分析"></a>一、富集分析</h3><p>barplot</p>
<p>cnetplot</p>
<h3 id="二、蛋白互作网络分析（PPI"><a href="#二、蛋白互作网络分析（PPI" class="headerlink" title="二、蛋白互作网络分析（PPI)"></a>二、蛋白互作网络分析（PPI)</h3><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-06%2015-05-37_20220806070837589137.png"></p>
<h1 id="第三步、表达验证"><a href="#第三步、表达验证" class="headerlink" title="第三步、表达验证"></a>第三步、表达验证</h1><h3 id="一、实验"><a href="#一、实验" class="headerlink" title="一、实验"></a>一、实验</h3><p>qPCR</p>
<h3 id="二、信息"><a href="#二、信息" class="headerlink" title="二、信息"></a>二、信息</h3><p>TCGA、GTEx、GEPIA2</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-06%2015-06-40_20220806070811424163.png"></p>
<h1 id="第四步、功能验证"><a href="#第四步、功能验证" class="headerlink" title="第四步、功能验证"></a>第四步、功能验证</h1><h3 id="一、实验-1"><a href="#一、实验-1" class="headerlink" title="一、实验"></a>一、实验</h3><p>敲减</p>
<p>过表达</p>
<h3 id="二、信息-1"><a href="#二、信息-1" class="headerlink" title="二、信息"></a>二、信息</h3><p>生存分析</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-06%2015-07-02_20220806070734328208.png"></p>
<h1 id="第五步、分子机制"><a href="#第五步、分子机制" class="headerlink" title="第五步、分子机制"></a>第五步、分子机制</h1><h3 id="一、序列变异"><a href="#一、序列变异" class="headerlink" title="一、序列变异"></a>一、序列变异</h3><h3 id="二、表观遗传"><a href="#二、表观遗传" class="headerlink" title="二、表观遗传"></a>二、表观遗传</h3><h3 id="三、转录调控"><a href="#三、转录调控" class="headerlink" title="三、转录调控"></a>三、转录调控</h3><p><em>TCGA等多组学关联分析</em></p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/%E6%88%AA%E5%B1%8F2022-07-22%2023.45.39_20220722154924866564.png" alt="不会缩放"></p>
]]></content>
      <categories>
        <category>转录组</category>
      </categories>
      <tags>
        <tag>R</tag>
      </tags>
  </entry>
  <entry>
    <title>OPPO R11 Plus 刷MIUI12.5</title>
    <url>/2022/07/23/015-oppo-r11-plus/</url>
    <content><![CDATA[<h1 id="一、刷入售后工程包，解锁BL"><a href="#一、刷入售后工程包，解锁BL" class="headerlink" title="一、刷入售后工程包，解锁BL"></a>一、刷入售后工程包，解锁BL</h1><h1 id="二、刷入TWRP，重启到REC"><a href="#二、刷入TWRP，重启到REC" class="headerlink" title="二、刷入TWRP，重启到REC"></a>二、刷入TWRP，重启到REC</h1><h1 id="三、刷入MIUI底层框架，重启到REC"><a href="#三、刷入MIUI底层框架，重启到REC" class="headerlink" title="三、刷入MIUI底层框架，重启到REC"></a>三、刷入MIUI底层框架，重启到REC</h1><p><em>安装带ROOT安卓8.1版本刷8.1框架</em></p>
<h1 id="四、刷入MIUI-12-5，重启到REC"><a href="#四、刷入MIUI-12-5，重启到REC" class="headerlink" title="四、刷入MIUI 12.5，重启到REC"></a>四、刷入MIUI 12.5，重启到REC</h1><p><em>刷入安卓8.1</em></p>
<h1 id="五、刷入Magisk-25-2-zip-重启到REC"><a href="#五、刷入Magisk-25-2-zip-重启到REC" class="headerlink" title="五、刷入Magisk_25.2.zip,重启到REC"></a>五、刷入Magisk_25.2.zip,重启到REC</h1><h1 id="六、刷入Xposed-zip-重启到系统"><a href="#六、刷入Xposed-zip-重启到系统" class="headerlink" title="六、刷入Xposed.zip,重启到系统"></a>六、刷入Xposed.zip,重启到系统</h1><h1 id="七、安装对应版本Magisk-Manager应用，Xposed等"><a href="#七、安装对应版本Magisk-Manager应用，Xposed等" class="headerlink" title="七、安装对应版本Magisk Manager应用，Xposed等"></a>七、安装对应版本Magisk Manager应用，Xposed等</h1>]]></content>
      <categories>
        <category>刷机</category>
      </categories>
      <tags>
        <tag>MIUI</tag>
      </tags>
  </entry>
  <entry>
    <title>海洋所科研人员绘制完成牡蛎全基因组序列图谱</title>
    <url>/2022/07/27/016-mu-li-quan-ji-yin-zu-tu-pu/</url>
    <content><![CDATA[<p>近日，牡蛎基因组计划（Oyster Genome Project，OGP）项目组宣布，历时两年的牡蛎基因组序列图谱终于绘制完成。这是世界上第一张养殖贝类的全基因组序列图谱，标志着基于短序列的高杂合度基因组拼接和组装技术获得了重大突破。据悉，目前的基因组图谱已达到国际领先的基因组图谱标准。</p>
<p>近年来，我国的海水养殖业取得了长足发展。根据资料显示，2007年全国水产养殖总产量已达到3490万吨，占世界水产养殖产量的70%，其中海水养殖产量为1384万吨，占到我国水产养殖产量的41%。我国海水养殖产量75%以上是贝类，贝类养殖产业规模和产量均居世界首位。而牡蛎作为贝类的“模式种”，一直受到科学家们的广泛关注。</p>
<p>鉴于国家海洋经济发展战略和现代生物学科的发展需求、牡蛎优越的经济价值及其潜在的基础研究价值，2008年5月，中国科学院海洋研究所研究员张国范博士和美国新泽西州立大学教授郭希明博士联合发起了牡蛎基因组计划，并以深圳华大基因研究院为首选科技合作伙伴，组成了一支以中国科学院海洋研究所为核心的国际牡蛎基因组研究团队。牡蛎基因组计划在科技部和大连獐子岛渔业集团股份有限公司的大力支持下完成。</p>
<h4 id="牡蛎——贝类的“模式种”"><a href="#牡蛎——贝类的“模式种”" class="headerlink" title="牡蛎——贝类的“模式种”"></a>牡蛎——贝类的“模式种”</h4><p>牡蛎俗称海蛎子、蚝等,隶属软体动物门，双壳纲，珍珠贝目，是世界上第一大养殖贝类，是人类可利用的重要海洋生物资源之一，为全球性分布种类。除了可食用外，牡蛎也是海洋生态系统的重要成员，对内湾和近海水域藻华的调控具有重要作用。此外，牡蛎在动物系统演化中还具有举足轻重的地位，是形态各异的冠轮动物的代表。作为海洋养殖年产量最大的动物类群，世界牡蛎年产量约为400多万吨。由于其分布广、经济和生态价值高，牡蛎受到广泛的关注，是研究最为充分的贝类，是贝类的“模式种”。</p>
<p>中国拥有丰富的牡蛎资源，是牡蛎的故乡，拥有利用牡蛎的悠久历史，早在两千多年前，中国南方沿海一些地区的居民就掌握了牡蛎养殖技术。目前，渤海、黄海、东海、南海均有牡蛎生产基地, 其主要产地为福建、广东、山东、广西、辽宁、浙江等。其中长牡蛎是最重要的养殖物种。</p>
<p>据了解，牡蛎在广东、福建称蚝或蚵，江浙称蛎黄，山东以北称蛎子或海蛎子。牡蛎不仅肉鲜味美、营养丰富, 而且具有独特的保健功能和药用价值，是一种营养价值很高的海产珍品，鲜蚝汤素有“海中牛奶”之称。牡蛎的含锌量居人类食物之首。古今中外均认为牡蛎有治虚弱、解丹毒、降血压、滋阴壮阳的功能。沿海居民对牡蛎具有深厚感情，很多沿海国家和地区都举办自己的牡蛎节，形成了独特的牡蛎文化。</p>
<p>随着牡蛎养殖产量的迅速增加，解决“如何高效利用牡蛎资源进行高值化开发利用，为人类提供理想的海洋食品及海洋药物”、“如何以细胞工程、基因工程和酶工程为手段进一步加强海洋生物技术的应用”、“如何开发海洋生物基因工程药物和细胞工程药物等相关产业的发展”等问题，对推动我国海洋产业的迅速发展具有极其重要的现实意义。</p>
<h4 id="一个物种基因组计划的完成，就意味着这一物种学科和产业发展的新开端"><a href="#一个物种基因组计划的完成，就意味着这一物种学科和产业发展的新开端" class="headerlink" title="一个物种基因组计划的完成，就意味着这一物种学科和产业发展的新开端"></a>一个物种基因组计划的完成，就意味着这一物种学科和产业发展的新开端</h4><p>基因是一种资源，而且是一种有限的战略性资源。因此，开发基因资源已成为发达国家之间激烈竞争的焦点之一。基因工程研究的基本任务是开发人们有特殊需要的基因产物，这样的基因统称为目的基因。具有优良性状的基因理所当然是目的基因，而致病基因在特定情况下同样可作为目的基因，具有很高的开发价值。即使是那些今天尚不清楚功能的基因，随着研究的深入，以后也都有可能成为具有高开发价值的目的基因。</p>
<p>21世纪是基因的世纪。随着科学技术的高速发展以及DNA内部结构和遗传机制的秘密一点一点呈现在人们眼前，生物学家不再仅仅满足于探索、揭示生物遗传的秘密，而是开始跃跃欲试，设想在分子的水平上去干预生物的遗传特性。以上种种又与基因组计划密不可分。</p>
<p>一个物种基因组的完成就意味着对这一物种生命密码天书进行人工编辑时代的到来。在现代分子生物学的定义中，基因组是生物体所携带的遗传信息总和。包括单倍体细胞核、细胞器或病毒粒子所含的全部DNA分子或RNA分子。基因组包含了DNA的基因区和非编码序列，是具有遗传效应的DNA分子片段，能够传递给下一代。人类基因组由30亿个碱基对组成，于2000年6月完成，是全人类的共同财富。国内外专家普遍认为，基因组序列图首次在分子层面上为人类提供了一份生命“说明书”，不仅奠定了人类认识自我的基石，推动了生命与医学科学的革命性进展，而且为全人类的健康带来了福音。2000年人类基因组草图完成时，仅42个物种完成了全基因组测序，但是，随着全基因组测序技术的快速发展以及全基因组测序对生物科学研究重大影响的推动，全世界的基因组测序计划数量快速增加。至2009年已增加至1100个，每年平均增加118个物种。2009年9月份统计的在测基因组项目达到4543个<a href="http://www.genomesonline.org/" title="*基因组在线数据库*"><em>基因组在线数据库</em></a>。</p>
<p>“一个物种基因组计划的完成，就意味着这一物种学科和产业发展的新开端”。经过多年奋斗，中国已是基因组研究的大国，华大基因作为人类基因组计划中国部分（1％）的主要完成者，先后独立完成了水稻、家蚕、家鸡等重要经济种类的基因组测序，并成为中国在国际基因组学领域的代表。</p>
<h4 id="新策略解决高杂合度基因组的序列拼接和组装"><a href="#新策略解决高杂合度基因组的序列拼接和组装" class="headerlink" title="新策略解决高杂合度基因组的序列拼接和组装"></a>新策略解决高杂合度基因组的序列拼接和组装</h4><p>蔚蓝色的海洋意味着博大，意味着深邃，但同样也意味着未知。</p>
<p>随着人类和模式生物基因组计划的实施，世界各国已经瞄准了这片神秘的蔚蓝，瞄准了海洋生物基因资源。目前多个海洋生物基因组计划的启动，为全面了解海洋生物基因、深入开发海洋生物基因资源奠定了良好的基础。</p>
<p>对于基因组测序来讲，牡蛎是一个全新的物种，没有相近物种的参考序列。牡蛎基因组测序选取的研究对象是染色体数目较少（2n=20）、基因组较小（约为800 M）的长牡蛎，这是目前测序物种中杂合度最高、拼接难度最大的物种。在研究之初，重重难题便摆在了项目组研究人员面前。测序利用的是4代近交纯化个体，理论上能降低60%以上的杂合度，但其杂合度之高还是项目组始料未及的。考虑到大熊猫基因组也是基于短序列高通量测序技术完成，而且牡蛎基因组远远小于大熊猫的基因组（大熊猫的基因组是2.4G，接近牡蛎基因组的3倍），牡蛎基因组项目启动时，曾计划借鉴大熊猫的测序和拼接策略，但是，在具体实施过程中，项目组发现牡蛎基因组的高杂合度导致仅仅依靠大熊猫的测序策略根本不能完成拼接工作，这使得项目曾一度停滞不前。</p>
<p>柔绳断木，水滴穿石。在项目组的共同坚持和努力下，研究人员针对牡蛎基因组的高杂合度问题，及时调整了项目整体思路，特别是华大基因科研团队为此开发了针对高杂合度基因组的短序列片段拼接新算法，开辟了分级组装新手段，使难题最终得到圆满解决。这也为正在进行和将来要开展的高杂合度物种的基因组测序提供了全新的方法和技术。</p>
<h4 id="基因组数据全面提供解析牡蛎典型性状的组学基础"><a href="#基因组数据全面提供解析牡蛎典型性状的组学基础" class="headerlink" title="基因组数据全面提供解析牡蛎典型性状的组学基础"></a>基因组数据全面提供解析牡蛎典型性状的组学基础</h4><p>牡蛎基因组由8亿个碱基对组成，大约包含2万个基因。从初步分析来看，基因组数据支持了海洋低等生物具有高度遗传多样性的结论。</p>
<p>此外，目前已验证的109种锌指蛋白结构域在牡蛎基因组中均有发现，并且在整个基因组中所占的比例远远超过人类。这为解释牡蛎含锌量高的特点提供了基因组水平的线索。然而，这仅是对基因组进行初步探索的发现，随着研究的一步步深入，将会有更多的科学发现展现在世人眼前。</p>
<p>随着牡蛎基因组数据的深入发掘，有可能为有效改变牡蛎的生活习性，使其能够更好地为人类所利用提供更广阔的技术思路。例如，自然状态下的牡蛎会固着在船舶和管道表面，造成船舶阻力增加、管道堵塞等，这种特性使牡蛎被列为海洋污损生物之一。通过搜寻牡蛎基因组有望能够发现牡蛎附着变态调控通路中的关键受体，寻找经济有效的药物，诱导牡蛎幼虫跳过附着过程，直接发生变态而成为单体牡蛎，这个问题便迎刃而解。该问题的解决，将极大地有利于我们的经济和国防。</p>
<p>牡蛎是海洋潮起潮落中的王者。一般分布在潮间带和潮下带水深不超过10米的范围内。牡蛎还是抗逆性最强的水生动物之一，2亿年来潮间带多变的环境练就了牡蛎对温度、盐度、露空和海区常见病原极强的抵抗能力，在落潮露出水面时，能够耐受夏天酷热干燥的天气，同时也能够成功适应冬天冰冻天气，在离水露空条件下可存活1~2周，甚至1个月的时间。牡蛎高超的生存能力源于其内在的修为——完善的免疫防御机制，这些生物学特性在研究物种抗逆机理方面具有极高价值。</p>
<p>作为软体动物门的典型物种，在生物进化的大树上远远比天上的飞鸟，陆地的爬虫和徜徉海底漂亮的热带鱼类低等得多，但为什么牡蛎却能适应复杂多变的潮间带生活环境呢？</p>
<p>虽然没有进化出高等动物那样完善的获得性免疫，但牡蛎将天然免疫的功效发挥到极致，种类繁多，数量扩张的模式识别受体能够针对不同病原的保守位点作出准确的反应并通过信号级联放大对效应分子进行总动员，进而将病原挡在门外。谷胱甘肽氧化酶、糖原磷酸化酶、金属硫蛋白、热激蛋白等硕大的防御相关基因数目更是确保了牡蛎在对温度、盐度和氧气浓度的广谱耐受性。尽管拥有着高效的防御系统，养殖牡蛎因病原侵染造成大面积死亡的现象也并不鲜见，研究牡蛎的免疫防御机制也为养殖牡蛎的病害防治提供理论基础。另一方面，有些牡蛎对病原和重金属有较强的耐受能力，但是能够富集这些病原和物质，这种牡蛎被人类食用后便会引发疾病，广为人知的诺如病毒感染性腹泻便是由富集在牡蛎体内的诺如病毒引起的。牡蛎基因组的测序给广大科研工作者提供了一个从基因组水平上解析牡蛎免疫防御机制的平台，也为人类的饮食健康和食品安全提供了保障。</p>
<p>牡蛎的性别反转是令人非常感兴趣的科学问题。在自然群体中，大多数牡蛎个体属于雌雄异体，小部分为雌雄同体，牡蛎还可以自发“变性”，同一个个体在不同年份或不同的环境条件下，表现出不同的性别。牡蛎的性别决定调控机制是最令世界各国科学家感兴趣的课题之一，已有研究发现这可能和某个主效基因有关，雄性个体表现为异型配子形式，牡蛎基因组图谱的完成，有望为找到这个基因提供有力线索。此外，在某一海域，如江苏南通、福建厦门等海区，经常有许多不同种类的牡蛎生活在一起，它们的繁殖季节存在交叠，但是不同牡蛎之间一般不会发生杂交，牡蛎如何保证自己的精子和卵子细胞相互“专一”识别？研究发现牡蛎精子结合素蛋白Bindin可能与精卵的特异性识别有关，借助基因组数据对Bindin的种内和种间多态性和卵膜受体进行深入研究，可以阐明不同牡蛎生殖隔离的作用机制。</p>
<p>牡蛎超强的繁殖能力也是人们津津乐道的一个话题。据统计，一只雌性牡蛎在一个繁殖季节可以生产出高达4亿的卵细胞，而牡蛎的性腺只在繁殖季节才充分发育，牡蛎也仅仅依靠海洋中的微型海藻和有机碎屑为食，牡蛎为什么有如此令人称奇的生殖能力，这和牡蛎基因组的高度杂合有哪些潜在的关系，通过全基因组序列测定和分析或许可以为科研工作者深入探索这个科学问题提供线索。</p>
<p>随着牡蛎基因组的进一步注释，结合牡蛎转录组、小RNA、表观遗传学和系统生物学的研究，使科研工作者可以建立一个窗口，“从内向外”地观察牡蛎的各种生物学性状及其与环境的互作，全面解析牡蛎高繁殖力、高耐受力、高杂合性等生物学特性，研究杂种优势、物种分化和性别决定、高突变率及高遗传负荷、附着变态等组学机制，搭建基因组育种理论研究和技术平台，提升贝类和海洋基因组学研究水平，促进贝类养殖产业健康和可持续发展。</p>
<p>国际牡蛎基因组研究团队有关负责人表示，牡蛎全基因组序列图谱的绘制完成，将有力地推进基因组应用技术的发展。</p>
<p>李宁院士指出：“未来农业生物育种就将是基因组育种”。传统的育种主要依赖于表型性状进行定向选择。这种育种方式为人类提供了大量食物，是当前育种的最常规途径。但常规育种存在着周期长、准确性低、材料维护困难等问题，这些问题是一直困扰着育种学家的难题，且常规育种难以满足未来差异化市场发展的需求。随着分子生物学技术的发展，近些年又发展出了分子标记辅助育种，从技术上得到新的进步。然而由于可用的有效标记数太少，所以育种效率很低，至今仍很少见到有实际应用的报道。全基因组序列图谱的绘制完成，将使这些问题得到有效的解决。</p>
<p>国际牡蛎基因组研究团队有关负责人介绍说，由于有了全基因组序列，科研工作者可以通过数以万记的SNP直接对基因进行选择，将大大提高选择效率；由于有了全基因组序列，可以更加有效地研究不同性状的调控通路，为科研工作者对这些性状进行有效操控提供了理论支持和技术可能；由于有了全基因组序列，使科研工作者有可能在分子水平对生物的目标性状进行预先设计。</p>
<h4 id="政企研结合共推基因组计划发展"><a href="#政企研结合共推基因组计划发展" class="headerlink" title="政企研结合共推基因组计划发展"></a>政企研结合共推基因组计划发展</h4><p>牡蛎基因组计划瞄准海洋生物领域的关键科学和技术问题，具有前瞻性、创新性和重要的现实意义，是一个系统的科学工程，内容多、任务重、投入大，需要政企研的通力合作。在牡蛎全基因组序列图谱绘制完成的过程中，国际牡蛎基因组研究团队得到了科技部、中国科学院和獐子岛渔业集团的大力支持，是政企研合作的又一杰出成果。</p>
<p>獐子岛渔业集团是一家以海水增养殖为主的，集海珍品育苗、增养殖、加工、贸易、海上运输于一体的综合性海洋食品企业。作为农业产业化龙头企业，集团一直致力于科技创新，倡导并实践了“政府+ 科研机构+公司”的合作模式，与中国科学院海洋研究所建立了长期稳定的战略合作关系。多年来，双方强强联合，开展院地合作，取得了一个又一个丰硕的成果。</p>
<p>牡蛎基因组测序的完成开启了海洋贝类基因资源发掘之门，对产业的长期可持续发展具有重要作用。獐子岛渔业集团有关负责人表示，在发展的过程中，集团深刻认识到科技对产业发展的巨大推动作用和基因资源对于产业可持续发展的重要性。獐子岛渔业集团重资支持牡蛎基因组的研究，是集团从国家需求、产业发展的高度，从自身战略发展需求的角度作出的重要决定。集团对牡蛎基因组计划的后续研究与未来的产品研发充满了信心。</p>
<p>一个研究成果的诞生离不开团队，更离不开团队身后的庞大力量。牡蛎全基因组序列图谱的成功绘制，倾注着众多科研工作者的共同心血。</p>
<p>牡蛎基因组计划得到了唐启升院士、朱作言院士、杨焕明院士、徐洵院士、向仲怀院士、李宁院士、刘瑞玉院士、张福绥院士以及相建海研究员、王清印研究员等专家的关心与指点，得到了大连獐子岛渔业集团吴厚刚董事长和王诗欢总经理的热心支持。</p>
<p>华大基因研究院所展现出的科研攻关精神与技术创新能力，在克服重重困难最终完成高杂合度牡蛎基因组的成功组装中，发挥了关键作用，为项目取得突破性进展提供了重要的技术保障，得到了以中国科学院海洋研究所为核心的国际牡蛎基因组研究团队的高度评价与一致赞赏。</p>
<p>正是聚集了这些支持与帮助，汇八方之力，牡蛎基因组计划迎来了更快的发展。</p>
<h4 id="基因引领未来"><a href="#基因引领未来" class="headerlink" title="基因引领未来"></a>基因引领未来</h4><p>基因资源是国家战略资源。当前各国在生物产业链方面的意识空前提高，通过整合产业资源、完善产业链条、抢占产业上游的龙头，以谋求对产业链的掌控和垄断。因此，谁能够抢占了上游的龙头——基因资源，谁就将在生物产业竞争中占有主导地位。</p>
<p>人类基因组计划的完成，极大地鼓舞了世界各国的生物专家，并为其他生物的研究提供了强大的技术支持。牡蛎全基因组序列图谱绘制的完成，也将极大地推动科学家对以牡蛎为代表的贝类乃至其他水产动物，特别是海产无脊椎动物基因资源的有效开发和深度利用研究。总之，牡蛎全基因组测序图谱的绘制完成为海洋贝类基因开发和应用铺设了坚实的道路。</p>
<h4 id="随着水产基因组时代的到来，我国的科研工作者在对基因资源的深度发掘和利用应集中在以下几个方面。"><a href="#随着水产基因组时代的到来，我国的科研工作者在对基因资源的深度发掘和利用应集中在以下几个方面。" class="headerlink" title="随着水产基因组时代的到来，我国的科研工作者在对基因资源的深度发掘和利用应集中在以下几个方面。"></a>随着水产基因组时代的到来，我国的科研工作者在对基因资源的深度发掘和利用应集中在以下几个方面。</h4><p>一是基于牡蛎全基因组序列图谱，结合比较基因组学研究，对基因组进行深度解析，了解牡蛎等贝类基因组结构和功能特征。</p>
<p>二是批量发掘生长、发育、生殖、性控、贝壳形成和抗逆性等重要性状相关功能基因，为深入开展贝类生物学基础研究提供基因资源。</p>
<p>三是对重要经济性状进行基因解析，筛选和验证生长、发育、抗性等关键基因，研究其作用机理和调控网络，明确基因型与表型关联性，为性状改良和品种培育提供理论基础。</p>
<p>四是研究分子设计育种的理论和方法，分析基因、调控网络对环境的反应，建立G-P链接模型和数据库，开发生长和抗性性状的复合/聚合技术，构建模拟育种技术平台。</p>
<p>五是开发编码具有特殊营养或应用价值的多肽和蛋白基因，筛选水产动物特有的具有自主知识产权的药物功能基因或药物合成相关的功能基因，为批量生产功能多肽和蛋白及研制开发新型海洋药物奠定基础。</p>
<p>2009年，胡锦涛总书记视察山东时指出，要大力发展海洋经济，科学开发海洋资源，培育海洋优势产业，打造山东半岛蓝色经济区。这是胡锦涛总书记站在全局高度作出的重大战略部署。进入新的世纪，在陆地资源日益枯竭的今天，人类社会在空间、资源、环境、技术、产业等方面，对海洋提出了新的要求，谁抢占了海洋科技的制高点，谁就率先占领了海洋空间，谁就控制了未来的战略资源，占地球表面积71%的海洋成为了新的经济增长点，也成为了人类新的生存空间。</p>
<p>大风起兮云飞扬，千帆竞过浪潮涌。以牡蛎基因组计划为契机的海洋基因资源研发必将成为蓝色经济发展的强大引擎，引领蓝色经济走向更加辉煌的明天！</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/W020100802375780882489.jpg" alt="img"></p>
<p>牡蛎基因组部分序列及其分析</p>
<p><a href="http://www.cas.cn/ky/kyjz/201008/t20100802_2916092.shtml#:~:text=%E7%89%A1%E8%9B%8E%E5%9F%BA%E5%9B%A0%E7%BB%84%E7%94%B18%E4%BA%BF%E4%B8%AA%E7%A2%B1%E5%9F%BA%E5%AF%B9%E7%BB%84%E6%88%90%EF%BC%8C%E5%A4%A7%E7%BA%A6%E5%8C%85%E5%90%AB2%E4%B8%87%E4%B8%AA%E5%9F%BA%E5%9B%A0%E3%80%82,%E4%BB%8E%E5%88%9D%E6%AD%A5%E5%88%86%E6%9E%90%E6%9D%A5%E7%9C%8B%EF%BC%8C%E5%9F%BA%E5%9B%A0%E7%BB%84%E6%95%B0%E6%8D%AE%E6%94%AF%E6%8C%81%E4%BA%86%E6%B5%B7%E6%B4%8B%E4%BD%8E%E7%AD%89%E7%94%9F%E7%89%A9%E5%85%B7%E6%9C%89%E9%AB%98%E5%BA%A6%E9%81%97%E4%BC%A0%E5%A4%9A%E6%A0%B7%E6%80%A7%E7%9A%84%E7%BB%93%E8%AE%BA%E3%80%82%20%E6%AD%A4%E5%A4%96%EF%BC%8C%E7%9B%AE%E5%89%8D%E5%B7%B2%E9%AA%8C%E8%AF%81%E7%9A%84109%E7%A7%8D%E9%94%8C%E6%8C%87%E8%9B%8B%E7%99%BD%E7%BB%93%E6%9E%84%E5%9F%9F%E5%9C%A8%E7%89%A1%E8%9B%8E%E5%9F%BA%E5%9B%A0%E7%BB%84%E4%B8%AD%E5%9D%87%E6%9C%89%E5%8F%91%E7%8E%B0%EF%BC%8C%E5%B9%B6%E4%B8%94%E5%9C%A8%E6%95%B4%E4%B8%AA%E5%9F%BA%E5%9B%A0%E7%BB%84%E4%B8%AD%E6%89%80%E5%8D%A0%E7%9A%84%E6%AF%94%E4%BE%8B%E8%BF%9C%E8%BF%9C%E8%B6%85%E8%BF%87%E4%BA%BA%E7%B1%BB%E3%80%82" title="海洋所科研人员绘制完成牡蛎全基因组序列图谱">原文链接</a></p>
]]></content>
      <categories>
        <category>基因组</category>
      </categories>
      <tags>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>中国科学院海洋所在牡蛎基因组编辑方面获进展</title>
    <url>/2022/07/27/017-mu-li-ji-yin-zu-bian-ji/</url>
    <content><![CDATA[<p>近日，中国科学院海洋研究所实验海洋生物学重点实验室张琳琳团队在牡蛎基因组编辑方面获新进展。相关研究成果发表在Frontiers in Marine Science（<em>DOI：10.3389/fmars.2022.912409</em>）上。</p>
<p>随着高品质动物蛋白需求的增长，水产养殖正成为人类食用海产品的主要来源。与许多成熟的陆生牲畜和作物系统相比，多数水产养殖物种育种仍处于驯化的早期阶段。传统的育种方式如选择、杂交和标记辅助育种系统，推进了水产养殖物种经济性状（包括抗病性、营养价值和生长质量等）的遗传改良。基因组编辑技术是近年来探索基因功能和解析性状直接有效的方法，其中CRISPR/Cas9基因编辑技术具有操作简单、靶点选择广、成本低、效率高等优点，为重要水产物种经济性状的遗传解析和良种培育提供了有力工具。</p>
<p>牡蛎为世界大宗水产养殖贝类，而与水产鱼类相比，基因组编辑育种技术在牡蛎中应用尚处于起步阶段。针对牡蛎卵径小（~50 μm）、显微操作难、幼虫死亡率高、间接发育时间时间长以及在获得可遗传纯系方面难度大、成本高、耗时长的难题，张琳琳团队经过长期研究攻关，搭建了一套基于电穿孔的Cas9/sgRNA复合物高通量递送和突变体快速检测的技术平台，实现了对牡蛎（Crassostrea gigas angulate）基因组中标记基因（β-tubulin）的高效编辑。</p>
<p>研究采用前期研发的“长片段缺失镶嵌性突变技术”（Zhang L., et al, 2016, Nature Communications；Zhang L., et al., 2017, PNAS）。通过同时电穿孔多个靶基因sgRNAs，研究在长牡蛎靶向基因中检测到超过300 bp的长片段缺失突变，使研究可以使用PCR和常规琼脂糖凝胶电泳对突变体进行快速筛选和基因分型。这种同时传递两个以上sgRNAs以获得长片段缺失的策略是显著的改进，简化了基因组编辑基因型检测的工作流程。此外，利用原位杂交和行为学分析等表型检测手段，研究在牡蛎G0代幼虫中观察到表型的镶嵌型突变（纤毛的缩短、缺失）和运动能力下降。这种镶嵌型突变有利于探究在G0代个体中对突变表型进行快速鉴别，同时能规避目标基因完全缺失导致的胚胎致死性。该研究在海洋经济贝类牡蛎中建立了基于电穿孔和长片段缺失镶嵌性突变的CRISPR/Cas9基因编辑平台，可为今后基于CRISPR/Cas9基因组编辑技术在海洋贝类中开展基因功能研究提供有益参考，并为牡蛎以及其他水产养殖物种的基因组编辑育种提供有力工具。</p>
<p>研究工作得到山东省“海洋生命资源绿色发展技术与应用”工作站、中科院战略性先导科技专项（B类）和国家海外引才计划青年项目等的支持。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/W020220620393411496149.jpg" alt="img"></p>
<h6 id="基于电穿孔的CRISPR-Cas9基因编辑系统和突变表型快速检测平台示意图"><a href="#基于电穿孔的CRISPR-Cas9基因编辑系统和突变表型快速检测平台示意图" class="headerlink" title="基于电穿孔的CRISPR/Cas9基因编辑系统和突变表型快速检测平台示意图"></a>基于电穿孔的CRISPR/Cas9基因编辑系统和突变表型快速检测平台示意图</h6><p><img src="https://www.cas.cn/syky/202206/W020220620393502040349.jpg" alt="img"></p>
<h6 id="CRISPR-Cas9系统介导的长牡蛎β-tubulin基因的长片段缺失"><a href="#CRISPR-Cas9系统介导的长牡蛎β-tubulin基因的长片段缺失" class="headerlink" title="CRISPR/Cas9系统介导的长牡蛎β-tubulin基因的长片段缺失"></a>CRISPR/Cas9系统介导的长牡蛎β-tubulin基因的长片段缺失</h6><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/W020220620393578486192.jpg" alt="img"></p>
<h6 id="CRISPR-Cas9系统介导的长牡蛎镶嵌型突变的纤毛表型"><a href="#CRISPR-Cas9系统介导的长牡蛎镶嵌型突变的纤毛表型" class="headerlink" title="CRISPR/Cas9系统介导的长牡蛎镶嵌型突变的纤毛表型"></a>CRISPR/Cas9系统介导的长牡蛎镶嵌型突变的纤毛表型</h6><p><a href="https://www.cas.cn/syky/202206/t20220606_4836984.shtml" title="中国科学院海洋所在牡蛎基因组编辑方面获进展">阅读原文</a></p>
]]></content>
      <categories>
        <category>基因组</category>
      </categories>
      <tags>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>中国科学院海洋所构建完成长牡蛎染色体水平基因组和变异图谱</title>
    <url>/2022/07/27/018-chang-mu-li-bian-yi-tu-pu/</url>
    <content><![CDATA[<p>近日，由中科院海洋所张国范研究组独立完成的论文“Construction of a chromosome-level genome and variation map for the Pacific oyster Crassostrea gigas（长牡蛎染色体水平基因组和变异图谱构建）”在国际学术期刊Molecular Ecology Resources（《分子生态资源》）在线发表。该研究首次构建了长牡蛎染色体水平基因组和贝类中第一张包含SNP、INDEL和CNV的综合序列变异图谱，发现长牡蛎基因组中存在高比例的长片段重复序列，CNV结构变异可导致个体间平均21%的区域差异，更新了长牡蛎基因组资源和对基因组复杂性的认知。 </p>
<p>　　长牡蛎(Crassostrea gigas)，俗称太平洋牡蛎，是世界重要的养殖贝类，具有重要的经济和生态价值。张国范研究组长期从事贝类养殖和育种相关工作，并一直致力于牡蛎基因资源挖掘和分子育种研究。2012年在Nature发表的牡蛎第一张基因组图谱得到广泛应用，引领并开启了水产物种基因组学相关研究。张国范研究组之后一直对牡蛎基因资源进行维护和更新。随着新一代测序技术的普及和对长牡蛎染色体水平基因组需求的增加，研究组于2019年正式启动长牡蛎染色体水平基因组构建工作。 </p>
<p>　　本研究利用高覆盖第三代测序(PacBio，~200×)结合HIC技术，并利用遗传连锁图谱进行辅助，对一个中国青岛的长牡蛎进行从头组装，获得基因组总长度为587M，包含10条染色体水平scaffold序列，ContigN50达到3.1M，ScaffoldN50达到60M，组装完整性和连续性均有较大提高。发现基因组中高比例的长片段重复在基因进化中发挥了重要作用，同时也是导致之前基于二代测序技术组装的长牡蛎基因组碎片化的主要原因。基于495个野生长牡蛎的重测序数据分析，构建了长牡蛎综合变异图谱，包含480万个高质量SNP，60万个INDEL和4.9万个CNV。这些新的数据资源对牡蛎比较基因组学、分子育种和适应进化等研究具有重要意义。美国南加州大学Dennis Hedgecock教授团队成员Xiaoshen Yin博士对该基因组进行了分析，发现和连锁图谱一致性达到90%以上，明显的组装错误不到0.1%，肯定了其较高的组装质量(Yin et al, 2020)。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/9d425ff3112e40209dec2f6d4402c1fd.png" alt="img"></p>
<h6 id="长牡蛎基因组序列图谱"><a href="#长牡蛎基因组序列图谱" class="headerlink" title="长牡蛎基因组序列图谱"></a>长牡蛎基因组序列图谱</h6><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/99541f9189404b44a250c5bfe3313b6c.png" alt="img"></p>
<h6 id="长牡蛎基因组变异图谱"><a href="#长牡蛎基因组变异图谱" class="headerlink" title="长牡蛎基因组变异图谱"></a>长牡蛎基因组变异图谱</h6><p>　　本研究得到国家自然科学基金、山东省科技创新重大专项、中科院海洋大科学研究中心重点部署项目、国家贝类产业技术体系专项基金等资助。中科院海洋所高性能计算中心对部分生物信息分析提供了技术支持。亓海刚副研究员为论文第一作者，李莉研究员和张国范研究员为通讯作者。 </p>
<p>　　论文链接：<a href="http://onlinelibrary.wiley.com/doi/abs/10.1111/1755-0998.13368" title="onlinelibrary.wiley.com/doi/abs/10.1111/1755-0998.13368">onlinelibrary.wiley.com/doi/abs/10.1111/1755-0998.13368</a>。</p>
]]></content>
      <categories>
        <category>基因组</category>
      </categories>
      <tags>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>基因组组装</title>
    <url>/2022/07/27/019-ji-yin-zu-zu-zhuang/</url>
    <content><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>基因组组装(Genome assembly)是生物信息学领域的核心问题，基因组组装就是把序列测序产生的读取片段reads经过序列拼接组装，生成基因组的碱基序列。基因组组装软件可根据得到的所有读长组装成基因组。基因组组装这个步骤对于基因组分析是十分关键的，因为目前二代测序技术获得的测序序列一般都较短，需要组装拼接成较长的完整的序列用于进一步分析，例如长序列能提高物种注释分析的准确性。</p>
<p>宏观来说，基因组组装可以分为从头组装(De novo assembly) 和映射比对组装(mapping assembly), 从头组装是指不需要依靠任何已知的基因组信息，反过来，映射比对组装就是需要把测序序列和参考基因组来比对，找到序列的对应位置再进行组装，本文主要讲解的从头组装。 当然两种都有各个的用处，映射比对组装也有一些算法例如BWT算法。</p>
<p>由于目前组装技术的限制和实际情况的复杂性，最终组装得到的序列与真实基因组序列之间仍可能存在差异，甚至只能得到若干条无法进一步连接起来的序列。对组装效果的评价主要依由于据组装序列的连续性、完整性和准确性。连续性要求组装得到的（多条）序列长度尽可能长；完整性要求组装序列的总长度占基因组序列长度的比例尽可能大；准确性要求组装序列与真实序列尽可能符合。</p>
<p>目前基因组组装一般有基于OLC(Overlap-Layout-Consensus, 先重叠后扩展)和基于De Brujin Graph(DBG)两种组装算法，基于OLC的组装方法适合长序列组装，运行依赖的数据结构需要消耗大量的内存，且运行速度比较慢，错误率高，而DBG组装方法内存消耗相对较低，运算速度快，且准确率高。目前主流的基因组装算法都是基于后者改进设计的。</p>
<h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>在开始之前，有几个名词需要说明下：</p>
<p>reads：就是我们测序产生的短读序列，通常一代和三代的reads读长在几千到几万bp之间，二代的相对较短，平均是几十到几百bp。</p>
<p>contig：中文叫做重叠群，就是不同reads之间的overlap交叠区，拼接成的序列就是contig</p>
<p>scaffold:这是比contig还要长的序列，获得contig之后还需要构建paired-end或者mate-pair库，从而获得一定片段的两端序列，这些序列可以确定contig的顺序关系和位置关系，最后contig按照一定顺序和方向组成scaffold，其中形成scaffold过程中还需要填补contig之间的空缺。</p>
<p><img src="/images/v2-f9a1759747a90750e705354ea59d57f5_720w.jpg"></p>
<h3 id="基于OLC算法"><a href="#基于OLC算法" class="headerlink" title="基于OLC算法"></a>基于OLC算法</h3><p>OLC组装算法主要这么对一代和三代测序序列因为他们的reads读长相对较长。OLC算法的整体步骤可以分为三步：</p>
<p>Overlap：对所有reads进行两两比对，找到片段间的重叠信息，一般在比对之前会将reads做下索引，减少计算量。这里需要设定最小重叠长度，如果两个read的最小重叠长度低于一定阈值，那么可以认为两段序列顺序性较差。</p>
<p>Layout：根据得到的重叠信息将存在的重叠片段建立一种组合关系，形成重叠群，即Contig。Contig进一步排列，生成多个较长的scaffold.</p>
<p>根据构成Contig的片段的原始质量数据，在重叠群中寻找一条质量最重的序列路径，并获得与路径对应的序列，即Consensus。通过Consensus的多序列比对算法，就可以获得最终的基因组序列。</p>
<p><img src="/images/v2-6bca24193c62ea94ae4e7c463594d52e_720w.jpg"></p>
<h3 id="基于DBG算法"><a href="#基于DBG算法" class="headerlink" title="基于DBG算法"></a>基于DBG算法</h3><p>基于DBG基因组装算法原理图如下：</p>
<p>详细的步骤如下：</p>
<p><img src="/images/v2-cf3419bfff19b276137e4712ab31f7cc_720w.jpg"></p>
<p>序列k-mer化：对需要测序的片段等大小拆分，即将reads 逐个碱基切分为长度为K的子序列。例如我们的K取3，那么序列ACGTCGA就会被拆分成5个子序列分别是：ACG, CGT, GTC, TCC, CGA。</p>
<p>de Brujin图构建：de Brujin图是一种有向图，我们将k-mers得到的子序列作为图的节点，如果两个节点有 K-1个共同重叠子集，就把两个节点连接在一起，这样一定程度上已经能够展现出序列的顺序信息了，例如：</p>
<p><img src="/images/v2-d657a68af27007b1ee2582658e03550d_720w.jpg"></p>
<p>从上面的两个序列得到的de Brujin图可以知道，红色部分为高频的子序列，而绿色的为相对低频的子序列。</p>
<ol>
<li><p>图结构简化：这里主要简化结构的以下方面:</p>
</li>
<li><p>去除低频和低覆盖率的k-mer</p>
</li>
<li><p>将小的重复对解开，让每个节点的入度和出度都为1</p>
</li>
<li><p>将相似性较高的k-mers合并，也就是bubbles合并成单链</p>
</li>
</ol>
<p><img src="/images/v2-27278ef2a316eace4f8bb906c55882c8_720w.png"></p>
<p>网上有个小哥总结这几个还是不错的</p>
<p>测序错误产生的分支：</p>
<p><img src="/images/v2-616058a6aa3e1eb9bafd5e8213e7097b_720w.jpg"></p>
<p>SNP导致的bubble结构：</p>
<p><img src="/images/v2-46069f53a4842707a871fcb6d7ef855e_720w.jpg"></p>
<p>reads序列重复导致的bubble：</p>
<p><img src="/images/v2-10de4293e4c302091cf47ad0d68b11ab_720w.jpg"></p>
<p>contigs拆分：通过read的配对末端（pair-end）和环化配对（mate-pair）信息去除一些环结构，最后把一些无法合并的分叉结构再次拆分成多个contigs：</p>
<p><img src="/images/v2-a5c9cad0cb03114e2f598ed791b99a7a_720w.jpg"></p>
<p>scaffold构建：这个过程和OLC的比较类似，也是通过contig两端的pair的序列信息，将多个contig连接成scaffold.同时将contig之间的GAP填充，补充方式是通过已经组装的contigs之间的覆盖关系来补充，形成多个没有空缺的scaffold。</p>
<p>最终组装：最终是把多个scaffold组装成无GAP的基因组序列。</p>
]]></content>
      <categories>
        <category>基因组</category>
      </categories>
      <tags>
        <tag>转载</tag>
      </tags>
  </entry>
  <entry>
    <title>Python爬取bing主页壁纸</title>
    <url>/2022/08/01/020-python-pa-qu-bing-zhu-ye-bi-zhi/</url>
    <content><![CDATA[<h3 id="一、爬取代码"><a href="#一、爬取代码" class="headerlink" title="一、爬取代码"></a>一、爬取代码</h3><h6 id="突然想给博客换个轮播图"><a href="#突然想给博客换个轮播图" class="headerlink" title="突然想给博客换个轮播图"></a>突然想给博客换个轮播图</h6><h6 id="百度搞起-smile"><a href="#百度搞起-smile" class="headerlink" title="百度搞起:smile:"></a>百度搞起<span class="github-emoji"><span>😄</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></h6><pre class="line-numbers language-none"><code class="language-none">import requests

import json


def Get_picUrl():

url = "https://cn.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1"

con = requests.get(url=url)

content = json.loads(con.text)

imgUrl = 'https://cn.bing.com' + content['images'][0]['url']

response = requests.get(imgUrl)

if str(response) != '':

imgUrl = '../static/img/temp/lunbo3.jpg'

return imgUrl


i = Get_picUrl()

imgUrl = ''''

print(imgUrl)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="根据需要自己修改"><a href="#根据需要自己修改" class="headerlink" title="根据需要自己修改"></a>根据需要自己修改</h5><h3 id="二、遇到的问题"><a href="#二、遇到的问题" class="headerlink" title="二、遇到的问题"></a>二、遇到的问题</h3><h6 id="lxml中etree找不到，暂时未解决"><a href="#lxml中etree找不到，暂时未解决" class="headerlink" title="lxml中etree找不到，暂时未解决"></a>lxml中etree找不到，暂时未解决</h6><h3 id="三、加入到Django中"><a href="#三、加入到Django中" class="headerlink" title="三、加入到Django中"></a>三、加入到Django中</h3><h5 id="1-django中的render"><a href="#1-django中的render" class="headerlink" title="1. django中的render"></a>1. django中的render</h5><h6 id="context在Django里表现为-Context-类，在-django-template-模块里。-它的构造函数带有一个可选的参数："><a href="#context在Django里表现为-Context-类，在-django-template-模块里。-它的构造函数带有一个可选的参数：" class="headerlink" title="context在Django里表现为 Context 类，在 django.template 模块里。 它的构造函数带有一个可选的参数："></a>context在Django里表现为 Context 类，在 django.template 模块里。 它的构造函数带有一个可选的参数：</h6><h6 id="一个字典映射变量和它们的值。-调用-Template-对象-的-render-方法并传递context来填充模板："><a href="#一个字典映射变量和它们的值。-调用-Template-对象-的-render-方法并传递context来填充模板：" class="headerlink" title="一个字典映射变量和它们的值。 调用 Template 对象 的 render() 方法并传递context来填充模板："></a>一个字典映射变量和它们的值。 调用 Template 对象 的 render() 方法并传递context来填充模板：</h6><pre class="line-numbers language-none"><code class="language-none">from django.template import Context, Template 

t = Template('My name is {{ name }}.') 

c = Context({'name': 'Stephane'}) 

t.render(c) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> u’My name is Stephane.’</p>
<h6 id="在views-py中"><a href="#在views-py中" class="headerlink" title="在views.py中:"></a>在views.py中:</h6><p> <code>return render(request, 'blog_add.html', {'blog': blog, 'form': form, 'id': id, 'tag': tag})</code></p>
<h5 id="2-django中的render-to-response"><a href="#2-django中的render-to-response" class="headerlink" title="2. django中的render_to_response"></a>2. django中的render_to_response</h5><p> <code>return render_to_response('blog_add.html', {'blog': blog, 'form': form, 'id': id, 'tag': tag})</code></p>
<h6 id="很明显，如果使用render-to-response就省去了render里传递的request。"><a href="#很明显，如果使用render-to-response就省去了render里传递的request。" class="headerlink" title="很明显，如果使用render_to_response就省去了render里传递的request。"></a>很明显，如果使用render_to_response就省去了render里传递的request。</h6><h6 id="3-locals-用法：locals-可以直接将函数中所有的变量全部传给模板。当然这可能会传递一些多余的参数，有点浪费内存的嫌疑。"><a href="#3-locals-用法：locals-可以直接将函数中所有的变量全部传给模板。当然这可能会传递一些多余的参数，有点浪费内存的嫌疑。" class="headerlink" title="3.locals()用法：locals()可以直接将函数中所有的变量全部传给模板。当然这可能会传递一些多余的参数，有点浪费内存的嫌疑。"></a>3.locals()用法：locals()可以直接将函数中所有的变量全部传给模板。当然这可能会传递一些多余的参数，有点浪费内存的嫌疑。</h6>]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>爬虫</tag>
      </tags>
  </entry>
  <entry>
    <title>基因组组装（二）</title>
    <url>/2022/08/04/021-ji-yin-zu-zu-zhuang-er/</url>
    <content><![CDATA[<h1 id="二代测序基因组组装"><a href="#二代测序基因组组装" class="headerlink" title="二代测序基因组组装"></a>二代测序基因组组装</h1><h2 id="一、数据下载"><a href="#一、数据下载" class="headerlink" title="一、数据下载"></a>一、数据下载</h2><h3 id="1-两种数据格式"><a href="#1-两种数据格式" class="headerlink" title="1.两种数据格式"></a>1.两种数据格式</h3><p>1.frag_x.fastq –&gt; 不超过100bp</p>
<p>2.shortjump_x.fastq –&gt; 不超过37bp</p>
<h6 id="raw-data"><a href="#raw-data" class="headerlink" title="==> raw_data"></a>==&gt; raw_data</h6><h2 id="二、数据质控"><a href="#二、数据质控" class="headerlink" title="二、数据质控"></a>二、数据质控</h2><h3 id="1-低质量reads过滤及去除接头"><a href="#1-低质量reads过滤及去除接头" class="headerlink" title="1.低质量reads过滤及去除接头"></a>1.低质量reads过滤及去除接头</h3><p><code>fastp -i data/frag_1.fastq.gz -I data/frag_2.fastq.gz -o frag_1.fq.gz -O frag_2.fq.gz</code></p>
<h3 id="2-错误碱基修正"><a href="#2-错误碱基修正" class="headerlink" title="2.错误碱基修正"></a>2.错误碱基修正</h3><p> bfc -s 3m -t 6 data/frag_1.fastq.gz | gzip -1 &gt; clean-data/corrected_1.fq.gz</p>
<p> bfc -s 3m -t 6 data/frag_2.fastq.gz | gzip -1 &gt; clean-data/corrected_2.fq.gz</p>
<h6 id="clean-data"><a href="#clean-data" class="headerlink" title="==> clean_data"></a>==&gt; clean_data</h6><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-04%2021-24-57_20220804132913665132.png"></p>
<h2 id="三、基因组组装"><a href="#三、基因组组装" class="headerlink" title="三、基因组组装"></a>三、基因组组装</h2><h3 id="1-SOAPdenovo"><a href="#1-SOAPdenovo" class="headerlink" title="1.SOAPdenovo"></a>1.SOAPdenovo</h3><p> SOAPdenovo是由华大基因开发的SOAP软件包的一部分，SOAPdenovo主要用于短序列reads拼接，尤其是illumina测序数据。从小的细菌基因组到大的动植物基因组，人基因组都适用。已经成功应用于大熊猫基因组，黄瓜基因组等众多基因组的拼接中。</p>
<p> SOAPdenovo的一个优点是使用起来比较简单，但是却拥有很好的拼接效果，尤其在基因组构建Scaffold方面，效果很好。对于内存控制的也比较好。通常只要给软件输入测序的数据，即可拼接出很好的全基因组。</p>
<p>下面简单介绍一下SOAPdenovo组装的一般过程：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/19684072-c918d42c41db034c.png"></p>
<p> 原理：</p>
<p> A.随即打散基因组，进行双端测序：扩增长度在150–500bp之间的短克隆，并直接测序</p>
<p> B.将未处理（或者未经纠正的）reads读入到内存中，并且用deBruijin图数据结构来表示reads间的Overlap</p>
<p> C.通过移除错误的连接，解决微小的重复来简化图：</p>
<p> a.剪去短末端</p>
<p> b.移除低覆盖度的边</p>
<p> c.解决reads路径中得微小重复</p>
<p> d.合并茎环：可能由于重复或者二倍体染色体组的混杂造成</p>
<p> D.在简化图的基础上，我们在重复边界上打断连接，输出明确的序列作为contigs</p>
<p> E.我们重新用reads和contigs进行比对，使用双端信息来把单一的单一的contigs连接成scaffolds</p>
<p> F.最后，我们使用配对双端resds来填补scaffolds内部可能是由重复序列所造成的Gap。</p>
<p><code>SOAPdenovo-63mer all -K 31 -p 6 -s example.config -o soapdenovo_asm</code></p>
<p>得到一系列soapdenovo_asm开头的文件，重要的只有*.contig和*.scafSeq两个文件，分别是组装好的contig和scafSeq的文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-04%2021-52-52_20220804135516335414.png"></p>
<p>*.contig</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-04%2021-54-08_20220804135631259376.png"></p>
<p>*.scafSeq</p>
<h3 id="2-abyss"><a href="#2-abyss" class="headerlink" title="2.abyss"></a>2.abyss</h3><h3 id="3-velvet"><a href="#3-velvet" class="headerlink" title="3.velvet"></a>3.velvet</h3><h3 id="4-SPAdes"><a href="#4-SPAdes" class="headerlink" title="4.SPAdes"></a>4.SPAdes</h3><h3 id="5-SGA"><a href="#5-SGA" class="headerlink" title="5.SGA"></a>5.SGA</h3><h6 id="contig和-scafSeq-代表soapdenovo-asm"><a href="#contig和-scafSeq-代表soapdenovo-asm" class="headerlink" title="==> *.contig和*.scafSeq ( * 代表soapdenovo_asm)"></a>==&gt; *.contig和*.scafSeq ( * 代表soapdenovo_asm)</h6><h2 id="四、修补Gaps"><a href="#四、修补Gaps" class="headerlink" title="四、修补Gaps"></a>四、修补Gaps</h2><p><code>GapCloser -b example.config -a soapdenovo_asm.scafSeq -o genome.scf2.fasta -t 6 -p 31</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-04%2021-59-55_20220804140036163421.png"></p>
<p>genome.scf2.fasta</p>
<h6 id="genome-scf2-fasta"><a href="#genome-scf2-fasta" class="headerlink" title="==> genome.scf2.fasta"></a>==&gt; genome.scf2.fasta</h6><h2 id="五、基因组组装评估"><a href="#五、基因组组装评估" class="headerlink" title="五、基因组组装评估"></a>五、基因组组装评估</h2><p><code>quast.py genome.scf2.fasta -o quast_out/quast-report</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-04%2022-04-00_20220804140716496576.png"></p>
<p>Cumulative length</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-04%2022-04-30_20220804140750968335.png"></p>
<p>Nx</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-04%2022-04-49_20220804140820854349.png"></p>
<p>GC content</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-04%2022-05-48_20220804140838005000.png"></p>
<p>Contig size viewer</p>
<h6 id="quast-out-quast-report文件夹"><a href="#quast-out-quast-report文件夹" class="headerlink" title="==> quast_out/quast-report文件夹"></a>==&gt; quast_out/quast-report文件夹</h6><h2 id="六、基因组数据可视化"><a href="#六、基因组数据可视化" class="headerlink" title="六、基因组数据可视化"></a>六、基因组数据可视化</h2><h3 id="1-IGV"><a href="#1-IGV" class="headerlink" title="1.IGV"></a>1.IGV</h3><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-04%2022-39-08_20220804144423539261.png"></p>
<p>Sequence</p>
<h3 id="2-UCSC-genome-browser"><a href="#2-UCSC-genome-browser" class="headerlink" title="2.UCSC genome browser"></a>2.UCSC genome browser</h3><h3 id="3-Snap-Gene-Viewer"><a href="#3-Snap-Gene-Viewer" class="headerlink" title="3.Snap Gene Viewer"></a>3.Snap Gene Viewer</h3><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-04%2023-05-19_20220804150858152084.png"></p>
<p>Map</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-04%2023-05-49_20220804150911918373.png"></p>
<p>Sequence</p>
<h6 id="genome-scf2文件夹"><a href="#genome-scf2文件夹" class="headerlink" title="==> genome.scf2文件夹"></a>==&gt; genome.scf2文件夹</h6>]]></content>
      <categories>
        <category>基因组</category>
      </categories>
      <tags>
        <tag>组装</tag>
      </tags>
  </entry>
  <entry>
    <title>分子生物学（一）</title>
    <url>/2022/08/05/022-fen-zi-sheng-wu-xue-yi/</url>
    <content><![CDATA[<h2 id="分子生物学的研究层次和基本任务"><a href="#分子生物学的研究层次和基本任务" class="headerlink" title="分子生物学的研究层次和基本任务"></a>分子生物学的研究层次和基本任务</h2><h3 id="两个研究层次：核酸和蛋白质"><a href="#两个研究层次：核酸和蛋白质" class="headerlink" title="两个研究层次：核酸和蛋白质"></a>两个研究层次：核酸和蛋白质</h3><h3 id="四个基本任务：定性、定位、定量和相互作用"><a href="#四个基本任务：定性、定位、定量和相互作用" class="headerlink" title="四个基本任务：定性、定位、定量和相互作用"></a>四个基本任务：定性、定位、定量和相互作用</h3><h5 id="定性：PCR、测序、生物信息学分析、原核表达"><a href="#定性：PCR、测序、生物信息学分析、原核表达" class="headerlink" title="定性：PCR、测序、生物信息学分析、原核表达"></a>定性：PCR、测序、生物信息学分析、原核表达</h5><h5 id="定量：原位杂交、免疫组化、荧光融合蛋白、Northern-Blot、Western-Blot"><a href="#定量：原位杂交、免疫组化、荧光融合蛋白、Northern-Blot、Western-Blot" class="headerlink" title="定量：原位杂交、免疫组化、荧光融合蛋白、Northern Blot、Western Blot"></a>定量：原位杂交、免疫组化、荧光融合蛋白、Northern Blot、Western Blot</h5><h5 id="定量：qPCR、ddPCR、Microarray、高通量测序、Northern-Blot、Western-Blot"><a href="#定量：qPCR、ddPCR、Microarray、高通量测序、Northern-Blot、Western-Blot" class="headerlink" title="定量：qPCR、ddPCR、Microarray、高通量测序、Northern Blot、Western Blot"></a>定量：qPCR、ddPCR、Microarray、高通量测序、Northern Blot、Western Blot</h5><h5 id="相互作用：酵母双杂交、免疫共沉淀、Pull-Down、荧光共定位、FRET、BiFC、Chip-seq"><a href="#相互作用：酵母双杂交、免疫共沉淀、Pull-Down、荧光共定位、FRET、BiFC、Chip-seq" class="headerlink" title="相互作用：酵母双杂交、免疫共沉淀、Pull Down、荧光共定位、FRET、BiFC、Chip-seq"></a>相互作用：酵母双杂交、免疫共沉淀、Pull Down、荧光共定位、FRET、BiFC、Chip-seq</h5><h2 id="实验中常见的浓度单位："><a href="#实验中常见的浓度单位：" class="headerlink" title="实验中常见的浓度单位："></a>实验中常见的浓度单位：</h2><table>
<thead>
<tr>
<th align="left">浓度表示</th>
<th align="left">单位类型</th>
<th align="left">定义（公式）</th>
<th align="left">常见用途/说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1 M NaCl</td>
<td align="left">物质的量浓度</td>
<td align="left">溶质的物质的量 / 溶液的体积</td>
<td align="left">最通用的浓度表示法，用于精确的化学计量和计算。</td>
</tr>
<tr>
<td align="left">98% 硫酸</td>
<td align="left">质量分数</td>
<td align="left">(溶质的质量 / 溶液的质量) × 100%</td>
<td align="left">常用于描述浓酸、浓碱等高浓度试剂。</td>
</tr>
<tr>
<td align="left">75% 乙醇</td>
<td align="left">体积分数</td>
<td align="left">(溶质的体积 / 溶液的体积) × 100%</td>
<td align="left">常用于描述两种液体互溶的溶液，如酒精饮料、消毒酒精。</td>
</tr>
<tr>
<td align="left">10% SDS</td>
<td align="left">质量体积浓度</td>
<td align="left">(溶质的质量 / 溶液的体积) × 100%</td>
<td align="left">在生物学和生化实验中极为常用，配制固体溶质于液体溶剂的溶液。</td>
</tr>
<tr>
<td align="left">10 N NaOH</td>
<td align="left">当量浓度</td>
<td align="left">溶质的物质的量 / 反应中得失1摩尔电子的量</td>
<td align="left">现已较少使用，但在酸碱中和、氧化还原反应中很直观。1 N NaOH = 1 M NaOH。</td>
</tr>
</tbody></table>
<h6 id="一般情况下：溶质-溶液，所以溶液需要定容，单位对应关系是kg对应L，g对应ml"><a href="#一般情况下：溶质-溶液，所以溶液需要定容，单位对应关系是kg对应L，g对应ml" class="headerlink" title="一般情况下：溶质/溶液，所以溶液需要定容，单位对应关系是kg对应L，g对应ml"></a>一般情况下：溶质/溶液，所以溶液需要定容，单位对应关系是kg对应L，g对应ml</h6><h2 id="十字交叉法"><a href="#十字交叉法" class="headerlink" title="十字交叉法"></a>十字交叉法</h2><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-05%2020-18-28_20220805121901110639.png"></p>
]]></content>
      <categories>
        <category>分子生物学</category>
      </categories>
      <tags>
        <tag>笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>一个简单的基因家族分析</title>
    <url>/2022/08/05/023-ji-yin-jia-zu-fen-xi/</url>
    <content><![CDATA[<h1 id="基因家族分析"><a href="#基因家族分析" class="headerlink" title="基因家族分析"></a>基因家族分析</h1><p>以拟南芥为例，重现一个描述芝麻 大豆、拟南芥中一个与油脂合成相关的基因的进化关系以及拷贝数差异的图</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-06%2009-09-17_20220806010943489989.png"></p>
<h2 id="一、准备参考基因序列"><a href="#一、准备参考基因序列" class="headerlink" title="一、准备参考基因序列"></a>一、准备参考基因序列</h2><p>拟南芥中FAD4-like基因有三条：At1g62190、At2g22890、At4g27030</p>
<h5 id="拟南芥蛋白序列文件：atha-fasta"><a href="#拟南芥蛋白序列文件：atha-fasta" class="headerlink" title="拟南芥蛋白序列文件：atha.fasta"></a>拟南芥蛋白序列文件：atha.fasta</h5><h5 id="找出以上三个序列，拷贝放进query-fasta文件"><a href="#找出以上三个序列，拷贝放进query-fasta文件" class="headerlink" title="找出以上三个序列，拷贝放进query.fasta文件"></a>找出以上三个序列，拷贝放进query.fasta文件</h5><h2 id="二、准备大豆和芝麻的蛋白序列"><a href="#二、准备大豆和芝麻的蛋白序列" class="headerlink" title="二、准备大豆和芝麻的蛋白序列"></a>二、准备大豆和芝麻的蛋白序列</h2><h5 id="芝麻蛋白序列文件：sind-fasta"><a href="#芝麻蛋白序列文件：sind-fasta" class="headerlink" title="芝麻蛋白序列文件：sind.fasta"></a>芝麻蛋白序列文件：sind.fasta</h5><h5 id="大豆蛋白序列文件：gmax-fasta"><a href="#大豆蛋白序列文件：gmax-fasta" class="headerlink" title="大豆蛋白序列文件：gmax.fasta"></a>大豆蛋白序列文件：gmax.fasta</h5><p>######合并芝麻、大豆、拟南芥的蛋白序列文件</p>
<p><code>cat atha.fasta gmax.fasta sind.fasta &gt; all.fasta</code></p>
<h2 id="三、Blast（局部比对软件）"><a href="#三、Blast（局部比对软件）" class="headerlink" title="三、Blast（局部比对软件）"></a>三、Blast（局部比对软件）</h2><h3 id="1-比对数据库构建"><a href="#1-比对数据库构建" class="headerlink" title="1.比对数据库构建"></a>1.比对数据库构建</h3><p><code>makeblastdb -dbtype prot -in all.fasta -out all</code></p>
<h6 id="得到一系列以all为名的数据库文件"><a href="#得到一系列以all为名的数据库文件" class="headerlink" title="==> 得到一系列以all为名的数据库文件"></a>==&gt; 得到一系列以all为名的数据库文件</h6><h3 id="3-blast比对"><a href="#3-blast比对" class="headerlink" title="3.blast比对"></a>3.blast比对</h3><p><del>blastp -query query.fasta -db all -out blast.out -evalue 1e-10</del></p>
<p>==&gt; 结果太详细，-outfmt 第七种，表格带注释形式</p>
<p><code>blastp -query query.fasta -db all -out blast.out -evalue 1e-10 -outfmt 7</code></p>
<p>要求alignment length足够长80/100，identity足够高，evalue足够小，score足够高 -&gt; 结果好</p>
<h6 id="blast-out"><a href="#blast-out" class="headerlink" title="==> blast.out"></a>==&gt; blast.out</h6><h2 id="四、提取Blast结果中比对上的序列的ID"><a href="#四、提取Blast结果中比对上的序列的ID" class="headerlink" title="四、提取Blast结果中比对上的序列的ID"></a>四、提取Blast结果中比对上的序列的ID</h2><h6 id="过滤结果"><a href="#过滤结果" class="headerlink" title="过滤结果"></a>过滤结果</h6><p><code>grep -v "#" blast.out | awk '$3&gt;40 &amp;&amp; $11 protein_ids.txt</code></p>
<p> -v：反向选择</p>
<p> sort：排序</p>
<p> uniq：去除相邻的重复</p>
<h6 id="protein-ids-txt"><a href="#protein-ids-txt" class="headerlink" title="==> protein_ids.txt"></a>==&gt; protein_ids.txt</h6><h2 id="五、根据ID提取序列"><a href="#五、根据ID提取序列" class="headerlink" title="五、根据ID提取序列"></a>五、根据ID提取序列</h2><h6 id="大佬lh写的程序seqtk"><a href="#大佬lh写的程序seqtk" class="headerlink" title="大佬lh写的程序seqtk"></a>大佬lh写的程序seqtk</h6><p><code>seqtk subseq all.fasta protein_ids.txt &gt; result.fasta</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-06%2010-07-49_20220806020821747787.png"></p>
<h6 id="result-fasta"><a href="#result-fasta" class="headerlink" title="==> result.fasta"></a>==&gt; result.fasta</h6><h2 id="六、根据序列构建进化树"><a href="#六、根据序列构建进化树" class="headerlink" title="六、根据序列构建进化树"></a>六、根据序列构建进化树</h2><p>利用mega建树</p>
]]></content>
      <categories>
        <category>基因家族分析</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title>转录组标准分析</title>
    <url>/2022/08/05/024-zhuan-lu-zu-biao-zhun-fen-xi/</url>
    <content><![CDATA[<h2 id="如何获得表达矩阵？"><a href="#如何获得表达矩阵？" class="headerlink" title="如何获得表达矩阵？"></a>如何获得表达矩阵？</h2><h3 id="1-Microarray"><a href="#1-Microarray" class="headerlink" title="1.Microarray"></a>1.Microarray</h3><h3 id="2-RNA-Seq"><a href="#2-RNA-Seq" class="headerlink" title="2.RNA-Seq"></a>2.RNA-Seq</h3><h6 id="短reads"><a href="#短reads" class="headerlink" title="==> 短reads"></a>==&gt; 短reads</h6><h2 id="一、比对Spliced-alignment"><a href="#一、比对Spliced-alignment" class="headerlink" title="一、比对Spliced alignment"></a>一、比对Spliced alignment</h2><h3 id="1-比对到基因组"><a href="#1-比对到基因组" class="headerlink" title="1.比对到基因组"></a>1.比对到基因组</h3><p>Hisat2<br>STAR</p>
<h3 id="2-比对到转录组"><a href="#2-比对到转录组" class="headerlink" title="2.比对到转录组"></a>2.比对到转录组</h3><p>Bowtie2</p>
<h2 id="二、表达定量Quantification"><a href="#二、表达定量Quantification" class="headerlink" title="二、表达定量Quantification"></a>二、表达定量Quantification</h2><h2 id="三、标准化Normalization"><a href="#三、标准化Normalization" class="headerlink" title="三、标准化Normalization"></a>三、标准化Normalization</h2><p>RPKM<br>TPM</p>
<h2 id="表达数据挖掘"><a href="#表达数据挖掘" class="headerlink" title="表达数据挖掘"></a>表达数据挖掘</h2><h2 id="差异表达"><a href="#差异表达" class="headerlink" title="差异表达"></a>差异表达</h2><h2 id="富集分析"><a href="#富集分析" class="headerlink" title="富集分析"></a>富集分析</h2><h2 id="样本聚类分析"><a href="#样本聚类分析" class="headerlink" title="样本聚类分析"></a>样本聚类分析</h2><h2 id="相关系数"><a href="#相关系数" class="headerlink" title="相关系数"></a>相关系数</h2><h2 id="聚类分析和WGCNA"><a href="#聚类分析和WGCNA" class="headerlink" title="聚类分析和WGCNA"></a>聚类分析和WGCNA</h2><h2 id="从聚类分析到主成分分析"><a href="#从聚类分析到主成分分析" class="headerlink" title="从聚类分析到主成分分析"></a>从聚类分析到主成分分析</h2>]]></content>
      <categories>
        <category>转录组</category>
      </categories>
      <tags>
        <tag>笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>将测序数据比对到参考基因组</title>
    <url>/2022/08/06/025-bi-dui/</url>
    <content><![CDATA[<h2 id="一项目设计"><a href="#一项目设计" class="headerlink" title="一项目设计"></a>一项目设计</h2><h3 id="1-取样"><a href="#1-取样" class="headerlink" title="1.取样"></a>1.取样</h3><p>S1:7.16</p>
<p>S2:8.07</p>
<p>S3:8.26</p>
<p>S4:9.14</p>
<p>三个生物学重复，共二十四个样本</p>
<h3 id="2-建库"><a href="#2-建库" class="headerlink" title="2.建库"></a>2.建库</h3><p>试剂盒：NEBNexi</p>
<h3 id="3-测序"><a href="#3-测序" class="headerlink" title="3.测序"></a>3.测序</h3><p>模式：Single-end</p>
<p>读长：101bp</p>
<p>测序仪：Hiseq2000</p>
<h2 id="二、将测序数据比对到参考基因组-测序数据量"><a href="#二、将测序数据比对到参考基因组-测序数据量" class="headerlink" title="二、将测序数据比对到参考基因组 ==> 测序数据量"></a>二、将测序数据比对到参考基因组 ==&gt; 测序数据量</h2><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-06%2023-10-05_20220806151210236124.png"></p>
<h2 id="三、特异表达分析"><a href="#三、特异表达分析" class="headerlink" title="三、特异表达分析"></a>三、特异表达分析</h2><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-06%2023-11-38_20220806151402533026.png"></p>
]]></content>
  </entry>
  <entry>
    <title>转录组分析</title>
    <url>/2022/08/06/026-zhuan-lu-zu-fen-xi/</url>
    <content><![CDATA[<h1 id="转录组分析"><a href="#转录组分析" class="headerlink" title="转录组分析"></a>转录组分析</h1><h2 id="一、准备数据"><a href="#一、准备数据" class="headerlink" title="一、准备数据"></a>一、准备数据</h2><h3 id="1-测序数据-fastq"><a href="#1-测序数据-fastq" class="headerlink" title="1.测序数据 fastq"></a>1.测序数据 fastq</h3><h4 id="A-测序公司"><a href="#A-测序公司" class="headerlink" title="A.测序公司"></a>A.测序公司</h4><h4 id="B-下载数据"><a href="#B-下载数据" class="headerlink" title="B.下载数据"></a>B.下载数据</h4><p>NCBI下载SRA，苹果有24个</p>
<p>下载list文件SSR.txt，利用sratools中prefetch下载</p>
<h5 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h5><p><code>awk '{print "prefetch "$1" &amp;"}' SSR.txt &gt;run_prefetch.sh</code></p>
<p>运行后得到SRRxxxxxxx.sra</p>
<p>利用 <code>fastq-dump --split-3 SSR2176358.sra</code>转化为fastq文件</p>
<p>转换gff格式为gtf</p>
<p><code>gffread -T -o genes.gtf HFTH.genes.gff</code></p>
<h3 id="2-数据信息表-samples-txt"><a href="#2-数据信息表-samples-txt" class="headerlink" title="2.数据信息表 samples.txt"></a>2.数据信息表 samples.txt</h3><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-07%2010-54-55_20220807025530240811.png"></p>
<h3 id="3-参考基因组"><a href="#3-参考基因组" class="headerlink" title="3.参考基因组"></a>3.参考基因组</h3><p>基因组序列 genome.fasta</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-07%2011-12-28_20220807031257352599.png"></p>
<p>基因注释 genes.gtf</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-07%2011-14-39_20220807031507759775.png"></p>
<h2 id="二、比对到参考基因组"><a href="#二、比对到参考基因组" class="headerlink" title="二、比对到参考基因组"></a>二、比对到参考基因组</h2><h3 id="1-输入"><a href="#1-输入" class="headerlink" title="1.输入"></a>1.输入</h3><p>基因组序列 genome.fasta</p>
<p>测序数据 fastq</p>
<h3 id="2-步骤"><a href="#2-步骤" class="headerlink" title="2.步骤"></a>2.步骤</h3><p>一个测序数据的处理</p>
<h4 id="①构建参考基因组"><a href="#①构建参考基因组" class="headerlink" title="①构建参考基因组"></a>①构建参考基因组</h4><h5 id="脚本文件-step1-hisat-build-sh"><a href="#脚本文件-step1-hisat-build-sh" class="headerlink" title="脚本文件 step1.hisat_build.sh"></a>脚本文件 step1.hisat_build.sh</h5><h5 id="内容："><a href="#内容：" class="headerlink" title="内容："></a>内容：</h5><p><code>hisat2-build ../ref/genome.fasta ../ref/genome 1&gt;hisat2-build.log 2&gt;&amp;1</code></p>
<p> 0 表示stdin标准输入</p>
<p> 1 表示stdout标准输出</p>
<p> 2 表示stderr标准错误</p>
<h6 id="意思是将1和2日志存入build-log"><a href="#意思是将1和2日志存入build-log" class="headerlink" title="意思是将1和2日志存入build.log"></a>意思是将1和2日志存入build.log</h6><h5 id="运行命令："><a href="#运行命令：" class="headerlink" title="运行命令："></a>运行命令：</h5><p><code>nohup sh step1.hisat_build.sh &amp;</code></p>
<p><em>（过程需要几个小时，八九十G内存，个人电脑搞不定）</em></p>
<h6 id="ref-genome-ht2"><a href="#ref-genome-ht2" class="headerlink" title="###### ==> ../ref/genome.*.ht2"></a>###### ==&gt; ../ref/genome.*.ht2</h6><h4 id="②比对"><a href="#②比对" class="headerlink" title="②比对"></a>②比对</h4><h5 id="脚本文件-step2-run-hisat-sh"><a href="#脚本文件-step2-run-hisat-sh" class="headerlink" title="脚本文件 step2.run_hisat.sh"></a>脚本文件 step2.run_hisat.sh</h5><h5 id="内容：-1"><a href="#内容：-1" class="headerlink" title="内容："></a>内容：</h5><p><code>hisat2 --new-summary -p 6 -x ../ref/genome -U /home/ywh/workspace/rnaseq-apple-training/RNASeq-ref/data/BLO_S1_LD1.fq.gz -S BLO_S1_LD3.sam --rna-strandness R 1&gt;BLO_S1_LD1.log 2&gt;&amp;1</code></p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">
-p：线程数

-x：参考基因组路径

-U：单末端测序

-S：输出文件路径

-ran-strandness：数据为链特异性文库（R：单末端测序、RF：双末端测序）
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h5 id="运行命令：-1"><a href="#运行命令：-1" class="headerlink" title="运行命令："></a>运行命令：</h5><p><code>nohup sh step1.hisat_build.sh &amp;</code></p>
<h6 id="sam"><a href="#sam" class="headerlink" title="==> *.sam"></a>==&gt; *.sam</h6><h4 id="③压缩和排序"><a href="#③压缩和排序" class="headerlink" title="③压缩和排序"></a>③压缩和排序</h4><p><em>转换为bam格式，源文件可以删除</em></p>
<h5 id="脚本文件-step3-sam2bamall-sh"><a href="#脚本文件-step3-sam2bamall-sh" class="headerlink" title="脚本文件 step3.sam2bamall.sh"></a>脚本文件 step3.sam2bamall.sh</h5><p><code>samtools sort -o BLO_S1_LD1.bam BLO_S1_LD1.sam </code></p>
<h5 id="运行命令"><a href="#运行命令" class="headerlink" title="运行命令"></a>运行命令</h5><p>直接运行</p>
<h6 id="bam"><a href="#bam" class="headerlink" title="==> *.bam"></a>==&gt; *.bam</h6><h4 id="④给bam构建index"><a href="#④给bam构建index" class="headerlink" title="④给bam构建index"></a>④给bam构建index</h4><h5 id="脚本文件-step4-bamindex-sh"><a href="#脚本文件-step4-bamindex-sh" class="headerlink" title="脚本文件 step4.bamindex.sh"></a>脚本文件 step4.bamindex.sh</h5><p><em>用于IGV使用</em></p>
<p><code>samtools index BLO_S1_LD1.bam</code></p>
<h5 id="运行命令-1"><a href="#运行命令-1" class="headerlink" title="运行命令"></a>运行命令</h5><p>直接运行</p>
<h6 id="bam-bai"><a href="#bam-bai" class="headerlink" title="==> *.bam.bai"></a>==&gt; *.bam.bai</h6><p><strong>一共24个测序文件，利用Linux命令一键生成脚本</strong></p>
<h5 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h5><p>②</p>
<p><code>awk '{print "hisat2 --new-summary -p 10 -x ../ref/genome -U "$3" -S "$2".sam --rna-strandness R 1&gt;"$2".log 2&gt;&amp;1 &amp;"}' ../data/samples.txt</code></p>
<p><em>注意路径</em></p>
<h5 id="脚本文件-step2-run-hisat2-sh"><a href="#脚本文件-step2-run-hisat2-sh" class="headerlink" title="脚本文件 step2.run_hisat2.sh"></a>脚本文件 step2.run_hisat2.sh</h5><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-07%2011-40-34_20220807034141107976.png"></p>
<p>③</p>
<p><code>awk '{print "samtools sort -o "$2".bam "$2".sam"}' ../data/samples.txt &gt;step3.sam2bamall.sh </code></p>
<h5 id="脚本文件-step3-sam2bamall-sh-1"><a href="#脚本文件-step3-sam2bamall-sh-1" class="headerlink" title="脚本文件 step3.sam2bamall.sh"></a>脚本文件 step3.sam2bamall.sh</h5><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-07%2012-01-31_20220807040148997519.png"></p>
<p>④</p>
<p><code>awk '{print "samtools index "$2".bam"}' ../data/samples.txt &gt;step4.bamindexall.sh</code></p>
<h5 id="脚本文件-step4-bamindexall-sh"><a href="#脚本文件-step4-bamindexall-sh" class="headerlink" title="脚本文件 step4.bamindexall.sh"></a>脚本文件 step4.bamindexall.sh</h5><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-07%2012-02-24_20220807040243847988.png"></p>
<h3 id="3-输出"><a href="#3-输出" class="headerlink" title="3.输出"></a>3.输出</h3><p>比对结果 bam</p>
<p><strong>可利用IGV进行比对结果可视化，检验比对结果</strong></p>
<h2 id="三、表达定量"><a href="#三、表达定量" class="headerlink" title="三、表达定量"></a>三、表达定量</h2><h3 id="1-输入-1"><a href="#1-输入-1" class="headerlink" title="1.输入"></a>1.输入</h3><p>比对结果 bam</p>
<p>基因注释 genes.gtf</p>
<h3 id="2-软件"><a href="#2-软件" class="headerlink" title="2.软件"></a>2.软件</h3><p>htseq -&gt; htseq-count</p>
<p>subread(subread) -&gt; featureCounts</p>
<h3 id="3-步骤"><a href="#3-步骤" class="headerlink" title="3.步骤"></a>3.步骤</h3><h4 id="脚本"><a href="#脚本" class="headerlink" title="脚本"></a>脚本</h4><p>run-featurecounts.R</p>
<p>批量生成脚本</p>
<p><code>awk '{print "Rscript script/run-featurecounts.R -b ../1.Mapping/"$2".bam -g ../ref/genes.gtf -o "$2}' ../data/samples.txt &gt;run_Quantification.sh</code></p>
<p>run_Quantification.sh</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-07%2013-56-07_20220807055624241191.png"></p>
<p>t</p>
<h3 id="4-结果"><a href="#4-结果" class="headerlink" title="4.结果"></a>4.结果</h3><p>定量结果 *.count</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-07%2014-04-03_20220807060424862295.png"></p>
<h2 id="四、合并成矩阵"><a href="#四、合并成矩阵" class="headerlink" title="四、合并成矩阵"></a>四、合并成矩阵</h2><h3 id="1-输入-2"><a href="#1-输入-2" class="headerlink" title="1.输入"></a>1.输入</h3><p>定量结果 count</p>
<h3 id="2-步骤-1"><a href="#2-步骤-1" class="headerlink" title="2.步骤"></a>2.步骤</h3><p><code>ls ../2.Quantification/*.count &gt;genes.quant_files.txt</code></p>
<p><code>perl script/abundance_estimates_to_matrix.pl --est_method featureCounts --quant_files genes.quant_files.txt --out_prefix genes</code></p>
<h3 id="3-输出-1"><a href="#3-输出-1" class="headerlink" title="3.输出"></a>3.输出</h3><h4 id="①counts-矩阵"><a href="#①counts-矩阵" class="headerlink" title="①counts 矩阵"></a>①counts 矩阵</h4><p>genes.counts.matrix</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-07%2014-18-48_20220807061912982290.png"></p>
<h4 id="②TPM-矩阵"><a href="#②TPM-矩阵" class="headerlink" title="②TPM 矩阵"></a>②TPM 矩阵</h4><p>genes.TPM.not_cross_norm</p>
<h4 id="③TPM-TMM-矩阵"><a href="#③TPM-TMM-矩阵" class="headerlink" title="③TPM + TMM 矩阵"></a>③TPM + TMM 矩阵</h4><p>genes.TMM.EXPR.matrix</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-07%2014-14-21_20220807061445911230.png"></p>
<h2 id="五、差异表达分析"><a href="#五、差异表达分析" class="headerlink" title="五、差异表达分析"></a>五、差异表达分析</h2><h3 id="1-输入-3"><a href="#1-输入-3" class="headerlink" title="1.输入"></a>1.输入</h3><p>counts 矩阵</p>
<h3 id="2-软件-1"><a href="#2-软件-1" class="headerlink" title="2.软件"></a>2.软件</h3><p>DESeq2 / edgeR</p>
<h3 id="3-步骤-1"><a href="#3-步骤-1" class="headerlink" title="3.步骤"></a>3.步骤</h3><h4 id="脚本文件-run-DE-sh"><a href="#脚本文件-run-DE-sh" class="headerlink" title="脚本文件 run_DE.sh"></a>脚本文件 run_DE.sh</h4><pre class="line-numbers language-perl" data-language="perl"><code class="language-perl">
perl <span class="token operator">/</span>home<span class="token operator">/</span>ywh<span class="token operator">/</span>miniconda3<span class="token operator">/</span>envs<span class="token operator">/</span>r4<span class="token operator">/</span>opt<span class="token operator">/</span>trinity<span class="token operator">-</span><span class="token v-string string">2.1.1</span><span class="token operator">/</span>Analysis<span class="token operator">/</span>DifferentialExpression<span class="token operator">/</span>run_DE_analysis<span class="token operator">.</span>pl <span class="token operator">\</span>

 <span class="token operator">--</span>matrix <span class="token operator">..</span><span class="token operator">/</span><span class="token number">3</span><span class="token operator">.</span>Merge_result<span class="token operator">/</span>genes<span class="token operator">.</span>counts<span class="token operator">.</span>matrix <span class="token operator">\</span>

 <span class="token operator">--</span>method DESeq2 <span class="token operator">\</span>

 <span class="token operator">--</span>samples_file <span class="token operator">..</span><span class="token operator">/</span>data<span class="token operator">/</span>samples<span class="token operator">.</span>txt <span class="token operator">\</span>

 <span class="token operator">--</span>contrasts contrasts<span class="token operator">.</span>txt 
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-输出"><a href="#4-输出" class="headerlink" title="4.输出"></a>4.输出</h3><p>DESeq2.xxxxx.dir/genes.counts.matrix.KID_S1_vs_BLO_S1.DESeq2.Rscript</p>
<p>为R的脚本文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-07%2014-22-44_20220807062315530638.png"></p>
<p>DESeq2.xxxxx.dir/genes.counts.matrix.KID_S1_vs_BLO_S1.DESeq2.DE_results</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-07%2014-26-07_20220807062636232617.png"></p>
<p>DESeq2.xxxxx.dir/genes.counts.matrix.KID_S1_vs_BLO_S1.DESeq2.DE_results.MA_n_Volcano.pdf</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Screenshot%20from%202022-08-07%2014-29-15_20220807063029124955.png"></p>
]]></content>
      <categories>
        <category>转录组</category>
      </categories>
      <tags>
        <tag>笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>完整模型训练模型</title>
    <url>/2022/08/21/028-wan-zheng-mo-xing-xun-lian-mo-xing/</url>
    <content><![CDATA[<h2 id="一、准备数据集"><a href="#一、准备数据集" class="headerlink" title="一、准备数据集"></a>一、准备数据集</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">
train_data <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>CIFAR10<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">"./dataset"</span><span class="token punctuation">,</span> train<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> transform<span class="token operator">=</span>torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

test_data <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>datasets<span class="token punctuation">.</span>CIFAR10<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">"./dataset"</span><span class="token punctuation">,</span> train<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> transform<span class="token operator">=</span>torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> download<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="二、定义训练的设备"><a href="#二、定义训练的设备" class="headerlink" title="二、定义训练的设备"></a>二、定义训练的设备</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">
<span class="token keyword">if</span> torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

 device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cuda"</span><span class="token punctuation">)</span>

<span class="token keyword">else</span><span class="token punctuation">:</span>

 device <span class="token operator">=</span> torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">"cpu"</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="三、length-长度"><a href="#三、length-长度" class="headerlink" title="三、length 长度"></a>三、length 长度</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">
train_data_size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>train_data<span class="token punctuation">)</span>

test_data_size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>test_data<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"训练数据集的长度：{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>train_data_size<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"测试数据集的长度：{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>test_data_size<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="四、利用Dataloader-来加载数据集"><a href="#四、利用Dataloader-来加载数据集" class="headerlink" title="四、利用Dataloader 来加载数据集"></a>四、利用Dataloader 来加载数据集</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">
train_dataloader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>train_data<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">)</span>

test_dataloader <span class="token operator">=</span> DataLoader<span class="token punctuation">(</span>test_data<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="五、搭建神经网络"><a href="#五、搭建神经网络" class="headerlink" title="五、搭建神经网络"></a>五、搭建神经网络</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">
<span class="token keyword">class</span> <span class="token class-name">Tudui</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>

 <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>

 <span class="token builtin">super</span><span class="token punctuation">(</span>Tudui<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

 self<span class="token punctuation">.</span>model1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>

 nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

 nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

 nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

 nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

 nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

 nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

 nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

 nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

 nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>

 <span class="token punctuation">)</span>


 <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>

 x <span class="token operator">=</span> self<span class="token punctuation">.</span>model1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

 <span class="token keyword">return</span> x


tudui <span class="token operator">=</span> Tudui<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># if torch.cuda.is_available():</span>

<span class="token comment"># tudui = tudui.cuda()</span>

tudui <span class="token operator">=</span> tudui<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>


<span class="token comment"># check</span>

<span class="token comment"># input = torch.ones((64,3,32,32))</span>

<span class="token comment"># output = tudui(input)</span>

<span class="token comment"># print(output.shape)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="六、损失函数"><a href="#六、损失函数" class="headerlink" title="六、损失函数"></a>六、损失函数</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">
loss_fn <span class="token operator">=</span> nn<span class="token punctuation">.</span>CrossEntropyLoss<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># if torch.cuda.is_available():</span>

<span class="token comment"># loss_fn = loss_fn.cuda()</span>

loss_fn <span class="token operator">=</span> loss_fn<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="七、优化器"><a href="#七、优化器" class="headerlink" title="七、优化器"></a>七、优化器</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">
learning_rate <span class="token operator">=</span> <span class="token number">1e-2</span>

optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>SGD<span class="token punctuation">(</span>tudui<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learning_rate<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="八、设置训练网络的一些参数"><a href="#八、设置训练网络的一些参数" class="headerlink" title="八、设置训练网络的一些参数"></a>八、设置训练网络的一些参数</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">
<span class="token comment"># 记录训练的次数</span>

total_train_step <span class="token operator">=</span> <span class="token number">0</span>

<span class="token comment"># 记录测试的次数</span>

total_test_step <span class="token operator">=</span> <span class="token number">0</span>

<span class="token comment"># 训练的轮数</span>

epoch <span class="token operator">=</span> <span class="token number">10</span>


<span class="token comment"># 添加tensorboard</span>

writer <span class="token operator">=</span> SummaryWriter<span class="token punctuation">(</span><span class="token string">"logs_train"</span><span class="token punctuation">)</span>

start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>epoch<span class="token punctuation">)</span><span class="token punctuation">:</span>

 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"------第 {} 轮训练开始------"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


 <span class="token comment"># 训练步骤开始</span>

 <span class="token keyword">for</span> data <span class="token keyword">in</span> train_dataloader<span class="token punctuation">:</span>

 imgs<span class="token punctuation">,</span> targets <span class="token operator">=</span> data

<span class="token comment"># if torch.cuda.is_available():</span>

<span class="token comment"># imgs = imgs.cuda()</span>

<span class="token comment"># targets = targets.cuda()</span>

 imgs <span class="token operator">=</span> imgs<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>

 targets <span class="token operator">=</span> targets<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>

 outputs <span class="token operator">=</span> tudui<span class="token punctuation">(</span>imgs<span class="token punctuation">)</span>

 loss <span class="token operator">=</span> loss_fn<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> targets<span class="token punctuation">)</span>


 <span class="token comment"># 优化器优化模型</span>

 optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>

 loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>

 optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>


 total_train_step <span class="token operator">=</span> total_train_step <span class="token operator">+</span> <span class="token number">1</span>

 <span class="token keyword">if</span> total_train_step <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>

 end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

 <span class="token keyword">print</span><span class="token punctuation">(</span>end_time <span class="token operator">-</span> start_time<span class="token punctuation">)</span>

 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"训练次数：{}, Loss:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>total_train_step<span class="token punctuation">,</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

 writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">"train_loss"</span><span class="token punctuation">,</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> total_train_step<span class="token punctuation">)</span>

 <span class="token comment"># 测试步骤开始</span>

 total_test_loss <span class="token operator">=</span> <span class="token number">0</span>

 total_accuracy <span class="token operator">=</span> <span class="token number">0</span>

 <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

 <span class="token keyword">for</span> data <span class="token keyword">in</span> test_dataloader<span class="token punctuation">:</span>

 imgs<span class="token punctuation">,</span> targets <span class="token operator">=</span> data

<span class="token comment"># if torch.cuda.is_available():</span>

<span class="token comment"># imgs = imgs.cuda()</span>

<span class="token comment"># targets = targets.cuda()</span>

 imgs <span class="token operator">=</span> imgs<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>

 targets <span class="token operator">=</span> targets<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token punctuation">)</span>

 outputs <span class="token operator">=</span> tudui<span class="token punctuation">(</span>imgs<span class="token punctuation">)</span>

 loss <span class="token operator">=</span> loss_fn<span class="token punctuation">(</span>outputs<span class="token punctuation">,</span> targets<span class="token punctuation">)</span>

 total_test_loss <span class="token operator">=</span> total_test_loss <span class="token operator">+</span> loss<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token punctuation">)</span>

 accuracy <span class="token operator">=</span> <span class="token punctuation">(</span>outputs<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> targets<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

 total_accuracy <span class="token operator">+=</span> accuracy


 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"整体测试集上的Loss：{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>total_test_loss<span class="token punctuation">)</span><span class="token punctuation">)</span>

 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"整体测试集上的正确率：{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>total_accuracy<span class="token operator">/</span>test_data_size<span class="token punctuation">)</span><span class="token punctuation">)</span>


 writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">"test_loss"</span><span class="token punctuation">,</span> total_test_loss<span class="token punctuation">,</span> total_test_step<span class="token punctuation">)</span>

 writer<span class="token punctuation">.</span>add_scalar<span class="token punctuation">(</span><span class="token string">"test_accuracy"</span><span class="token punctuation">,</span> total_accuracy<span class="token punctuation">,</span> total_test_step<span class="token punctuation">)</span>

 total_test_step <span class="token operator">+=</span> <span class="token number">1</span>


 torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span>tudui<span class="token punctuation">,</span> <span class="token string">"tudui_{}.pth"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>

 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"模型已保存"</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>python</category>
      </categories>
      <tags>
        <tag>深度学习</tag>
      </tags>
  </entry>
  <entry>
    <title>Western blot 原理和详细操作步骤</title>
    <url>/2022/11/04/029-western-blot/</url>
    <content><![CDATA[<h2 id="Western-blot-原理"><a href="#Western-blot-原理" class="headerlink" title="Western blot 原理"></a>Western blot 原理</h2><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-d6d9839833ec998ef6f250fe7a4dbc5b_720w.webp"></p>
<blockquote>
<p>Western blot（也称为蛋白质免疫印迹）是一种常用于研究中分离和鉴定蛋白质的技术。它利用 SDS-聚丙烯酰胺凝胶电泳 (SDS-PAGE) 来分离指定样品中包含的各种蛋白质，然后将分离的蛋白质转移到硝酸纤维素或 PVDF 膜上，接下来将膜与对感目标蛋白质的特异抗体一起孵育。在洗膜过程中，未结合的抗体被洗掉，只留下与目标蛋白质结合的抗体，最后通过显影胶片或荧光扫描来检测结合的抗体。</p>
</blockquote>
<blockquote>
<p>由于抗体仅与目标蛋白质结合，因此一般只能看到一条清晰的带，条带的粗细对应于蛋白质量。通过分析特定反应的位置和强度，可以获得目标蛋白在给定细胞或组织匀浆中的表达信息。由于凝胶电泳的高分辨率和免疫的强特异性和高灵敏度，Western印迹分析可检测低至1ng的靶蛋白。该方法广泛应用于分子生物学、生物化学、免疫遗传学等分子生物学领域。</p>
</blockquote>
<h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><h3 id="一、准备样品"><a href="#一、准备样品" class="headerlink" title="一、准备样品"></a>一、准备样品</h3><ol>
<li><p>制冰，准备冰盒。</p>
</li>
<li><p>配制细胞裂解液：根据细胞数量确定所需裂解液：50ul/六孔板一孔 。</p>
</li>
</ol>
<p> 裂解液配方：100ul碧云天裂解液+1ul蛋白酶抑制剂混合物+1ul PMSF</p>
<ol start="3">
<li><p>按实验需要准备好细胞：去掉培养基，1×PBS洗3次（去掉培养基中的血清），每个孔（6孔板）加入适量的裂解液。迅速用细胞刮刮下细胞并转移至1.5ml管中，置于冰上20min，振荡混合后，再置冰上10min。</p>
</li>
<li><p>12,000g，4℃离心15min，收集上清至另一1.5ml管。</p>
</li>
<li><p>取2.5ul样品加22.5ul三蒸水稀释，用于BCA法测蛋白浓度。</p>
</li>
<li><p>其余样品加5×Loading Buffer（按2.5mlBuffer/10ml蛋白）用95℃煮10分钟，期间振荡一次。</p>
</li>
<li><p>直接上样跑胶或者分装-80°C长期保存。</p>
</li>
</ol>
<h3 id="二、SDS-PAGE聚丙烯酰胺凝胶电泳"><a href="#二、SDS-PAGE聚丙烯酰胺凝胶电泳" class="headerlink" title="二、SDS-PAGE聚丙烯酰胺凝胶电泳"></a>二、SDS-PAGE聚丙烯酰胺凝胶电泳</h3><ol>
<li>制备分离胶（10%）</li>
</ol>
<p> <em>注：不同的分离胶配方可参见《分子克隆》p1716表A8-9</em></p>
<ol start="2">
<li><p>小心注入分离胶，留2 cm左右的空间（制胶架绿色或白色边框下缘）给浓缩胶，顶层覆盖无水乙醇。静置约30分钟。</p>
</li>
<li><p>制备浓缩胶（5%）</p>
</li>
<li><p>倒掉无水乙醇，用吸水纸吸去残留无水乙醇，然后将浓缩胶注入分离胶上端，注意避免气泡。</p>
</li>
<li><p>插入梳子，待浓缩胶凝固（胶与梳子之间有明显的分界，加上分离胶的凝固时间要大于2h），<del>用超纯水水将孔洗净，去除凝胶碎片，然后用滤纸吸干水</del>。</p>
</li>
<li><p>将胶放入电泳槽，上下槽均加入1×电泳缓冲液（反复使用不要超过3次）。</p>
</li>
<li><p>上样：marker孔中取5ul prestained marker<del>加入适量1×上样Buffer,使得总体积与sample孔一样</del>。Sample上样量一般为15－25μl，先用heating block 100℃煮5-10分钟，期间振荡一次，然后快速离心再上样跑胶；<del>在没有load sample的孔中加入等体积的1×上样Buffer</del>。</p>
</li>
<li><p>电泳：开始为恒压60-80V，当跑过浓缩胶后，将电流加大到100-120V，电泳时间根据目标蛋白的大小及marker的位置确定，一般为目标蛋白跑到分离胶的三分之二的位置即可。</p>
</li>
</ol>
<h3 id="三、转膜"><a href="#三、转膜" class="headerlink" title="三、转膜"></a>三、转膜</h3><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-4655ee5889e0b74ffeaf44a5927c9cfb_720w.webp"></p>
<ol>
<li><p>切胶，按Marker指示和目的条带的位置切胶(注意将胶切角做记号)，将洗脱的胶浸入转膜缓冲液中15分钟。</p>
</li>
<li><p>PVDF膜做好记号后先浸入甲醇中1分钟，再连同4张3mm滤纸和海绵浸入转移缓冲液中15分钟。</p>
</li>
<li><p>制备“夹心饼”：</p>
</li>
</ol>
<p> 依次按如下顺序：纤维垫–滤纸—PVDF膜—凝胶—滤纸–纤维垫。</p>
<p> 注意：每加一种物品都要对齐，确保没有气泡。</p>
<ol start="4">
<li>转膜：转膜时间根据1.确定。（60min）</li>
</ol>
<p> PVDF膜一边接正极（红色），凝胶一边接负极（黑色）。</p>
<h3 id="四、封闭和抗体孵育"><a href="#四、封闭和抗体孵育" class="headerlink" title="四、封闭和抗体孵育"></a>四、封闭和抗体孵育</h3><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-579f20046a8c0c8ed195c58cfce73423_720w.webp"></p>
<ol>
<li><p>转膜以后，<del>用10ml的1×TBS室温洗膜10分钟</del>。</p>
</li>
<li><p>15ml奶粉封闭液室温孵育<strong>2h</strong>或者4℃平缓摇动过夜。由于奶粉较为难溶，因此要<strong>提前至少1h配置</strong>。</p>
</li>
<li><p>10ml的TBS/T洗膜<del>3</del>5次，每次5分钟。</p>
</li>
<li><p>加入15ml一抗稀释缓冲液（抗体根据说明稀释），室温2 hrs或者4℃平缓摇动过夜，回收一抗，<del>按5ul/ml一抗液加入叠氮钠（可抑制细菌生长）4℃保存（不常用的抗体可-20℃长期保存），可重复使用！</del></p>
</li>
</ol>
<p><em>如果用辣根过氧化物酶(HRP)检测系统，封闭液不应加叠氮钠(NaN3)，因为叠氮钠对辣根过氧化物酶（HRP）有灭活作用</em></p>
<ol start="5">
<li><p>10ml的TBS/T洗膜<del>3</del>5次，每次5分钟。</p>
</li>
<li><p>加入二抗（一般为1：2000稀释），室温平缓摇动1h。</p>
</li>
<li><p>10ml的TBS/T洗膜<del>3</del>5次，每次5分钟。</p>
</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-787bb84a8e567620a49e3f0df4b365bf_720w.webp"></p>
<h3 id="五、显影"><a href="#五、显影" class="headerlink" title="五、显影"></a>五、显影</h3><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-87069acd533b8a41b7a4296c72786b0b_720w.webp"></p>
<ol>
<li><p>显色步骤：先铺保鲜膜，在吸水纸上再铺上保鲜膜；分别将水、显影液（颜色变深则不能用）和定影液倒入各自的盘中。2.5ml ECL-A 和2.5ml ECL-B混合,避光。将ECL混合液、膜等拿入暗房。关好门，反锁，拉回布。ECL混合液倒入小盒中，膜用吸水纸稍微吸干放入ECL混合液中室温摇动5min（使得ECL均匀的铺过膜），吸水纸吸干后置于保鲜膜上，膜面朝下包好置于夹子上，剪好X-film（注意手只能拿X-film的边缘）放于膜上，剪角一边为marker(注意：取胶片时要把灯光调到最小，且不要对着灯光，应背着灯光。)，根据条带的亮度来调整曝光时间，一般可先曝光2min，观察条带的深度，再确定最佳的曝光时间。</p>
</li>
<li><p>显影，定影: 取出X-film置于显影液中一定时间后(视目的条带强度与背景而定)，水洗一次再置于定影液中定影5min以上。</p>
</li>
</ol>
<p> <em>（当然，随着时代的进步，现在很多实验室很少用古老的胶片显影定影。用在最后的发光二抗孵育后，直接扫描。这类仪器很多，操作方法看不同实验室的配置）</em></p>
]]></content>
      <categories>
        <category>蛋白组</category>
      </categories>
      <tags>
        <tag>实验</tag>
      </tags>
  </entry>
  <entry>
    <title>SDS-PAGE（聚丙烯酰胺）蛋白电泳原理详解</title>
    <url>/2022/11/04/030-sds-page/</url>
    <content><![CDATA[<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-94435d28b337a80366f73f71e9d7fb14_1440w.jpg"></p>
<h2 id="WB流程"><a href="#WB流程" class="headerlink" title="WB流程"></a>WB流程</h2><blockquote>
<p>首先通过SDS-PAGE聚丙烯酰胺凝胶电泳使蛋白质样本分离，再将凝胶上的蛋白电泳转移到固相载体上（NC膜或者PVDF膜），方便后续印迹显影操作，然后使用封闭液将封闭非特异位点，以避免抗体的非特异性吸附，这样固定的蛋白质即可与特异性的多克隆或单克隆抗体相互作用。最后通过化学发光法或荧光方法进行蛋白条带显影。</p>
</blockquote>
<blockquote>
<p>其中SDS聚丙烯酰胺凝胶电泳条件是关系到蛋白条带是否均一、整齐、干净的关键步骤。</p>
</blockquote>
<h2 id="SDS-PAGE聚丙烯酰胺凝胶电泳的原理和步骤"><a href="#SDS-PAGE聚丙烯酰胺凝胶电泳的原理和步骤" class="headerlink" title="SDS-PAGE聚丙烯酰胺凝胶电泳的原理和步骤"></a>SDS-PAGE聚丙烯酰胺凝胶电泳的原理和步骤</h2><p><strong>SDS-PAGE</strong> （十二烷基硫酸钠–聚丙烯酰胺，sodium dodecyl sulfate – polyacrylamide gel electrophoresis）凝胶电泳是一种可以根据蛋白质的分子量分离样本中蛋白的技术。在电荷的影响下分离大分子称为电泳（electrophoresis）。在SDS-PAGE中使用的凝胶是聚丙烯酰胺（polyacrylamide），使蛋白质呈线性化的试剂是SDS。 因此得名SDS-PAGE。</p>
<h3 id="一、SDS-PAGE的原理"><a href="#一、SDS-PAGE的原理" class="headerlink" title="一、SDS-PAGE的原理:"></a>一、SDS-PAGE的原理:</h3><p>首先准备一套蛋白电泳设备，蛋白质样品和marker上样到凝胶孔中，设置电压，启动电泳程序。通常样本中会添加一种还原剂，如巯基乙醇或二硫苏糖醇(DTT)(在洗涤剂的存在下，如SDS），可以打开折叠蛋白质的二硫键；而样本中加入的SDS洗涤剂可以给所有蛋白质加上负电荷，从而将它们线性化成多肽。聚丙烯酰胺则是多肽电泳分离的介质。多肽在电场的作用下向阳极方向泳动。</p>
<p>蛋白电泳的迁移率与一下三个因素有关：</p>
<p>①　形状—所有的蛋白质在用还原剂处理后都处于一级结构中。 因此，形状不影响蛋白质的分离。</p>
<p>②　电荷—经过SDS处理后，所有的蛋白质都是负电荷， 因此，电荷不影响分离。</p>
<p>③　大小—蛋白质的分离完全与它们的分子量大小有关。</p>
<p>在电泳中，分子量越小的多肽移动得越快，因为它们遇到的阻力更小。分子量越大的多肽移动得更慢，因为它们遇到的阻力更大。因此蛋白质完全是因为分子量大小的不同而分开（如图1）。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-26a9bacb485bfc577ab19e732af15c7b_720w.webp"></p>
<h3 id="二、SDS-PAGE电泳中各主要试剂的作用："><a href="#二、SDS-PAGE电泳中各主要试剂的作用：" class="headerlink" title="二、SDS-PAGE电泳中各主要试剂的作用："></a>二、SDS-PAGE电泳中各主要试剂的作用：</h3><h5 id="1-β-巯基乙醇-二硫苏糖醇（DTT）"><a href="#1-β-巯基乙醇-二硫苏糖醇（DTT）" class="headerlink" title="1. β-巯基乙醇/二硫苏糖醇（DTT）"></a>1. β-巯基乙醇/二硫苏糖醇（DTT）</h5><p>β-巯基乙醇或二硫苏糖醇（DTT）做为还原剂添加入样品中，可以还原（分解）存在于蛋白质的肽链上半胱氨酸残基之间的二硫键(S-S键)。S-S键使蛋白质折叠形成二级结构。因为蛋白的构象会干扰电泳的迁移率。所以，当电泳时，消除蛋白构象对迁移率的干扰非常重要。β-巯基乙醇还原蛋白的二硫键为游离的-SH，样本中所有的蛋白都变成线性的一级结构，使其电泳迁移率只与蛋白分子量有关（图1）。</p>
<h5 id="2-十二烷基硫酸钠-SDS"><a href="#2-十二烷基硫酸钠-SDS" class="headerlink" title="2. 十二烷基硫酸钠 (SDS)"></a>2. 十二烷基硫酸钠 (SDS)</h5><p>在制备SDS-PAGE样品时，将SDS混合在样品缓冲液中。 蛋白样本用β-巯基乙醇处理后解聚成单一线性；用SDS处理后，所有蛋白质均只带负电荷。 SDS可以使所有的蛋白质分子均匀的带上负电荷(图01)。 因此，当施加电压时，所有的蛋白质都向凝胶的正极迁移。 因为，不同大小的蛋白质得到的负电荷与其分子量成正比，它们只因为分子量大小的不同而分离开，而不是因为带电荷的多少或者蛋白构象。 在凝胶中也存在SDS，这是为了确保所有的蛋白质在整个凝胶中保持荷载负电荷。</p>
<h5 id="3-溴酚蓝-BPB"><a href="#3-溴酚蓝-BPB" class="headerlink" title="3. 溴酚蓝 (BPB)"></a>3. 溴酚蓝 (BPB)</h5><p>溴酚蓝是电泳中的示踪染料，用于监测各个蛋白分子电泳过程的进展。 BPB与样品蛋白混合后上样，当电泳开始时，BPB与蛋白质一起迁移，但速度更快，会比样品中的任何蛋白质更快到达凝胶的末端，甚至缓冲液中的甘氨酸分子也在BPB之后到达末端。 BPB带有轻微的负电荷，这就是为什么它可以向阳极迁移，同时又可以作为蛋白质分子的示踪染料。</p>
<h5 id="4-聚丙烯酰胺凝胶"><a href="#4-聚丙烯酰胺凝胶" class="headerlink" title="4. 聚丙烯酰胺凝胶"></a>4. 聚丙烯酰胺凝胶</h5><p>聚丙烯酰胺凝胶是通过使用少量的交联剂（如N，N‘-亚甲基双丙烯酰胺）使单体丙烯酰胺在水中的聚合而成。因此，丙烯酰胺（Acrylamide）和双丙烯酰胺(Bis-acrylamide)共聚形成了丙烯酰胺的直链与双丙烯酰胺的相互联结形成三维网络结构。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-54f1bccefd52213e7ecf9d969972e929_b.jpg"></p>
<p>有其他的交联剂可以代替双丙烯酰胺（bisacrylamide），如：</p>
<p>² 哌嗪二丙烯酸酯 (PDA) –-可以用于降低SDS-PAGE胶的银染背景；</p>
<p>² N,N’- 酒石酸双丙烯铣胺 (DATD) –一种可以破坏交联剂而使凝胶可溶的试剂；</p>
<p>丙烯酰胺和双丙烯酰胺的比例决定了凝胶的孔径。 因此，在不连续凝胶体系中，会有不同浓度和pH的浓缩胶和分离胶。</p>
<h3 id="三、那么，浓缩胶是如何工作的呢？"><a href="#三、那么，浓缩胶是如何工作的呢？" class="headerlink" title="三、那么，浓缩胶是如何工作的呢？"></a>三、那么，浓缩胶是如何工作的呢？</h3><p>浓缩胶的目的是将需要分离的蛋白质混合物聚集在浓缩胶和分离胶的分界线上。 因此，所有的蛋白质首先被压缩累积在分界线上，然后，在大约同一时间进入分离凝胶，无论蛋白质的大小是多少。</p>
<p>2种分子与此有关：</p>
<p>①　紧随其后的来自Tris-Gly电泳缓冲液的甘氨酸分子</p>
<p>②　具备牵引作用的来自Tris-HCL 电泳缓冲液的氯化物离子</p>
<p>当施加电压后，甘氨酸分子（最简单的氨基酸）和Cl-开始通过凝胶向正极迁移。 由于甘氨酸分子在浓缩胶中以两性离子的形式存在，其电泳迁移速率非常慢。 氯离子比甘氨酸分子迁移得更快，产生了不平衡的正反离子区域，从而在氯离子和甘氨酸离子之间形成了很大的电压梯度。 在甘氨酸分子（最慢的)和氯离子(最快的）之间存在样本混合物中的所有蛋白质（图03）。样品分子在氯化物和甘氨酸之间中间迁移，逐渐被压缩成非常薄而清晰的蛋白层，方便后面更好的蛋白分离。</p>
<p>在这个阶段，样本蛋白分子处于两种离子（后面的甘氨酸和前面的氯离子Cl-）之间，在浓缩胶和分离胶之间形成薄薄的一层。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-6c85facd823b6328166fe18f1ffe34d2_720w.webp"></p>
<p>当蛋白分子到达分离胶界面时发生了什么？</p>
<p>当到达分离胶时，pH值增大，孔径急剧减小。在更高的pH值下，甘氨酸分子不再以两性离子的形式存在，它们在这个阶段就会电离，并开始比在浓缩胶中时迁移得更快。 氯离子Cl-很快就会向阳极迁移。 因此，一旦蛋白质不堆积，甘氨酸分子很快难以束缚样品蛋白质分子，蛋白质分子开始在电流的作用下按照分子量大小自由的分离(图4)。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-de6189d4cd377cffe335c8f9117c453d_720w.webp"></p>
<table>
<thead>
<tr>
<th></th>
<th>浓缩胶</th>
<th>分离胶</th>
</tr>
</thead>
<tbody><tr>
<td>聚丙烯酰胺浓度</td>
<td>低</td>
<td>高</td>
</tr>
<tr>
<td>孔径大小</td>
<td>更大</td>
<td>更小</td>
</tr>
<tr>
<td>Tris-HCl 的pH值</td>
<td>6.8</td>
<td>8.8</td>
</tr>
<tr>
<td>目的</td>
<td>使多肽链积聚在浓缩胶和分离胶的界线上</td>
<td>根据分子量大小分离多肽分子</td>
</tr>
</tbody></table>
<p><strong>过硫酸铵（APS）和TEMED</strong></p>
<p>凝胶的聚合是通过自由基机制发生的。 TEMED(N，N，N，N-四甲基乙二胺)作为催化剂，生成硫酸盐自由基。过硫酸铵是提供形成自由基的硫酸盐基团的。 这些用于自由基生成的硫酸盐由过硫酸铵提供，如图02所示。</p>
<h3 id="四、SDS-PAGE凝胶电泳的主要步骤："><a href="#四、SDS-PAGE凝胶电泳的主要步骤：" class="headerlink" title="四、SDS-PAGE凝胶电泳的主要步骤："></a>四、SDS-PAGE凝胶电泳的主要步骤：</h3><h5 id="1-先制备和灌注分离胶"><a href="#1-先制备和灌注分离胶" class="headerlink" title="1. 先制备和灌注分离胶:"></a>1. 先制备和灌注分离胶:</h5><p>制备分离胶需要两块玻璃板，一个短板，一个长板，将两块玻璃板夹在制胶架上（图5），灌胶完成后，加异丙醇赶走凝胶上面的气泡。关于灌胶的高度，这可以通过放置梳子确定，一般大约梳子下1cm,用笔标记制胶的高度，开始灌胶，加异丙醇封胶。等待胶凝固后，倒掉上层异丙醇，用吸水纸吸干异丙醇。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-2d20b9a30f6ac4b7bf76264825c6580b_720w.webp"></p>
<h5 id="2-再制备和灌注浓缩胶"><a href="#2-再制备和灌注浓缩胶" class="headerlink" title="2. 再制备和灌注浓缩胶:"></a>2. 再制备和灌注浓缩胶:</h5><p>当下层的分离胶凝固后，就可以开始直接加积层胶至玻璃最上层，然后插入梳子。等待积层胶凝固后，小心拔出梳子，避免用力过猛破坏了凝胶上样孔。</p>
<h5 id="3-点样至凝胶孔中："><a href="#3-点样至凝胶孔中：" class="headerlink" title="3. 点样至凝胶孔中："></a>3. 点样至凝胶孔中：</h5><p>用微量移液器向凝胶孔中依次加入蛋白marker和样本，蛋白marker是已知蛋白条带分子量的预染蛋白，可作为标定蛋白大小的标尺参考。然后依次点入其他样本至凝胶孔中。每孔的样本上样量保持一致（主要是质量一致），加样时要小心，确保不损坏加样孔的尺寸或不将样品溢出孔外，更不能把样本加到孔外。 在这个阶段，蛋白质的样品是蓝色的，因为在制备样品时使用了电泳指示剂染料–溴酚蓝</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-4c63a7a570cd2369994aff563d2963dc_720w.webp"></p>
<h5 id="4-设定电泳条件，启动电泳："><a href="#4-设定电泳条件，启动电泳：" class="headerlink" title="4. 设定电泳条件，启动电泳："></a>4. 设定电泳条件，启动电泳：</h5><p>将凝胶和玻璃板浸入电泳缓冲液中后，就可以开始设定电压和时间，开始电泳了。 当示踪染料到达或穿过凝胶时，停止电泳。</p>
<h5 id="5-分析蛋白条带"><a href="#5-分析蛋白条带" class="headerlink" title="5. 分析蛋白条带"></a>5. 分析蛋白条带</h5><p>考马斯亮蓝染色或者进行蛋白转膜以进行后续的免疫印迹实验；</p>
<p>用去离子水冲洗凝胶3-5次，以去除SDS和缓冲液。 它可能会阻碍染料（0.1%考马斯蓝）与蛋白质的结合。 然后将凝胶浸泡在考马斯蓝染液中染色，室温，摇床孵育。 一般蛋白质条带会在几分钟内开始出现，但完全染色大约需要1小时（图06）</p>
]]></content>
      <categories>
        <category>蛋白组</category>
      </categories>
      <tags>
        <tag>实验</tag>
      </tags>
  </entry>
  <entry>
    <title>PCR实验最常见的9个问题及解决方案</title>
    <url>/2022/11/08/031-pcr-shi-yan/</url>
    <content><![CDATA[<h2 id="1-如何有效设计引物"><a href="#1-如何有效设计引物" class="headerlink" title="1. 如何有效设计引物"></a>1. 如何有效设计引物</h2><ol>
<li><p>使用Oligo或Primer设计引物，</p>
</li>
<li><p>在保守区内设计</p>
</li>
<li><p>长度一般在18-27bp</p>
</li>
<li><p>上下游引物Tm值最好是60-75℃</p>
</li>
<li><p>GC含量=40%-60%</p>
</li>
<li><p>引物自身及引物之间不应存在互补序列，避免发夹结构</p>
</li>
</ol>
<h2 id="2-PCR电泳无扩增条带"><a href="#2-PCR电泳无扩增条带" class="headerlink" title="2. PCR电泳无扩增条带"></a>2. PCR电泳无扩增条带</h2><ol>
<li><p>酶失活或在反应体系中未加入酶。TaqDNA聚合酶因保存或运输不当而失活，往往通过更换新酶或用另一来源的酶以获得满意的结果。</p>
</li>
<li><p>模板含有杂质。特别是对甲醛固定及石蜡包埋的组织常含甲酸，造成DNA脱嘌呤而影响PCR的结果。</p>
</li>
<li><p>变性温度是否准确：PCR仪指示温度与实际温度是否相符，过高酶在前几个循环就迅速失活；过低则模板变性不彻底。</p>
</li>
<li><p>反应系统中污染了蛋白酶及核酸酶，应在未加Taq酶以前，将反应体系95℃加热5-10分钟。</p>
</li>
<li><p>引物变质失效。人工合成的引物是否正确。是否纯化，或因储存条件不当而失活。</p>
</li>
<li><p>引物错误。利用BLAST检查引物特异性或重新设计引物。</p>
</li>
<li><p>DNA凝胶电泳时加入阳性对照，确保不是DNA凝胶和PCR程序的问题。</p>
</li>
</ol>
<h2 id="3-PCR产物量过少"><a href="#3-PCR产物量过少" class="headerlink" title="3. PCR产物量过少"></a>3. PCR产物量过少</h2><ol>
<li><p>退火温度不合适。以2度为梯度设计梯度PCR反应优化退火温度。</p>
</li>
<li><p>DNA模板量太少。增加DNA模板量。</p>
</li>
<li><p>PCR循环数不足。增加反应循环数。</p>
</li>
<li><p>引物量不足。增加体系中引物含量。</p>
</li>
<li><p>延伸时间太短。以1kb/分钟的原则设置延伸时间。</p>
</li>
<li><p>变性时间过长。变性时间过长会导致DNA聚合酶失活。</p>
</li>
<li><p>DNA模板中存在抑制剂。确保DNA模板干净</p>
</li>
</ol>
<h2 id="4-扩增产物在凝胶中涂布或成片状条带弥散"><a href="#4-扩增产物在凝胶中涂布或成片状条带弥散" class="headerlink" title="4. 扩增产物在凝胶中涂布或成片状条带弥散"></a>4. 扩增产物在凝胶中涂布或成片状条带弥散</h2><ol>
<li><p>酶量过高。减少酶量；酶的质量差，调换另一来源的酶。</p>
</li>
<li><p>dNTP浓度过高。减少dNTP的浓度。</p>
</li>
<li><p>MgCl2浓度过高。可适当降低其用量。</p>
</li>
<li><p>模板量过多。质粒DNA的用量应&lt;50ng，而基因组DNA则应&lt;200ng。</p>
</li>
<li><p>引物浓度不够优化。对引物进行梯度稀释重复PCR反应。</p>
</li>
<li><p>循环次数过多；增加模板量减少循环次数至30，缩短退火时间及延伸时间，或改用二种温度的PCR循环。</p>
</li>
<li><p>退火温度过低。</p>
</li>
<li><p>电泳体系有问题：</p>
</li>
</ol>
<p> ①凝胶中缓冲液和电泳缓冲液浓度相差太大；</p>
<p> ②凝胶没有凝固好；</p>
<p> ③琼脂糖质量差。</p>
<ol start="9">
<li>若为PCR试剂盒则可能：</li>
</ol>
<p> ①由于运输储存不当引起试剂盒失效；</p>
<p> ②试剂盒本身质量有问题，如引物选择、循环参数等选择不当。</p>
<ol start="10">
<li>降解的陈旧模板扩增也易产生涂布。</li>
</ol>
<h2 id="5-扩增产物出现多条带（杂带）"><a href="#5-扩增产物出现多条带（杂带）" class="headerlink" title="5. 扩增产物出现多条带（杂带）"></a>5. 扩增产物出现多条带（杂带）</h2><ol>
<li><p><strong>引物用量偏大</strong>，<strong>引物的特异性不高</strong>。应调换引物或降低引物的使用量。</p>
</li>
<li><p>循环的次数过多。适当增加模板的量，减少循环次数。</p>
</li>
<li><p>酶的用量偏高或酶的质量不好，应降低酶量或调换另一来源的酶。</p>
</li>
<li><p>退火温度偏低，退火及延伸时间偏长。应提高退火温度，减少变性与延伸时间，也可采用二种温度的PCR扩增。以2度为梯度设计梯度PCR反应优化退火温度。</p>
</li>
<li><p>样品处理不当。</p>
</li>
<li><p>Mg2+浓度偏高，因适当调整Mg2+使用浓度。</p>
</li>
<li><p>若为PCR试剂盒，也可能时试剂盒本身质量有问题。</p>
</li>
<li><p>复制提前终止。使用非热启动的聚合酶时常有发生。冰上准备反应体系或采用热启动聚合酶。</p>
</li>
<li><p>反应缓冲液未完全融化或未充分混匀。确保反应缓冲液融化完全并彻底混匀。</p>
</li>
<li><p>引物特异性差。利用BLAST检查引物特异性或重新设计引物。</p>
</li>
<li><p>引物量过多。减少反应体系中引物的用量。</p>
</li>
<li><p>模板量过多。质粒DNA的用量应&lt;50ng，而基因组DNA则应&lt;200ng</p>
</li>
<li><p>外源DNA污染。确保操作的洁净</p>
</li>
</ol>
<h2 id="6-阴性对照出现条带"><a href="#6-阴性对照出现条带" class="headerlink" title="6. 阴性对照出现条带"></a>6. 阴性对照出现条带</h2><ol>
<li>试剂，枪头，工作台污染。使用全新的试剂和枪头，对工作台进行清洁</li>
</ol>
<h2 id="7-条带大小与理论不符"><a href="#7-条带大小与理论不符" class="headerlink" title="7. 条带大小与理论不符"></a>7. 条带大小与理论不符</h2><ol>
<li><p>污染。使用全新的试剂和枪头，对工作台进行清洁。</p>
</li>
<li><p>模板或引物使用错误。查看引物是否会扩增部分条带和模板是否正确。</p>
</li>
<li><p>基因亚型。对研究的基因进行序列分析和BLAST研究</p>
</li>
</ol>
<h2 id="8-持续出现假性条带"><a href="#8-持续出现假性条带" class="headerlink" title="8. 持续出现假性条带"></a>8. 持续出现假性条带</h2><ol>
<li>起始退火温度太低，或目的扩增产物和非目的产物的T值相差不大。可尝试适当提高PCR温度或者设置降落PCR，降低循环数</li>
</ol>
<h2 id="9-菌落PCR检测有条带，接种大摇后无条带"><a href="#9-菌落PCR检测有条带，接种大摇后无条带" class="headerlink" title="9. 菌落PCR检测有条带，接种大摇后无条带"></a>9. 菌落PCR检测有条带，接种大摇后无条带</h2><ol>
<li>可重新以菌落和菌液为模板进行PCR对照检测，因为菌落PCR的<strong>假阳性</strong>概率还是比较高。如果仍出现上述结果，推测可能是平板上连接液中的<strong>未连接载体的扩增</strong>引起的目的条带，进一步质粒PCR检测，可证明目的片段是否真正连接成功。</li>
</ol>
]]></content>
      <categories>
        <category>PCR</category>
      </categories>
      <tags>
        <tag>实验</tag>
      </tags>
  </entry>
  <entry>
    <title>酵母双杂交</title>
    <url>/2022/11/12/032-xiao-mu-shuang-za-jiao/</url>
    <content><![CDATA[<blockquote>
<p>酵母双杂交系统是在真核模式生物酵母中进行的，研究活细胞内蛋白质相互作用，对蛋白质之间微弱的、瞬间的作用也能够通过报告基因的表达产物敏感地检测得到，它是一种具有很高灵敏度的研究蛋白质之间关系的技术。大量的研究文献表明，酵母双杂交技术既可以用来研究哺乳动物基因组编码的蛋白质之间的互作，也可以用来研究高等植物基因组编码的蛋白质之间的互作。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-cd616c9fbb17b42a5605d03c4462f5af_720w.webp"></p>
<h2 id="一、实验目的："><a href="#一、实验目的：" class="headerlink" title="一、实验目的："></a>一、实验目的：</h2><p>验证PGBKT7-A与PGADT7-B是否为相互作用的关系</p>
<h2 id="二、实验原理："><a href="#二、实验原理：" class="headerlink" title="二、实验原理："></a>二、实验原理：</h2><p>Y2H的建立是基于对真核生物调控转录起始过程的认识，细胞起始基因转录需要有反式转录激活因子的参与;酵母转录因子 GAL4在结构上是组件式的，往往由功能上相互独立的结构域构成，其中有DNA结合功能域（DNA binding domain,DNA-BD）和转录激活结构域（activation domain，DNA-AD）;这两个结合域分开时仍分别具有功能，但不能激活转录。只有当被分开的两者通过适当的途径在空间上较为接近时，才能重新呈现完整的GAL4转录因子活性，使启动子下游基因得到转录。</p>
<blockquote>
<p>GAL4是酵母（Saccharomyces cerevisiae）转录激活蛋白Gal4的基因。Gal4能识别基因启动子的上游激活序列（UASg）的17bp长的一段序列：5’-CGGRNNRCYNYNYNCNCCG-3’（R表示嘌呤，Y表示嘧啶，N表示任意脱氧核苷酸）。GAL4与GAL80作用，GAL80可结合半乳糖代谢产物。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/Yeast-Two-Hybrid-yl.jpg"></p>
<h2 id="三、实验方法："><a href="#三、实验方法：" class="headerlink" title="三、实验方法："></a>三、实验方法：</h2><p>Clontech酵母双杂交系统</p>
<h2 id="四、实验设计："><a href="#四、实验设计：" class="headerlink" title="四、实验设计："></a>四、实验设计：</h2><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-c766f5bfe1fbd4fc3d8505ddc9d3af8c_720w.webp"></p>
<p>常用AD质粒</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-acf736e7b4e93b741c860a045a1de9f4_720w.webp"></p>
<p>常用AD质粒</p>
<p>【实验方案】</p>
<ol>
<li><p>构建bait protein到BD载体上，构建正确后转入酵母菌株。</p>
</li>
<li><p>构建prey protein到AD载体上。</p>
</li>
<li><p>通过检测bait protein在SD-Trp/-His/-Ade来检测Bait自激活情况。当存在轻微自激活时，改用全部报告基因检测条件，检测自激活情况。无自激活现象可继续实验；有自激活现象中止实验。</p>
</li>
<li><p>通过检测prey protein在SD-Leu/-His/-Ade来检测Prey自激活情况。当存在轻微自激活时，改用全部报告基因检测条件，检测自激活情况。无自激活现象可继续实验；有自激活现象中止实验。</p>
</li>
<li><p>通过检测BD-Bait与AD-空载体杂交菌株在SD-Trp/ -Leu/-His/ -Ade培养基上的生长情况，判断bait protein是否存在与DNA激活域的直接互作。有互作中止实验，无直接互作可继续实验。</p>
</li>
<li><p>通过检测AD-Prey与BD-空载体杂交菌株在SD-Trp/ -Leu/-His/ -Ade培养基上的生长情况，判断诱饵蛋白是否存在于DNA结合域的直接互作。有互作中止实验，无直接互作可继续实验。</p>
</li>
<li><p>杂交。</p>
</li>
<li><p>涂布SD-Trp/ -Leu获得杂交菌株。</p>
</li>
<li><p>涂布SD-Trp/ -Leu/-His/ -Ade验证互作情况。</p>
</li>
<li><p>酵母作图。</p>
</li>
<li><p>实验结束。</p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Reaction</th>
<th>AD plasmid</th>
<th>BD plasmid</th>
<th>涂板种类</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>pGADT7-largeT</td>
<td>pGBKT7-p53</td>
<td>SD-TL</td>
<td>阳性对照</td>
</tr>
<tr>
<td>2</td>
<td>pGADT7-largeT</td>
<td>pGBKT7-laminC</td>
<td>SD-TL</td>
<td>阴性对照</td>
</tr>
<tr>
<td>3</td>
<td>pGADT7-B</td>
<td>pGBKT7-A</td>
<td>SD-TL</td>
<td>实验组</td>
</tr>
<tr>
<td>4</td>
<td>pGADT7-B</td>
<td>pGBKT7</td>
<td>SD-TL</td>
<td>自激活检测</td>
</tr>
<tr>
<td>5</td>
<td>pGADT7</td>
<td>pGBKT7-A</td>
<td>SD-TL</td>
<td>自激活检测</td>
</tr>
</tbody></table>
<p>▼</p>
<table>
<thead>
<tr>
<th>Reaction</th>
<th>AD plasmid</th>
<th>BD plasmid</th>
<th>涂板种类</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>Empty-AD</td>
<td>Empty-BD</td>
<td>SD-TL</td>
<td>阳性对照</td>
</tr>
<tr>
<td>2</td>
<td>pGADT7-largeT</td>
<td>pGBKT7-laminC</td>
<td>SD-TL</td>
<td>阴性对照</td>
</tr>
<tr>
<td>3</td>
<td>D10-BD</td>
<td>JNK-AD</td>
<td>SD-TL</td>
<td>实验组</td>
</tr>
<tr>
<td>4</td>
<td>D10-AD</td>
<td>JNK-BD</td>
<td>SD-TL</td>
<td>实验组</td>
</tr>
<tr>
<td>5</td>
<td>D10-BD</td>
<td>Empty-AD</td>
<td>SD-TL</td>
<td>自激活检测</td>
</tr>
<tr>
<td>6</td>
<td>Empty-BD</td>
<td>JNK-AD</td>
<td>SD-TL</td>
<td>自激活检测</td>
</tr>
<tr>
<td>7</td>
<td>JNK-BD</td>
<td>Empty-AD</td>
<td>SD-TL</td>
<td>自激活检测</td>
</tr>
<tr>
<td>8</td>
<td>Empty-BD</td>
<td>D10-AD</td>
<td>SD-TL</td>
<td>自激活检测</td>
</tr>
</tbody></table>
<h2 id="五、结果展示："><a href="#五、结果展示：" class="headerlink" title="五、结果展示："></a>五、结果展示：</h2><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/640"></p>
<p>自激活检测&amp;互作检测结果</p>
<p>pGADT7-largeT/ pGBKT7-p53为阳性对照</p>
<p>pGADT7-largeT/pGBKT7-laminC为阴性对照</p>
<p>对照菌株在SD-TL缺陷平板上都能正常生长，而仅有阳性对照可在SD-TLHA缺陷平板生长。pGBKT7-A+ pGADT7、pGBKT7+ pGADT7-B转化子中随机挑选的菌落在SD-TLHA缺陷平板上不能生长，生长状态同阴性对照，因此不存在自激活。</p>
<h2 id="六、结论："><a href="#六、结论：" class="headerlink" title="六、结论："></a>六、结论：</h2><p>pGBKT7-A+ pGADT7-B在SD-TL、SD-TLHA缺陷平板上都能生长，证明这两个基因具有相互作用。</p>
<h2 id="七、其他"><a href="#七、其他" class="headerlink" title="七、其他"></a>七、其他</h2><h3 id="1-为什么选择酵母作为双杂交系统的报道株？"><a href="#1-为什么选择酵母作为双杂交系统的报道株？" class="headerlink" title="1.为什么选择酵母作为双杂交系统的报道株？"></a>1.为什么选择酵母作为双杂交系统的报道株？</h3><p>酵母作为酵母双杂交系统的报道株，它具有诸多优点：易于转化、回收扩增质粒；具有可直接进行选择的标记基因和特征性报道基因；酵母内源性蛋白不易同来源于哺乳动物的蛋白结合。</p>
<h3 id="2-酵母双杂交系统应用"><a href="#2-酵母双杂交系统应用" class="headerlink" title="2.酵母双杂交系统应用"></a>2.酵母双杂交系统应用</h3><p>检验一对已知蛋白间的相互作用；</p>
<p>用已知功能的蛋白基因筛选双杂交cDNA文库，以研究蛋白质之间相互作用的传递途径；</p>
<p>通过对待测蛋白做点突变或缺失突变处理，研究一对蛋白间发生相互作用所必需的结构域；</p>
<p>分析新基因的生物学功能。即以功能未知的新基因去筛选文库，然后根据钓到的已知基因的功能推测该新基因的功能。</p>
<h3 id="3-酵母双杂交系统优势"><a href="#3-酵母双杂交系统优势" class="headerlink" title="3.酵母双杂交系统优势"></a>3.酵母双杂交系统优势</h3><p>利用酵母双杂交系统可以直接、快速的研究蛋白-蛋白之间的相互作用，具有敏感性高、操作简便等优点</p>
<p>敏感性高：检测结果是基因表达产物的积累效应，如酵母的表型，因而可检测存在于蛋白之间微弱或暂时的相互作用</p>
<p>操作简便：与其它检测方法相比，酵母双杂交实验不需要进行蛋白纯化，省去了纯化蛋白质的繁琐步骤</p>
<p>真实性好：相互作用的验证在细胞内进行，能真实的反应蛋白间的相互作用</p>
<p>酵母双杂交系统 免疫共沉淀（Co-IP）</p>
<p>检测瞬时相互作用 是 否</p>
<p>检测弱相互作用 是 否</p>
<p>验证方式 体内相互作用检测 体内相互作用检测</p>
<p>是否需要蛋白纯化 否 是</p>
<p>是否需要抗体 否 是</p>
<p>表1：酵母双杂交与免疫共沉淀对比</p>
<h3 id="4-酵母双杂交系统局限性"><a href="#4-酵母双杂交系统局限性" class="headerlink" title="4.酵母双杂交系统局限性"></a>4.酵母双杂交系统局限性</h3><h5 id="①假阳性"><a href="#①假阳性" class="headerlink" title="①假阳性"></a>①假阳性</h5><p>假阳性是酵母双杂交实验常遇到的问题，假阳性是指两待测蛋白没有相互作用但依然显示出了阳性结果。产生假阳性的原因很多，如某些蛋白质本身具有激活转录功能或在酵母内表达时发挥转录激活作用，使DNA结合结构域杂交蛋白（BD-bait）在无特异激活结构域的情况下可激活转录。另外有些蛋白质表面有对其它蛋白质的低亲和力区，容易形成蛋白体复合物，能够引起报告基因表达，产生假阳性结果。</p>
<p>为了降低假阳性需要设计正确的对照，应对诱饵蛋白和靶蛋白能否单独激活报告基因做验证。使用两个或两个以上的报告基因也可以降低假阳性，利用两个以上报告基因，只有同时具有两种以上相应表型才是真阳性结果。另外， 将报告基因整合到染色体上，可以使基因表达水平稳定，消除了由于质粒拷贝数变化引起基因表达水平波动而造成的假阳性。</p>
<h5 id="②不能检测某些在核外蛋白之间的相互作用"><a href="#②不能检测某些在核外蛋白之间的相互作用" class="headerlink" title="②不能检测某些在核外蛋白之间的相互作用"></a>②不能检测某些在核外蛋白之间的相互作用</h5><p>酵母双杂交分析相互作用的蛋白必须定于核内才能激活报告基因，但是很多蛋白质的相互作用依赖于翻译后加工，如二硫键的形成等，而此过程需要在包浆内完成，这样有多种蛋白质不适用此方法。</p>
<p>为了解决这一问题，人们对酵母双杂交技术进行改进，发展了核外双杂交技术（见下文）。</p>
<h3 id="5-酵母双择交技术的新发展"><a href="#5-酵母双择交技术的新发展" class="headerlink" title="5.酵母双择交技术的新发展"></a>5.酵母双择交技术的新发展</h3><p>在传统酵母双杂交系统的基础上，发展了多种改型的双杂交技术以适应不同目的需要。</p>
<h3 id="6-反向双杂交技术"><a href="#6-反向双杂交技术" class="headerlink" title="6.反向双杂交技术"></a>6.反向双杂交技术</h3><p>反向杂交技术（也成反式双杂交技术）主要用于在确定蛋白质之间相互作用后，进一步研究其结构和功能的关系，确定蛋白质间作用的关键位点或起决定作用的个别氨基酸、特定结构等。这项技术的特点是采取了反选择筛选策略，其关键是报道基因的表达产物对细胞生长有抑制作用。这样当诱饵蛋白与靶蛋白存在相互作用时，表达出有毒性的报道蛋白，细胞不能生长。</p>
<p>例如Vidal等采用了反式选择性的报告基因URA3，其编码的酶使细胞不能在5一氟乳清酸存在的情况下下生长。如果融合蛋白的相互作用被阻断， URA3则不表达，酵母菌表现对5一氟乳清酸的抗性。因此，采用反式双杂交系统可以很容易地检验出与某一蛋白相互作用的蛋白的突变体。对突变体进行研究，即可找出影响蛋白质间相互作用的关键位点。</p>
<h3 id="7-酵母三杂交系统"><a href="#7-酵母三杂交系统" class="headerlink" title="7.酵母三杂交系统"></a>7.酵母三杂交系统</h3><p>酵母三杂交系统</p>
<p>酵母三杂交系统可以用于检测蛋白质-核酸之间的相互作用。三杂交系统的本质与双杂交是相同的，只是需通过第三个分子的介导把两个杂交蛋白带到一起。它的基本原理是将一个已知与RNA结合的蛋白与BD构建第一个融合蛋白，将待测蛋白质与AD构建第二个融合蛋白，同时构建一条含有两个不同结合位点的融合RNA，当RNA与两个融合蛋白相结合时，可激活报道基因的表达。除了蛋白质-核酸之间的相互作用，酵母三杂交系统也可用于检测检测蛋白质与肽配体、蛋白质与有机小配体、蛋白质与蛋白激酶间的相互作用。</p>
<p>核外双杂交技术</p>
<p>在传统的酵母双杂交系统中，蛋白之间的相互作用是在细胞核内发生的。因此，它不能检测某些在核外蛋白之间的相互作用。为了克服这种局限性，发展出了核外双杂交技术。该技术以SRS 和 USPS两种系统为代表。</p>
<p>SRS 也称 Sos 蛋白召集系统 （Sos RecruitmentSystem） 。它的基本原理是分别将待测蛋白X与哺乳动物细胞的一种鸟苷交换因子（ EGF） Sos蛋白融合;将Y蛋白与锚定在酵母细胞膜上的Src肉豆寇烯化信号蛋白融合 ，并使它们共表达于一个cdc25-2基因温度敏感型突变的酵母菌株内。由于该菌株中cdc25-2基因编码的 EGF 蛋白在 36 ℃条件下不能激活细胞膜上的Ras蛋白，Ras途径不通。所以细胞无法在36 ℃条件下生存。但如果待测蛋白X与Y之间发生相互作用就能把Sos蛋白带到细胞膜上并激活附近的Ras蛋白，从而打通Ras途径，使该菌株获得在36℃条件下生存的能力。</p>
<p>USPS也称为基于遍在蛋白的裂解蛋白感受器。它的设计是根据这样一个事实，即真核细胞中遍在蛋白与某一蛋白之间新生成的融合会被遍在蛋白特异的蛋白酶（UBPs） 迅速切开，但这种切割只有当遍在蛋白正确折叠时才会发生。研究发现，遍在蛋白基因的N端和C端这两部分即使分离，只要共表达与同一个细胞内，它们仍能正确折叠。将待测蛋白X与带有点突变的遍在蛋白N端片段融合，将待测蛋白Y与下游接有报告蛋白的正常遍在蛋白C端片段融合，并使它们共表达与同一个细胞内。因遍在蛋白N端片段内含有点突变，它与C端片段之间不能自然形成正确的折叠。只有当蛋白X和Y之间发生相互作用时才能克服点突变的影响，使遍在蛋白的两端形成正确折叠，从而引来UBPs切除与C端片段连接的报告蛋白。此技术建立之初是通过Western blot检测有无被切下的报告蛋白来判断待测蛋白之间是否发生了相互作用的，所以操作比较繁琐，不便于推广。最近有人对它作了改进 ，以一种融合的转录激活因子PLV作为报告蛋白。PLV一旦被从遍在蛋白C端片段上切下，它就会进入细胞核内激活特定的报告基因 ，如LacZ和HIS3等。这样就可以根据转化细胞是否生长及显色来判断待测蛋白之间有无相互作用。因此极大地简化了操作步骤，提高了筛选效率。</p>
]]></content>
      <categories>
        <category>蛋白组</category>
      </categories>
      <tags>
        <tag>实验</tag>
      </tags>
  </entry>
  <entry>
    <title>免疫共沉淀（Co-IP）</title>
    <url>/2022/11/15/033-mian-yi-gong-chen-dian-co-ip/</url>
    <content><![CDATA[<blockquote>
<p>蛋白间相互作用是细胞各种基本功能的主要完成者，参与几乎所有的重要生命活动。因此，蛋白-蛋白相互作用研究以及建立相互作用的关系网络图，具有十分重要的意义，也是目前蛋白质研究领域的热点。</p>
</blockquote>
<blockquote>
<p>Co-IP（免疫共沉淀，co-inmunoprecipitation）是经典的利用抗体从样品中捕获靶蛋白及其互作蛋白、复合体的一项技术，能够特异性富集所研究的目的蛋白。由于过程中采用了非变性条件，保留了互作及复合体的细胞内状态。相对于酵母双杂交、pull down等方法，其特色之一便是捕获的蛋白互作发生在所研究的特定组织细胞内，保存了互作蛋白及复合体的“内源”状态。</p>
</blockquote>
<h2 id="一、Co-IP实验原理："><a href="#一、Co-IP实验原理：" class="headerlink" title="一、Co-IP实验原理："></a>一、Co-IP实验原理：</h2><p>以抗体和抗原之间的专一性作用为基础的用于研究蛋白质相互作用的经典方法，是确定两种蛋白质在完整细胞内生理性相互作用的有效方法。</p>
<p>当细胞在非变性条件下被裂解时，完整细胞内存在的许多蛋白质－蛋白质间的相互作用被保留了下来。如果用蛋白质X的抗体免疫沉淀X，那么与X在体内结合的蛋白质Y也能沉淀下来。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-f747d49a139b7809315b0237a7db2437_720w.webp"></p>
<h2 id="二、Co-IP实验优势："><a href="#二、Co-IP实验优势：" class="headerlink" title="二、Co-IP实验优势："></a>二、Co-IP实验优势：</h2><p>a) 取材可以选择该目的蛋白所在物种、特定组织、细胞，因此CoIP能够反应该蛋白在天然组织细胞状态下存在的互作关系蛋白；</p>
<p>b) 找出整个复合体中直接/间接互作的多个蛋白，研究复合体组成；</p>
<p>c) 通过与质谱鉴定连用可以初筛到一系列未知蛋白，再通过其他技术进一步验证。</p>
<h2 id="三、Co-IP实验注意事项"><a href="#三、Co-IP实验注意事项" class="headerlink" title="三、Co-IP实验注意事项"></a>三、Co-IP实验注意事项</h2><p>a)需要特异性IP级别诱饵蛋白抗体（重点）；</p>
<p>b)如果没有特异性抗体，则需要考虑构建重组标签质粒，用标签抗体进行CoIP实验；</p>
<p>c)样品种类实验风险：过表达细胞样品 IP全称是immunoprecipitation，即免疫沉淀，这一步主要是为了纯化目的蛋白。</p>
<blockquote>
<p>IB全称是immunoblotting，即免疫印迹，也就是常规的Western Blotting，用于显示目的蛋白。</p>
</blockquote>
<blockquote>
<p>WCL全称是whole cell lysates，即整个细胞的裂解成分。</p>
</blockquote>
<blockquote>
<p>HC全称是heavy chain，即重链，</p>
</blockquote>
<blockquote>
<p>LC全称是light chain，即轻链。</p>
</blockquote>
<h3 id="现在将图分为三部分，先看第一部分，即上面的部分，“-”表示含有这种蛋白，“-”表示没有，这个实验一共做了四组，从左到右分别为："><a href="#现在将图分为三部分，先看第一部分，即上面的部分，“-”表示含有这种蛋白，“-”表示没有，这个实验一共做了四组，从左到右分别为：" class="headerlink" title="现在将图分为三部分，先看第一部分，即上面的部分，“+”表示含有这种蛋白，“-”表示没有，这个实验一共做了四组，从左到右分别为："></a>现在将图分为三部分，先看第一部分，即上面的部分，“+”表示含有这种蛋白，“-”表示没有，这个实验一共做了四组，从左到右分别为：</h3><p>（1）只表达HA-cGAS的293T细胞；</p>
<p>（2）共同表达HA-cGAS与NRLP14-FL的293T细胞；</p>
<p>（3）只表达STING-HA的293T细胞；</p>
<p>（4）共同表达STING-HA与与NRLP14-FL的293T细胞，如下所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-8b2f8f638a7e7e242fd995311a0538fd_720w.webp"></p>
<h3 id="再看第二部分WB的图，WB的图就是使用含有FLAG抗体的珠子拉下来的蛋白做的，使用拉下来的这些蛋白再做WB，它的原理前面已经描述过了。使用FLAG抗体的珠子拉下来的蛋白使用HA抗体来进行检测，其结果如下："><a href="#再看第二部分WB的图，WB的图就是使用含有FLAG抗体的珠子拉下来的蛋白做的，使用拉下来的这些蛋白再做WB，它的原理前面已经描述过了。使用FLAG抗体的珠子拉下来的蛋白使用HA抗体来进行检测，其结果如下：" class="headerlink" title="再看第二部分WB的图，WB的图就是使用含有FLAG抗体的珠子拉下来的蛋白做的，使用拉下来的这些蛋白再做WB，它的原理前面已经描述过了。使用FLAG抗体的珠子拉下来的蛋白使用HA抗体来进行检测，其结果如下："></a>再看第二部分WB的图，WB的图就是使用含有FLAG抗体的珠子拉下来的蛋白做的，使用拉下来的这些蛋白再做WB，它的原理前面已经描述过了。使用FLAG抗体的珠子拉下来的蛋白使用HA抗体来进行检测，其结果如下：</h3><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-1c5b5a85f1e2c9775ca481d37e799833_720w.webp"></p>
<p>从上面的图像可以看出以下信息：</p>
<p>第一，HC与LC条带都非常明显，之所以出现这个条件是因为，在WB之前进行的蛋白变性这一步，由于加样缓冲液中含有巯基乙醇，巯基乙醇会把抗体的重链和轻链之间的二硫键破坏，从而使的抗体变成<strong>重链分子55KD</strong>和<strong>轻链分子25KD</strong>，因此会在结果中呈现两个条带。</p>
<p>第二，第一组（只表达HA-cGAS的293T细胞）中没有条带，第二组（共同表达HA-cGAS与NRLP14-FL的293T细胞）没有条带，第三组（只表达STING-HA的293T细胞）有一点点条带，第四组（共同表达STING-HA与与NRLP14-FL的293T细胞）条带明显，这<strong>说明NLRP14与STING有相互作用</strong>，为什么说有相互作用呢？因为我们是用FLAG抗体来拉的蛋白，从理论上讲，我们只能拉下FLAG标记的NLRP14，也就是NLRP14-FL（FL就是FLAG），但是，从拉下的蛋白中用HA进行检测，居然检测出来了HA标记的STING，这就说明，使用FLAG拉NLRP14-FL时，这个蛋白复合物中含有STING-HA。</p>
<h3 id="再看图的第三部分，也就是下面的这一部分，是用FLAG抗体和HA抗体来进行检测整个细胞的裂解液，是作为阳性对照（有的文献中会标明input组），如下所示："><a href="#再看图的第三部分，也就是下面的这一部分，是用FLAG抗体和HA抗体来进行检测整个细胞的裂解液，是作为阳性对照（有的文献中会标明input组），如下所示：" class="headerlink" title="再看图的第三部分，也就是下面的这一部分，是用FLAG抗体和HA抗体来进行检测整个细胞的裂解液，是作为阳性对照（有的文献中会标明input组），如下所示："></a>再看图的第三部分，也就是下面的这一部分，是用FLAG抗体和HA抗体来进行检测整个细胞的裂解液，是作为阳性对照（有的文献中会标明input组），如下所示：</h3><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/v2-7cadfdc3010f33836517b7861138245c_720w.webp"></p>
<p>其中右侧的WCL表示的是整个细胞的裂解液，也就是还没有使用FLAG抗体的珠子去拉的时候的样本，也就是说直接裂解了293T细胞后的样本，从这个结果中可以得到以下信息：</p>
<p>第一，在使用FLAG抗体进行检测全蛋白时，相当于阳性对照。</p>
<p>第一组（只表达HA-cGAS的293T细胞）中没有条带，因为这种293T细胞中只有HA标记的cGAS，</p>
<p>第二组（共同表达HA-cGAS与NLRP14-FL的293T细胞）有条带，因为FLAG抗体能检测出使用了FLAG标记的NLRP14，NLRP14的蛋白分子量大概是125kD，</p>
<p>第三组（只表达STING-HA的293T细胞）没有条带，因此这种293T细胞只表达HA标记的STING；</p>
<p>第四组（共同表达STING-HA与与NLRP14-FL的293T细胞）条带明显，因为这个细胞中含有FLAG标记的NLRP14。</p>
<p>第二，使用HA抗体检测全蛋白，这是阳性对照，是说明细胞中含有相应的蛋白。</p>
<p>我们可以发现，</p>
<p>第一组（只表达HA-cGAS的293T细胞）在27kD附近没有条件，在50kD部分有条带，这说明，全蛋白中含有HA标记的cGAS（cGAS的蛋白分子量是62kD，多数蛋白标签的分子量很少，基本可以忽略），做这个实验主要是作为阳性对照；</p>
<p>第二组（共同表达HA-cGAS与NLRP14-FL的293T细胞）在37kD附近没有条带，在50kD附近有条带；结合前面的结果来看，就说明这个细胞中含有HA标记的cGAS（因为它的分子量大概是50kD），还含有FALG标记的NLRP14（因为NLRP14的蛋白分子量大概是125kD）；</p>
<p>第三组（只表达STING-HA的293T细胞）在37kD处有条带，这说明细胞中含有HA标记的STING（因为STING的分子量大概是35kD）；</p>
<p>第四组（共同表达STING-HA与与NLRP14-FL的293T细胞）在110kD处有条带，在37kD处也有条带，这说明这种细胞中含有NLRP14与STING。</p>
<p>从上面的图片可以知道，<strong>在做Co-IP实验时，需要设立阳性对照组来证明你的细胞中有某个蛋白A与B，再使用抗蛋白A的抗体来拉A蛋白，再使用抗蛋白B的抗体来检测拉下来的蛋白，如果检测到了蛋白B，就说明蛋白A与蛋白B有相互作用。</strong></p>
]]></content>
      <categories>
        <category>蛋白组</category>
      </categories>
      <tags>
        <tag>实验</tag>
      </tags>
  </entry>
  <entry>
    <title>1.NPC内网穿透——Linux</title>
    <url>/2025/07/24/18/</url>
    <content><![CDATA[<blockquote>
<p>历时半个月，浅浅学习了一下重测序数据的分析流程，为防止遗忘，特写此后几篇文章，以便后续回忆参考。</p>
</blockquote>
<blockquote>
<p>要进行重测序数据分析，首要的是搞一台服务器，恰好课题组有一台服务器，但问题是只能在内网访问，遂采用NPC进行内网穿透，实现异地访问使用。</p>
</blockquote>
<p>用到的软件<br><a href="https://kmxo.lanzoub.com/iF7O730413eb">linux-npc.zip - 蓝奏云</a><br><a href="https://d-jy.net/docs/nps/?lang=zh#/use">使用教程</a><br>共两个步骤<br>1.下载npc客户端后修改 npc.conf文件<br>模板参考<br>修改前</p>
<pre class="line-numbers language-none"><code class="language-none">[common]
server_addr=填写服务器IP地址:8024
conn_type=tcp
vkey=唯一验证密钥
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>示例如下：<br>修改前</p>
<p><img src="/images/18/953241429.png" alt="mdqu8nxa.png"></p>
<p>修改后</p>
<p><img src="/images/18/1669145814.png" alt="mdqu91bc.png"></p>
<p>2.在文件目录中执行以下命令需要修改ip和密钥<br>（不要修改服务端口和删除空格）</p>
<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>


<h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><ol>
<li>无配置文件模式（推荐）<br>详细命令行参数</li>
</ol>
<p>📌 适用于</p>
<p>快速连接 NPS 服务器<br>所有配置均在 Web 管理端完成<br>客户端仅需运行一条命令<br>📌 普通连接（TCP 模式）</p>
<p> <code>./npc -server=ip:8024 -vkey=web界面中显示的密钥 -type=tcp</code> </p>
<p>📌 TLS 加密连接（安全模式）</p>
<p> <code>./npc -server=ip:8025 -vkey=web界面中显示的密钥 -type=tls</code> </p>
<p>📌 连接多个服务端</p>
<p> <code>./npc install -server=xx:12,yy:34 -vkey=xx,yy -type=tcp,tls</code> </p>
<p>📌 说明：</p>
<p>默认端口 8024 为非 TLS 端口，用于普通 TCP 连接<br>如果 -type=tls，必须使用 8025 作为 TLS 端口，否则连接失败</p>
<ol start="2">
<li>注册到系统服务（开机启动 &amp; 守护进程）<br>📌 适用于</li>
</ol>
<p>保证 NPC 在服务器重启后自动运行<br>无需手动启动，后台运行<br>Linux/macOS</p>
<pre class="line-numbers language-none"><code class="language-none"># 普通连接（TCP）
sudo ./npc install -server=ip:8024 -vkey=xxx -type=tcp -log=off
# TLS 加密连接（安全模式）
sudo ./npc install -server=ip:8025 -vkey=xxx -type=tls -log=off
# 连接多个服务端
sudo ./npc install -server=xx:12,yy:34 -vkey=xx,yy -type=tcp,tls -log=off

# 启动服务
sudo npc start
# 停止服务
sudo npc stop
# 卸载（修改参数时需要先卸载再重新注册）
 sudo npc uninstall <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>

<p>后面就是开放相应的端口，实现远程访问。</p>
]]></content>
      <categories>
        <category>默认分类</category>
      </categories>
  </entry>
  <entry>
    <title>2.重测序数据分析——初步整理</title>
    <url>/2025/07/31/19/</url>
    <content><![CDATA[<blockquote>
<p>布置好服务器后就是对重测序数据进行分析了。<br>首先，看一下我手里的数据，其实已经有公司处理好的数据了，在此，我并未对重测序下机原始数据进行分析，而是使用的公司初步过滤的 Filter.snp.vcf.gz和.tbi文件。</p>
</blockquote>
<p>前期在写重测序相关的专利，看别人专利时，发现重测序可进行Fst计算分析，绘制的图类似GWAS的曼哈顿图，遂想模仿绘制，便有了下面的一系列相关内容。</p>
<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>

<h1 id="一、FST和GWAS："><a href="#一、FST和GWAS：" class="headerlink" title="一、FST和GWAS："></a>一、FST和GWAS：</h1><p>首先，先介绍一下FST和GWAS，二者都是遗传学中常用的分析方法，但它们的目的和分析方式不一样。</p>
<ul>
<li>FST（Fixation Index）是用来衡量不同群体之间的遗传差异。如果两个群体在某些基因上有很大的差异，FST 值就会很高，说明这两个群体在基因组上有很大分化。</li>
<li>GWAS（全基因组关联研究）是用来找出基因和特定性状之间的关系。简单来说，它帮助我们发现哪些基因变异可能会影响某个性状（比如身高、疾病或壳色）。</li>
</ul>
<h2 id="以黑白壳长牡蛎为例"><a href="#以黑白壳长牡蛎为例" class="headerlink" title="以黑白壳长牡蛎为例"></a>以黑白壳长牡蛎为例</h2><p>假设我们研究的是黑壳和白壳长牡蛎，这两种牡蛎的壳色差异显著，我们分别进行 FST和 GWAS 分析，使用 黑壳牡蛎 和 白壳牡蛎 作为群体标签。<br>FST 分析：我们将所有牡蛎按壳色分成两个群体，分别是 黑壳牡蛎 和 白壳牡蛎。通过计算 FST 值，我们能发现这两个群体之间在基因组中哪些区域的差异最大。如果某个基因区域的 FST 值很高，说明这个区域可能与这两个群体的遗传差异有关。<br>GWAS 分析：这里我们把牡蛎的壳色作为 表型，看看基因组中的哪些变异（SNP）与壳色相关。我们仍然用 黑壳牡蛎 和 白壳牡蛎 作为两组样本，进行统计分析，找出哪些基因变异可能影响壳色。<br>FST 和 GWAS 的区别<br>FST 分析 主要是比较两个群体（黑壳和白壳牡蛎）在基因组上的差异，找出遗传分化最大的区域。FST 是群体层面的分析，不直接与表型（如壳色）相关。<br>GWAS 分析 关注的是表型与基因型之间的关联，目的是找出影响牡蛎壳色的具体基因变异。在这个过程中，壳色作为表型，与基因变异建立直接关系。</p>
<p>虽然 黑壳牡蛎 和 白壳牡蛎 都可以作为群体标签（FST）或表型分组（GWAS），但它们的分析目的不同：<br>FST 是用来研究群体之间的遗传分化，揭示哪些基因区域可能在两种牡蛎群体之间有显著差异。<br>GWAS 则是通过关联分析找出哪些基因变异直接影响牡蛎的壳色。<br>这两种方法可以互相补充，共同揭示基因和表型之间复杂的关系。</p>
<h2 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h2><p>虽然 <strong>FST</strong> 和 <strong>GWAS</strong> 都涉及基因组和表型之间的关系，但它们的目的和侧重点其实是有区别的。虽然在 <strong>黑壳牡蛎</strong> 和 <strong>白壳牡蛎</strong> 的例子中，确实它们的分析结果看起来有些相似，但 <strong>FST</strong> 和 <strong>GWAS</strong> 的核心概念还是有本质区别的。</p>
<p>我们来逐一比较一下两者的侧重点，看看为什么它们的目的不同，即使在分析黑白壳差异时，结果可能会有交集。</p>
<h3 id="🧬-FST-和-GWAS-的核心区别"><a href="#🧬-FST-和-GWAS-的核心区别" class="headerlink" title="🧬 FST 和 GWAS 的核心区别"></a>🧬 <strong>FST 和 GWAS 的核心区别</strong></h3><ol>
<li><p><strong>FST 分析</strong>：<br>FST 用来衡量<strong>不同群体之间的遗传分化</strong>。它通过比较群体间的基因频率差异，找出哪些区域在群体之间分化最显著。重点是研究群体 <strong>A</strong> 和 <strong>B</strong>（比如黑壳和白壳牡蛎）是否有不同的遗传背景，尤其是群体间的遗传结构。</p>
<ul>
<li><strong>目标</strong>：找出群体间在基因组上最显著的分化区域。</li>
<li><strong>侧重点</strong>：群体差异、基因变异的分布，通常不直接关注与某个特定表型（如壳色）的关联。</li>
</ul>
<p>举个例子：</p>
<ul>
<li><strong>黑壳和白壳牡蛎</strong>之间，可能会发现某些基因区域的 <strong>FST 值很高</strong>，说明这些区域在两个群体之间的遗传差异很大，但这并不意味着这些基因变异一定会影响壳色。</li>
</ul>
</li>
</ol>
<hr>
<ol start="2">
<li><p><strong>GWAS 分析</strong>：<br>GWAS 的目的是研究基因型和<strong>特定表型</strong>之间的关联，它是通过统计分析来找出与表型（比如牡蛎壳色）相关的遗传变异。在 <strong>GWAS</strong> 中，重点是找出哪些特定的 <strong>基因变异</strong> 直接影响了我们关注的 <strong>表型</strong>（比如壳色的白色或黑色）。</p>
<ul>
<li><strong>目标</strong>：找出与表型（如壳色）相关的基因变异。</li>
<li><strong>侧重点</strong>：基因与表型（壳色）之间的直接关系。</li>
</ul>
<p>举个例子：</p>
<ul>
<li>在 <strong>GWAS 分析</strong> 中，我们的目标是找出哪些 <strong>SNP</strong> 直接与壳色（黑色或白色）相关。如果某个基因区域的 <strong>SNP</strong> 在黑壳牡蛎和白壳牡蛎之间有显著差异，那么我们会认为这个变异可能与壳色性状相关。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="🧩-区别的关键点："><a href="#🧩-区别的关键点：" class="headerlink" title="🧩 区别的关键点："></a>🧩 <strong>区别的关键点</strong>：</h3><table>
<thead>
<tr>
<th>项目</th>
<th>FST</th>
<th>GWAS</th>
</tr>
</thead>
<tbody><tr>
<td><strong>目标</strong></td>
<td>研究群体间的遗传分化，找出群体间差异最大的基因区域</td>
<td>找出与特定表型（如壳色）相关的基因变异</td>
</tr>
<tr>
<td><strong>关注点</strong></td>
<td>群体的遗传结构差异</td>
<td>基因与表型的直接关联</td>
</tr>
<tr>
<td><strong>分析方式</strong></td>
<td>比较不同群体的基因频率差异，计算 <strong>FST 值</strong></td>
<td>将基因型数据与表型数据结合，进行 <strong>关联分析</strong></td>
</tr>
<tr>
<td><strong>最终结果</strong></td>
<td>找出遗传分化较大的区域</td>
<td>找到影响表型的基因变异（SNP）</td>
</tr>
</tbody></table>
<h3 id="🌿-简单总结："><a href="#🌿-简单总结：" class="headerlink" title="🌿 简单总结："></a>🌿 <strong>简单总结：</strong></h3><ul>
<li><p><strong>FST</strong> 分析关注的是群体之间<strong>遗传结构</strong>的差异，它告诉你 <strong>哪些基因区域</strong> 在不同群体（黑壳和白壳牡蛎）之间分化最大，<strong>但并不直接关注这些区域是否与表型（壳色）相关</strong>。</p>
</li>
<li><p><strong>GWAS</strong> 直接关注的是基因和表型之间的关联，它告诉你 <strong>哪些特定的基因变异</strong> 与壳色变化有直接关系，<strong>并且是针对表型的分析</strong>。</p>
</li>
</ul>
<h3 id="🔄-为什么这两者有重叠但不完全相同："><a href="#🔄-为什么这两者有重叠但不完全相同：" class="headerlink" title="🔄 为什么这两者有重叠但不完全相同："></a>🔄 <strong>为什么这两者有重叠但不完全相同：</strong></h3><ul>
<li>如果你在 <strong>FST 分析</strong> 中发现某个区域的 <strong>FST 值很高</strong>，这表明该区域可能在群体间存在显著差异。</li>
<li>然后，如果你再做 <strong>GWAS</strong> 分析，发现这个区域的变异确实与 <strong>壳色</strong> 相关，那么就可以确定这个基因区域<strong>可能影响壳色</strong>，而且它是群体分化的热点。</li>
</ul>
<p>因此，<strong>FST</strong> 主要是用来筛选出潜在的遗传分化区域，而 <strong>GWAS</strong> 是用来验证这些区域与表型的关联。</p>
<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>

<p>下面我们进行相关的FST分析</p>
<h1 id="二、FST计算"><a href="#二、FST计算" class="headerlink" title="二、FST计算"></a>二、FST计算</h1><p>最头疼的一步，布置环境，安装分析所用的软件包。<br>plink1.9和plink2.0均未成功分析，遂使用vcftools进行处理。</p>
<p>文件为 Filter.snp.vcf.gz，如果需要解压就使用下面方法</p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">gunzip  Filter.snp.vcf.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>vcftools使用mamba构建新环境</p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">conda install -n base -c conda-forge mamba  # 安装mamba
mamba create -n vcftools_env -c bioconda vcftools<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">vcftools --vcf Filter.snp.vcf \
         --weir-fst-pop BM.txt \
         --weir-fst-pop WM.txt \
         --out BM_vs_WM_fst<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>得出BM_vs_WM_fst.weir.fst文件</p>
<p>然后在R中进行绘图。</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">library(ggplot2)
fst %
  summarise(center = (min(pos_cum) + max(pos_cum)) / 2)

# 设置显著阈值线（例如 top 1%）
fst_threshold %  # 调整抽样比例(1-5%)
  ungroup()

# 2. 直接使用plot_ly() + scattergl模式（最佳性能）
p %
layout(
  xaxis = list(
    title = "Chromosome",
    tickvals = axis_df$center,
    ticktext = axis_df$CHROM
  ),
  yaxis = list(title = "FST"),
  hoverlabel = list(bgcolor = "white")
) %&gt;%
config(
  displayModeBar = TRUE,
  scrollZoom = TRUE
)

p<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="/images/19/3703765276.png" alt="mdvvhepw.png"><br>结果文件200多M，太大了，浏览器卡的几乎无法正常浏览，遂放弃。</p>
<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>

<blockquote>
<p>下面尝试过滤后再分析</p>
</blockquote>
<p>画图结果显示SNP位点过多，需要再次处理</p>
<p>文件其实已经是公司过滤过的数据了，数据量较大，再过滤一次。</p>
<h2 id="1-使用-vcftools-或-bcftools-进行-SNP-过滤"><a href="#1-使用-vcftools-或-bcftools-进行-SNP-过滤" class="headerlink" title="1. 使用 vcftools 或 bcftools 进行 SNP 过滤"></a>1. 使用 vcftools 或 bcftools 进行 SNP 过滤</h2><pre class="line-numbers language-Bash" data-language="Bash"><code class="language-Bash"># 基本质量过滤
 vcftools --vcf  Filter.snp.vcf \
         --minQ 30 \
         --min-meanDP 10 \
         --max-meanDP 100 \
         --min-alleles 2 \
         --max-alleles 2 \
         --maf 0.05 \
         --max-missing 0.9 \
         --recode \
         --out filtered<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-使用-PLINK-进行FST计算"><a href="#2-使用-PLINK-进行FST计算" class="headerlink" title="2. 使用 PLINK 进行FST计算"></a>2. 使用 PLINK 进行FST计算</h2><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 转换为 PLINK 格式</span>
plink --vcf filtered.recode.vcf --make-bed --out filtered_plink

<span class="token title important"><span class="token punctuation">##</span> 计算群体间 FST</span>
plink --bfile filtered_plink \
      --fst \
      --within pop_info_fixed.tsv \
      --out fst_results \
      --allow-extra-chr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="3-筛选显著-FST-位点"><a href="#3-筛选显著-FST-位点" class="headerlink" title="3.筛选显著 FST 位点"></a>3.筛选显著 FST 位点</h2><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> 提取 FST &gt; 0.05 的位点（阈值根据研究设定）</span>
 awk '$5 &gt; 0.05 {print $2}' fst_results.fst &gt; high_fst_snps.txt 

<span class="token title important"><span class="token punctuation">##</span> 统计高 FST 位点数量</span>
 wc -l high_fst_snps.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-可视化-FST-分布（R-代码）"><a href="#4-可视化-FST-分布（R-代码）" class="headerlink" title="4.可视化 FST 分布（R 代码）"></a>4.可视化 FST 分布（R 代码）</h2><pre class="line-numbers language-R" data-language="R"><code class="language-R">library(ggplot2)

# 读取结果
fst %
  # 布局设置
  layout(
    legend = list(
      font = list(size = 10),  # 统一增大所有图例项字体
      itemclick = TRUE        # 可选：禁用图例项点击隐藏
    ),
    title = list(
      text = "Genome-wide FST Manhattan Plot",
      x = 0.05, y = 0.98
    ),
    xaxis = list(
      title = "Genomic Position (Mb)",
      showgrid = FALSE,
      tickvals = plot_data %&gt;% 
        group_by(CHROM) %&gt;% 
        summarise(center = median(POS/1e6)) %&gt;% 
        pull(center),
        ticktext = main_chroms,
      # ticktext = str_remove(main_chroms, "NC_")
        tickangle = -45,  # ← 关键参数：标签倾斜45度（负号表示逆时针）
        tickfont = list(size = 8),  # 可选：调整标签字体大小
        ticklen = 5,  # 刻度线长度
        tickwidth = 1,  # 刻度线粗细
        showgrid = FALSE
    ),
    yaxis = list(
      title = "Weighted FST",
      range = c(0, max(plot_data$WEIGHTED_FST) * 1.1)
    ),
    hoverlabel = list(
      bgcolor = "white",
      font = list(size = 10)
    ),
    legend = list(
      orientation = "h",
      x = 0.5, y = 1.1,
      bgcolor = "rgba(255,255,255,0.8)")
    ,
    margin = list(t = 80)  # 顶部留白
  ) %&gt;%
  # 交互功能
  highlight(
    "plotly_selected",
    opacityDim = 0.2,
    selected = attrs_selected(
      marker = list(size = 15, color = "black"),
      textfont = list(weight = "bold"))
  )

# 5. 输出结果 --------------------------------------------------------------
# 显示图表
p<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/images/19/1902442139.png" alt="mdvwczfp.png"></p>
<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>

<p>可以看到有些窗口FST值较高，我想筛选SNP进行验证，如何继续做呢？</p>
]]></content>
      <categories>
        <category>多组学</category>
        <category>重测序</category>
      </categories>
  </entry>
  <entry>
    <title>3.对基因进行注释，长牡蛎注释包的构建及KEGG和GO分析</title>
    <url>/2025/08/02/25/</url>
    <content><![CDATA[<blockquote>
<p>前面我们发现了一些显著的SNP窗口位点，下面对显著的SNP位点进行提取。</p>
</blockquote>
<h1 id="1-提取SNP位点信息"><a href="#1-提取SNP位点信息" class="headerlink" title="1.提取SNP位点信息"></a>1.提取SNP位点信息</h1><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> 设置FST阈值（例如取WEIGHTED_FST &gt; 0.2）</span>
awk '$5 &gt; 0.2' fst_binned.windowed.weir.fst &gt; high_fst_windows.txt

<span class="token title important"><span class="token punctuation">##</span> 检查最高FST窗口</span>
sort -k5,5nr high_fst_windows.txt | head


<span class="token title important"><span class="token punctuation">##</span> 从高FST结果生成BED格式（用于后续注释）</span>
awk '{print $1"\t"$2"\t"$3"\t"$5}' high_fst_windows.txt &gt; high_fst_regions.bed

<span class="token title important"><span class="token punctuation">##</span> 合并相邻窗口（如距离 merged_high_fst.bed</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="2-对提取SNP位点注释"><a href="#2-对提取SNP位点注释" class="headerlink" title="2.对提取SNP位点注释"></a>2.对提取SNP位点注释</h1><p>然后提取与基因重叠的区域（需准备reference.gtf）</p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">##</span> 步骤1：过滤GFF3中的基因行（注意GFF3中gene的第三列为"gene"）</span>
bedtools intersect -a merged_high_fst.bed -b ../GCF_902806645.1_cgigas_uk_roslin_v1_genomic.gff -wa -wb | \
awk -F'\t' '$8 == "gene" {print $1,$2,$3,$12}' OFS='\t' | \
awk -F'[;\t]' '{gsub(/ID=gene-/, "", $4); print $1,$2,$3,$4}' | sort | uniq &gt; fst_genes.txt
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="3-提取SNP位点所在基因的ID号"><a href="#3-提取SNP位点所在基因的ID号" class="headerlink" title="3.提取SNP位点所在基因的ID号"></a>3.提取SNP位点所在基因的ID号</h1><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">awk -F'\t' '{
  match($8, /ID=gene-([^;]+)/, id_arr);
  match($8, /Name=([^;]+)/, name_arr);
  if (id_arr[1] &amp;&amp; name_arr[1]) {
    print $1, $2, $3, id_arr[1], name_arr[1];
  }
}' OFS='\t' fst_genes_annotated.bed &gt; fst_gene_ids_names.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>


<p>下面为整理好的上述过程的脚本</p>
<p>命名为<code># annotate_fst.sh</code> </p>
<pre class="line-numbers language-Bash" data-language="Bash"><code class="language-Bash">#!/bin/bash
# 输入文件
BED="merged_high_fst.bed"
GFF="../GCF_902806645.1_cgigas_uk_roslin_v1_genomic.gff"

# 步骤1：提取基因（直接运行，若为空则需名称映射）
bedtools intersect -a $BED -b $GFF -wa -wb | \
awk -F'\t' '$8 == "gene" {print $1,$2,$3,$12}' OFS='\t' | \
awk -F'[;\t]' '{gsub(/ID=gene-/, "", $4); print $1,$2,$3,$4}' | sort | uniq &gt; fst_genes.txt

# 步骤2：检查结果
echo "=== 前10行基因 ==="
head fst_genes.txt
echo "=== 行数统计 ==="
wc -l fst_genes.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>

<h1 id="4-通过基因ID提取蛋白序列"><a href="#4-通过基因ID提取蛋白序列" class="headerlink" title="4.通过基因ID提取蛋白序列"></a>4.通过基因ID提取蛋白序列</h1><p>下面为根据基因ID提取转录本序列，然后进行注释（后面不用这个，直接构建注释包进行分析，感觉更好</p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">grep -E "$(paste -sd'|' missing_loc.txt)" ../GCF_902806645.1_cgigas_uk_roslin_v1_genomic.gff | grep "gene" | grep -E "$(paste -sd'|' missing_loc.txt)" | grep -o "gene_biotype=[^;]*" | sort | uniq -c


grep -E "$(paste -sd'|' gene_loc_ids.txt)" ../GCF_902806645.1_cgigas_uk_roslin_v1_genomic.gff | grep "protein_id=" | \
sed -r 's/.<span class="token italic"><span class="token punctuation">*</span><span class="token content">protein_id=([^;]+).</span><span class="token punctuation">*</span></span>/\1/' | sort | uniq &gt; protein_ids.txt


seqkit grep -f protein_ids.txt ../GCF_902806645.1_cgigas_uk_roslin_v1_protein.faa &gt; proteins_extracted/fst_genes_proteins.faa

grep "^&gt;" proteins_extracted/fst_genes_proteins.faa | wc -l
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>发现不能完全匹配所有LOC，查看哪些没匹配到</p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 找所有LOC对应的protein_id</span>
grep -E "$(paste -sd'|' gene_loc_ids.txt)" ../GCF_902806645.1_cgigas_uk_roslin_v1_genomic.gff | grep "protein_id=" | \
sed -r 's/.<span class="token italic"><span class="token punctuation">*</span><span class="token content">protein_id=([^;]+).</span><span class="token punctuation">*</span></span>/\1/' | sort | uniq &gt; protein_ids_all.txt

<span class="token title important"><span class="token punctuation">#</span> 检查protein_ids.txt是否包含所有</span>
<span class="token blockquote punctuation">&gt;</span> comm -23 protein_ids_all.txt protein_ids.txt &gt; missing_proteins.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>下面是上述命令整理好的查找脚本</p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span>!/bin/bash</span>
set -euo pipefail

<span class="token title important"><span class="token punctuation">#</span> 1. 从fst_gene_ids_names.txt中提取LOC ID列表（假设第4列为LOC ID）</span>
cut -f4 fst_gene_ids_names.txt | sort | uniq &gt; gene_loc_ids.txt

<span class="token title important"><span class="token punctuation">#</span> 2. 从基因组注释GFF文件中筛选出这些LOC对应的protein_id</span>
grep -E "$(paste -sd'|' gene_loc_ids.txt)" ../GCF_902806645.1_cgigas_uk_roslin_v1_genomic.gff | \
    grep "protein_id=" | \
    sed -r 's/.<span class="token italic"><span class="token punctuation">*</span><span class="token content">protein_id=([^;]+).</span><span class="token punctuation">*</span></span>/\1/' | \
    sort | uniq &gt; protein_ids.txt

<span class="token title important"><span class="token punctuation">#</span> 3. 使用seqkit提取对应的蛋白序列到指定文件</span>
seqkit grep -f protein_ids.txt ../GCF_902806645.1_cgigas_uk_roslin_v1_protein.faa &gt; proteins_extracted/fst_genes_proteins.faa

<span class="token title important"><span class="token punctuation">#</span> 4. 统计提取到的蛋白数量，确认数量</span>
grep "^&gt;" proteins_extracted/fst_genes_proteins.faa | wc -l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>

<h1 id="5-对提取的蛋白进行注释"><a href="#5-对提取的蛋白进行注释" class="headerlink" title="5.对提取的蛋白进行注释"></a>5.对提取的蛋白进行注释</h1><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">conda create -n eggnog3_env -c bioconda -c conda-forge eggnog-mapper
conda activate eggnog3_env


emapper.py -h

tar -xvzf eggnog_mapper_data-5.0.2.tar.gz -C ./data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">emapper.py -i proteins_extracted/fst_genes_proteins.faa \
  --output fst_proteins_annotation \
  --data_dir ./data \
  -m diamond \
  --cpu 12 \
  --override<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>

<p>下面是R中的操作，主要进行KEGG和GO分析</p>
<h1 id="1-对前面注释的基因进行聚类分析"><a href="#1-对前面注释的基因进行聚类分析" class="headerlink" title="1.对前面注释的基因进行聚类分析"></a>1.对前面注释的基因进行聚类分析</h1><p>详细内容见 <a href="http://192.168.1.101/usr/uploads/2025/08/706163015.ipynb">Fst_2.ipynb</a><br><img src="/images/25/2038951127.png" alt="mdvyq9m6.png"><br>结果如上，没有达到我的预期，操作也较麻烦。</p>
<h1 id="2-构建非模式物种注释包org-Cgigas-eg-db"><a href="#2-构建非模式物种注释包org-Cgigas-eg-db" class="headerlink" title="2.构建非模式物种注释包org.Cgigas.eg.db"></a>2.构建非模式物种注释包org.Cgigas.eg.db</h1><p>详细内容见 <a href="http://192.168.1.101/usr/uploads/2025/08/3120321603.ipynb">Fst_3.ipynb</a> </p>
<pre><code class="markdown">library(tidyverse)
library(AnnotationForge)
library(readxl)

emapper %
  dplyr::select(GID=query,Gene_Symbol=Preferred_name, 
                GO=GOs,KO=KEGG_ko,Pathway =KEGG_Pathway, 
                OG=eggNOG_OGs,Gene_Name =seed_ortholog)

emapper$GID %   #这是只提取有GO注释信息的行，判断的标准时GO信息不是NA，这也就是为什么前面必须将“-”替换为NA，不替换就无法进行有效过滤。
  mutate(EVIDENCE = 'gigas')     #硬生生加了1列EVIDENCE，全部赋值A,凑数的。
dim(gene2go)    #查看数据维度。
#[1] 1523399       3

#提取GID与KO信息，这里只有2列信息
gene2ko%
 separate_rows(KO, sep = ',', convert = F) %&gt;%
  dplyr::filter(!is.na(KO))
dim(gene2ko)
#[1] 30530     2

#提取GID与Pathway信息，这里只有2列信息
gene2pathway%
separate_rows(Pathway, sep = ',', convert = F) %&gt;%
  dplyr::filter(!is.na(Pathway))
 dim(gene2pathway)
#[1] 143056      2

#提取GID与Gene_Symbol信息，Gene_Symbol是Preferred_name信息，这里只有2列信息
gene2symbol%
  dplyr::filter(!is.na(Gene_Symbol))
dim(gene2symbol)
#[1] 4561    2

## 删除 GO ID 中的空格、制表符、换行符

gene2go$GO
</code></pre>
]]></content>
      <categories>
        <category>重测序</category>
      </categories>
  </entry>
  <entry>
    <title>4.提取重测序数据中黑白肌痕组中各SNP的位点信息及基因型频率</title>
    <url>/2025/08/03/32/</url>
    <content><![CDATA[<p>相关的sh文件内容如下：</p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span>!/bin/bash</span>
<span class="token title important"><span class="token punctuation">#</span> 用法：./extract_chromosome_snps_no_split.sh   </span>

set -euo pipefail

<span class="token title important"><span class="token punctuation">#</span> 彩色日志函数，蓝色时间，绿色成功，红色错误，黄色警告</span>
log() {
  local msg="$1"
  local color="${2:-34}"  # 默认蓝色
  echo -e "\033[1;${color}m[$(date '+%Y-%m-%d %H:%M:%S')]\033[0m $msg"
}

<span class="token title important"><span class="token punctuation">#</span> 参数检查</span>
if [ $# -lt 3 ]; then
  echo "Usage: $0   "
  echo "Example: ./extract_chromosome_snps_no_split.sh NC_047567.1 input.vcf.gz results"
  exit 1
fi

CHROM=$1
VCF=$2
PREFIX=$3
GFF="../GCF_902806645.1_cgigas_uk_roslin_v1_genomic.gff"

<span class="token title important"><span class="token punctuation">#</span> 检查工具</span>
command -v bcftools &gt;/dev/null || { log "ERROR: bcftools not found" 31; exit 1; }
command -v bedtools &gt;/dev/null || { log "ERROR: bedtools not found" 31; exit 1; }
command -v awk &gt;/dev/null || { log "ERROR: awk not found" 31; exit 1; }

<span class="token title important"><span class="token punctuation">##########################</span></span>
<span class="token title important"><span class="token punctuation">#</span> STEP 1: 提取基因坐标</span>
<span class="token title important"><span class="token punctuation">##########################</span></span>
log "STEP 1/5: Extracting gene coordinates for $CHROM..."

GENE_BED="${PREFIX}_genes.bed"
if [ -s "$GENE_BED" ]; then
  lines=$(wc -l &lt; "$GENE_BED")
  log "Found existing gene BED file ($GENE_BED, $lines lines), skipping extraction..." 33
else
  matched_gene_lines=$(grep -w "$CHROM" "$GFF" | awk -F'\t' '$3=="gene"')
  if [ -z "$matched_gene_lines" ]; then
    log "CRITICAL ERROR: No 'gene' lines found for chromosome '$CHROM'" 31
    log "Possible reasons:" 31
    log "1. Chromosome name不匹配 (如缺少'chr'前缀)" 31
    log "2. GFF中没有gene类型注释" 31
    log "Debug信息:" 31
    log "-&gt; Chromosome 检查: $(grep -m1 "$CHROM" "$GFF" || echo '未找到')" 31
    log "-&gt; 染色体中所有 feature 类型:" 31
    grep -w "$CHROM" "$GFF" | awk -F'\t' '{print $3}' | sort | uniq -c
    exit 1
  fi

  grep -w "$CHROM" "$GFF" | \
    awk -F'\t' '$3=="gene"' | \
    awk -F'\t' '{
      split($9, a, ";");
      gene_id="";
      for (i in a) {
        if (a[i] <span class="token strike"><span class="token punctuation">~</span><span class="token content"> /^gene=/) {
          gsub(/^gene=/, "", a[i]); gene_id=a[i];
        } else if (a[i] </span><span class="token punctuation">~</span></span> /^ID=gene-/) {
          gsub(/^ID=gene-/, "", a[i]); gene_id=a[i];
        }
      }
      print $1, $4, $5, gene_id
    }' OFS='\t' &gt; "$GENE_BED"

  gene_count=$(wc -l &lt; "$GENE_BED")
  if [ "$gene_count" -eq 0 ]; then
    log "ERROR: Gene extraction failed! No gene records written." 31
    exit 1
  fi
  log "Successfully extracted $gene_count genes to $GENE_BED" 32
fi

<span class="token title important"><span class="token punctuation">##########################</span></span>
<span class="token title important"><span class="token punctuation">#</span> STEP 2: 提取染色体SNP</span>
<span class="token title important"><span class="token punctuation">##########################</span></span>
log "STEP 2/5: Extracting SNPs for $CHROM..."

SNP_VCF="${PREFIX}_snps.vcf.gz"
if [ -s "$SNP_VCF" ]; then
  variants=$(bcftools view "$SNP_VCF" | grep -v '^#' | wc -l)
  log "Found existing SNP file ($SNP_VCF) with $variants variants, skipping extraction..." 33
else
  bcftools view -r "$CHROM" "$VCF" -Oz -o "$SNP_VCF"
  bcftools index "$SNP_VCF"
  variants=$(bcftools view "$SNP_VCF" | grep -v '^#' | wc -l)
  log "SNPs extracted to $SNP_VCF (Total variants: $variants)" 32
fi

<span class="token title important"><span class="token punctuation">##########################</span></span>
<span class="token title important"><span class="token punctuation">#</span> STEP 3: 转换VCF格式为TSV</span>
<span class="token title important"><span class="token punctuation">##########################</span></span>
log "STEP 3/5: Converting VCF to table..."

SNP_TSV="${PREFIX}_snps.tsv"
if [ -s "$SNP_TSV" ]; then
  lines=$(wc -l &lt; "$SNP_TSV")
  log "Found existing SNP table ($SNP_TSV) with $lines lines, skipping conversion..." 33
else
  bcftools query -f '%CHROM\t%POS\t%REF\t%ALT\t%QUAL[\t%GT:%AD]\n' "$SNP_VCF" &gt; "${SNP_TSV}.tmp"

  <span class="token title important"><span class="token punctuation">#</span> 添加表头（样本名）</span>
  echo -e "chromosome\tposition\tref\talt\tqual\t"$(bcftools query -l "$SNP_VCF" | tr '\n' '\t' | sed 's/\t$//') &gt; header.tsv
  cat header.tsv "${SNP_TSV}.tmp" &gt; "$SNP_TSV"
  rm header.tsv "${SNP_TSV}.tmp"

  lines=$(wc -l &lt; "$SNP_TSV")
  log "VCF converted to $SNP_TSV (Total lines: $lines)" 32
fi

<span class="token title important"><span class="token punctuation">##########################</span></span>
<span class="token title important"><span class="token punctuation">#</span> STEP 4: SNP注释</span>
<span class="token title important"><span class="token punctuation">##########################</span></span>
log "STEP 4/5: Annotating SNPs with genes (single pass)..."

ANNOTATED="${PREFIX}_annotated.tsv"
if [ -s "$ANNOTATED" ]; then
  lines=$(wc -l &lt; "$ANNOTATED")
  log "Found existing annotated SNPs file ($ANNOTATED) with $lines lines, skipping annotation..." 33
else
  SNPS_BED=$(mktemp)
  INTERSECT_OUT=$(mktemp)

  <span class="token title important"><span class="token punctuation">#</span> 转换TSV到BED格式（0-based）</span>
  awk -F'\t' 'BEGIN{OFS="\t"} NR&gt;1 {print $1,$2-1,$2,$0}' "$SNP_TSV" &gt; "$SNPS_BED"

  log "Running bedtools intersect..." 33
  bedtools intersect -a "$SNPS_BED" -b "$GENE_BED" -wa -wb &gt; "$INTERSECT_OUT"

  <span class="token title important"><span class="token punctuation">#</span> 提取最终结果，保留原始字段并加gene列</span>
  awk -F'\t' 'BEGIN{OFS="\t"} {
    nf = NF;
    for(i=4; i 0) ? bm_counts["00"]/bm_total<span class="token italic"><span class="token punctuation">*</span><span class="token content">100 : 0;
    bm_het_pct = (bm_total &gt; 0) ? bm_counts["01"]/bm_total</span><span class="token punctuation">*</span></span>100 : 0;
    bm_alt_pct = (bm_total &gt; 0) ? bm_counts["11"]/bm_total<span class="token italic"><span class="token punctuation">*</span><span class="token content">100 : 0;
    bm_other_pct = (bm_total &gt; 0) ? bm_counts["other"]/bm_total</span><span class="token punctuation">*</span></span>100 : 0;
    
<span class="token code keyword">    wm_ref_pct = (wm_total &gt; 0) ? wm_counts["00"]/wm_total*100 : 0;
    wm_het_pct = (wm_total &gt; 0) ? wm_counts["01"]/wm_total*100 : 0;
    wm_alt_pct = (wm_total &gt; 0) ? wm_counts["11"]/wm_total*100 : 0;
    wm_other_pct = (wm_total &gt; 0) ? wm_counts["other"]/wm_total*100 : 0;</span>
    
<span class="token code keyword">    # 输出结果（现在总和应为100%）
    print $1, $2, $3, $4, $5,
          sprintf("%.3f", bm_ref_pct), sprintf("%.3f", bm_het_pct), sprintf("%.3f", bm_alt_pct), sprintf("%.3f", bm_other_pct), bm_total,
          sprintf("%.3f", wm_ref_pct), sprintf("%.3f", wm_het_pct), sprintf("%.3f", wm_alt_pct), sprintf("%.3f", wm_other_pct), wm_total;</span>
  }' "$SNP_TSV" &gt; "$FREQ_OUT"
  
  lines=$(wc -l &lt; "$FREQ_OUT")
  log "Genotype frequency table written to $FREQ_OUT ($((lines-1)) variant lines)" 32
fi

log "SUCCESS! Final results:" 32
log "- Gene coordinates: ${GENE_BED}" 32
log "- SNP VCF: ${PREFIX}_snps.vcf.gz" 32
log "- Annotated SNPs: ${PREFIX}_annotated.tsv ($(wc -l &lt; ${PREFIX}_annotated.tsv) lines)" 32
log "- Genotype frequencies: ${PREFIX}_genotype_freq.tsv ($(wc -l &lt; ${PREFIX}_genotype_freq.tsv) lines)" 32<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>相关的指令如下</p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">dos2unix xxxxxx.sh

rm -f NC_047567.1_results_*

./extract_chromosome_snps.sh NC_047567.1 Filter.snp.vcf.gz NC_047567.1_results 8
./extract_chromosome_snps_2.0.sh NC_047567.1 Filter.snp.vcf.gz NC_047567.1_results<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>重测序</category>
      </categories>
  </entry>
  <entry>
    <title>UZ801 随身wifi 刷debain 搭Blog</title>
    <url>/2024/11/21/4/</url>
    <content><![CDATA[<h1 id="在随身WiFi上部署个人博客完整指南"><a href="#在随身WiFi上部署个人博客完整指南" class="headerlink" title="在随身WiFi上部署个人博客完整指南"></a>在随身WiFi上部署个人博客完整指南</h1><h2 id="0、写在前面"><a href="#0、写在前面" class="headerlink" title="0、写在前面"></a>0、写在前面</h2><p>感谢酷安社区里的 @handsomehacker @梦太晓 大佬的分享，本文很多部分都是参考自他们。</p>
<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>

<p>要想在随身WiFi部署个人博客，首先需要将你的随身WiFi刷成Debian系统，这个不是本文的重点，在此不再赘述，请确保你已经完成了Debian系统的安装。</p>
<p>本文主要分成以下两个部分：</p>
<ul>
<li>Typecho博客的部署</li>
<li>基于frp的内网穿透</li>
</ul>
<p>基于frp的内网穿透需要准备一台具有公网IP的服务器，如果没有只能完成本地博客的部署。</p>
<p>建议在开始前切换为超级用户，可使用如下命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">su</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>根据提示输入密码即可。</p>
<h2 id="1、Typecho博客的部署"><a href="#1、Typecho博客的部署" class="headerlink" title="1、Typecho博客的部署"></a>1、Typecho博客的部署</h2><blockquote>
<p>本节摘自自 @梦太晓 的分享<br>酷安原文链接：<code>https://www.coolapk.com/feed/42368631?shareKey=NTM2MmFmODQzYjM2NjQ3OWY0OGY~&amp;shareUid=4402655&amp;shareFrom=com.coolapk.market_12.0.7</code></p>
</blockquote>
<h3 id="1-1-一键安装Typecho博客"><a href="#1-1-一键安装Typecho博客" class="headerlink" title="1.1 一键安装Typecho博客"></a>1.1 一键安装Typecho博客</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wget</span> <span class="token parameter variable">-O</span> /root/install_typecho.sh https://www.coolapk.com/link?url<span class="token operator">=</span>https%3A%2F%2Fimtx-bucket.oss-cn-shenzhen.aliyuncs.com%2Flinux%2Fsh%2Ftypecho%2Finstall_typecho.sh <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> +x /root/install_typecho.sh <span class="token operator">&amp;&amp;</span> /root/install_typecho.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>install_typecho.sh 脚本内容：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">echo</span> <span class="token string">"这个脚本是【安装typecho博客】，会同时安装Nginx PHP MySQL(MariaDB)，确定要运行吗？"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"【建议提前切换至root用户   sudo -i】"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"【建议提前更新源           apt update】"</span>
<span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"输入yes确认运行 输入其他退出："</span> yesOrNo
<span class="token builtin class-name">echo</span> <span class="token string">"你的输入是： "</span> <span class="token variable">$yesOrNo</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">${yesOrNo}</span> <span class="token operator">=</span> <span class="token string">"yes"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"输入【正确】，继续往下执行"</span>
<span class="token keyword">else</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"输入【错误】，即将退出脚本"</span>
    <span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token string">"【开始安装typecho博客】: "</span><span class="token variable"><span class="token variable">`</span><span class="token function">date</span> <span class="token string">"+%F %T"</span><span class="token variable">`</span></span>

<span class="token comment"># 安装Nginx</span>
<span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> nginx

<span class="token comment"># 安装PHP及部分扩展</span>
<span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> php php-fpm php-mysqli php-mbstring

<span class="token comment"># 安装MySQL</span>
<span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> mariadb-server

<span class="token comment"># 安装解压工具</span>
<span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">zip</span>

<span class="token comment"># 创建数据库，数据库名typecho</span>
<span class="token comment"># 添加用户到MySQL数据库中，用户名typecho  密码typecho，登录主机为localhost(仅允许本机登录，无法远程登录)</span>
<span class="token comment"># 授予typecho用户，管理typecho数据库的一切权限</span>
<span class="token comment"># 刷新数据库用户权限等，让其生效</span>
mysql <span class="token parameter variable">-u</span> root -p密码  
<span class="token operator">&gt;</span> 本节参考自：<span class="token variable"><span class="token variable">`</span>https://blog.csdn.net/qq_36981760/article/details/115713179<span class="token variable">`</span></span>

<span class="token comment">### 2.1 frp下载地址</span>

下载地址：<span class="token variable"><span class="token variable">`</span>https://github.com/fatedier/frp/releases<span class="token variable">`</span></span>

选择合适的版本进行下载即可。

分别在服务器和随身WiFi进行下载，可以使用如下命令分别下载（请确认是amd还是arm）：

```bash
<span class="token comment"># 服务器</span>
<span class="token function">wget</span> https://github.com/fatedier/frp/releases/download/v0.49.0/frp_0.49.0_linux_amd64.tar.gz

<span class="token comment"># 随身WiFi</span>
<span class="token function">wget</span> https://github.com/fatedier/frp/releases/download/v0.49.0/frp_0.49.0_linux_arm64.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-2-frp软件的解压"><a href="#2-2-frp软件的解压" class="headerlink" title="2.2 frp软件的解压"></a>2.2 frp软件的解压</h3><p>分别进行解压，解压命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> 压缩包.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>解压后如下：</p>
<pre class="line-numbers language-none"><code class="language-none">frp_0.49.0_linux_amd64/
├── frpc
├── frpc.ini
├── frpc_full.ini
├── frps
├── frps.ini
└── frps_full.ini<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里服务器端和客户端都放在了<code>/usr/local/frp/</code>目录下。</p>
<h3 id="2-3-frp添加权限"><a href="#2-3-frp添加权限" class="headerlink" title="2.3 frp添加权限"></a>2.3 frp添加权限</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 服务器端添加权限</span>
<span class="token builtin class-name">cd</span> /usr/local/frp
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> frps

<span class="token comment"># 客户端添加权限</span>
<span class="token builtin class-name">cd</span> /usr/local/frp
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">777</span> frpc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-4-服务器端frp配置文件及frp启动"><a href="#2-4-服务器端frp配置文件及frp启动" class="headerlink" title="2.4 服务器端frp配置文件及frp启动"></a>2.4 服务器端frp配置文件及frp启动</h3><p><strong>服务器端配置：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 打开服务器端配置文件</span>
<span class="token function">vim</span> ./frps.ini<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>我的填写内容如下：</strong></p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">common</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">bind_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">7000</span>
<span class="token key attr-name">dashboard_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">7500</span>
<span class="token key attr-name">dashboard_user</span> <span class="token punctuation">=</span> <span class="token value attr-value">admin</span>
<span class="token key attr-name">dashboard_pwd</span> <span class="token punctuation">=</span> <span class="token value attr-value">admin</span>
<span class="token key attr-name">vhost_http_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">7002</span>
<span class="token key attr-name">vhost_https_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">7003</span>
<span class="token key attr-name">max_pool_count</span> <span class="token punctuation">=</span> <span class="token value attr-value">50</span>
<span class="token key attr-name">token</span> <span class="token punctuation">=</span> <span class="token value attr-value">aaa123</span>
<span class="token key attr-name">tcp_mux</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">log_file</span> <span class="token punctuation">=</span> <span class="token value attr-value">/usr/local/frp/frps.log</span>
<span class="token key attr-name">log_level</span> <span class="token punctuation">=</span> <span class="token value attr-value">info</span>
<span class="token key attr-name">log_max_days</span> <span class="token punctuation">=</span> <span class="token value attr-value">3</span>
<span class="token key attr-name">authentication_timeout</span> <span class="token punctuation">=</span> <span class="token value attr-value">0</span>
<span class="token key attr-name">subdomain_host</span> <span class="token punctuation">=</span> <span class="token value attr-value">xxx.xx.xxx.xx</span>
<span class="token key attr-name">privilege_mode</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>注意：删掉配置文件中所有注释<br>服务器端开放对应端口</p>
</blockquote>
<p><strong>frp的启动：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 前台启动</span>
./frps <span class="token parameter variable">-c</span> ./frps.ini

<span class="token comment"># 后台启动</span>
./frps <span class="token parameter variable">-c</span> ./frps.ini <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-5-客户端frp配置文件及frp启动"><a href="#2-5-客户端frp配置文件及frp启动" class="headerlink" title="2.5 客户端frp配置文件及frp启动"></a>2.5 客户端frp配置文件及frp启动</h3><p><strong>客户端配置：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 打开客户端配置文件</span>
<span class="token function">vim</span> ./frpc.ini<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>我的填写内容如下：</strong></p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">common</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">server_addr</span> <span class="token punctuation">=</span> <span class="token value attr-value">10.10.xxx.xxx</span>
<span class="token key attr-name">server_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">7000</span>
<span class="token key attr-name">token</span> <span class="token punctuation">=</span> <span class="token value attr-value">aaa123</span>
<span class="token key attr-name">tcp_mux</span> <span class="token punctuation">=</span> <span class="token value attr-value">true</span>
<span class="token key attr-name">log_file</span> <span class="token punctuation">=</span> <span class="token value attr-value">/usr/local/frp/frpc.log</span>
<span class="token key attr-name">log_level</span> <span class="token punctuation">=</span> <span class="token value attr-value">info</span>
<span class="token key attr-name">log_max_days</span> <span class="token punctuation">=</span> <span class="token value attr-value">3</span>
<span class="token key attr-name">authentication_timeout</span> <span class="token punctuation">=</span> <span class="token value attr-value">0</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">ssh</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">type</span> <span class="token punctuation">=</span> <span class="token value attr-value">tcp</span>
<span class="token key attr-name">local_ip</span> <span class="token punctuation">=</span> <span class="token value attr-value">192.168.xxx.xxx</span>
<span class="token key attr-name">local_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">22</span>
<span class="token key attr-name">remote_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">7001</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">web01</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">type</span> <span class="token punctuation">=</span> <span class="token value attr-value">http</span>
<span class="token key attr-name">local_ip</span> <span class="token punctuation">=</span> <span class="token value attr-value">192.168.xxx.xxx</span>
<span class="token key attr-name">local_port</span> <span class="token punctuation">=</span> <span class="token value attr-value">80</span>
<span class="token key attr-name">subdomain_host</span> <span class="token punctuation">=</span> <span class="token value attr-value">xxx.xx.xxx.xx</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>注意：删掉配置文件中所有注释</p>
</blockquote>
<p><strong>frp的启动：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 前台启动</span>
./frpc <span class="token parameter variable">-c</span> ./frpc.ini

<span class="token comment"># 后台启动</span>
./frpc <span class="token parameter variable">-c</span> ./frpc.ini <span class="token operator">&amp;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-6-阶段小结"><a href="#2-6-阶段小结" class="headerlink" title="2.6 阶段小结"></a>2.6 阶段小结</h3><p>完成上述步骤之后即完成了基础的配置，可以通过访问：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 公网IP:穿透的http端口</span>
xxx.xx.xxx.xx:7002<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>来访问我们内网的个人博客。</p>
<h3 id="2-7-设置frp开机自启"><a href="#2-7-设置frp开机自启" class="headerlink" title="2.7 设置frp开机自启"></a>2.7 设置frp开机自启</h3><p><strong>服务器端：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 需要先 cd 到 frp 解压目录</span>
<span class="token comment"># 复制文件</span>
<span class="token function">cp</span> frps /usr/local/bin/frps
<span class="token function">mkdir</span> /etc/frp
<span class="token function">cp</span> frps.ini /etc/frp/frps.ini

<span class="token comment"># 编写 frp service 文件，以 ubuntu 为例</span>
<span class="token function">vim</span> /usr/lib/systemd/system/frps.service  <span class="token comment"># 有时候需要手动创建system文件夹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>frps.service内容如下：</strong></p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">frps</span>
<span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">network.target</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">TimeoutStartSec</span><span class="token punctuation">=</span><span class="token value attr-value">30</span>
<span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/bin/frps -c /etc/frp/frps.ini</span>
<span class="token key attr-name">ExecStop</span><span class="token punctuation">=</span><span class="token value attr-value">/bin/kill $MAINPID</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>启动 frp 并设置开机启动：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl <span class="token builtin class-name">enable</span> frps
systemctl start frps
systemctl status frps

<span class="token comment"># 部分服务器上,可能需要加 .service 后缀来操作,即:</span>
systemctl <span class="token builtin class-name">enable</span> frps.service
systemctl start frps.service
systemctl status frps.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>客户端：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 需要先 cd frp 解压目录</span>
<span class="token comment"># 复制文件</span>
<span class="token function">cp</span> frpc /usr/local/bin/frpc
<span class="token function">mkdir</span> /etc/frp
<span class="token function">cp</span> frpc.ini /etc/frp/frpc.ini

<span class="token comment"># 编写 frp service 文件，以 centos7 为例</span>
<span class="token function">vim</span> /usr/lib/systemd/system/frpc.service  <span class="token comment"># 有时候需要手动创建system文件夹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>frpc.service内容如下：</strong></p>
<pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Unit</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">Description</span><span class="token punctuation">=</span><span class="token value attr-value">frpc</span>
<span class="token key attr-name">After</span><span class="token punctuation">=</span><span class="token value attr-value">network.target</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Service</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">TimeoutStartSec</span><span class="token punctuation">=</span><span class="token value attr-value">30</span>
<span class="token key attr-name">ExecStart</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/bin/frpc -c /etc/frp/frpc.ini</span>
<span class="token key attr-name">ExecStop</span><span class="token punctuation">=</span><span class="token value attr-value">/bin/kill $MAINPID</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">Install</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">WantedBy</span><span class="token punctuation">=</span><span class="token value attr-value">multi-user.target</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>启动 frp 并设置开机启动：</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">systemctl <span class="token builtin class-name">enable</span> frpc
systemctl start frpc
systemctl status frpc

<span class="token comment"># 部分服务器上,可以需要加 .service 后缀来操作,即:</span>
systemctl <span class="token builtin class-name">enable</span> frpc.service
systemctl start frpc.service
systemctl status frpc.service<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3、总结"><a href="#3、总结" class="headerlink" title="3、总结"></a>3、总结</h2><p>至此完成了个人博客的部署以及内网穿透操作，因为写的仓促，难免存在错误，有问题及时交流。</p>
]]></content>
      <categories>
        <category>默认分类</category>
      </categories>
  </entry>
  <entry>
    <title>5.各样本SNP位点信息可视化</title>
    <url>/2025/08/03/40/</url>
    <content><![CDATA[<blockquote>
<p>前面我们对各样本的SNP位点信息进行了提取，现在我们要进行SNP位点的筛选，相对快捷的办法就是可视化，下面我们进行分析</p>
</blockquote>
<p>需要用到的R包</p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">library(tidyverse)
library(vcfR)
library(data.table)
library(ggplot2)
library(dplyr)
library(tidyr)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>下面以单个基因为例进行分析</p>
<pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token title important"><span class="token punctuation">#</span> 先读取数据（不自动解析列名）</span>
snp_data %
  as.matrix()

<span class="token title important"><span class="token punctuation">#</span> 5. 可视化设置 ------------------------------------------------</span>
<span class="token title important"><span class="token punctuation">#</span> 颜色映射</span>
gt_colors %
  layout(
    title = list(text = "SNP Genotype Heatmap", y = 0.98),
    xaxis = list(
      title = "Genomic Position",
      rangeslider = list(visible = TRUE),  # 横向滚动条
      type = "category",  # 防止数值排序
      tickangle = 45
    ),
    yaxis = list(
      title = list(text = "Sample", standoff = 30),
      tickfont = list(size = 10),
      automargin = TRUE,  # 自动调整边距
      tickmode = "array",
      tickvals = seq_len(nrow(heatmap_matrix)),
      ticktext = rownames(heatmap_matrix)
    ),
    margin = list(
      l = left_margin,  # 动态左边距
      r = 50,
      b = 100,
      t = 100
    )
  )

<span class="token title important"><span class="token punctuation">#</span> 7. 输出结果 --------------------------------------------------</span>
<span class="token title important"><span class="token punctuation">#</span> 在RStudio中直接查看</span>
print(fig)

<span class="token title important"><span class="token punctuation">#</span> 保存为HTML文件</span>
htmlwidgets::saveWidget(
  widget = fig,
  file = "snp_heatmap_complete.html",
  title = "Interactive SNP Heatmap",
  selfcontained = TRUE,
  libdir = "lib"
)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出结果如下<br><img src="/images/40/2532418108.png" alt="mdvqrk99.png"></p>
]]></content>
      <categories>
        <category>重测序</category>
      </categories>
  </entry>
  <entry>
    <title>6.筛选组内一致率90%，组间有差异的SNP位点</title>
    <url>/2025/09/03/48/</url>
    <content><![CDATA[<p><strong>分析需求：</strong> </p>
<blockquote>
<p>请分析查找组间差异SNP &amp; Indel。需要找组内一致，组间具有差异的突变位点，样本一致率卡90%，即在大于90%的样本中突变型一致就认为是组内一致的突变。</p>
</blockquote>
<p><strong>关键技术要求</strong>：</p>
<ul>
<li><strong>组内一致性</strong>：在&gt;90%的样本中突变型一致即认为组内一致</li>
<li><strong>组间差异性</strong>：不同群体间基因型存在明显分化</li>
<li><strong>质量控制</strong>：确保结果的统计学可靠性</li>
</ul>
<hr>
<h2 id="🎯-分析目标与生物学意义"><a href="#🎯-分析目标与生物学意义" class="headerlink" title="🎯 分析目标与生物学意义"></a>🎯 分析目标与生物学意义</h2><p>在群体遗传学和分子育种研究中，识别群体特异性变异位点是理解物种分化、适应性进化以及关键性状遗传基础的核心任务。本次分析旨在：</p>
<ul>
<li><strong>揭示群体分化标记</strong>：找到在不同群体间固定差异的SNP位点</li>
<li><strong>定位候选基因区域</strong>：为后续的功能验证提供可靠的候选位点</li>
<li><strong>支撑分子标记开发</strong>：为育种标记辅助选择提供理论基础</li>
</ul>
<h2 id="🔧-1-筛选流程设计与实现"><a href="#🔧-1-筛选流程设计与实现" class="headerlink" title="🔧 1. 筛选流程设计与实现"></a>🔧 1. 筛选流程设计与实现</h2><h3 id="核心算法逻辑"><a href="#核心算法逻辑" class="headerlink" title="核心算法逻辑"></a>核心算法逻辑</h3><pre class="mermaid">graph TD
    A[原始基因型数据] --&gt; B[群体分组统计]
    B --&gt; C{组内一致性检验}
    C --&gt;|通过| D{组间差异性检验}
    C --&gt;|不通过| E[过滤掉]
    D --&gt;|有差异| F[输出结果]
    D --&gt;|无差异| E</pre>

<h3 id="筛选命令详解"><a href="#筛选命令详解" class="headerlink" title="筛选命令详解"></a>筛选命令详解</h3><pre class="line-numbers language-Bash" data-language="Bash"><code class="language-Bash">#!/bin/bash
# filename: filter_variants_integrated.sh
# Usage: ./filter_variants_integrated.sh [threshold] [input_file] [output_file] [include_het] [diff_mode]

show_help() {
    cat  "$OUTPUT_FILE"

# ------------------ 主体处理 ------------------
START_TIME=$(date +%s)
log "INFO" "开始处理位点..."

awk -v threshold="$THRESHOLD" \
    -v bm_start="$BM_START" \
    -v bm_end="$BM_END" \
    -v wm_start="$WM_START" \
    -v wm_end="$WM_END" \
    -v total_variants="$TOTAL_VARIANTS" \
    -v log_file="$LOG_FILE" \
    -v include_het="$INCLUDE_HET" \
    -v diff_mode="$DIFF_MODE" '
BEGIN {
    OFS="\t"
    processed = 0
    passed = 0
    start_time = systime()
    print strftime("[%Y-%m-%d %H:%M:%S]") " [INFO] AWK processor started" &gt;&gt; log_file
}

NR==1 {next}  # 跳过表头

{
    processed++

    bm_ref=0; bm_alt=0; bm_het=0; bm_total=0
    wm_ref=0; wm_alt=0; wm_het=0; wm_total=0

    # BM
    for (i=bm_start; i 0) ? bm_alt / bm_total : 0
    bm_het_ratio = (bm_total &gt; 0) ? bm_het / bm_total : 0
    
    wm_ref_ratio = (wm_total &gt; 0) ? wm_ref / wm_total : 0
    wm_alt_ratio = (wm_total &gt; 0) ? wm_alt / wm_total : 0
    wm_het_ratio = (wm_total &gt; 0) ? wm_het / wm_total : 0

    bm_gt = "MIXED"
    wm_gt = "MIXED"

    if (bm_total &gt;= 20) {
        if (bm_ref_ratio &gt;= threshold) bm_gt="REF"
        else if (bm_alt_ratio &gt;= threshold) bm_gt="ALT"
        else if (!include_het &amp;&amp; (bm_het/bm_total &gt;= threshold)) bm_gt="HET"
    }
    if (wm_total &gt;= 20) {
        if (wm_ref_ratio &gt;= threshold) wm_gt="REF"
        else if (wm_alt_ratio &gt;= threshold) wm_gt="ALT"
        else if (!include_het &amp;&amp; (wm_het/wm_total &gt;= threshold)) wm_gt="HET"
    }

    diff = 0
    if (bm_gt != "MIXED" &amp;&amp; wm_gt != "MIXED") {
        if (diff_mode=="simple") {
            if (bm_gt=="REF" &amp;&amp; wm_gt=="ALT") diff=1
            else if (bm_gt=="ALT" &amp;&amp; wm_gt=="REF") diff=1
        } else if (diff_mode=="strict") {
            if (bm_gt != wm_gt) diff=1
        }
    }

    if (diff==1) {
        print $0, bm_ref, bm_alt, bm_het, bm_total, bm_ref_ratio, bm_alt_ratio, bm_het_ratio, bm_gt, wm_ref, wm_alt, wm_het, wm_total, wm_ref_ratio, wm_alt_ratio, wm_het_ratio, wm_gt
        passed++
    }
}

END {
    end_time = systime()
    duration = end_time - start_time
    minutes = int(duration / 60)
    seconds = duration % 60
    print strftime("[%Y-%m-%d %H:%M:%S]") " [INFO] Processed: " processed ", Passed: " passed &gt;&gt; log_file
    print strftime("[%Y-%m-%d %H:%M:%S]") " [INFO] Pass rate: " (passed/processed)*100 "%" &gt;&gt; log_file
}
' "$INPUT_FILE" &gt;&gt; "$OUTPUT_FILE"

# ------------------ 结果汇总 ------------------
RESULT_COUNT=$(($(wc -l &lt; "$OUTPUT_FILE") - 1))
log "INFO" "分析完成！ 筛选通过: $RESULT_COUNT"
echo "结果输出到: $OUTPUT_FILE"
echo "日志文件: $LOG_FILE"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="筛选命令的输入输出说明"><a href="#筛选命令的输入输出说明" class="headerlink" title="筛选命令的输入输出说明"></a>筛选命令的输入输出说明</h3><h4 id="输入文件格式要求："><a href="#输入文件格式要求：" class="headerlink" title="输入文件格式要求："></a>输入文件格式要求：</h4><pre class="line-numbers language-none"><code class="language-none"># 输入文件应该是制表符分隔的文本文件，包含以下列：
# CHROM  POS     REF     ALT     Sample1 Sample2 Sample3 ... SampleN
# 1      1000    A       G       0/1     1/1     0/0     ... 0/1
# 1      2000    C       T       1/1     0/1     1/1     ... 0/0

# 基因型编码说明：
# 0/0: 纯合参考型
# 1/1: 纯合突变型  
# 0/1: 杂合型
# ./.: 缺失数据<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="输出结果内容："><a href="#输出结果内容：" class="headerlink" title="输出结果内容："></a>输出结果内容：</h4><pre class="line-numbers language-none"><code class="language-none"># 输出文件在原文件基础上添加以下统计列：
# bm_ref    bm_alt    bm_het    bm_total  bm_ref_ratio  bm_alt_ratio  bm_het_ratio  bm_gt
# wm_ref    wm_alt    wm_het    wm_total  wm_ref_ratio  wm_alt_ratio  wm_het_ratio  wm_gt

# 输出示例：
# CHROM  POS   REF  ALT  ...  bm_ref  bm_alt  bm_gt  wm_ref  wm_alt  wm_gt
# 1      1000  A    G    ...  18      2       REF    2       18      ALT
# 这表示：BM组18个样本为REF型，WM组18个样本为ALT型，符合组间差异条件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="关键输出解读："><a href="#关键输出解读：" class="headerlink" title="关键输出解读："></a>关键输出解读：</h4><ul>
<li><strong>bm_gt/wm_gt</strong>: 群体基因型判定（REF/ALT/HET/MIXED）</li>
<li>***_ratio**: 各类基因型在群体中的比例</li>
<li><strong>筛选逻辑</strong>: BM组和WM组基因型相反且各自组内一致率&gt;90%的位点</li>
</ul>
<h2 id="📊-2-结果可视化与质控"><a href="#📊-2-结果可视化与质控" class="headerlink" title="📊 2. 结果可视化与质控"></a>📊 2. 结果可视化与质控</h2><h3 id="可视化代码实现"><a href="#可视化代码实现" class="headerlink" title="可视化代码实现"></a>可视化代码实现</h3><pre class="line-numbers language-R" data-language="R"><code class="language-R">library(tidyverse)
library(vcfR)
library(data.table)
library(ggplot2)
library(dplyr)
library(tidyr)


# 先读取数据（不自动解析列名）
snp_data %
  layout(
    title = list(text = "SNP Genotype Heatmap", y = 0.98),
    xaxis = list(
      title = "Genomic Position",
      rangeslider = list(visible = TRUE),
      type = "category",
      tickangle = 45
    ),
    yaxis = list(
      title = list(text = "Sample", standoff = 30),
      tickfont = list(size = 10),
      automargin = TRUE,
      tickmode = "array",
      tickvals = rownames(heatmap_matrix),  # 直接使用样本名
      ticktext = rownames(heatmap_matrix)
    ),
    margin = list(l = left_margin, r = 50, b = 100, t = 100)
  )

# 7. 输出结果 ------------------------------------------------
fig  # 在RStudio中查看

# 可选：保存为HTML
# htmlwidgets::saveWidget(fig, "snp_heatmap.html", selfcontained = TRUE)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="可视化代码的输入输出说明"><a href="#可视化代码的输入输出说明" class="headerlink" title="可视化代码的输入输出说明"></a>可视化代码的输入输出说明</h3><h4 id="输入数据格式："><a href="#输入数据格式：" class="headerlink" title="输入数据格式："></a>输入数据格式：</h4><pre class="line-numbers language-none"><code class="language-none"># 输入数据应为数据框格式，包含以下列：
# CHROM  POS     Sample1 Sample2 Sample3 ... SampleN
# 1      1000    0/1     1/1     0/0     ... 0/1
# 1      2000    1/1     0/1     1/1     ... 0/0

# 或者从VCF文件直接读取：
# vcf &lt;- read.vcfR("input.vcf")
# snp_data &lt;- vcfR2tidy(vcf)$fix<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="输出可视化结果："><a href="#输出可视化结果：" class="headerlink" title="输出可视化结果："></a>输出可视化结果：</h4><pre class="line-numbers language-none"><code class="language-none"># 1. 交互式热图 - 在RStudio中显示或保存为HTML
#    - X轴: 基因组位置
#    - Y轴: 样本名称  
#    - 颜色: 蓝色(0/0), 红色(1/1), 黄色(0/1), 灰色(缺失)

# 2. 控制台输出的统计信息：
#    - 总位点数: 1500
#    - 总样本数: 96  
#    - 基因型统计: REF=45%, ALT=40%, HET=12%, MISSING=3%

# 3. 热图特性：
#    - 支持缩放和拖动查看细节
#    - 鼠标悬停显示具体基因型信息
#    - 自适应布局，适合发表级图片输出<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="可视化价值："><a href="#可视化价值：" class="headerlink" title="可视化价值："></a>可视化价值：</h4><ul>
<li><strong>快速质控</strong>: 一眼识别数据质量问题</li>
<li><strong>模式识别</strong>: 直观看到群体分层和基因型分布模式</li>
<li><strong>结果验证</strong>: 确认筛选出的差异位点确实显示预期模式</li>
<li><strong>报告展示</strong>: 生成可用于发表的高质量图表</li>
</ul>
<h2 id="💡-技术要点与注意事项"><a href="#💡-技术要点与注意事项" class="headerlink" title="💡 技术要点与注意事项"></a>💡 技术要点与注意事项</h2><h3 id="参数选择策略"><a href="#参数选择策略" class="headerlink" title="参数选择策略"></a>参数选择策略</h3><ol>
<li><p><strong>一致率阈值（90%）</strong>：</p>
<ul>
<li>平衡了统计严格性和生物学现实性</li>
<li>允许少量个体变异或测序错误</li>
<li>可根据样本量调整：样本量越大，阈值可适当提高</li>
</ul>
</li>
<li><p><strong>样本量要求</strong>：</p>
<ul>
<li>每组至少20个有效样本确保统计可靠性</li>
<li>小样本群体建议调整阈值或使用其他统计方法</li>
</ul>
</li>
<li><p><strong>杂合位点处理</strong>：</p>
<ul>
<li>默认排除杂合型作为”一致”基因型</li>
<li>对于异交物种可考虑包含杂合型</li>
</ul>
</li>
</ol>
<h3 id="常见问题排查"><a href="#常见问题排查" class="headerlink" title="常见问题排查"></a>常见问题排查</h3><ol>
<li><p><strong>结果位点过少</strong>：</p>
<ul>
<li>检查群体间真实分化程度</li>
<li>验证一致率阈值是否过高</li>
<li>确认样本分组是否正确</li>
</ul>
</li>
<li><p><strong>热图显示异常</strong>：</p>
<ul>
<li>检查基因型编码格式</li>
<li>确认染色体坐标系统一</li>
<li>验证样本名称一致性</li>
</ul>
</li>
<li><p><strong>性能优化建议</strong>：</p>
<ul>
<li>大文件使用<code>data.table</code>替代<code>data.frame</code></li>
<li>分染色体并行处理</li>
<li>预处理时过滤低质量位点</li>
</ul>
</li>
</ol>
<h2 id="🚀-下游分析方向"><a href="#🚀-下游分析方向" class="headerlink" title="🚀 下游分析方向"></a>🚀 下游分析方向</h2><p>筛选得到的差异位点可用于：</p>
<ol>
<li><p><strong>基因组扫描分析</strong>：</p>
<ul>
<li>识别选择扫荡区域</li>
<li>定位群体分化热点</li>
</ul>
</li>
<li><p><strong>功能注释</strong>：</p>
<ul>
<li>基因本体富集分析</li>
<li>通路分析</li>
</ul>
</li>
<li><p><strong>育种应用</strong>：</p>
<ul>
<li>开发群体特异性分子标记</li>
<li>辅助亲本选配</li>
</ul>
</li>
<li><p><strong>进化研究</strong>：</p>
<ul>
<li>构建系统发育树</li>
<li>群体结构分析</li>
</ul>
</li>
</ol>
<hr>
<p><strong>总结</strong>：本流程提供了一个完整的从原始基因型数据到高质量差异位点筛选的解决方案，结合严格的统计标准和直观的可视化验证，确保结果的生物学可靠性和技术可重复性。</p>
<script type="module"> import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';	mermaid.initialize({startOnLoad: true, flowchart: {curve: 'linear'}}); </script>]]></content>
      <categories>
        <category>默认分类</category>
        <category>重测序</category>
      </categories>
  </entry>
  <entry>
    <title>内网穿透</title>
    <url>/2024/11/21/5/</url>
    <content><![CDATA[<p>前言<br>对于在本地搭建需求公网的服务，比如nas，游戏联机等。但是又没有公网，这种时候就需要用到内网穿透工具，通过端口转发实现公网访问。市面上的映射基本都是限制流量，要么就是带宽只有1m。</p>
<p>经过我的不断寻找，终于是找到了一款不限制流量，且基础带宽高的内网穿透工具。以下是他的基本信息：</p>
<p>免费带宽：国内8m，国外32m（这是我能找到的唯一一款国内国外单独计带宽的映射）<br>免费隧道：4条<br>流量：不限制<br>并发：不限制<br>除此之外访问地址并不会强制变化<br>官网链接</p>
<blockquote>
<p><a href="https://www.chmlfrp.cn/">https://www.chmlfrp.cn</a></p>
</blockquote>
<p>使用教程<br>这款映射是基于开源软件frp实现的端口映射功能，所以实际使用方法和frp的使用方法一致，复制它生成的配置文件然后运行即可。</p>
<p>注册/登录<br>没有帐户的首先前往chmlfrp官网注册账户，登录进首页之后是这样的页面：</p>
<p>创建隧道<br>随后通过菜单前往 “隧道管理 -&gt; 隧道列表” ，然后点击右上角的添加隧道按钮（我已经创建了一个隧道）</p>
<p>然后选择符合你要求的节点（一般选择离你近，且节点负载较低的节点。节点负载可以在 “隧道管理 -&gt; 节点状态” 查看所有节点的具体负载）</p>
<p>然后填写相应隧道信息，如果没有特殊需求，一般只需要填写端口类型及内网端口。</p>
<p>随后点击确定即可成功创建隧道</p>
<p>启动隧道<br>前往 “隧道管理 -&gt; 软件下载” 页面，下载对应你系统的软件。</p>
<p>下载好后解压压缩包，一般来讲只需要这三个文件，其他文件可以删除，也可以选择保留。</p>
<p>随后进入网站的 “隧道管理 -&gt; 配置文件” 页面，在此页面选择你创建隧道的节点，就可以获取到相应的配置文件。将获取的配置文件覆盖到文件夹的frpc.ini中：</p>
<p>随后保存文件，然后在此文件夹创建一个 “启动.txt” 的文本档案，然后将.txt后缀改为.bat。（注意！此方法仅windows可用，且需要打开显示文件扩展名）</p>
<p>右键 “启动.bat” ，点击编辑，输入以下代码：</p>
<p> <code>&nbsp;./frpc -c frpc.ini</code> </p>
<p>接下来是设置开机后台自启</p>
<p>新建一个启动服务</p>
<p>编辑该服务</p>
<p>重新加载</p>
<p>启动服务</p>
<p>开始服务</p>
<p>查看服务状态</p>
<p>重启</p>
<p>在弹出的cmd窗口中直接输入frpc即可启动</p>
]]></content>
      <categories>
        <category>折腾</category>
        <category>WIFI</category>
      </categories>
  </entry>
  <entry>
    <title>Typecho快速修改文章图片和文件链接地址</title>
    <url>/2025/09/03/50/</url>
    <content><![CDATA[<p>说明<br>为了使我们的博客速度更快，图片等一些文件会采用外接的形式。但当跟换域名或CDN图片地址时，需要大批修正一切文章的援用图片链接和一些文件链接地址，手动修正又烦劳，这里就说一下通过 phpMyAdmin工具快速修正数据库文章图片，文件链接地址。</p>
<hr>
<h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h2><p>如果您使用的是基于 Debian 或 Ubuntu 的 Linux 系统，可以尝试使用 apt-get 命令。例如：</p>
<blockquote>
<p>sudo apt-get update<br>sudo apt-get install phpmyadmin</p>
</blockquote>
<hr>
<p>The phpmyadmin package must have a database installed and configured before it c<br>with dbconfig-common.</p>
<p>If you are an advanced database administrator and know that you want to perform<br>database has already been installed and configured, you should refuse this optio<br>most likely be provided in /usr/share/doc/phpmyadmin.</p>
<p>Otherwise, you should probably choose this option.</p>
<p>Configure database for phpmyadmin with dbconfig-common? [yes/no] yes</p>
<p>Please provide a password for phpmyadmin to register with the database server. I<br>generated.</p>
<p>MySQL application password for phpmyadmin:</p>
<p>Password confirmation:</p>
<p>Determining localhost credentials from /etc/mysql/debian.cnf: succeeded.<br>请选择要自动配置以运行 phpMyAdmin 的网络服务器。</p>
<ol>
<li>apache2  2. lighttpd</li>
</ol>
<p>(Enter the items or ranges you want to select, separated by spaces.)</p>
<p>要自动重新配置的网络服务器： 2</p>
<p>dbconfig-common: writing config to /etc/dbconfig-common/phpmyadmin.conf</p>
<p>Creating config file /etc/dbconfig-common/phpmyadmin.conf with new version</p>
<p>Creating config file /etc/phpmyadmin/config-db.php with new version<br>checking privileges on database phpmyadmin for phpmyadmin@localhost: user creati<br>granting access to database phpmyadmin for phpmyadmin@localhost: success.<br>verifying access for phpmyadmin@localhost: success.<br>creating database phpmyadmin: success.<br>verifying database phpmyadmin exists: success.<br>populating database via sql…  done.<br>dbconfig-common: flushing administrative password<br>Lighttpd not installed, skipping<br>正在处理用于 libc-bin (2.31-13+deb11u2) 的触发器 …<br>ldconfig: /lib/libusbgx.so.2 is not a symbolic link</p>
<p>正在处理用于 php7.4-fpm (7.4.33-1+deb11u9) 的触发器 …<br>正在处理用于 php7.4-cli (7.4.33-1+deb11u9) 的触发器 …</p>
<hr>
<p>选择了 lighttpd (选项2) 作为Web服务器，但你的系统实际上运行的是 Nginx</p>
<p>下面是后续的解决步骤：</p>
<h3 id="第一步：手动配置-Nginx-以支持-phpMyAdmin"><a href="#第一步：手动配置-Nginx-以支持-phpMyAdmin" class="headerlink" title="第一步：手动配置 Nginx 以支持 phpMyAdmin"></a>第一步：手动配置 Nginx 以支持 phpMyAdmin</h3><p>由于自动配置失败了，我们需要手动为 Nginx 创建配置文件。</p>
<ol>
<li><p><strong>创建 phpMyAdmin 的符号链接</strong>（如果尚未存在）：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/share/phpmyadmin /var/www/html/phpmyadmin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
</li>
<li><p><strong>编辑 Nginx 站点配置文件</strong>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/nginx/sites-enabled/default<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p><strong>在 <code>server</code> 块中添加以下 location 配置</strong>（放在PHP location块之前或之后）：</p>
<pre class="line-numbers language-Nginx" data-language="Nginx"><code class="language-Nginx"># phpMyAdmin 配置
location /phpmyadmin {
    root /usr/share/;
    index index.php index.html index.htm;
    
    location ~ ^/phpmyadmin/(.+.php)$ {
        try_files $uri =404;
        root /usr/share/;
        fastcgi_pass unix:/run/php/php7.4-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include /etc/nginx/fastcgi_params;
    }
    
    location ~* ^/phpmyadmin/(.+.(jpg|jpeg|gif|css|png|js|ico|html|xml|txt))$ {
        root /usr/share/;
    }
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<h3 id="第二步：测试并重启-Nginx"><a href="#第二步：测试并重启-Nginx" class="headerlink" title="第二步：测试并重启 Nginx"></a>第二步：测试并重启 Nginx</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 测试配置语法</span>
<span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span>

<span class="token comment"># 如果语法正确，重启Nginx</span>
<span class="token function">sudo</span> systemctl restart nginx
<span class="token comment"># 或者使用重载</span>
<span class="token function">sudo</span> nginx <span class="token parameter variable">-s</span> reload<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="第三步：访问-phpMyAdmin"><a href="#第三步：访问-phpMyAdmin" class="headerlink" title="第三步：访问 phpMyAdmin"></a>第三步：访问 phpMyAdmin</h3><p>现在你应该可以通过浏览器访问 phpMyAdmin：</p>
<pre class="line-numbers language-none"><code class="language-none">http://你的服务器IP或域名/phpmyadmin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="第四步：登录-phpMyAdmin"><a href="#第四步：登录-phpMyAdmin" class="headerlink" title="第四步：登录 phpMyAdmin"></a>第四步：登录 phpMyAdmin</h3><p>使用以下凭据登录：</p>
<ul>
<li><strong>用户名</strong>：phpmyadmin（或者你之前设置的MySQL用户名）</li>
<li><strong>密码</strong>：你刚才安装时设置的密码</li>
</ul>
<h3 id="如果遇到权限问题"><a href="#如果遇到权限问题" class="headerlink" title="如果遇到权限问题"></a>如果遇到权限问题</h3><p>如果无法访问，可能需要调整权限：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 调整phpMyAdmin目录权限</span>
<span class="token function">sudo</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> www-data:www-data /usr/share/phpmyadmin/
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token parameter variable">-R</span> <span class="token number">755</span> /usr/share/phpmyadmin/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="验证MySQL连接"><a href="#验证MySQL连接" class="headerlink" title="验证MySQL连接"></a>验证MySQL连接</h3><p>如果仍然无法连接，检查MySQL用户权限：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 登录MySQL</span>
<span class="token function">sudo</span> mysql <span class="token parameter variable">-u</span> root <span class="token parameter variable">-p</span>

<span class="token comment"># 检查phpmyadmin用户权限</span>
SELECT user, <span class="token function">host</span> FROM mysql.user<span class="token punctuation">;</span>
SHOW GRANTS FOR <span class="token string">'phpmyadmin'</span>@<span class="token string">'localhost'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="安全建议"><a href="#安全建议" class="headerlink" title="安全建议"></a>安全建议</h3><ol>
<li><strong>限制访问</strong>：考虑通过IP限制或HTTP认证来保护phpMyAdmin</li>
<li><strong>使用HTTPS</strong>：确保通过SSL访问phpMyAdmin</li>
<li><strong>修改URL路径</strong>：将 <code>/phpmyadmin</code> 改为不易猜测的路径</li>
</ol>
<p>这样配置后，phpMyAdmin 就应该可以正常工作了。完成后你可以通过浏览器访问并管理你的Typecho数据库，然后运行之前提到的SQL命令来批量更新图片链接。</p>
<p>{lamp/}</p>
<h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><p>操作前请各位先备份一下数据库</p>
<p>(1)执行sql</p>
<pre class="line-numbers language-SQL" data-language="SQL"><code class="language-SQL">UPDATE `typecho_contents` SET `text` = REPLACE(`text`,'旧域名地址','新域名地址');<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> <code>typecho_contents</code>  是typecho存放文章的一个表<br>(2)方法2<br><img src="/images/50/3725854188.png" alt="mf3n8p7s.png"></p>
<p>选中 <code>typecho_contents</code> ，然后点上面的搜索，选择查找和替换，输入之前的图片或者文件地址和之后的地址，字段选择 <code>text</code> ，确认后执行即可批量修改。</p>
]]></content>
      <categories>
        <category>WIFI</category>
      </categories>
  </entry>
  <entry>
    <title>ANNOVAR | 变异注释</title>
    <url>/2025/09/16/53/</url>
    <content><![CDATA[<h2 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a>一、简介</h2><p>会得到一系列变异数据，这些变异数据只是告诉我们在基因组的某个位置发生了一段序列的改变，至于这个改变会不会影响生物学功能，我们并不清楚。而注释就是将基因组的序列变异数据转化为我们更关心的生物学功能变化的信息。</p>
<p>Annovar常被用在人类基因组的注释上，其实，它也可以对人类以外的基因组数据进行注释。比如，老鼠基因组的注释上。需要自己进行建立注释信息。</p>
<p>ANNOVAR是一个perl编写的命令行工具，能在安装了perl解释器的多种操作系统上执行。允许多种输入文件格式，包括最常被使用的VCF格式。输出文件也有多种格式，包括注释过的VCF文件、用tab或者逗号分隔的text文件。</p>
<p>ANNOVAR能快速注释遗传变异并预测其功能。类似的variants注释软件还有 VEP, snpEff, VAAST, AnnTools等等.</p>
<hr>
<p>ANNOVAR 注释变异可以分成有基于基因、基于染色体区间和变异数据等三种类型. 这三种注释分别针对于每一个variant的不同方面：</p>
<p>基于基因的注释（gene-based annotation）<br>注释结果为突变位点位于基因的相对位置，是否改变氨基酸编码，确定受影响的氨基酸，获得变异位点的HGVS命名方式，揭示variant与已知基因直接的关系以及对其产生的功能性影响。可灵活使用RefSeq genes, UCSC genes, ENSEMBL genes, GENCODE genes或许多其他基因定义系统。</p>
<p>基于染色体区间的注释（region-based annotation）<br>识别特定基因组区域的变异，例如，44个物种中的保守区域，预测的转录因子结合位点, segmental duplication regions, GWAS hits, ChIP-Seq peaks, RNA-Seq peaks等等许多其他的在基因组区间的注释；</p>
<p>变异数据库的注释 / 基于过滤的注释（ filter-based annotation ）<br>则给出这个variant的一系列信息，如： population frequency in different populations 和various types of variant-deleteriousness prediction scores, 这些可被用来过滤掉一些公共的及 probably（大概,肯定的成分较大,是most likely） nondeleterious variants. 包括Clinvar, dbSNP, Cosmic, ExAC, gnomAD等等，突变数据库整理可参考从 vcf 文件准备 ANNOVAR 数据库。鉴定特定数据库中记录的变异，例如，该变异位点是否在dbSNP中有报道，在千人基因组计划中的等位基因频率如何等等。</p>
<p>ANNOVAR 数据库文件实际上为特定格式的文本文件，其数据库文件命名规则为: ${path_database}/${buildver}_${database_name}.txt</p>
<p>ANNOVAR 所有注释结果都在 vcf 文件 INFO 列添加key-value</p>
<h2 id="二、ANNOVAR的下载"><a href="#二、ANNOVAR的下载" class="headerlink" title="二、ANNOVAR的下载"></a>二、ANNOVAR的下载</h2><p>下载地址</p>
<p>填写登记表，下载ANNOVAR软件（<a href="http://annovar.openbio/">http://annovar.openbio</a> informatics.org/），解压文件</p>
<p>tar xvfz annovar.latest.tar.gz<br>解压后生成annovar文件夹，里面有6个perl脚本程序和2个文件夹。</p>
<h3 id="ANNOVAR-的文件结构"><a href="#ANNOVAR-的文件结构" class="headerlink" title="ANNOVAR 的文件结构"></a>ANNOVAR 的文件结构</h3><p>|– annotate_variation.pl              # 主程序，功能包括下载数据库，三种不同的注释<br>|– coding_change.pl                   # 可用来推断蛋白质序列<br>|– convert2annovar.pl                 # 将多种格式转为.avinput的程序<br>|– retrieve_seq_from_fasta.pl         # 用于自行建立其他物种的转录本<br>|– table_annovar.pl                   # 注释程序，可一次性完成三种类型的注释<br>|– variants_reduction.pl              # 可用来更灵活地定制过滤注释流程<br>|– example                            # 存放示例文件<br>|– humandb                            # 人类注释数据库<br>自带了humandb是已经建立好的hg19或者GRCh37等常用的数据库，可用于人的注释。 如果要进行其他注释，需要使用 -downdb命令下载数据库到 humandb/ 目录。</p>
<p>三、注释<br>perl retrieve_seq_from_fasta.pl<br>  –format refGene<br>  –seqfile zunla.fasta  zunla_refGene.txt<br>  –out zunla_refGeneMrna.fa</p>
<ol>
<li>用ANNOVAR注释人类基因组variants信息<br>1.1 下载所有需要的注释信息库<br>对于基于基因的注释的数据库已经在下好的 ANNOVAR package中了。如果要进行其他注释，需要按以下命令下载数据库到 ‘humandb/’ 目录里：<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">perl annotate_variation.pl --downdb --buildver hg19 cytoBand humandb/
perl annotate_variation.pl --downdb --webfrom annovar --buildver hg19 1000g2014oct humandb/
perl annotate_variation.pl --downdb --webfrom annovar --buildver hg19 exac03 humandb/
perl annotate_variation.pl --downdb --webfrom annovar --buildver hg19 ljb26_all humandb/
perl annotate_variation.pl --downdb --webfrom annovar --buildver hg19 clinvar_20140929 humandb/
perl annotate_variation.pl --downdb --webfrom annovar --buildver hg19 snp138 humandb/

# -buildver: 基因组对应版本
# -webfrom annovar: 从annovar库里下载;如果annovar库中没有，则不用写该选项，会从UCSC中下载
# refGene: 数据库名称
# humandb/: 下载至该目录<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ol>
<p>这里下载的是几个通常用到的数据库：<br>1）cytoBand 是每个细胞间band（cytogenetic band）的染色体坐标信息 ,<br>2）1000g2014oct<br>　　　　for alternative allele frequency in the 1000 Genomes Project (version October 2014),<br>　　　　是2014年10版，1000基因组项目（和ExAV 外显子集合联合一样，是公开、开放的数据库）<br>　　　　里面供选择的等位基因频率信息<br>3）exac03<br>　　　　for the variants reported in the Exome Aggregation Consortium (version 0.3),<br>　　　　是0.3版外显子集合联合中报道过的variants.<br>4）ljb26_all<br>　　　　for various functional deleteriousness prediction scores from the dbNSFP database (version 2.6),<br>　　　　 dbNSFP: A Lightweight Database of Human NonsynonymousSNPs and TheirFunctionalPredictions on ResearchGate<br>5）clinvar_20140929<br>　　　　for the variants reported in the ClinVar database (version 20140929)<br>　　　　ClinVar是美国国家生物技术信息中心（NCBI）于2012年11月宣布、2013年4月正式启动的公共、免费数据库。作为核心数据库，ClinVar数据库整合了十多个不同类型数据库、通过标准的命名法来描述疾病，同时支持科研人员将数据下载到本地中，开展更为个性化的研究。在遗传变异和临床表型方面，NCBI和不同的研究组已经建立了各种各样的数据库，数据信息相对比较分散，ClinVar数据库的目的在于整合这些分散的数据、将变异、临床表型、实证数据以及功能注解与分析等四个方面的信息，通过专家评审，逐步形成一个标准的、可信的、稳定的遗传变异-临床表型相关的数据库。<br>6）snp138<br>　　　　for the dbSNP database (version 138).</p>
<p>注意：<br>　　(i) 第一个命令中不包含 –webfrom annovar 选项, 因此是从the UCSC Genome Browser annotation database下载文件的；<br>　　(ii) –buildver hg19 选项是针对hg19这一版的基因组的；<br>　　(iii) 运行上面命令后，在 humandb/ 目录下会多几个以 hg19为前缀的文件。</p>
<p>1.2 table_annovar.pl注释variants<br>输入下列命令，用之前下载好的注释数据库来注释vcf格式文件中的variants。ANNOVAR 所有注释结果都在 vcf 文件 INFO 列添加key-value。输出的csv文件将包含输入的5列主要信息以及各个数据库里的注释。</p>
<p>perl table_annovar.pl  humandb/ –outfile final –buildver hg19<br>  –protocol refGene,cytoBand,1000g2014oct_eur,1000g2014oct_afr,exac03,ljb26_all,clinvar_20140929,snp138<br>  –operation g,r,f,f,f,f,f,f<br>  –vcfinput<br> 参考输入的vcf文件的名称<br>　　–protocol 选项后跟注释来源数据库的准确名称<br>　　–operation选项后跟注释的类型:<br>　　　　g 表示基于基因的注释（gene-based annotation）；<br>　　　　r 表示基于区域的注释（region-based annotation）；<br>　　　　f 表示基于筛选子的注释（ filter-based annotation）；<br>　　–outfile 选项是指定输出文件的前缀</p>
<p>关键步骤：<br>　　1、确保注释数据库的名称正确并且是按你想要在输出文件中显示的顺序排列的；<br>　　2、确保 –operation指定的注释类型顺序和–protocol指定的数据库顺序是一致的；<br>　　3、确保每个protocal名称或注释类型之间只有一个逗号，并且没有空白。</p>
<p>final.hg19_multianno.vcf.输出文件应该是以个VCF格式文件，INFO那列以 key=value 形式、 ;分割成几个小区域. eg:Func.refGene=intronic;Gene.refGene=SAMD11. 每个键值对代表一个ANNOVAR注释信息。输出文件可以用为VCF格式文件设计的基因分析软件进一步处理。</p>
<p>final.hg19_multianno.txt. 每一行代表一个variant 。用tab分隔，多余列为加上的注释信息，顺序按 –protocol选项所设定的注释类型argument。</p>
<ol start="2">
<li>用Annovar注释人类以外的基因组（Gene-based annotation）<br>Annovar常被用在人类基因组的注释上，其实，它也可以对人类以外的基因组数据进行注释。annovar一般只包含人类基因组注释数据库，其他的物种需要自己进行建立注释信息。</li>
</ol>
<p>2.1 以注释小鼠基因组为例<br>一般如果你想看是否有某种物种,如小鼠mm9的注释库时，命令行运行</p>
<p>perl annotate_variation.pl -builder mm9 -downdb avdblist -webfrom annovar ./<br>会生成一个mm9开头的文件，里面包含小鼠mm9有多少注释数据库，然后自己可以构建一个mousedb数据库 先在annovar文件夹里面创建mousedb文件夹（名字可自取），命令mkdir mousedb 然后使用annovar文件夹下的perl程序annotate_variation.pl</p>
<p>perl annotate_variation.pl -downdb -buildver mm9 -webfrom annovar refGene mousedb/<br>这个命令能实现的是帮忙下载mm9的refGene的文件，保存在mousedb文件下，自动解压后文件名为mm9_refGene.txt。 然后程序会提示使用以下两个命令继续建库</p>
<p>annotate_variation.pl –buildver mm9 –downdb seq mousedb/mm9_seq<br>retrieve_seq_from_fasta.pl mousedb/mm9_refGene.txt -seqdir mousedb/mm9_seq -format refGene -outfile mousedb/mm9_refGeneMrna.fa<br>同样在annovar文件下运行这两个perl程序</p>
<p>perl annotate_variation.pl –buildver mm9 –downdb seq mousedb/mm9_seq<br>通过这个命令，会在mousedb下创建文件夹mm9_seq，并且在里面下载mm9的基因组文件chromFa.tar.gz，perl程序帮忙解压后是按染色体分开的fasta格式文件。 然后继续运行perl程序</p>
<p>perl retrieve_seq_from_fasta.pl mousedb/mm9_refGene.txt -seqdir mousedb/mm9_seq -format refGene -outfile mousedb/mm9_refGeneMrna.fa<br>该程序会会在mousedb下创建mm9_refGeneMrna.fa文件，是根据mm9_refGene.txt的信息，重新构建成的老鼠转录表达基因fasta格式文件 这样老鼠mm9 annovar gene based注释库就弄好了 以文本文件test.input为案例进行测试 生成test.input的txt格式文件，根据annovar官网介绍，只要这最基本的五列信息就可以进行注释，五列分别染色体名称，染色体上的位置，染色体上的位置，参考基因组碱基，变异碱基。</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">1       19215217        19215217        T       C
1       33803084        33803084        A       G
1       33803198        33803198        A       G
1       37499237        37499237        T       C
1       37499238        37499238        T       C
1       37500003        37500003        T       C
1       43826936        43826936        T       C
1       58853960        58853960        A       G
1       58854487        58854487        A       G
1       60436865        60436865        T       C<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后使用perl程序进行gene based的注释</p>
<p>perl annotate_variation.pl -out test -build mm9 test.input mousedb<br>注释后会生成test.variant_function，test.exonic_variant_function和test.log文件，前两个即为所需要的文件。用这个例子输出test.exonic_variant_function文件输出为空文件，因为这些位点没有在exonic区域的，所以没有结果。如果有位点在exonic中，则在test.exonic_variant_function中会更具体的描述为同义突变还是非同义突变</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">intronic        Tfap2b  1       19215217        19215217        T       C
UTR3            Bag2    1       33803084        33803084        A       G
UTR3            Bag2    1       33803198        33803198        A       G
UTR3            Mgat4a  1       37499237        37499237        T       C
UTR3            Mgat4a  1       37499238        37499238        T       C
UTR3            Mgat4a  1       37500003        37500003        T       C
intronic        Uxs1    1       43826936        43826936        T       C
intronic        Casp8   1       58853960        58853960        A       G
intronic        Casp8   1       58854487        58854487        A       G
intronic        Cyp20a1 1       60436865        60436865        T       C<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2.2 以注释大猩猩基因组（with the genome build identifier as panTro2.）为例。<br>对于gene-based annotation， ANNOVAR需要 genePred format 的 gene definition file和 FASTA format 的 transcript sequence file；</p>
<p>第一步：输入以下命令，下载大猩猩基因组定义文件（ gene definition file）及序列的 FASTA 文件到chimpdb/目录</p>
<p>perl annotate_variation.pl –downdb –buildver panTro2 gene chimpdb/<br>perl annotate_variation.pl –downdb –buildver panTro2 seq chimpdb/panTro2_seq<br>运行过程中，出现下列提示</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">---------------------------ADDITIONAL PROCEDURE---------------------------
--------------------------------------------------------------------------
NOTICE: the FASTA file for the genome is not available to download but can be generated by the ANNOVAR software.
PLEASE RUN THE FOLLOWING TWO COMMANDS CONSECUTIVELY TO GENERATE THE FASTA FILES (you may need to change -seqdir to -seqfile for some genomes):

    annotate_variation.pl --buildver panTro2 --downdb seq chimpdb/panTro2_seq
    retrieve_seq_from_fasta.pl chimpdb/panTro2_refGene.txt -seqdir chimpdb/panTro2_seq -format refGene -outfile chimpdb/panTro2_refGeneMrna.fa<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>第二步：注意ANNOVAR数据库中只包含人类基因组已建好的转录本，不包含其他物种的。故需要按以下命令自行建立对应物种的transcript FASTA file</p>
<p>perl retrieve_seq_from_fasta.pl chimpdb/panTro2_refGene.txt<br>  –seqdir chimpdb/panTro2_seq<br>  –format refGene<br>  –outfile chimpdb/panTro2_refGeneMrna.fa<br>–seqdir说明下载的序列文件的所在目录；<br>–format说明 gene definition file的格式.；<br>–outfile 指定输出mRNA 序列文件的名称；</p>
<p>关键：跟在–outfile后的输出文件名应该是 _refGeneMrna.fa这种形式，否则下一步找不到正确的 transcript FASTA sequence file.</p>
<p>第三步：注释variants，with the chimpanzee gene annotation:</p>
<p>perl table_annovar.pl  chimpdb/<br>  –vcfinput<br>  –outfile final<br>  –buildver panTro2<br>  –protocol refGene<br>  –operation g<br> input VCF file；<br>chimpdb/ directory of the downloaded data；</p>
<p>第四步：输出结果文件核对。 final.panTro2_multianno.txt file. The gene annotation for chimpanzee is added after the input variants.</p>
<p>关键：如果没有现成可用的gene definition file ，可以将基因预测工具产生的 GFF3 or GTF 文件转换成 gene definition file.</p>
<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>


<h2 id="三、构建自定义注释库"><a href="#三、构建自定义注释库" class="headerlink" title="三、构建自定义注释库"></a>三、构建自定义注释库</h2><p>ANNOVAR可以从服务器下载注释库，但是主要针对人类基因组，那么需要分析、注释其它的物种测序结果，怎么办呢，需要自建注释库。</p>
<p>1 以注释长牡蛎基因组为例</p>
<h3 id="第一步：准备工作"><a href="#第一步：准备工作" class="headerlink" title="第一步：准备工作"></a>第一步：准备工作</h3><p>首先，需要参考基因组的序列和注释文件，这里是名为Cg长牡蛎</p>
<p>GCF_902806645.1_cgigas_uk_roslin_v1_genomic.fna      # 长牡蛎 的参考基因组序列<br>/home/wanglab/Ywh/adductor_muscle_scar/Crassostrea_gigas.cgigas_uk_roslin_v1.61.gtf       # 长牡蛎的注释文件，我这里是gtf<br>ANNOVAR 建库需要 genePred 文件，因而需要准备几个转换 gtf 到 genePred 格式的软件</p>
<p>gffread           # gff3 to gtf<br>gtfToGenePred     # gtf to genePred<br>gffread的下载地址，需要自行编译。编译过程会自行下载<a href="https://github.com/gpertea/gclib%EF%BC%8C%E4%B9%9F%E5%8F%AF%E4%BB%A5%E9%A2%84%E5%85%88%E4%B8%8B%E8%BD%BD%EF%BC%8C%E7%84%B6%E5%90%8E">https://github.com/gpertea/gclib，也可以预先下载，然后</a> <code>make</code> 。</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">git clone https://github.com/gpertea/gffread
cd gffread
make release<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>推荐直接conda安装</p>
<p> <code>conda install gffread</code><br>gtfToGenePred的下载地址，已经编译好了，下载直接使用，他属于UCSC工具包，因而在conda环境安装gtfToGenePred的命令为</p>
<p> <code>conda install ucsc-gtftogenepred</code><br>conda直接安装gtftogenepred没成功，需要加上UCSC前缀。</p>
<h3 id="第二步：建立注释库"><a href="#第二步：建立注释库" class="headerlink" title="第二步：建立注释库"></a>第二步：建立注释库</h3><p>创建辣椒注释库的文件夹Cgigasdb，然后进去</p>
<p>mkdir Cgigasdb<br>cd Cgigasdb<br>转换gff3 为 gtf，推荐使用GTF格式，因为有些GFF3格式文件转换可能不正确</p>
<p>gffread Cgigas.gff -T -o Cgigas.gtf<br>转换gtf 为 GenePred</p>
<p>gtfToGenePred -genePredExt “/home/wanglab/Ywh/adductor_muscle_scar/ReSeq_Data/DZQD2023092909/annovar/Cgigasdb/GCF_902806645.1_cgigas_uk_roslin_v1_genomic.gtf” Cg_refGene.txt<br>建立注释库</p>
<p>perl ../retrieve_seq_from_fasta.pl –format refGene –seqfile GCF_902806645.1_cgigas_uk_roslin_v1_genomic.fna –outfile Cg_refGeneMrna.fa Cg_refGene.txt<br>这样我们的建库就完成了，获得两个重要的文件</p>
<p>Cgigas_refGeneMrna.fa<br>Cgigas_refGene.txt<br>强调：关于文件的命名，按照常规逻辑，这两个文件肯定不能随便命名，不然annovar无法识别！摸索了一下，前缀就是下面build参数使用的名字，这里就是Cgigas，下面注释就要使用“-build Cgigas”这个参数，对于基于基因注释的txt文件命名就是refGene，连起来就是 Cgigas_refGene.txt。而fa文件前缀一样，后面有稍稍差别为refGeneMrna，连起来就是Cgigas_refGeneMrna.fa。</p>
<h3 id="第三步：转换需要注释的vcf文件"><a href="#第三步：转换需要注释的vcf文件" class="headerlink" title="第三步：转换需要注释的vcf文件"></a>第三步：转换需要注释的vcf文件</h3><p>BB3.HC.vcf是HaplotypeCaller得到的vcf文件，转换成适用annovar的文件格式。得到的BB3.avinput就是我们需要注释的文件</p>
<p>perl convert2annovar.pl -format vcf4 BB3.HC.vcf &gt; BB3.avinput</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C"># 将您的TSV转换为Annovar的avinput格式
awk 'NR&gt;1 {print $1"\t"$2"\t"$2"\t"$3"\t"$4}' /home/wanglab/Ywh/adductor_muscle_scar/Variants/filtered_variants_thr0p7_20250902_162128.tsv &gt; filtered_variants_thr0p7_20250902_162128.avinput<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ANNOVAR主要使用convert2annovar.pl程序进行转换，转换后文件是精简过的，主要包含前面提到的5列内容，如果要将原格式的文件的所有内容都包含在转换后的.avinput文件中，可以使用-includeinfo参数；如果需要分开每个sample输出单一的.avinput文件，可以使用-allsample参数，等等。</p>
<p>ANNOVAR还主要支持以下格式转换：</p>
<p>SAMtools pileup format<br>Complete Genomics format<br>GFF3-SOLiD calling format<br>SOAPsnp calling format<br>MAQ calling format<br>CASAVA calling format</p>
<h2 id="第四步：annotate-variation注释"><a href="#第四步：annotate-variation注释" class="headerlink" title="第四步：annotate_variation注释"></a>第四步：annotate_variation注释</h2><pre class="line-numbers language-C" data-language="C"><code class="language-C"># 一步完成注释和表格输出
perl table_annovar.pl filtered_variants_thr0p7_20250902_162128.avinput Cgigasdb/ \
   -buildver Cg \
   -out filtered_variants_thr0p7_20250902_162128 \
   -remove \
   -protocol refGene \
   -operation g \
   -nastring . \
   -csvout<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>-geneanno -dbtype refGene是默认值，可以省略，那么命令也可以写成</p>
<p>得到结果文件：</p>
<p>BB3.exonic_variant_function     # 外显子区域突变的功能、类型等<br>BB3.variant_function            # 突变的基因及位置<br>BB3.log                         # 日志文件<br>第五步：table_annovar.pl注释</p>
<p>table_annovar.pl是ANNOVAR多个脚本的封装，可以一次性完成三种类型的注释。</p>
<p>我这里只有regGene类型的注释库，那么注释命令为</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">perl table_annovar.pl  
  BB3.avinput pepperdb/  
  -buildver zunla               # 使用zunla注释库
  -out BB3 
  -remove                       # 清除所有临时文件
  -protocol refGene             # 注释库类型为refgene
  -operation g                  # 操作子为g
  -nastring .                   # 缺省值用“.”代替
  -csvout                       # 输出csv文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>table_annovar.pl也可以不经过转换，直接对vcf文件进行注释，添加-vcfinput参数就行，注释的内容将会放在vcf文件的“INFO”那一栏。但是需要注意的是不能和-csvout参数同时使用，命令如下</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">perl table_annovar.pl 
  BB3.HC.vcf 
  pepperdb/  
  -buildver zunla 
  -out BB3 
  -protocol refGene 
  -operation g 
  -nastring .  
  -vcfinput 
  -polish<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>所以，两种输入格式</p>
<p>VCF文件：用 -vcfinput指定<br>avinput<br>每行代表一个位点<br>前5列依次为：chromosome, start position, end position, the reference nucleotides, the observed nucleotides<br>reference nucleotides：不知道时可设置为0<br>observed nucleotides: insertion,deletion,block subsititution可用-表示<br>其余列：可有可无，如果有，在输出文件中会原样输出。<br>more BB3.avinput</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">1       948921  948921  T       C       comments: rs15842, a SNP in 5' UTR of ISG15
1       13211293        13211294        TC      -       comments: rs59770105, a 2-bp deletion
1       11403596        11403596        -       AT      comments: rs35561142, a 2-bp insertion
1       105492231       105492231       A       ATAAA   comments: rs10552169, a block substitution
1       67705958        67705958        G       A       comments: rs11209026 (R381Q), a SNP in IL23R associated <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>cat example/ex1.avinput</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">1   948921  948921  T   C   comments: rs15842, a SNP in 5' UTR of ISG15
1   1404001 1404001 G   T   comments: rs149123833, a SNP in 3' UTR of ATAD3C
1   5935162 5935162 A   T   comments: rs1287637, a splice site variant in NPHP4
1   162736463   162736463   C   T   comments: rs1000050, a SNP in Illumina SNP arrays
1   84875173    84875173    C   T   comments: rs6576700 or SNP_A-1780419, a SNP in Affymetrix SNP arrays
1   13211293    13211294    TC  -   comments: rs59770105, a 2-bp deletion
1   11403596    11403596    -   AT  comments: rs35561142, a 2-bp insertion
1   105492231   105492231   A   ATAAA   comments: rs10552169, a block substitution
1   67705958    67705958    G   A   comments: rs11209026 (R381Q), a SNP in IL23R associated with Crohn's disease
2   234183368   234183368   A   G   comments: rs2241880 (T300A), a SNP in the ATG16L1 associated with Crohn's disease<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>该格式每列以tab分割，最重要的地方为前5列，分别是:</p>
<p>染色体(Chromosome)<br>起始位置(Start)<br>结束位置(End)<br>参考等位基因(Reference Allele)<br>替代等位基因(Alternative Allele)<br>剩下为注释部分（可选）。<br>ANNOVAR主要也是依靠这5处信息对数据库进行比对，进而注释变异。</p>
<p>报错：</p>
<p>chmod 777 table_annovar.pl<br>问题依旧！</p>
<p>没办法，只能跑去table_annovar.pl脚本的444行看一下具体代码</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">1.  #generate gene anno
2.  my $sc;
3.  $sc = $SC_PREFIX .  "annotate_variation.pl -geneanno -buildver $buildver -dbtype $protocol -outfile $tempfile.$protocol -exonsort -nofirstcodondel $queryfile $dbloc";  #20191010: add -nofirstcodondel
4.  $argument and $sc .=  " $argument";
5.  $intronhgvs and $sc .=  " -splicing_threshold $intronhgvs";

7.  if  ($thread)  {
8.  $sc .=  " -thread $thread";
9.  }
10.  if  ($maxgenethread)  {
11.  $sc .=  " -maxgenethread $maxgenethread";
12.  }

14.  print STDERR "\nNOTICE: Running with system command \n";
15.  system ($sc)  and  die  "Error running system command: \n";<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<p>444行的内容为system ($sc) and die “Error running system command: \n”;<br>看得出来，这里执行了system系统命令，往上查找变量$sc的值，发现这里调用了annotate_variation.pl脚本，同样</p>
<p>chmod 777 annotate_variation.pl<br>为了避免别的脚本权限问题，干脆全部777</p>
<p>chmod 777 *<br>成功解决权限问题。</p>
<p>注释完的结果合并到原文件</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"># 步骤1: 为原始文件添加行号
awk 'NR==1 {print "LineNumber\t"$0} NR&gt;1 {print NR-1"\t"$0}' /home/wanglab/Ywh/adductor_muscle_scar/Variants/filtered_variants_thr0p7_20250902_162128.tsv &gt; original_with_linenum.tsv

# 步骤2: 为注释文件添加行号
awk 'NR==1 {print "LineNumber\t"$0} NR&gt;1 {print NR-1"\t"$0}' filtered_variants_thr0p7_20250902_162128.Cg_multianno.csv &gt; anno_with_linenum.tsv

# 步骤3: 基于行号合并
join -t $'\t' -1 1 -2 1 original_with_linenum.tsv anno_with_linenum.tsv &gt; merged_result.tsv

# 步骤4: 清理临时文件
rm original_with_linenum.tsv anno_with_linenum.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




<p>2 以构建拟南芥（Arabidopsis thaliana）的注释所需文件为例<br>第一步：准备<br>下载Arabidopsis 的 GTF file 和 genome FASTA file，到 ‘atdb’目录下。解压文件。 地址</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">mkdir atdb                                                                                                                                                
cd atdb         
wget ftp://ftp.ensemblgenomes.org/pub/release-27/plants/fasta/arabidopsis_thaliana/dna/Arabidopsis_thaliana.TAIR10.27.dna.genome.fa.gz                    
wget ftp://ftp.ensemblgenomes.org/pub/release-27/plants/gtf/arabidopsis_thaliana/Arabidopsis_thaliana.TAIR10.27.gtf.gz                                                                                                                                                                                                                   
gunzip Arabidopsis_thaliana.TAIR10.27.dna.genome.fa.gz             
gunzip Arabidopsis_thaliana.TAIR10.27.gtf.gz  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>**第二步：<br>用 gtfToGenePred 工具将 GTF file 转换 GenePred file</p>
<p>gtfToGenePred -genePredExt Arabidopsis_thaliana.TAIR10.27.gtf AT_refGene.txt<br>用retrieve_seq_from_fasta.pl生成 transcript FASTA file</p>
<p>perl ../retrieve_seq_from_fasta.pl –format refGene –seqfile Arabidopsis_thaliana.TAIR10.27.dna.genome.fa AT_refGene.txt AT_refGeneMrna.fa<br>After this step, the annotation database files needed for gene-based annotation are ready. Now you can annotate a given VCF file using the procedure starting from B(iii). Please note that the ‘–buildver’ argument should be set to ‘AT’.<br>参考<a href="http://annovar.openbioinformatics.org/en/latest/user-guide/gene/">http://annovar.openbioinformatics.org/en/latest/user-guide/gene/</a> for more details.bases and other arguments are the same as in the human genome annotation.</p>
<p>总脚本如下</p>
<p>下载物种基因序列、注释文件</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">wget -c ftp://ftp.ensemblgenomes.org/pub/release-27/plants/fasta/arabidopsis_thaliana/dna/Arabidopsis_thaliana.TAIR10.27.dna.genome.fa.gz
wget -c ftp://ftp.ensemblgenomes.org/pub/release-27/plants/gtf/arabidopsis_thaliana/Arabidopsis_thaliana.TAIR10.27.gtf.gz
gzip -d Arabidopsis_thaliana.TAIR10.27.dna.genome.fa.gz
gzip -d Arabidopsis_thaliana.TAIR10.27.gtf.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p>#gtf文件格式转换</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">wget -c http://hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64/gtfToGenePred
gtfToGenePred -genePredExt Arabidopsis_thaliana.TAIR10.27.gtf AT_refGene.txt
 
# 另一种格式转换方法，https://github.com/chengcz/pyGTF

# 使用软件包提供脚本build物种数据库，数据库buildver为AT，名称为refGene
perl retrieve_seq_from_fasta.pl --format refGene --seqfile Arabidopsis_thaliana.TAIR10.27.dna.genome.fa AT_refGene.txt --out AT_refGeneMrna.fa<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="五、批量注释"><a href="#五、批量注释" class="headerlink" title="五、批量注释"></a>五、批量注释</h2><p>/home/jmzeng/bio-soft/annovar/convert2annovar.pl -format vcf4  Sample3.varscan.snp.vcf &gt; Sample3.annovar<br>/home/jmzeng/bio-soft/annovar/convert2annovar.pl -format vcf4  Sample4.varscan.snp.vcf &gt; Sample4.annovar<br>/home/jmzeng/bio-soft/annovar/convert2annovar.pl -format vcf4  Sample5.varscan.snp.vcf &gt; Sample5.annovar<br>然后用下面这个脚本批量注释</p>
<p>image001<br>Reading gene annotation from /home/jmzeng/bio-soft/annovar/humandb/hg19_refGene.txt … Done with 50914 transcripts (including 11516 without coding sequence annotation) for 26271 unique genes</p>
<p>最后查看结果可知，真正在外显子上面的突变并不多</p>
<p>23515 Sample3.anno.exonic_variant_function<br>23913 Sample4.anno.exonic_variant_function<br>24009 Sample5.anno.exonic_variant_function<br>annovar软件就是把我们得到的十万多个snp分类了，看看这些snp分别是基因的哪些位置，是否引起蛋白突变</p>
<p>downstream<br>exonic<br>exonic;splicing<br>intergenic<br>intronic<br>ncRNA_exonic<br>ncRNA_intronic<br>ncRNA_splicing<br>ncRNA_UTR3<br>ncRNA_UTR5<br>splicing<br>upstream<br>upstream;downstream<br>UTR3<br>UTR5<br>UTR5;UTR3<br>六、一步到位：table_annovar.pl 可以同时进行3种注释<br>perl table_annovar.pl example/ex1.avinput humandb/ -buildver hg19 -out myanno -remove -protocol refGene,cytoBand,exac03,avsnp147,dbnsfp30a -operation gx,r,f,f,f -nastring . -csvout -polish -xref example/gene_xref.txt<br>#-remove: remove all temporary files<br>#-operation:g,gene-based; gx,gene-based with cross-reference annotation (from -xref argument);r, region-based; f,filter-based.<br>#-nastring：没有对应注释，则输出<code>.</code><br>#-csvout:结果用,分隔；去掉则采用默认，用Tab分隔<br>#-xref: whether a known genetic disease is caused by defects in this gene (this information was suffplied in the  example/gene_xref.txt file in the command line) 这一项没有也OK</p>
<p>其中（每种数据库对应的类型参考官网）<br>g,gene-based,对应数据库为refGene,ensGene等<br>r,region-based,对应数据库为cytoBand等<br>f,filter-based,对应数据库为exac03,avsnp147,dbnsfp30a等</p>
<p>3种注释分开进行：annotate_variation.pl<br>1 gene-based<br>perl annotate_variation.pl -geneanno -dbtype refGene -buildver hg19 example/ex1.avinput humandb/  </p>
<p>结果文件在example/中，ex1.avinput.variant_function和ex1.avinput.exonic_variant_function<br>（1）ex1.avinput.variant_function</p>
<p>[root@localhost example]# head ex1.avinput.variant_function<br>UTR5    ISG15(NM_005101:c.-33T&gt;C)       1       948921  948921  T       C       comments: rs15842, a SNP in 5’ UTR of ISG15<br>UTR3    ATAD3C(NM_001039211:c.*91G&gt;T)   1       1404001 1404001 G       T       comments: rs149123833, a SNP in 3’ UTR of ATAD3C</p>
<p>第1列：variant effects,将变异分类，如intergenic, intronic, non-synonymous SNP, frameshift deletion, large-scale duplication等<br>第2列：基因名，Symbol，括号中为NM_22222,为refGene编号<br>其余列：输入文件ex1.avinput的内容</p>
<p>（2）ex1.avinput.exonic_variant_function</p>
<p>[root@localhost example]# head  ex1.avinput.exonic_variant_function<br>line9   nonsynonymous SNV       IL23R:NM_144701:exon9:c.G1142A:p.R381Q, 1       67705958        67705958       GA       comments: rs11209026 (R381Q), a SNP in IL23R associated with Crohn’s disease<br>line10  nonsynonymous SNV       ATG16L1:NM_017974:exon8:c.A841G:p.T281A,ATG16L1:NM_001190267:exon9:c.A550G:p.T184A,ATG16L1:NM_030803:exon9:c.A898G:p.T300A,ATG16L1:NM_001190266:exon9:c.A646G:p.T216A,ATG16L1:NM_198890:exon5:c.A409G:p.T137A,  2       234183368       234183368       A       G       comments: rs2241880 (T300A), a SNP in the ATG16L1 associated with Crohn’s disease<br>line11  nonsynonymous SNV       NOD2:NM_022162:exon4:c.C2104T:p.R702W,NOD2:NM_001293557:exon3:c.C2023T:p.R675W,16       50745926        50745926        C       T       comments: rs2066844 (R702W), a non-synonymous SNP in NOD2</p>
<p>第1列：该变异在input文件的行号<br>第2列：对编码基因的影响，frameshift,nonsynonymous等<br>第3列：被影响的基因或转录本,其中NM_22222,为refGene编号<br>其余列：同输入文件</p>
<p>用awk操作时，分隔符设定为\t；不设置时，空格也被当做分隔符，会造成错位</p>
<p>[root@localhost example]# head  ex1.avinput.exonic_variant_function|awk -F ‘\t’ ‘{print $2}’<br>nonsynonymous SNV<br>nonsynonymous SNV<br>nonsynonymous SNV<br>nonsynonymous SNV<br>frameshift insertion<br>frameshift deletion<br>frameshift deletion<br>stoploss<br>stopgain<br>frameshift substitution</p>
<p>[root@localhost example]# head  ex1.avinput.exonic_variant_function|awk ‘{print $2}’<br>nonsynonymous<br>nonsynonymous<br>nonsynonymous<br>nonsynonymous<br>frameshift<br>frameshift<br>frameshift<br>stoploss<br>stopgain<br>frameshift</p>
<p>2 region-based<br>perl annotate_variation.pl -regionanno -dbtype cytoBand -buildver hg19 example/ex1.avinput humandb/ </p>
<p>鉴定各变异的cytogenetic band,如1p36.33<br>结果文件在example中，ex1.avinput.hg19_cytoBand</p>
<p>[root@localhost example]# more ex1.avinput.hg19_cytoBand<br>cytoBand        1p36.33 1       948921  948921  T       C       comments: rs15842, a SNP in 5’ UTR of ISG15<br>cytoBand        1p36.33 1       1404001 1404001 G       T       comments: rs149123833, a SNP in 3’ UTR of ATAD3C<br>cytoBand        1p36.31 1       5935162 5935162 A       T       comments: rs1287637, a splice site variant in NP<br>HP4<br>cytoBand        1q23.3  1       162736463       162736463       C       T       comments: rs1000050, a SNP in Il<br>lumina SNP arrays<br>第1列：cytoBand<br>第2列：1p21.1<br>其余列：同输入文件</p>
<p>3 ilter<br>perl annotate_variation.pl -filter -dbtype exac03 -buildver hg19 example/ex1.avinput humandb/<br>结果文件在example/中,ex1.avinput.hg19_exac03_filtered(exac03中没有报道的位点）和ex1.avinput.hg19_exac03_dropped（exac03中报道的位点，包含其等位基因频率）</p>
<hr>
<p>比较两个文件的重复值，保留后者重复项</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">awk 'BEGIN {OFS="\t"} 
     NR==FNR {if(FNR&gt;1) start_values[$3] = 1; next} 
     FNR==1 {print; next} 
     $2 in start_values' annovar/merged_result.tsv filtered_variants_thr0p7_20250916_203336.tsv &gt; filtered_filtered_variants_thr0p7_20250916_203336.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<hr>
<p><a href="https://www.jianshu.com/p/84c818207240">https://www.jianshu.com/p/84c818207240</a><br><a href="https://www.plob.org/article/9976.html">https://www.plob.org/article/9976.html</a></p>
<p>snpEff<br><a href="https://www.bioinfo-scrounger.com/archives/268/">https://www.bioinfo-scrounger.com/archives/268/</a></p>
<p>重要<br><a href="http://www.bio-info-trainee.com/2028.html">http://www.bio-info-trainee.com/2028.html</a><br><a href="https://www.jianshu.com/p/cea3b179b8a9">https://www.jianshu.com/p/cea3b179b8a9</a></p>
<p>ANNOVAR注释变异VCF结果说明<br><a href="https://www.omicsclass.com/article/464">https://www.omicsclass.com/article/464</a><br><a href="https://www.omicsclass.com/article/804">https://www.omicsclass.com/article/804</a><br><a href="http://blog.sina.com.cn/s/blog_71df25810102ybtt.html">http://blog.sina.com.cn/s/blog_71df25810102ybtt.html</a></p>
<p>Hui Y, Kai W. Genomic variant annotation and prioritization with ANNOVAR and wANNOVAR[J]. Nature Protocols, 2015, 10(10).</p>
]]></content>
      <categories>
        <category>重测序</category>
      </categories>
  </entry>
  <entry>
    <title>基因结构</title>
    <url>/2025/09/17/55/</url>
    <content><![CDATA[<h2 id="结构图"><a href="#结构图" class="headerlink" title="结构图"></a>结构图</h2><pre class="mermaid">flowchart TD
A["一个完整的真核生物基因（DNA模板链）"]

subgraph A_Sub[基因结构]
    direction LR
    Promoter[启动子 Promoter]
    Exon1[外显子1 Exon 1]
    Intron[内含子 Intron]
    Exon2[外显子2 Exon 2]
    Terminator[终止子 Terminator]
end

A --&gt; A_Sub

subgraph Transcription[第一步：转录]
    direction TB
    B["初级mRNA转录本（Pre-mRNA, 包含所有序列）"]
end

A_Sub --转录--&gt; Transcription

subgraph Splicing[第二步：加工（剪切与拼接）]
    direction TB
    C["切除内含子并将外显子连接起来"]
end

Transcription --加工--&gt; Splicing

subgraph Final_mRNA[第三步：成熟mRNA]
    direction LR
    D["5' 帽子"]
    E["5' UTR"]
    F["CDS (编码序列)起始密码子AUG -&gt; 终止密码子UAA/UAG/UGA"]
    G["3' UTR"]
    H["多聚A尾巴"]
end

Splicing --"拼接后形成"--&gt; Final_mRNA

%% 定义关系
Exon1 --包含--&gt; UTR1[5' UTR部分]
Exon1 --包含--&gt; CDS_Part1[CDS部分]
Exon2 --包含--&gt; CDS_Part2[CDS部分]
Exon2 --包含--&gt; UTR2[3' UTR部分]

UTR1 --最终成为--&gt; E
CDS_Part1 --最终成为--&gt; F
CDS_Part2 --最终成为--&gt; F
UTR2 --最终成为--&gt; G

Final_mRNA --"进入细胞质进行翻译（核糖体）"--&gt; I["合成的蛋白质"]
F --&gt; I

classDef default fill:#f9f9f9,stroke:#333,stroke-width:2px;
classDef coding fill:#e6f7ff,stroke:#333,stroke-width:1px;
classDef noncoding fill:#fff5e6,stroke:#333,stroke-width:1px;
classDef process fill:#f0f8ff,stroke:#2266ff,stroke-width:2px;

class Exon1,Exon2,CDS_Part1,CDS_Part2,F coding;
class Promoter,Intron,Terminator,UTR1,UTR2,E,G noncoding;
class Transcription,Splicing process;</pre>


<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>


<p>下面是代码</p>
<pre class="line-numbers language-none"><code class="language-none">flowchart TD
A["一个完整的真核生物基因（DNA模板链）"]

subgraph A_Sub[基因结构]
    direction LR
    Promoter[启动子 Promoter]
    Exon1[外显子1 Exon 1]
    Intron[内含子 Intron]
    Exon2[外显子2 Exon 2]
    Terminator[终止子 Terminator]
end

A --&gt; A_Sub

subgraph Transcription[第一步：转录]
    direction TB
    B["初级mRNA转录本（Pre-mRNA, 包含所有序列）"]
end

A_Sub --转录--&gt; Transcription

subgraph Splicing[第二步：加工（剪切与拼接）]
    direction TB
    C["切除内含子并将外显子连接起来"]
end

Transcription --加工--&gt; Splicing

subgraph Final_mRNA[第三步：成熟mRNA]
    direction LR
    D["5' 帽子"]
    E["5' UTR"]
    F["CDS (编码序列)起始密码子AUG -&gt; 终止密码子UAA/UAG/UGA"]
    G["3' UTR"]
    H["多聚A尾巴"]
end

Splicing --"拼接后形成"--&gt; Final_mRNA

%% 定义关系
Exon1 --包含--&gt; UTR1[5' UTR部分]
Exon1 --包含--&gt; CDS_Part1[CDS部分]
Exon2 --包含--&gt; CDS_Part2[CDS部分]
Exon2 --包含--&gt; UTR2[3' UTR部分]

UTR1 --最终成为--&gt; E
CDS_Part1 --最终成为--&gt; F
CDS_Part2 --最终成为--&gt; F
UTR2 --最终成为--&gt; G

Final_mRNA --"进入细胞质进行翻译（核糖体）"--&gt; I["合成的蛋白质"]
F --&gt; I

classDef default fill:#f9f9f9,stroke:#333,stroke-width:2px;
classDef coding fill:#e6f7ff,stroke:#333,stroke-width:1px;
classDef noncoding fill:#fff5e6,stroke:#333,stroke-width:1px;
classDef process fill:#f0f8ff,stroke:#2266ff,stroke-width:2px;

class Exon1,Exon2,CDS_Part1,CDS_Part2,F coding;
class Promoter,Intron,Terminator,UTR1,UTR2,E,G noncoding;
class Transcription,Splicing process;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<script type="module"> import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';	mermaid.initialize({startOnLoad: true, flowchart: {curve: 'linear'}}); </script>]]></content>
      <categories>
        <category>重测序</category>
      </categories>
  </entry>
  <entry>
    <title>410随身WiFi棒子Debian刷入青龙教程</title>
    <url>/2025/09/25/56/</url>
    <content><![CDATA[<p>备份教程<br>刷Debian前请先备份（非常重要！！！）</p>
<p>弄成砖了是可以刷回来的，大佬可忽略</p>
<p>备份教程：	<a href="https://xiao54.com/linux/32.html">https://xiao54.com/linux/32.html</a><br>视频教程：	<a href="https://www.bilibili.com/blackboard/webplayer/mbplayer.html?aid=326276265&amp;bvid=BV1iw411J7BG&amp;cid=1406661980&amp;p=1">https://www.bilibili.com/blackboard/webplayer/mbplayer.html?aid=326276265&amp;bvid=BV1iw411J7BG&amp;cid=1406661980&amp;p=1</a><br>下载链接：	<a href="https://www.123pan.com/s/354uVv-z7YU3.html">https://www.123pan.com/s/354uVv-z7YU3.html</a><br>先进入fastboot模式，输入指令</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">adb reboot bootloader<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>410随身WiFi棒子Debian刷入青龙教程<br>SSH账号密码<br>解压要刷的Debian系统，然后点击一件刷入</p>
<p>cmd登录地址:ssh <a href="mailto:root@10.42.0.1">root@10.42.0.1</a> 密码:1313144</p>
<p>SSH软件:IP:10.42.0.1 用户名:root 密码:1313144</p>
<p>热点:4G-wifi 密码:12345678</p>
<p>更新驱动<br>更新驱动视频教程：<a href="https://player.bilibili.com/">https://player.bilibili.com/</a></p>
<p>更新驱动前注意事项：需要安装vivo9008drivers.exe软件，如安装过请忽略</p>
<p>1、在【Android Device】下查看有没有【Android Composite ADB Interface】这个驱动，如果不是，右键【更新驱动程序】-【浏览我的计算机以查找驱动程序软件】-【让我从计算机上的可用驱动程序列表中选取(L)】，选择【Android Composite ADB Interface或者USB Composite Device】-【下一步】</p>
<p>2、插入棒子会显示一个未知设备或者RNDIS，不确定是那个就先拔掉棒子，然后重新插入</p>
<p>3、下拉找到【网络适配器】-厂商下拉选择【Microsoft】型号下拉选择【基于远程 NDIS 的Internet 共享设备】-【下一步】-即可完成安装驱动</p>
<p>网络编辑<br>1、现在就用键盘上的方向键编辑，鼠标就不能用了</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">nmtui<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2、把热点删除，因为他现在不支持WiFi和热点一起开启，所以要把热点删除连接WiFi给debian系统通网才能继续操作</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">true &gt; /etc/apt/sources.list.d/mobian.list<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3、更新软件包</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">sudo apt-get update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>4、更新curl wget</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">apt install curl wget<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>5、安装docker系统</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">apt install docker.io<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>6、docker设置随服务启动而自启动</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">systemctl enable docker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>7、启动docker</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">systemctl start docker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>给docker设置加速代理<br>1、创建文件夹</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">sudo mkdir -p /etc/docker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2、填入加速代理</p>
<p>如不能使用则代理失效了，请更换代理，更换里面的链接即可。</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">sudo tee /etc/docker/daemon.json  /sys/kernel/debug/usb/ci_hdrc.0/role
安装1panel代码
```html
curl -sSL https://resource.fit2cloud.com/1panel/package/quick_start.sh -o quick_start.sh &amp;&amp; bash quick_start.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>近期商家为了成本emmmc质量都不太行下面这个指令查看寿命</p>
<p>查看棒子颗粒寿命<br>查看内存寿命如果显示是0x01寿命就很好，如果显示0+09等越来越远的寿命也就离挂不远了：</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">cat /sys/class/mmc_host/mmc0/mmc0\:0001/life_time<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><img src="/images/56/477017655.png" alt="mfzbzmj7.png"></p>
<p>410随身WiFi棒子Debian刷入青龙教程<br>关灯方法一<br>1、先安装dialog</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">apt install dialog<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2、然后执行一键命令</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">curl -L gitee.com/ojf6ii/led-control-script/raw/master/led2.sh -o /bin/ledctl &amp;&amp; chmod 755 /bin/ledctl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3、下载完成后输入指令即可打开界面</p>
<p>ledctl<br>关灯方法二<br>1、打开文件夹</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">vi /etc/rc.local<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2、粘贴以下代码保存设置开机自启关闭led，重启即可生效</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">echo none &gt; /sys/class/leds/red\:os/trigger
echo none &gt; /sys/class/leds/blue\:wifi/trigger
echo none &gt; /sys/class/leds/green\:internet/trigger<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>WIFI</category>
      </categories>
  </entry>
  <entry>
    <title>openipc goke7205v200</title>
    <url>/2024/12/03/7/</url>
    <content><![CDATA[<h1 id="保存原始固件"><a href="#保存原始固件" class="headerlink" title="保存原始固件"></a>保存原始固件</h1><hr>
<h2 id="备份您的原始固件，请不要跳过这个步骤！"><a href="#备份您的原始固件，请不要跳过这个步骤！" class="headerlink" title="备份您的原始固件，请不要跳过这个步骤！"></a>备份您的原始固件，请不要跳过这个步骤！</h2><p>OpenIPC U-Boot 会覆盖原始的加密分区，因此无法恢复为出厂固件，除非您拥有此特定摄像机的完整闪存备份！要创建完整的固件备份，请启动 TFTP 服务器并在引导加载程序 shell 中执行这些命令。</p>
<blockquote>
<pre class="line-numbers language-Python" data-language="Python"><code class="language-Python"> # Enter commands line by line! Do not copy and paste multiple lines at once!
setenv ipaddr 192.168.15.169; setenv serverip 192.168.15.105
mw.b 0x42000000 0xff 0x1000000
sf probe 0; sf read 0x42000000 0x0 0x1000000
tftpput 0x42000000 0x1000000 backup-gk7205v200-nor16m.bin
# if there is no tftpput but tftp then run this instead
 tftp 0x42000000 backup-gk7205v200-nor16m.bin 0x1000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</blockquote>
<p>有关详细信息，请参阅项目 wiki 中的安装说明。</p>
<h1 id="烧录完整的-OpenIPC-固件"><a href="#烧录完整的-OpenIPC-固件" class="headerlink" title="烧录完整的 OpenIPC 固件"></a>烧录完整的 OpenIPC 固件</h1><h2 id="下载-OpenIPC-固件-Ultimate"><a href="#下载-OpenIPC-固件-Ultimate" class="headerlink" title="下载 OpenIPC 固件 (Ultimate)"></a>下载 OpenIPC 固件 (Ultimate)</h2><p>for Goke GK7205V200 with 16MB NOR flash</p>
<p>完整的固件由引导加载程序、内核和根文件系统组成，也适用于使用编程器烧写闪存芯片。 请注意，完整固件不包含预设环境。你还需要添加自己的MAC地址、IP地址等设置。</p>
<blockquote>
<h1 id="Enter-commands-line-by-line-Do-not-copy-and-paste-multiple-lines-at-once"><a href="#Enter-commands-line-by-line-Do-not-copy-and-paste-multiple-lines-at-once" class="headerlink" title="Enter commands line by line! Do not copy and paste multiple lines at once!"></a>Enter commands line by line! Do not copy and paste multiple lines at once!</h1><p>setenv ipaddr 192.168.15.169; setenv serverip 192.168.15.105<br>mw.b 0x42000000 0xff 0x1000000<br>tftpboot 0x42000000 openipc-gk7205v200-ultimate-16mb.bin</p>
<h1 id="if-there-is-no-tftpboot-but-tftp-then-run-this-instead"><a href="#if-there-is-no-tftpboot-but-tftp-then-run-this-instead" class="headerlink" title="if there is no tftpboot but tftp then run this instead"></a>if there is no tftpboot but tftp then run this instead</h1><p>tftp 0x42000000 openipc-gk7205v200-ultimate-16mb.bin<br>sf probe 0; sf lock 0;<br>sf erase 0x0 0x1000000; sf write 0x42000000 0x0 0x1000000<br>reset</p>
</blockquote>
<p>摄像机将自动重启并使用全新的引导加载程序启动。</p>
<p>注意准备中断并进入引导程序的命令行。 在引导加载程序的命令行中，根据您的闪存大小和类型重新映射 ROM 分区。</p>
<blockquote>
<h1 id="Enter-commands-line-by-line-Do-not-copy-and-paste-multiple-lines-at-once-1"><a href="#Enter-commands-line-by-line-Do-not-copy-and-paste-multiple-lines-at-once-1" class="headerlink" title="Enter commands line by line! Do not copy and paste multiple lines at once!"></a>Enter commands line by line! Do not copy and paste multiple lines at once!</h1><p>run setnor16m</p>
</blockquote>
<h1 id="恭喜！此时，您已经安装了-OpenIPC-固件-Ultimate-。"><a href="#恭喜！此时，您已经安装了-OpenIPC-固件-Ultimate-。" class="headerlink" title="恭喜！此时，您已经安装了 OpenIPC 固件 (Ultimate)。"></a>恭喜！此时，您已经安装了 OpenIPC 固件 (Ultimate)。</h1><p>在端口 85 ( <a href="http://192.168.15.169:85/">http://192.168.15.169:85/</a> ) 上打开摄像机的 Web 界面并使用登录root和密码12345登录。登录后将要求您设置自己的安全密码。通过以下方式访问摄像机ssh 或 UART 使用与上述相同的登录名和密码。</p>
<hr>
<p>打开web界面后，更新固件，更新完后调整majestic、sensor与设备型号对应。</p>
<h1 id="majestic"><a href="#majestic" class="headerlink" title="majestic"></a>majestic</h1><p>openipc未开源部分。</p>
]]></content>
      <categories>
        <category>折腾</category>
      </categories>
      <tags>
        <tag>openipc</tag>
      </tags>
  </entry>
  <entry>
    <title>GPT 学术优化</title>
    <url>/2024/12/06/8/</url>
    <content><![CDATA[<h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><p>安装方法：直接运行 (Windows, Linux or MacOS)<br>下载项目</p>
<blockquote>
<p>git clone –depth=1 <a href="https://github.com/binary-husky/gpt_academic.git">https://github.com/binary-husky/gpt_academic.git</a><br>cd gpt_academic<br>配置API_KEY等变量</p>
</blockquote>
<p>在config.py中，配置API KEY等变量。特殊网络环境设置方法、Wiki-项目配置说明。</p>
<p>「 程序会优先检查是否存在名为config_private.py的私密配置文件，并用其中的配置覆盖config.py的同名配置。如您能理解以上读取逻辑，我们强烈建议您在config.py同路径下创建一个名为config_private.py的新配置文件，并使用config_private.py配置项目，从而确保自动更新时不会丢失配置 」。</p>
<p>「 支持通过环境变量配置项目，环境变量的书写格式参考docker-compose.yml文件或者我们的Wiki页面。配置读取优先级: 环境变量 &gt; config_private.py &gt; config.py 」。</p>
<p>安装依赖</p>
<h4 id="（选择I-如熟悉python-python推荐版本-3-9-3-11）"><a href="#（选择I-如熟悉python-python推荐版本-3-9-3-11）" class="headerlink" title="（选择I: 如熟悉python, python推荐版本 3.9 ~ 3.11）"></a>（选择I: 如熟悉python, python推荐版本 3.9 ~ 3.11）</h4><p>备注：使用官方pip源或者阿里pip源, 临时换源方法：</p>
<blockquote>
<p>python -m pip install -r requirements.txt -i <a href="https://mirrors.aliyun.com/pypi/simple/">https://mirrors.aliyun.com/pypi/simple/</a></p>
</blockquote>
<blockquote>
<p>python -m pip install -r requirements.txt</p>
</blockquote>
<h4 id="（选择II-使用Anaconda）步骤也是类似的-https-www-bilibili-com-video-BV1rc411W7Dr-："><a href="#（选择II-使用Anaconda）步骤也是类似的-https-www-bilibili-com-video-BV1rc411W7Dr-：" class="headerlink" title="（选择II: 使用Anaconda）步骤也是类似的 (https://www.bilibili.com/video/BV1rc411W7Dr)："></a>（选择II: 使用Anaconda）步骤也是类似的 (<a href="https://www.bilibili.com/video/BV1rc411W7Dr)%EF%BC%9A">https://www.bilibili.com/video/BV1rc411W7Dr)：</a></h4><blockquote>
<p>conda create -n gptac_venv python=3.11    # 创建anaconda环境<br>conda activate gptac_venv                 # 激活anaconda环境</p>
</blockquote>
<blockquote>
<p>python -m pip install -r requirements.txt # 这个步骤和pip安装一样的步骤</p>
</blockquote>
<p>如果需要支持清华ChatGLM2/复旦MOSS/RWKV作为后端，请点击展开此处<br>运行</p>
<blockquote>
<p>python main.py</p>
</blockquote>
<p>使用第三方API、Azure等、文心一言、星火等，见Wiki页面</p>
<p>云服务器远程部署避坑指南。 请访问云服务器远程部署wiki</p>
<p>在其他平台部署&amp;二级网址部署</p>
<p>使用Sealos一键部署。<br>使用WSL2（Windows Subsystem for Linux 子系统）。请访问部署wiki-2<br>如何在二级网址（如<a href="http://localhost/subpath%EF%BC%89%E4%B8%8B%E8%BF%90%E8%A1%8C%E3%80%82%E8%AF%B7%E8%AE%BF%E9%97%AEFastAPI%E8%BF%90%E8%A1%8C%E8%AF%B4%E6%98%8E">http://localhost/subpath）下运行。请访问FastAPI运行说明</a></p>
<p>Advanced Usage<br>I：自定义新的便捷按钮（学术快捷键）<br>现在已可以通过UI中的界面外观菜单中的自定义菜单添加新的便捷按钮。如果需要在代码中定义，请使用任意文本编辑器打开core_functional.py，添加如下条目即可：</p>
<p>“超级英译中”: {<br>    # 前缀，会被加在你的输入之前。例如，用来描述你的要求，例如翻译、解释代码、润色等等<br>    “Prefix”: “请翻译把下面一段内容成中文，然后用一个markdown表格逐一解释文中出现的专有名词：\n\n”,</p>
<pre><code># 后缀，会被加在你的输入之后。例如，配合前缀可以把你的输入内容用引号圈起来。
"Suffix": "",
</code></pre>
<p>},</p>
<p>II：自定义函数插件<br>编写强大的函数插件来执行任何你想得到的和想不到的任务。 本项目的插件编写、调试难度很低，只要您具备一定的python基础知识，就可以仿照我们提供的模板实现自己的插件功能。 详情请参考函数插件指南。</p>
<p>⭐Latex/Arxiv论文翻译功能⭐<br> ===&gt;<br>虚空终端（从自然语言输入中，理解用户意图+自动调用其他插件）<br>步骤一：输入 “ 请调用插件翻译PDF论文，地址为<a href="https://openreview.net/pdf?id=rJl0r3R9KX">https://openreview.net/pdf?id=rJl0r3R9KX</a> ”<br>步骤二：点击“虚空终端”</p>
<p>模块化功能设计，简单的接口却能支持强大的功能</p>
<p>译解其他开源项目</p>
<p>装饰live2d的小功能（默认关闭，需要修改config.py）</p>
<p>OpenAI图像生成</p>
<p>基于mermaid的流图、脑图绘制</p>
<p>已知问题<br>某些浏览器翻译插件干扰此软件前端的运行<br>官方Gradio目前有很多兼容性问题，请务必使用requirement.txt安装Gradio</p>
<p>III：主题<br>可以通过修改THEME选项（config.py）变更主题</p>
<p>Chuanhu-Small-and-Beautiful 网址</p>
<p>访问GPT-Academic的在线服务并支持我们<br>V：参考与学习<br>代码中参考了很多其他优秀项目中的设计，顺序不分先后：</p>
<h1 id="清华ChatGLM2-6B"><a href="#清华ChatGLM2-6B" class="headerlink" title="清华ChatGLM2-6B:"></a>清华ChatGLM2-6B:</h1><p><a href="https://github.com/THUDM/ChatGLM2-6B">https://github.com/THUDM/ChatGLM2-6B</a></p>
<h1 id="清华JittorLLMs"><a href="#清华JittorLLMs" class="headerlink" title="清华JittorLLMs:"></a>清华JittorLLMs:</h1><p><a href="https://github.com/Jittor/JittorLLMs">https://github.com/Jittor/JittorLLMs</a></p>
<h1 id="ChatPaper"><a href="#ChatPaper" class="headerlink" title="ChatPaper:"></a>ChatPaper:</h1><p><a href="https://github.com/kaixindelele/ChatPaper">https://github.com/kaixindelele/ChatPaper</a></p>
<h1 id="Edge-GPT"><a href="#Edge-GPT" class="headerlink" title="Edge-GPT:"></a>Edge-GPT:</h1><p><a href="https://github.com/acheong08/EdgeGPT">https://github.com/acheong08/EdgeGPT</a></p>
<h1 id="ChuanhuChatGPT"><a href="#ChuanhuChatGPT" class="headerlink" title="ChuanhuChatGPT:"></a>ChuanhuChatGPT:</h1><p><a href="https://github.com/GaiZhenbiao/ChuanhuChatGPT">https://github.com/GaiZhenbiao/ChuanhuChatGPT</a></p>
<h1 id="Oobabooga-one-click-installer"><a href="#Oobabooga-one-click-installer" class="headerlink" title="Oobabooga one-click installer:"></a>Oobabooga one-click installer:</h1><p><a href="https://github.com/oobabooga/one-click-installers">https://github.com/oobabooga/one-click-installers</a></p>
<h1 id="More："><a href="#More：" class="headerlink" title="More："></a>More：</h1><p><a href="https://github.com/gradio-app/gradio">https://github.com/gradio-app/gradio</a><br><a href="https://github.com/fghrsh/live2d_demo">https://github.com/fghrsh/live2d_demo</a></p>
<p>下载项目<br>git命令下载</p>
<blockquote>
<p>git clone <a href="https://github.com/binary-husky/chatgpt_academic.git">https://github.com/binary-husky/chatgpt_academic.git</a></p>
</blockquote>
<p>github下载 download zip<br>ChatGPT学术优化项目地址:<a href="https://github.com/binary-husky/chatgpt_academic">https://github.com/binary-husky/chatgpt_academic</a></p>
<p>安装项目环境<br>这里是通过Anaconda Prompt创建环境</p>
<p>创建环境</p>
<blockquote>
<p>conda create -n chatgpt-academic python=3.11.0</p>
</blockquote>
<p>输入y，回车安装！</p>
<p>进入环境</p>
<blockquote>
<p>conda activate chatgpt-academic</p>
</blockquote>
<p>安装依赖<br>先进入到项目的根目录</p>
<blockquote>
<p>python -m pip install -r requirements.txt</p>
</blockquote>
<p>PS：我这里是可以正常安装的，因为项目要求gradio&gt;= <strong>3.23</strong> ，有些可能报错。需要先下载python的whl文件再进行安装。地址<a href="https://pypi.org/project/gradio/#files">https://pypi.org/project/gradio/#files</a></p>
<p>下载保存到你的项目根目录，在通过</p>
<blockquote>
<p>pip install gradio-3.24.1-py3-none-any.whl</p>
</blockquote>
<p>当我们安装好gradio之后，把requirements.txt文件中gradio注释</p>
<p>重新运行</p>
<blockquote>
<p>python -m pip install -r requirements.txt</p>
</blockquote>
<p>此致项目需要的环境就安装完成了！</p>
<p>打开解压的项目<br>这里以Vscode为例，配置config.py文件</p>
<p>配置API_KEY<br>打开你的科学上网助手，我这里使用是Clash是可以的（个人感觉路线选择美国的代理更好）<br>进入<a href="https://platform.openai.com/account/api-keys">https://platform.openai.com/account/api-keys</a></p>
<p>将创建的秘钥复制到config.py文件的API_KEY变量，秘钥配置完成！</p>
<p>配置代理网络的地址<br>第一步：进入网址<a href="https://ipapi.co/json/">https://ipapi.co/json/</a><br>第二步：打开开发者工具（Google浏览器快捷键Ctrl+Shift+i）,点击网络，按一下Ctrl+r，可以看到一个json文件</p>
<p>第三步：点击json文件</p>
<p>第四步：将这个地址复制到config.py文件中的proxies</p>
<p>运行项目<br>项目所需的环境、秘钥、代理全部配置好就可以运行项目了</p>
<blockquote>
<p>python main.py</p>
</blockquote>
<p>浏览器输入Running on local URL</p>
]]></content>
      <categories>
        <category>默认分类</category>
      </categories>
  </entry>
  <entry>
    <title>记一次清空SMART修复群晖报故障的硬盘</title>
    <url>/2024/12/08/9/</url>
    <content><![CDATA[<p>事先说明，虽然这篇文章内容大量注水，但是文中涉及的操作有风险，想要照葫芦画瓢的童鞋，请谨慎对待，切记提前备份重要数据。小姐姐们不见了别找我，我这里可不生产小姐姐</p>
<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>


<p>好，让我们进入正题，凡事都有个前因后果，先说说起因</p>
<p>前几天，群晖里一块希捷的2T硬盘报告故障，查看一下SMART信息，发现是End_to_End计数达到阈值，于是把硬盘抽出来接到Windows下用HDTune再次确认，确实见红了 但是用SeaTools扫描，各种长短检测都能通过，希捷这又是什么操作</p>
<p>HDTune忘记截图了，借用网上的一张图说明一下是哪一项见红HDTune忘记截图了，借用网上的一张图说明一下是哪一项见红<br><img src="/images/9/762531194.png" alt="m4f55w5m.png"><br>最后用MHDD扫描过后，发现硬盘并没有坏块，那么是什么原因导致的B8 End_to_End计数增加呢？各种说法都有，有说是硬盘上的缓存坏掉了，有说是SATA线接触不良导致，有说是缓存到磁盘的数据包校验出错，反正各种说法都有，具体硬盘SMART里如何判断这个值的，估计也只有硬盘厂家知道，所以就不要纠结了。但是就这样淘汰掉一块2T的硬盘？是不是太浪费了？记一次清空SMART修复群晖报故障的硬盘 </p>
<p>垃圾佬没别的本事，就是爱折腾，于是先尝试了低格整块硬盘，插回群晖还是报故障，看来只能祭出本垃圾佬的终极大杀器USB转TTL神器和给神器属性加成的TTL杜邦线了，没错，就是下面这俩玩意，马粑粑家几块钱一个，随便挑随便选记一次清空SMART修复群晖报故障的硬盘 </p>
<p>如果你的电脑是第一次插入USB转TTL神器，要先安装驱动，并像下图这样在属性里设置好端口的波特率为38400</p>
<p>安装好驱动的USB转TTL安装好驱动的USB转TTL</p>
<p>端口的设置，第一项要设置为 <strong>38400</strong> 端口的设置<br><img src="/images/9/413614975.png" alt="m4f59zrr.png"><br>第一项要设置为 38400</p>
<p>硬盘上TTL口的接法硬盘上TTL口的接法<br><img src="/images/9/231601982.png" alt="m4f5akz6.png"></p>
<p>USB转TTL的接法USB转TTL的接法<br><img src="http://hhhh.ywhywhywh.top/usr/uploads/2024/12/4065335586.png" alt="m4f5awqp.png"></p>
<p>接好了之后，让我们先把USB转TTL插入电脑的USB口，打开你的putty，像下图这样设置，如果你的USB转TTL在电脑上识别出来是COM4或者COM5这样的，请按你自己的实际情况设置COM口，Speed设置为38400，然后点open</p>
<p>putty设置putty设置</p>
<p>这时你会看到一个黑麻麻的窗口，什么都没有记一次清空SMART修复群晖报故障的硬盘 别着急，这时我们再接上电源线，记住，只接电源线。</p>
<p>不要接SATA数据线，不要接SATA数据线，不要接SATA数据线，重要的事情说三遍</p>
<p>另外，接电源线最好是用电源上引出来的原生SATA电源线，尽量不要用4pin转SATA的电源转换线</p>
<p>接上电源线后接上电源线后<br><img src="/images/9/2870995132.png" alt="m4f5bgip.png"></p>
<p>当你接上硬盘电源线后再看Putty会发现有回显了，当停在(P)SATA Reset后，说明硬盘已经启动完成了，这是可以按Ctrl+z激活终端，这时就会进入到希捷硬盘的F3工厂模式</p>
<p>按下Ctrl+z后进入F3工厂模式按下Ctrl+z后进入F3工厂模式<br><img src="/images/9/1842945658.png" alt="m4f5bqet.png"></p>
<p>这时如果只是清零SMART那只要输入两个命令/1和N1就能搞定</p>
<p>输入/1进入1模式<br><img src="/images/9/391565786.png" alt="m4f5c1cz.png"><br>输入/1进入1模式</p>
<p>在/1模式下输入N1，看到回显Clear SMART is completed，这时硬盘的SMART值已经被清零了，这时你可以拔掉电源线和TTL线，关机把硬盘接回电源线和SATA线（其实你不关机也行，重新接回SATA线和电源线就行，我经常这样干</p>
<p>这时在我们再用HDTune查看硬盘的SMART值会发现：马达启停次数，硬盘通电时间，马达旋转重试次数，点到点错误计数，接口CRC错误计数，等等等等的很多参数都已经变成0了</p>
<p>这是我的硬盘清零后的效果这是我的硬盘清零后的效果</p>
<p>看看我这个硬盘SMART清零后的效果，“启动/停止次数”因为之前清零SMART后拔插过一次电源线，所以这里计数是1</p>
<p>当然，有一些参数比如：原始读取错误率，磁头飞行时间等这些没有清零，这些都写在SMART的G-list里，要完全清掉需要在F3工厂模式里进入2模式停掉马达电机，清除G表，然后重建SMART和硬盘索引区到硬盘固件内才行</p>
<p>这硬盘有固件锁<br><img src="/images/9/1367509578.png" alt="m4f5ehrp.png"></p>
<p>这硬盘有固件锁</p>
<p>但是如果你像上图我这块硬盘一样，在进入2模式输入Z想停止电机，返回Diagnostic Port Locked的话，说明这块硬盘有固件锁。被锁了固件是无法清零G表的，这也是希捷为了限制一些返厂硬盘和一些奸商通过改写G表来充当新硬盘坑人做的限制。当然，道高一尺魔高一丈，如果你有PC3000的软件和红卡或者MRT的话，固件锁其实也是可以解开的，这时候你就真的可以为所欲为了</p>
<p>好了，本次折腾到此记录完毕，剩下的自然是把硬盘继续插回群晖里，把小姐姐们请回来</p>
<p>仅以此文说明硬盘的SMART是可以清零的，硬盘SMART里的G表也是可以清零的，整个SMART是完全可以清除然后重建成刚出厂的样子的，甚至SMART还是可以通过工厂模式改写成你想要的任何样子的，所以二手硬盘水很深很深，请各位谨慎选择</p>
<p>最后，此文仅以记录过程为目的，请某些头脑比较发达的朋友不要想着用学会了，拿旧硬盘把SMART清零了去坑人，既然有办法清零那肯定是有办法验出来的</p>
<p>最后的最后，如果你只是本着不想浪费的原则，想清掉SMART上的错误，让这块硬盘继续发挥余热，建议最好清零SMART后的硬盘不要存放重要数据，同时注意时常关注一下硬盘状态，毕竟一块硬盘如果SMART某项报错了，那硬盘肯定是有一些问题的，所以如果有一天你硬盘里的小姐姐们灰飞烟灭了，千万别怪我没有提醒</p>
<p>哦，还有个温馨提醒，USB转TTL的神器最好是选择CH340G芯片的，别选RS232的，别问我为什么，都是泪</p>
]]></content>
      <categories>
        <category>默认分类</category>
      </categories>
  </entry>
  <entry>
    <title>使用ANNOVAR进行长牡蛎SNP注释完整流程</title>
    <url>/2025/10/31/annovar/</url>
    <content><![CDATA[<h1 id="使用ANNOVAR进行长牡蛎-Crassostrea-gigas-SNP注释完整流程"><a href="#使用ANNOVAR进行长牡蛎-Crassostrea-gigas-SNP注释完整流程" class="headerlink" title="使用ANNOVAR进行长牡蛎(Crassostrea gigas)SNP注释完整流程"></a>使用ANNOVAR进行长牡蛎(<em>Crassostrea gigas</em>)SNP注释完整流程</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>本文介绍如何使用ANNOVAR对长牡蛎(<em>Crassostrea gigas</em>)的SNP变异数据进行功能注释。流程包括参考基因组数据库构建、变异数据格式转换、功能注释和结果整合。</p>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h3 id="1-软件安装"><a href="#1-软件安装" class="headerlink" title="1. 软件安装"></a>1. 软件安装</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ANNOVAR下载</span>
<span class="token function">wget</span> http://www.openbioinformatics.org/annovar/annovar.tar.gz
<span class="token function">tar</span> <span class="token parameter variable">-xzvf</span> annovar.tar.gz

<span class="token comment"># 其他依赖工具</span>
conda <span class="token function">install</span> <span class="token parameter variable">-c</span> bioconda ucsc-gtftogenepred<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-数据文件准备"><a href="#2-数据文件准备" class="headerlink" title="2. 数据文件准备"></a>2. 数据文件准备</h3><ul>
<li>参考基因组GTF文件：<code>/home/wanglab/Ywh/adductor_muscle_scar/Crassostrea_gigas.cgigas_uk_roslin_v1.61.gtf</code></li>
<li>基因组FASTA文件：<code>GCF_902806645.1_cgigas_uk_roslin_v1_genomic.fna</code></li>
<li>SNP数据：<code>filtered_variants_thr0p7_20250902_162128.tsv</code></li>
</ul>
<h2 id="完整流程"><a href="#完整流程" class="headerlink" title="完整流程"></a>完整流程</h2><h3 id="步骤1：构建自定义参考基因组数据库"><a href="#步骤1：构建自定义参考基因组数据库" class="headerlink" title="步骤1：构建自定义参考基因组数据库"></a>步骤1：构建自定义参考基因组数据库</h3><h4 id="1-1-转换GTF为GenePred格式"><a href="#1-1-转换GTF为GenePred格式" class="headerlink" title="1.1 转换GTF为GenePred格式"></a>1.1 转换GTF为GenePred格式</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gtfToGenePred <span class="token parameter variable">-genePredExt</span> <span class="token punctuation">\</span>
    <span class="token string">"/home/wanglab/Ywh/adductor_muscle_scar/ReSeq_Data/DZQD2023092909/annovar/Cgigasdb/GCF_902806645.1_cgigas_uk_roslin_v1_genomic.gtf"</span> <span class="token punctuation">\</span>
    Cg_refGene.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="1-2-提取mRNA序列"><a href="#1-2-提取mRNA序列" class="headerlink" title="1.2 提取mRNA序列"></a>1.2 提取mRNA序列</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">perl retrieve_seq_from_fasta.pl <span class="token punctuation">\</span>
    <span class="token parameter variable">--format</span> refGene <span class="token punctuation">\</span>
    <span class="token parameter variable">--seqfile</span> GCF_902806645.1_cgigas_uk_roslin_v1_genomic.fna <span class="token punctuation">\</span>
    <span class="token parameter variable">--outfile</span> Cg_refGeneMrna.fa <span class="token punctuation">\</span>
    Cg_refGene.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="步骤2：准备SNP输入文件"><a href="#步骤2：准备SNP输入文件" class="headerlink" title="步骤2：准备SNP输入文件"></a>步骤2：准备SNP输入文件</h3><h4 id="2-1-转换TSV为ANNOVAR输入格式"><a href="#2-1-转换TSV为ANNOVAR输入格式" class="headerlink" title="2.1 转换TSV为ANNOVAR输入格式"></a>2.1 转换TSV为ANNOVAR输入格式</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> <span class="token string">'NR&gt;1 {print $1"\t"$2"\t"$2"\t"$3"\t"$4}'</span> <span class="token punctuation">\</span>
    /home/wanglab/Ywh/adductor_muscle_scar/Variants/filtered_variants_thr0p7_20250902_162128.tsv <span class="token punctuation">\</span>
    <span class="token operator">&gt;</span> filtered_variants_thr0p7_20250902_162128.avinput<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>输入TSV格式：</strong></p>
<pre class="line-numbers language-none"><code class="language-none">chromosome	position	ref	alt	...
NC_047567.1	32667511	G	T	...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>输出AVINPUT格式：</strong></p>
<pre class="line-numbers language-none"><code class="language-none">chromosome	start	end	ref	alt
NC_047567.1	32667511	32667511	G	T<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="步骤3：执行功能注释"><a href="#步骤3：执行功能注释" class="headerlink" title="步骤3：执行功能注释"></a>步骤3：执行功能注释</h3><h4 id="3-1-使用table-annovar-pl进行注释"><a href="#3-1-使用table-annovar-pl进行注释" class="headerlink" title="3.1 使用table_annovar.pl进行注释"></a>3.1 使用table_annovar.pl进行注释</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">perl table_annovar.pl <span class="token punctuation">\</span>
    filtered_variants_thr0p7_20250902_162128.avinput <span class="token punctuation">\</span>
    Cgigasdb/ <span class="token punctuation">\</span>
    <span class="token parameter variable">-buildver</span> Cg <span class="token punctuation">\</span>
    <span class="token parameter variable">-out</span> filtered_variants_thr0p7_20250902_162128 <span class="token punctuation">\</span>
    <span class="token parameter variable">-remove</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">-protocol</span> refGene <span class="token punctuation">\</span>
    <span class="token parameter variable">-operation</span> g <span class="token punctuation">\</span>
    <span class="token parameter variable">-nastring</span> <span class="token builtin class-name">.</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">-csvout</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>参数说明：</strong></p>
<ul>
<li><code>-buildver Cg</code>: 使用自定义构建版本”Cg”</li>
<li><code>-protocol refGene</code>: 使用refGene数据库</li>
<li><code>-operation g</code>: 基因-based注释</li>
<li><code>-csvout</code>: 输出CSV格式</li>
<li><code>-nastring .</code>: 用”.”表示缺失值</li>
</ul>
<h3 id="步骤4：整合注释结果"><a href="#步骤4：整合注释结果" class="headerlink" title="步骤4：整合注释结果"></a>步骤4：整合注释结果</h3><h4 id="4-1-方法一：基于行号合并（推荐）"><a href="#4-1-方法一：基于行号合并（推荐）" class="headerlink" title="4.1 方法一：基于行号合并（推荐）"></a>4.1 方法一：基于行号合并（推荐）</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 为原始文件添加行号</span>
<span class="token function">awk</span> <span class="token string">'NR==1 {print "LineNumber\t"$0} NR&gt;1 {print NR-1"\t"$0}'</span> <span class="token punctuation">\</span>
    /home/wanglab/Ywh/adductor_muscle_scar/Variants/filtered_variants_thr0p7_20250902_162128.tsv <span class="token punctuation">\</span>
    <span class="token operator">&gt;</span> original_with_linenum.tsv

<span class="token comment"># 为注释文件添加行号</span>
<span class="token function">awk</span> <span class="token string">'NR==1 {print "LineNumber\t"$0} NR&gt;1 {print NR-1"\t"$0}'</span> <span class="token punctuation">\</span>
    filtered_variants_thr0p7_20250902_162128.Cg_multianno.csv <span class="token punctuation">\</span>
    <span class="token operator">&gt;</span> anno_with_linenum.tsv

<span class="token comment"># 基于行号合并</span>
<span class="token function">join</span> <span class="token parameter variable">-t</span> <span class="token string">$'<span class="token entity" title="\t">\t</span>'</span> <span class="token parameter variable">-1</span> <span class="token number">1</span> <span class="token parameter variable">-2</span> <span class="token number">1</span> <span class="token punctuation">\</span>
    original_with_linenum.tsv anno_with_linenum.tsv <span class="token punctuation">\</span>
    <span class="token operator">&gt;</span> merged_result.tsv

<span class="token comment"># 清理临时文件</span>
<span class="token function">rm</span> original_with_linenum.tsv anno_with_linenum.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="4-2-方法二：一次性合并"><a href="#4-2-方法二：一次性合并" class="headerlink" title="4.2 方法二：一次性合并"></a>4.2 方法二：一次性合并</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> -F<span class="token string">','</span> <span class="token string">'
BEGIN {OFS="\t"}
NR==FNR {
    if (FNR==1) {
        anno_header = $6"\t"$7"\t"$8"\t"$9"\t"$10
    } else {
        annotation[FNR] = $6"\t"$7"\t"$8"\t"$9"\t"$10
    }
    next
}
{
    if (FNR==1) {
        print $0 "\t" anno_header
    } else {
        print $0 "\t" annotation[FNR]
    }
}'</span> filtered_variants_thr0p7_20250902_162128.Cg_multianno.csv <span class="token punctuation">\</span>
   /home/wanglab/Ywh/adductor_muscle_scar/Variants/filtered_variants_thr0p7_20250902_162128.tsv <span class="token punctuation">\</span>
   <span class="token operator">&gt;</span> filtered_variants_thr0p7_20250902_162128_annotated.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="输出结果解读"><a href="#输出结果解读" class="headerlink" title="输出结果解读"></a>输出结果解读</h2><h3 id="注释结果包含的字段："><a href="#注释结果包含的字段：" class="headerlink" title="注释结果包含的字段："></a>注释结果包含的字段：</h3><ul>
<li><strong>Gene-based注释</strong>: 基因名称、转录本、外显子功能等</li>
<li><strong>位置信息</strong>: 染色体、位置、参考/变异碱基</li>
<li><strong>功能预测</strong>: 对蛋白质功能的影响</li>
</ul>
<h3 id="典型输出格式："><a href="#典型输出格式：" class="headerlink" title="典型输出格式："></a>典型输出格式：</h3><pre class="line-numbers language-none"><code class="language-none">Chr     Start   End     Ref     Alt     Func.refGene    Gene.refGene    ExonicFunc.refGene    AAChange.refGene
NC_047567.1 32667511 32667511 G T downstream LOC105320120 . .
NC_047567.1 32661831 32661831 C A exonic LOC105320120 nonsynonymous SNV LOC105320120:NM_001345123:exon2:c.T142A:p.S48T<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="常见问题与解决方案"><a href="#常见问题与解决方案" class="headerlink" title="常见问题与解决方案"></a>常见问题与解决方案</h2><h3 id="1-数据库构建失败"><a href="#1-数据库构建失败" class="headerlink" title="1. 数据库构建失败"></a>1. 数据库构建失败</h3><p><strong>问题</strong>: GTF文件格式不兼容<br><strong>解决</strong>: 确保GTF文件来自官方来源，使用<code>gtfToGenePred</code>前检查文件完整性</p>
<h3 id="2-注释结果为空"><a href="#2-注释结果为空" class="headerlink" title="2. 注释结果为空"></a>2. 注释结果为空</h3><p><strong>问题</strong>: 构建版本不匹配<br><strong>解决</strong>: 检查<code>-buildver</code>参数与数据库构建版本一致</p>
<h3 id="3-合并结果错位"><a href="#3-合并结果错位" class="headerlink" title="3. 合并结果错位"></a>3. 合并结果错位</h3><p><strong>问题</strong>: 输入文件行数不匹配<br><strong>解决</strong>: 使用基于行号的合并方法确保准确性</p>
<h2 id="流程优化建议"><a href="#流程优化建议" class="headerlink" title="流程优化建议"></a>流程优化建议</h2><h3 id="1-批量处理"><a href="#1-批量处理" class="headerlink" title="1. 批量处理"></a>1. 批量处理</h3><p>对于多个样本，可以编写循环脚本批量处理：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">sample</span> <span class="token keyword">in</span> sample1 sample2 sample3<span class="token punctuation">;</span> <span class="token keyword">do</span>
    perl table_annovar.pl <span class="token variable">${sample}</span>.avinput Cgigasdb/ <span class="token punctuation">\</span>
        <span class="token parameter variable">-buildver</span> Cg <span class="token punctuation">\</span>
        <span class="token parameter variable">-out</span> <span class="token variable">${sample}</span>_annotated <span class="token punctuation">\</span>
        <span class="token parameter variable">-protocol</span> refGene <span class="token punctuation">\</span>
        <span class="token parameter variable">-operation</span> g <span class="token punctuation">\</span>
        <span class="token parameter variable">-csvout</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-添加更多注释数据库"><a href="#2-添加更多注释数据库" class="headerlink" title="2. 添加更多注释数据库"></a>2. 添加更多注释数据库</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 添加保守性预测</span>
perl table_annovar.pl input.avinput Cgigasdb/ <span class="token punctuation">\</span>
    <span class="token parameter variable">-buildver</span> Cg <span class="token punctuation">\</span>
    <span class="token parameter variable">-out</span> output <span class="token punctuation">\</span>
    <span class="token parameter variable">-protocol</span> refGene,phastConsElements100way <span class="token punctuation">\</span>
    <span class="token parameter variable">-operation</span> g,r <span class="token punctuation">\</span>
    <span class="token parameter variable">-csvout</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>本流程提供了从原始SNP数据到功能注释的完整解决方案，特别针对长牡蛎等非模式生物。通过构建自定义数据库，可以有效地对物种特异性变异进行功能注释，为后续的群体遗传学和功能基因组学研究奠定基础。</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
  <entry>
    <title>AlphaFold与PyMOL的示例</title>
    <url>/2025/11/05/alphafold-pymol/</url>
    <content><![CDATA[<p>蛋白质与蛋白质互作是指不同蛋白质之间的相互作用，这种作用可以发生在细胞内或细胞外。蛋白质通过互相结合，形成复杂的细胞机制和信号传导网络，参与多种生物过程，如基因调控、代谢、信号传导等。这种互作是生命活动中的重要组成部分，对维持生物体的正常功能具有重要意义。</p>
<p><strong>那么如何用AlphaFold3预测候选蛋白质与蛋白质互作呢？</strong></p>
<h2 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a><strong>第一步</strong></h2><p>通过Uniport网站获取候选基因的蛋白质序列（以cGAS、STING为例）。获取cGAS蛋白质序列。</p>
<pre class="line-numbers language-none"><code class="language-none">&gt;XP_065930211.1 cyclic GMP-AMP synthase-like receptor isoform X1 [Magallana gigas]
MVFKCPICKREDFQSEGGLSSHITWKHSGSSDGRGSRPSTGGRGRRDDRDIKARVFKCPICKREDFQSEGGLSSHITWKHSGSSDGRGSRPSTGHGACGRSDNREYNTTVIKCPICKRGDFKSEGGLSCHITTVHPGSANGKGSRPSSCTNGKRDDGARPKTYTPRHRDHERHNSDRDVVRGVARVQRESSQRGSPDEFPFKDGAGGATWKSSSAKYKESPKQSRKTEEPRERPSSSDLNLSLSFNAQNFEKFVGMIEGSIVRPREDSTLRTDSINKFIDDLLVVMDRISDIPIKLLRSGSYYDRTKIDYNDEFDFMFYADIRMEADFTNCPPGYCKIRKGMTVKPDLDPFIDRNGYLVPEKYKAHMFDIFEKCRTDSSFRQGRRTQKQDRKPESPAYTLLFDLGISGKPPIDIDLVPAIKIDGWPKPARKIGPSKWIEKSMAERAMQCFHVVTKKFPEAHQDSRLLWRISFSHAEKELILHANMSDNGCRKDVFKILKRIKENMKSKNPTEMDKFCSYHLKMFILRFYDKHGDFSKERKLDLLKESIKQLAKCVREGTIENYFIPKDNVLQSVPEKERLSVVRELDGLLQ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>获取PRMT5的蛋白质序列。</p>
<pre class="line-numbers language-none"><code class="language-none">&gt;XP_011431693.2 STING ER exit protein [Magallana gigas]
MPKVVSRSVVCTDVKDQEEYQGEKPLYVYYCICGQISLILDCPIDKLPMRRRDNARVIDSQKHAHKLTCDPDDIVYLKRPQGIEKQYRQKCKRCGLWLYYHHQGNSGVMFVVDGALKRDAAKTDVYSQISEPKKVTLTKHTKNMGKFSSVTVSTVDEEEDEIEAKEIADSYAANAKVIEKQLFRKGINKRRQEEAAEEAKKKVKGTLIDK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a><strong>第二步</strong></h2><p>访问 <a href="https://alphafoldserver.com/">AlphaFold Server</a>（AlphaFold Server需要科学上网，而且建议使用Google浏览器，使用谷歌账号登录）和输入数据进行预测。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251105180712857.png" alt="image-20251105180712857"></p>
<p>登录谷歌邮箱账号，点击Add entity框就可以添加蛋白质、DNA、RNA、配体和离子（金属离子）。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251105180808034.png" alt="image-20251105180808034"></p>
<p>将cGAS和STING的蛋白质序列序列输入，点击”Continue and preview job”。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251105175436222.png" alt="image-20251105175436222"></p>
<p>点击“Confirm and submit job”即可提交作业，一般运行约10 分钟左右。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251105175503515.png" alt="image-20251105175503515"></p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251105175535419.png" alt="image-20251105175535419"></p>
<h2 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a><strong>第三步</strong></h2><p>cGAS和STING互作预测结果。点击“Download”可下载数据。颜色越蓝表示预测的置信度越高，越橙则越低。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251105175019365.png" alt="image-20251105175019365"></p>
<p>注：**<a href="https://zhida.zhihu.com/search?content_id=243460627&amp;content_type=Article&amp;match_order=1&amp;q=pLDDT&amp;zhida_source=entity">pLDDT</a>：基于 0-100 量表的每个原子置信度估计，其中较高的值表示置信度较高。**</p>
<p><a href="https://zhida.zhihu.com/search?content_id=243460627&amp;content_type=Article&amp;match_order=1&amp;q=pTM&amp;zhida_source=entity">pTM</a> 和 <a href="https://zhida.zhihu.com/search?content_id=243460627&amp;content_type=Article&amp;match_order=1&amp;q=ipTM&amp;zhida_source=entity">ipTM</a> 分数：预测模板建模（<code>pTM</code>）分数和界面预测模板建模（<code>ipTM</code>）分数均来自称为模板建模（<code>TM</code>）分数的度量。</p>
<p><code>pTM</code> 分数高于 0.5 表示整体预测的复合物折叠可能与真实结构相似。</p>
<p><strong><code>ipTM</code> 衡量复合物内亚基相对位置的预测准确性，高于 0.8 的值表示置信度高的高质量预测，而低于 0.6 的值则表明可能是失败的预测。</strong></p>
<p><code>ipTM</code> 分数在 0.6 到 0.8 之间为灰色区域，预测可能正确或不正确。</p>
<p>对于小结构或短链，TM 分数非常严格，因此当涉及少于 20 个标记时，<code>pTM</code> 分数赋值低于 0.05；在这些情况下，PAE 或 pLDDT 可能更能指示预测质量。</p>
<p>这些cif文件可以用PyMol类似的软件打开，然后进行后续分析。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251105175320026.png" alt="image-20251105175320026"></p>
<h2 id="第四步"><a href="#第四步" class="headerlink" title="第四步"></a>第四步</h2><p>在PyMOL中进行显示和绘制等</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251105200012399.png" alt="image-20251105200012399"></p>
<p>整体</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251105200216830.png" alt="image-20251105200216830"></p>
<p>绘制氢键等</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251105200320268.png" alt="image-20251105200320268"></p>
<p>可能的分子对接</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251105200927677.png" alt="image-20251105200927677"></p>
<p>加Label等</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251105201019286.png" alt="image-20251105201019286"></p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251105201511853.png" alt="image-20251105201511853"></p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251105202531766.png" alt="image-20251105202531766"></p>
<blockquote>
<p>注意：需要配合rosetta蛋白对接互作分析和实验验证！</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251105201718871.png" alt="image-20251105201718871"></p>
<p>关于rosetta，尽请期待！</p>
]]></content>
      <categories>
        <category>蛋白互作</category>
        <category>PyMOL</category>
      </categories>
  </entry>
  <entry>
    <title>GWAS + 热点区域识别 + LD Block 分析流程详解</title>
    <url>/2025/11/10/gwas-ld-block/</url>
    <content><![CDATA[<h2 id="🧬-一、项目概述"><a href="#🧬-一、项目概述" class="headerlink" title="🧬 一、项目概述"></a>🧬 一、项目概述</h2><p>在进行 <strong>GWAS（全基因组关联分析）</strong> 后，我们通常得到一个包含数十万到数百万个 SNP 的结果文件。然而，仅凭曼哈顿图观察显著位点往往无法直观判断“显著 SNP 是否存在聚集（hotspot）”，更难直接选定 LD 分析区域。</p>
<p>本篇文章介绍一套自动化分析流程，用于：</p>
<ol>
<li>从 GWAS 注释文件中提取特定染色体；</li>
<li>对 SNP 分布进行可视化与统计；</li>
<li>基于密度与显著性筛选“热点区域”；</li>
<li>输出推荐的 <strong>LD block 分析区域</strong>；</li>
<li>生成一整套图形报告（含基础可视化、热点分布、显著SNP分布、综合分析图）。</li>
</ol>
<p>该流程适用于任何 GWAS 结果（如 <code>.assoc</code> 或 <code>.anno.xls</code> 文件），并以染色体 <strong>NC_047567.1</strong> 为示例展示。</p>
<hr>
<h2 id="⚙️-二、环境配置"><a href="#⚙️-二、环境配置" class="headerlink" title="⚙️ 二、环境配置"></a>⚙️ 二、环境配置</h2><p>分析依赖 R 及多个可视化与基因组处理包，可通过以下命令一次性安装：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 一键安装所有依赖</span>
conda activate vcftools_env

conda <span class="token function">install</span> <span class="token parameter variable">-c</span> conda-forge r-base<span class="token operator">=</span><span class="token number">4.3</span>.3 <span class="token parameter variable">-y</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
conda <span class="token function">install</span> <span class="token parameter variable">-c</span> conda-forge r-tidyverse r-ggplot2 r-viridis r-scales r-circlize <span class="token parameter variable">-y</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
conda <span class="token function">install</span> <span class="token parameter variable">-c</span> bioconda r-biocmanager bioconductor-rtracklayer <span class="token parameter variable">-y</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">\</span>
<span class="token builtin class-name">echo</span> <span class="token string">"✅ 所有R包安装完成！"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>✅ 安装完成后即可运行所有 R 脚本，无需额外配置。</p>
<hr>
<h2 id="🔍-三、数据准备与预处理"><a href="#🔍-三、数据准备与预处理" class="headerlink" title="🔍 三、数据准备与预处理"></a>🔍 三、数据准备与预处理</h2><h3 id="1️⃣-查看所有染色体信息"><a href="#1️⃣-查看所有染色体信息" class="headerlink" title="1️⃣ 查看所有染色体信息"></a>1️⃣ 查看所有染色体信息</h3><p>1.show_all_chromosomes.sh</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">echo</span> <span class="token string">"=== 查看所有染色体名称 ==="</span>
<span class="token builtin class-name">echo</span> <span class="token string">"文件: color_GWAS.anno.xls"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"总行数: <span class="token variable"><span class="token variable">$(</span><span class="token function">wc</span> <span class="token parameter variable">-l</span> <span class="token operator">&lt;</span> color_GWAS.anno.xls<span class="token variable">)</span></span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"所有唯一的染色体名称:"</span>
<span class="token function">awk</span> <span class="token string">'NR&gt;1 {print $1}'</span> color_GWAS.anno.xls <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"前10个SNP的详细信息:"</span>
<span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">11</span> color_GWAS.anno.xls
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>脚本 <code>show_all_chromosomes.sh</code> 用于快速检查 GWAS 注释文件中的染色体分布与 SNP 数量。</p>
<p>目的：</p>
<ul>
<li>确定分析目标染色体；</li>
<li>统计 SNP 数量与基本信息；</li>
<li>避免文件格式错误。</li>
</ul>
<p>输出结果示例：</p>
<pre class="line-numbers language-none"><code class="language-none">=== 查看所有染色体名称 ===
所有唯一的染色体名称:
  2345  NC_047567.1
  1987  NC_047568.1
前10个SNP的详细信息:
Chr     POS     P.value     ...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="2️⃣-提取单条染色体数据"><a href="#2️⃣-提取单条染色体数据" class="headerlink" title="2️⃣ 提取单条染色体数据"></a>2️⃣ 提取单条染色体数据</h3><p>2.extract_NC_047567.1.sh</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">CHROM</span><span class="token operator">=</span><span class="token string">"NC_047567.1"</span>
<span class="token assign-left variable">ANNO_FILE</span><span class="token operator">=</span><span class="token string">"color_GWAS.anno.xls"</span>

<span class="token builtin class-name">echo</span> <span class="token string">"=== 提取染色体 <span class="token variable">$CHROM</span> 数据 ==="</span>

<span class="token comment"># 提取表头</span>
<span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">1</span> <span class="token string">"<span class="token variable">$ANNO_FILE</span>"</span> <span class="token operator">&gt;</span> <span class="token string">"<span class="token variable">${CHROM}</span>_data.txt"</span>

<span class="token comment"># 提取该染色体的数据</span>
<span class="token function">awk</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">chrom</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$CHROM</span>"</span> <span class="token string">'$1 == chrom'</span> <span class="token string">"<span class="token variable">$ANNO_FILE</span>"</span> <span class="token operator">&gt;&gt;</span> <span class="token string">"<span class="token variable">${CHROM}</span>_data.txt"</span>

<span class="token comment"># 统计</span>
<span class="token assign-left variable">TOTAL_LINES</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">wc</span> <span class="token parameter variable">-l</span> <span class="token operator">&lt;</span> <span class="token string">"<span class="token variable">${CHROM}</span>_data.txt"</span><span class="token variable">)</span></span>
<span class="token assign-left variable">SNP_COUNT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$((</span>TOTAL_LINES <span class="token operator">-</span> <span class="token number">1</span><span class="token variable">))</span></span>

<span class="token builtin class-name">echo</span> <span class="token string">"提取完成:"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"- 输出文件: <span class="token variable">${CHROM}</span>_data.txt"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"- SNP数量: <span class="token variable">$SNP_COUNT</span>"</span>

<span class="token comment"># 检查文件内容</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"前3行数据:"</span>
<span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">3</span> <span class="token string">"<span class="token variable">${CHROM}</span>_data.txt"</span>

<span class="token comment"># 生成位置文件</span>
<span class="token function">awk</span> <span class="token string">'NR&gt;1 {print $2}'</span> <span class="token string">"<span class="token variable">${CHROM}</span>_data.txt"</span> <span class="token operator">&gt;</span> <span class="token string">"<span class="token variable">${CHROM}</span>_positions.txt"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"位置文件: <span class="token variable">${CHROM}</span>_positions.txt"</span>

<span class="token comment"># 位置范围统计</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"位置范围统计:"</span>
<span class="token function">awk</span> <span class="token string">'NR&gt;1 {print $2}'</span> <span class="token string">"<span class="token variable">${CHROM}</span>_data.txt"</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-n</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'
BEGIN {min=999999999; max=0} 
{count++; sum+=$1; if($1&lt;min)min=$1; if($1&gt;max)max=$1} 
END {
    print "最小位置: " min
    print "最大位置: " max  
    print "位置范围: " min " - " max
    print "总跨度: " (max-min)/1000000 " Mb"
    print "SNP数量: " count
}'</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>extract_NC_047567.1.sh</code> 用于从注释表中提取指定染色体 SNP 信息。</p>
<p>核心步骤：</p>
<ul>
<li>从原始 GWAS 注释文件中筛选出对应染色体；</li>
<li>输出该染色体的 SNP 表；</li>
<li>自动生成位置文件与区间统计。</li>
</ul>
<p>输出：</p>
<pre class="line-numbers language-none"><code class="language-none">- 输出文件: NC_047567.1_data.txt
- SNP数量: 2345
- 位置范围: 1.2 Mb - 39.7 Mb
- 总跨度: 38.5 Mb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="📈-四、R-脚本分析模块"><a href="#📈-四、R-脚本分析模块" class="headerlink" title="📈 四、R 脚本分析模块"></a>📈 四、R 脚本分析模块</h2><h3 id="🔹-1-完整基础分析（3-0-complete-analysis-R）"><a href="#🔹-1-完整基础分析（3-0-complete-analysis-R）" class="headerlink" title="🔹 1. 完整基础分析（3.0.complete_analysis.R）"></a>🔹 1. 完整基础分析（<code>3.0.complete_analysis.R</code>）</h3><p>3.0.complete_analysis.R</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">#!/usr/bin/env Rscript
cat("=== 完整的染色体SNP分析 ===\n")

library(ggplot2)
library(dplyr)
library(viridis)
library(patchwork)

# 读取数据
chrom &lt;- "NC_047567.1"
snp_data &lt;- read.table(paste0(chrom, "_data.txt"), header = TRUE, sep = "\t", stringsAsFactors = FALSE)
snp_data$logP &lt;- -log10(snp_data$P.value)

cat("数据概况:\n")
cat("- SNP总数:", format(nrow(snp_data), big.mark = ","), "\n")
cat("- 位置范围:", format(min(snp_data$POS), big.mark = ","), "-", format(max(snp_data$POS), big.mark = ","), "\n")
cat("- 染色体长度:", format((max(snp_data$POS) - min(snp_data$POS))/1000000, digits=2), "Mb\n")
cat("- P值范围:", min(snp_data$P.value), "-", max(snp_data$P.value), "\n")

# 1. 基础可视化
cat("生成基础可视化...\n")

# 密度图
p_density &lt;- ggplot(snp_data, aes(x = POS/1000000)) +
    geom_density(fill = "steelblue", alpha = 0.7) +
    labs(title = "SNP密度分布", x = "基因组位置 (Mb)", y = "密度") +
    theme_minimal()

# 曼哈顿图
p_manhattan &lt;- ggplot(snp_data, aes(x = POS/1000000, y = logP)) +
    geom_point(aes(color = logP), alpha = 0.3, size = 0.5) +
    scale_color_viridis_c(name = "-log10(P)") +
    geom_hline(yintercept = -log10(0.05/nrow(snp_data)), linetype = "dashed", color = "red") +
    labs(title = "曼哈顿图", x = "基因组位置 (Mb)", y = "-log10(P值)") +
    theme_minimal()

# 组合图
png(paste0(chrom, "_basic_analysis.png"), width=16, height=10, units="in", res=300)
basic_plot &lt;- p_density / p_manhattan +
    plot_annotation(
        title = paste("染色体", chrom, "SNP分析"),
        subtitle = paste("总计", format(nrow(snp_data), big.mark = ","), "个SNP"),
        theme = theme(plot.title = element_text(hjust = 0.5, size=16, face="bold"))
    )
print(basic_plot)
dev.off()

# 2. 正确的热点区域分析
cat("进行热点区域分析...\n")

# 使用固定大小的窗口（1Mb窗口）
window_size &lt;- 1000000  # 1Mb窗口
starts &lt;- seq(min(snp_data$POS), max(snp_data$POS), by = window_size)

hotspot_analysis &lt;- data.frame()
for(i in 1:(length(starts)-1)) {
    start &lt;- starts[i]
    end &lt;- starts[i+1]
    window_data &lt;- snp_data[snp_data$POS &gt;= start &amp; snp_data$POS &lt; end, ]
    
    if(nrow(window_data) &gt; 0) {
        hotspot_analysis &lt;- rbind(hotspot_analysis, data.frame(
            Window = i,
            Start = start,
            End = end,
            SNP_Count = nrow(window_data),
            SNP_Density = nrow(window_data) / ((end - start)/1000000),  # 每Mb的SNP数
            Mean_logP = mean(window_data$logP, na.rm = TRUE),
            Max_logP = max(window_data$logP, na.rm = TRUE)
        ))
    }
}

cat("窗口分析完成，窗口数量:", nrow(hotspot_analysis), "\n")
cat("平均每窗口SNP数量:", round(mean(hotspot_analysis$SNP_Count)), "\n")
cat("平均SNP密度:", round(mean(hotspot_analysis$SNP_Density)), "SNPs/Mb\n")

# 识别热点区域（SNP密度前20%）
density_threshold &lt;- quantile(hotspot_analysis$SNP_Density, 0.80)
hot_regions &lt;- hotspot_analysis %&gt;%
    filter(SNP_Density &gt;= density_threshold) %&gt;%
    arrange(desc(SNP_Density))

cat("热点区域阈值:", round(density_threshold), "SNPs/Mb\n")
cat("发现热点区域:", nrow(hot_regions), "个\n")

# 热点区域可视化
png(paste0(chrom, "_hotspot_corrected.png"), width=14, height=6, units="in", res=300)
ggplot(hotspot_analysis, aes(x = Start/1000000, y = SNP_Density)) +
    geom_col(aes(fill = SNP_Density), alpha = 0.8, width = 0.8) +
    geom_hline(yintercept = density_threshold, linetype = "dashed", color = "red", size = 1) +
    geom_text(data = hot_regions, aes(label = round(SNP_Density)), vjust = -0.5, size = 3) +
    scale_fill_viridis_c(name = "SNP密度\n(SNPs/Mb)") +
    labs(title = paste("SNP热点区域分析 -", chrom),
         subtitle = paste("红色虚线: 热点阈值 (", round(density_threshold), "SNPs/Mb)"),
         x = "基因组位置 (Mb)", y = "SNP密度 (SNPs/Mb)") +
    theme_minimal() +
    theme(plot.title = element_text(hjust = 0.5, face = "bold"))
dev.off()

# 3. 输出热点区域和推荐分析区域
if(nrow(hot_regions) &gt; 0) {
    hotspot_info &lt;- data.frame(
        Region_ID = paste0("Hotspot_", 1:nrow(hot_regions)),
        Chromosome = chrom,
        Start_Mb = round(hot_regions$Start/1000000, 1),
        End_Mb = round(hot_regions$End/1000000, 1),
        Size_Mb = 1.0,  # 固定1Mb窗口
        SNP_Count = hot_regions$SNP_Count,
        SNP_Density = round(hot_regions$SNP_Density),
        Mean_logP = round(hot_regions$Mean_logP, 2),
        Max_logP = round(hot_regions$Max_logP, 2)
    )
    
    write.csv(hotspot_info, paste0(chrom, "_corrected_hotspots.csv"), row.names = FALSE)
    
    # 推荐前3个区域进行LD分析
    recommended &lt;- head(hotspot_info, 3)
    write.csv(recommended, paste0(chrom, "_recommended_ld_regions.csv"), row.names = FALSE)
    
    cat("\n=== 热点区域总结 ===\n")
    print(hotspot_info)
    
    cat("\n=== 推荐LD分析区域 ===\n")
    print(recommended)
} else {
    cat("未发现明显热点区域\n")
}

# 4. 生成分析报告
cat("\n=== 分析完成 ===\n")
cat("生成的文件:\n")
cat("- ", chrom, "_basic_analysis.png (基础分析图)\n")
cat("- ", chrom, "_hotspot_corrected.png (热点区域图)\n")
cat("- ", chrom, "_corrected_hotspots.csv (热点区域列表)\n")
cat("- ", chrom, "_recommended_ld_regions.csv (推荐LD分析区域)\n")

cat("\n下一步建议:\n")
if(nrow(hot_regions) &gt; 0) {
    cat("1. 对推荐区域进行LD block分析\n")
    cat("2. 重点关注高SNP密度且P值显著的区域\n")
    cat("3. 结合基因注释分析候选基因\n")
} else {
    cat("1. 考虑分析整个染色体或选择SNP密度较高的区域\n")
    cat("2. 可以手动选择感兴趣的区域进行LD分析\n")
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>该脚本是整个流程的核心，包含以下分析步骤：</p>
<h4 id="（1）基础可视化"><a href="#（1）基础可视化" class="headerlink" title="（1）基础可视化"></a>（1）基础可视化</h4><p>生成 <strong>SNP密度图</strong> 与 <strong>曼哈顿图</strong>：</p>
<ul>
<li>横轴为基因组位置（Mb）；</li>
<li>纵轴为 -log10(P)；</li>
<li>自动添加 Bonferroni 阈值线；</li>
<li>图像合并保存为 <code>*_basic_analysis.png</code>。</li>
</ul>
<h4 id="（2）窗口扫描与热点检测"><a href="#（2）窗口扫描与热点检测" class="headerlink" title="（2）窗口扫描与热点检测"></a>（2）窗口扫描与热点检测</h4><p>通过 1Mb 窗口滑动统计每 Mb 的 SNP 数量与密度，并识别：</p>
<ul>
<li>SNP 密度位于前 20% 的窗口；</li>
<li>输出为 <code>*_corrected_hotspots.csv</code>；</li>
<li>可视化结果为 <code>*_hotspot_corrected.png</code>。</li>
</ul>
<h4 id="（3）推荐-LD-分析区域"><a href="#（3）推荐-LD-分析区域" class="headerlink" title="（3）推荐 LD 分析区域"></a>（3）推荐 LD 分析区域</h4><p>程序自动输出密度最高的前三个窗口，保存为：</p>
<ul>
<li><code>*_recommended_ld_regions.csv</code></li>
</ul>
<h4 id="（4）结果总结与建议"><a href="#（4）结果总结与建议" class="headerlink" title="（4）结果总结与建议"></a>（4）结果总结与建议</h4><p>输出包括：</p>
<pre class="line-numbers language-none"><code class="language-none">=== 热点区域总结 ===
=== 推荐LD分析区域 ===
下一步建议:
1. 对推荐区域进行LD block分析
2. 结合基因注释分析候选基因<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="🔹-2-基于显著SNP的热点分析（3-1-corrected-significant-hotspots-R）"><a href="#🔹-2-基于显著SNP的热点分析（3-1-corrected-significant-hotspots-R）" class="headerlink" title="🔹 2. 基于显著SNP的热点分析（3.1.corrected_significant_hotspots.R）"></a>🔹 2. 基于显著SNP的热点分析（<code>3.1.corrected_significant_hotspots.R</code>）</h3><p>3.1.corrected_significant_hotspots.R</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">#!/usr/bin/env Rscript
cat("=== 基于显著SNP的热点区域分析 ===\n")

library(ggplot2)
library(dplyr)
library(viridis)
library(patchwork)

# 读取数据
chrom &lt;- "NC_047567.1"
snp_data &lt;- read.table(paste0(chrom, "_data.txt"), header = TRUE, sep = "\t", stringsAsFactors = FALSE)
snp_data$logP &lt;- -log10(snp_data$P.value)

cat("原始数据概况:\n")
cat("- 总SNP数:", format(nrow(snp_data), big.mark = ","), "\n")

# 定义显著性阈值
significance_threshold &lt;- -log10(0.05/nrow(snp_data))  # Bonferroni校正
cat("Bonferroni校正的显著性阈值: -log10(P) &gt;", round(significance_threshold, 2), "\n")

# 过滤显著SNP
significant_snps &lt;- snp_data[snp_data$logP &gt; significance_threshold, ]
cat("显著SNP数量:", format(nrow(significant_snps), big.mark = ","), "\n")
cat("显著SNP比例:", round(nrow(significant_snps)/nrow(snp_data)*100, 2), "%\n")

if(nrow(significant_snps) == 0) {
    cat("警告: 没有显著SNP，使用较宽松的阈值\n")
    significance_threshold &lt;- -log10(1e-5)  # 使用10^-5作为阈值
    significant_snps &lt;- snp_data[snp_data$logP &gt; significance_threshold, ]
    cat("使用阈值 -log10(P) &gt;", significance_threshold, "\n")
    cat("显著SNP数量:", nrow(significant_snps), "\n")
}

if(nrow(significant_snps) &gt; 0) {
    # 1. 显著SNP的分布可视化
    p1 &lt;- ggplot(significant_snps, aes(x = POS/1000000, y = logP)) +
        geom_point(aes(color = logP), alpha = 0.7, size = 1) +
        scale_color_viridis_c(name = "-log10(P)") +
        geom_hline(yintercept = significance_threshold, linetype = "dashed", color = "red") +
        labs(title = "显著SNP分布",
             x = "基因组位置 (Mb)", y = "-log10(P值)") +
        theme_minimal()
    
    p2 &lt;- ggplot(significant_snps, aes(x = POS/1000000)) +
        geom_density(fill = "red", alpha = 0.7) +
        labs(title = "显著SNP密度分布",
             x = "基因组位置 (Mb)", y = "密度") +
        theme_minimal()
    
    png(paste0(chrom, "_significant_snps.png"), width=16, height=8, units="in", res=300)
    combined &lt;- p1 | p2 +
        plot_annotation(
            title = paste("显著SNP分析 -", chrom),
            subtitle = paste("显著SNP:", nrow(significant_snps), "/", format(nrow(snp_data), big.mark = ",")),
            theme = theme(plot.title = element_text(hjust = 0.5, face="bold"))
        )
    print(combined)
    dev.off()
    
    # 2. 基于显著SNP的热点区域分析
    cat("进行显著SNP热点区域分析...\n")
    
    # 使用500kb窗口分析显著SNP
    window_size &lt;- 500000  # 500kb窗口
    starts &lt;- seq(min(snp_data$POS), max(snp_data$POS), by = window_size)
    
    hotspot_analysis &lt;- data.frame()
    for(i in 1:(length(starts)-1)) {
        start &lt;- starts[i]
        end &lt;- starts[i+1]
        window_data &lt;- significant_snps[significant_snps$POS &gt;= start &amp; significant_snps$POS &lt; end, ]
        
        if(nrow(window_data) &gt; 0) {
            hotspot_analysis &lt;- rbind(hotspot_analysis, data.frame(
                Window = i,
                Start = start,
                End = end,
                Significant_SNP_Count = nrow(window_data),
                SNP_Density = nrow(window_data) / ((end - start)/1000000),  # 每Mb的显著SNP数
                Mean_logP = mean(window_data$logP, na.rm = TRUE),
                Max_logP = max(window_data$logP, na.rm = TRUE)
            ))
        } else {
            # 也记录没有显著SNP的窗口
            hotspot_analysis &lt;- rbind(hotspot_analysis, data.frame(
                Window = i,
                Start = start,
                End = end,
                Significant_SNP_Count = 0,
                SNP_Density = 0,
                Mean_logP = NA,
                Max_logP = NA
            ))
        }
    }
    
    cat("窗口分析完成，窗口数量:", nrow(hotspot_analysis), "\n")
    
    # 识别显著SNP热点区域（显著SNP密度前20%）
    if(sum(hotspot_analysis$Significant_SNP_Count &gt; 0) &gt; 0) {
        density_threshold &lt;- quantile(hotspot_analysis$SNP_Density[hotspot_analysis$SNP_Density &gt; 0], 0.80, na.rm = TRUE)
        hot_regions &lt;- hotspot_analysis %&gt;%
            filter(SNP_Density &gt;= density_threshold) %&gt;%
            arrange(desc(SNP_Density))
        
        cat("显著SNP热点阈值:", round(density_threshold, 1), "显著SNPs/Mb\n")
        cat("发现显著SNP热点区域:", nrow(hot_regions), "个\n")
        
        # 热点区域可视化
        png(paste0(chrom, "_significant_hotspots.png"), width=14, height=6, units="in", res=300)
        ggplot(hotspot_analysis, aes(x = Start/1000000, y = SNP_Density)) +
            geom_col(aes(fill = SNP_Density), alpha = 0.8, width = 0.4) +
            geom_hline(yintercept = density_threshold, linetype = "dashed", color = "red", linewidth = 1) +
            geom_text(data = hot_regions, aes(label = round(SNP_Density, 1)), vjust = -0.5, size = 3) +
            scale_fill_viridis_c(name = "显著SNP密度\n(SNPs/Mb)") +
            labs(title = paste("显著SNP热点区域分析 -", chrom),
                 subtitle = paste("红色虚线: 热点阈值 (", round(density_threshold, 1), "显著SNPs/Mb)"),
                 x = "基因组位置 (Mb)", y = "显著SNP密度 (SNPs/Mb)") +
            theme_minimal() +
            theme(plot.title = element_text(hjust = 0.5, face = "bold"))
        dev.off()
        
        # 输出热点区域
        if(nrow(hot_regions) &gt; 0) {
            hotspot_info &lt;- data.frame(
                Region_ID = paste0("SigHotspot_", 1:nrow(hot_regions)),
                Chromosome = chrom,
                Start_Mb = round(hot_regions$Start/1000000, 1),
                End_Mb = round(hot_regions$End/1000000, 1),
                Size_Mb = 0.5,  # 500kb窗口
                Significant_SNP_Count = hot_regions$Significant_SNP_Count,
                SNP_Density = round(hot_regions$SNP_Density, 1),
                Mean_logP = round(hot_regions$Mean_logP, 2),
                Max_logP = round(hot_regions$Max_logP, 2)
            )
            
            write.csv(hotspot_info, paste0(chrom, "_significant_hotspots.csv"), row.names = FALSE)
            
            # 推荐前3个区域进行LD分析
            recommended &lt;- head(hotspot_info, 3)
            write.csv(recommended, paste0(chrom, "_recommended_significant_regions.csv"), row.names = FALSE)
            
            cat("\n=== 显著SNP热点区域 ===\n")
            print(hotspot_info)
            
            cat("\n=== 推荐LD分析区域（基于显著SNP）===\n")
            print(recommended)
        }
    } else {
        cat("警告: 没有发现显著SNP聚集的区域\n")
    }
    
} else {
    cat("错误: 没有显著SNP，无法进行热点区域分析\n")
}

cat("\n=== 分析完成 ===\n")
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此脚本进一步聚焦于显著 SNP：</p>
<h4 id="（1）显著性筛选"><a href="#（1）显著性筛选" class="headerlink" title="（1）显著性筛选"></a>（1）显著性筛选</h4><ul>
<li>默认使用 Bonferroni 阈值；</li>
<li>若无显著 SNP，自动使用更宽松阈值（如 1e-5）；</li>
<li>输出显著 SNP 的数量、比例及分布。</li>
</ul>
<h4 id="（2）基于显著SNP的窗口统计"><a href="#（2）基于显著SNP的窗口统计" class="headerlink" title="（2）基于显著SNP的窗口统计"></a>（2）基于显著SNP的窗口统计</h4><p>采用更精细的 500kb 窗口滑动，计算：</p>
<ul>
<li>显著SNP数；</li>
<li>显著SNP密度；</li>
<li>平均与最大 -log10(P)。</li>
</ul>
<p>筛选密度前 20% 的窗口作为 <strong>显著热点区域</strong>，输出为：</p>
<ul>
<li><code>*_significant_hotspots.csv</code></li>
<li>推荐区域：<code>*_recommended_significant_regions.csv</code></li>
</ul>
<h4 id="（3）显著SNP热点可视化"><a href="#（3）显著SNP热点可视化" class="headerlink" title="（3）显著SNP热点可视化"></a>（3）显著SNP热点可视化</h4><p>生成：</p>
<ul>
<li>显著SNP分布图；</li>
<li>显著SNP密度图；</li>
<li>热点分布柱状图；<br> 输出文件：<code>*_significant_hotspots.png</code></li>
</ul>
<hr>
<h3 id="🔹-3-最终可视化与总结（3-2-fixed-visualization-R）"><a href="#🔹-3-最终可视化与总结（3-2-fixed-visualization-R）" class="headerlink" title="🔹 3. 最终可视化与总结（3.2.fixed_visualization.R）"></a>🔹 3. 最终可视化与总结（<code>3.2.fixed_visualization.R</code>）</h3><p>3.2.fixed_visualization.R</p>
<pre class="line-numbers language-R" data-language="R"><code class="language-R">#!/usr/bin/env Rscript
cat("=== 修复版完整可视化 ===\n")

library(ggplot2)
library(dplyr)
library(viridis)
library(patchwork)
library(circlize)
library(scales)  # 添加scales包用于rescale函数

# 读取数据
chrom &lt;- "NC_047567.1"
snp_data &lt;- read.table(paste0(chrom, "_data.txt"), header = TRUE, sep = "\t", stringsAsFactors = FALSE)
snp_data$logP &lt;- -log10(snp_data$P.value)

# 读取显著热点区域
hotspots &lt;- read.csv(paste0(chrom, "_significant_hotspots.csv"))

cat("生成完整可视化...\n")

# 1. 曼哈顿风格组合图（更稳定的方法）
sig_threshold &lt;- -log10(0.05/nrow(snp_data))
significant_snps &lt;- snp_data[snp_data$logP &gt; sig_threshold, ]

cat("显著SNP数量:", nrow(significant_snps), "\n")
cat("热点区域:", nrow(hotspots), "个\n")

# 主曼哈顿图
p_manhattan &lt;- ggplot(snp_data, aes(x = POS/1000000, y = logP)) +
    # 所有SNP背景
    geom_point(data = snp_data[snp_data$logP &lt;= sig_threshold, ], 
               color = "grey80", alpha = 0.3, size = 0.3) +
    # 显著SNP
    geom_point(data = significant_snps, 
               aes(color = logP), alpha = 0.8, size = 1) +
    scale_color_viridis_c(name = "-log10(P)") +
    # 显著性阈值线
    geom_hline(yintercept = sig_threshold, 
               linetype = "dashed", color = "red", linewidth = 1) +
    # 热点区域标记
    geom_rect(data = hotspots, 
              aes(xmin = Start_Mb, xmax = End_Mb, ymin = 0, ymax = Inf),
              fill = "red", alpha = 0.1, inherit.aes = FALSE) +
    geom_text(data = hotspots, 
              aes(x = (Start_Mb + End_Mb)/2, y = max(snp_data$logP)*0.95, 
                  label = paste0("Hotspot\n", Significant_SNP_Count, " sig SNPs")),
              size = 2.5, color = "darkred", inherit.aes = FALSE) +
    labs(title = "Manhattan Plot with Significant SNP Hotspots",
         x = "Genomic Position (Mb)", y = "-log10(P-value)") +
    theme_minimal()

# 显著SNP密度图
p_density &lt;- ggplot(significant_snps, aes(x = POS/1000000)) +
    geom_density(fill = "red", alpha = 0.7, color = "darkred", linewidth = 1) +
    geom_rug(sides = "b", color = "red", alpha = 0.5) +
    # 热点区域标记
    geom_vline(data = hotspots, aes(xintercept = Start_Mb), 
               linetype = "dashed", color = "blue", linewidth = 0.8) +
    geom_vline(data = hotspots, aes(xintercept = End_Mb), 
               linetype = "dashed", color = "blue", linewidth = 0.8) +
    geom_label(data = hotspots, 
               aes(x = (Start_Mb + End_Mb)/2, y = 0, 
                   label = paste0(Start_Mb, "-", End_Mb, " Mb")),
              angle = 90, vjust = 1.2, size = 3, color = "blue", 
              fill = "white", alpha = 0.8, inherit.aes = FALSE) +
    labs(title = "Density of Significant SNPs",
         x = "Genomic Position (Mb)", y = "Density") +
    theme_minimal()

# 组合图
png(paste0(chrom, "_final_analysis.png"), width=16, height=10, units="in", res=300)
combined_plot &lt;- p_manhattan / p_density +
    plot_annotation(
        title = paste("Significant SNP Analysis:", chrom),
        subtitle = paste("Total:", nrow(significant_snps), "significant SNPs |", 
                        nrow(hotspots), "hotspot regions"),
        theme = theme(
            plot.title = element_text(hjust = 0.5, size = 18, face = "bold"),
            plot.subtitle = element_text(hjust = 0.5, size = 12)
        )
    )
print(combined_plot)
dev.off()
cat("组合分析图已生成\n")

# 2. 热点区域详细分析
if(nrow(hotspots) &gt; 0) {
    cat("生成热点区域详细图...\n")
    
    hotspot_plots &lt;- list()
    
    for(i in 1:nrow(hotspots)) {
        hotspot &lt;- hotspots[i, ]
        start_bp &lt;- hotspot$Start_Mb * 1000000
        end_bp &lt;- hotspot$End_Mb * 1000000
        
        # 提取热点区域内的SNP
        hotspot_snps &lt;- snp_data[snp_data$POS &gt;= start_bp &amp; snp_data$POS &lt;= end_bp, ]
        hotspot_sig_snps &lt;- hotspot_snps[hotspot_snps$logP &gt; sig_threshold, ]
        
        cat(paste0("热点", i, ": ", nrow(hotspot_snps), "个SNP, ", 
                   nrow(hotspot_sig_snps), "个显著SNP\n"))
        
        # 热点区域详细图
        p &lt;- ggplot(hotspot_snps, aes(x = POS, y = logP)) +
            # 背景SNP
            geom_point(data = hotspot_snps[hotspot_snps$logP &lt;= sig_threshold, ], 
                       color = "grey70", alpha = 0.5, size = 1) +
            # 显著SNP
            geom_point(data = hotspot_sig_snps, 
                       aes(color = logP), size = 2, alpha = 0.8) +
            scale_color_viridis_c(name = "-log10(P)") +
            # 显著性线
            geom_hline(yintercept = sig_threshold, linetype = "dashed", color = "red") +
            # 区域标记
            annotate("rect", xmin = start_bp, xmax = end_bp, 
                     ymin = 0, ymax = Inf, fill = "red", alpha = 0.1) +
            labs(title = paste("Hotspot", i, ":", hotspot$Start_Mb, "-", hotspot$End_Mb, "Mb"),
                 subtitle = paste("Size:", hotspot$Size_Mb, "Mb |", 
                                 hotspot$Significant_SNP_Count, "significant SNPs |",
                                 "Mean -log10(P):", hotspot$Mean_logP),
                 x = "Position (bp)", y = "-log10(P-value)") +
            theme_minimal() +
            theme(plot.title = element_text(face = "bold", hjust = 0.5),
                  plot.subtitle = element_text(hjust = 0.5))
        
        hotspot_plots[[i]] &lt;- p
        
        # 保存单个热点图
        ggsave(paste0(chrom, "_hotspot_", i, "_detail.png"), p, 
               width = 10, height = 6, dpi = 300)
    }
    
    # 热点区域组合图
    if(length(hotspot_plots) &gt; 1) {
        png(paste0(chrom, "_all_hotspots.png"), width=14, height=8, units="in", res=300)
        if(length(hotspot_plots) == 2) {
            final_plot &lt;- hotspot_plots[[1]] | hotspot_plots[[2]]
        } else {
            final_plot &lt;- wrap_plots(hotspot_plots)
        }
        print(final_plot)
        dev.off()
    }
}

# 3. 生成总结统计
cat("生成分析总结...\n")

summary_stats &lt;- data.frame(
    Metric = c("Total SNPs", "Significant SNPs", "Significance Threshold", 
               "Hotspot Regions", "Total Significant SNPs in Hotspots",
               "Hotspot 1 (31.5-32.0 Mb)", "Hotspot 2 (32.0-32.5 Mb)"),
    Value = c(
        format(nrow(snp_data), big.mark = ","),
        nrow(significant_snps),
        paste0("-log10(P) &gt; ", round(sig_threshold, 2)),
        nrow(hotspots),
        sum(hotspots$Significant_SNP_Count),
        paste0(hotspots$Significant_SNP_Count[1], " SNPs, mean -log10(P)=", hotspots$Mean_logP[1]),
        paste0(hotspots$Significant_SNP_Count[2], " SNPs, mean -log10(P)=", hotspots$Mean_logP[2])
    )
)

write.csv(summary_stats, paste0(chrom, "_analysis_summary.csv"), row.names = FALSE)

cat("\n=== 分析完成 ===\n")
cat("📊 生成的可视化文件:\n")
cat("   - ", chrom, "_final_analysis.png (组合分析图)\n")
cat("   - ", chrom, "_hotspot_1_detail.png (热点1详细图)\n")
cat("   - ", chrom, "_hotspot_2_detail.png (热点2详细图)\n")
cat("   - ", chrom, "_all_hotspots.png (所有热点组合图)\n")
cat("📋 生成的数据文件:\n")
cat("   - ", chrom, "_analysis_summary.csv (分析总结)\n")

cat("\n🎯 最终LD分析推荐:\n")
cat("   优先分析: 31.5-32.0 Mb 区域 (70个显著SNP)\n")
cat("   次要分析: 32.0-32.5 Mb 区域 (25个显著SNP)\n")
cat("   这些区域包含真正的功能变异，LD分析最有生物学意义！\n")<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>该脚本整合所有结果，生成最终图形报告。</p>
<h4 id="（1）综合曼哈顿-密度双图"><a href="#（1）综合曼哈顿-密度双图" class="headerlink" title="（1）综合曼哈顿 + 密度双图"></a>（1）综合曼哈顿 + 密度双图</h4><p>展示：</p>
<ul>
<li>全部SNP背景；</li>
<li>显著SNP标记；</li>
<li>热点区域矩形标注；</li>
<li>显著阈值线；<br> 输出文件：<code>*_final_analysis.png</code></li>
</ul>
<h4 id="（2）热点区域细化可视化"><a href="#（2）热点区域细化可视化" class="headerlink" title="（2）热点区域细化可视化"></a>（2）热点区域细化可视化</h4><p>为每个热点单独绘制详细图，包含：</p>
<ul>
<li>区域内SNP分布；</li>
<li>显著SNP聚集情况；</li>
<li>区域统计指标。</li>
</ul>
<p>输出：</p>
<pre class="line-numbers language-none"><code class="language-none">- NC_047567.1_hotspot_1_detail.png
- NC_047567.1_hotspot_2_detail.png
- NC_047567.1_all_hotspots.png<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="（3）分析总结报告"><a href="#（3）分析总结报告" class="headerlink" title="（3）分析总结报告"></a>（3）分析总结报告</h4><p>自动生成汇总文件：</p>
<ul>
<li><code>*_analysis_summary.csv</code><br> 包含总SNP数、显著SNP数、热点数量、推荐LD分析区间等信息。</li>
</ul>
<hr>
<h2 id="🧭-五、结果解读与后续分析建议"><a href="#🧭-五、结果解读与后续分析建议" class="headerlink" title="🧭 五、结果解读与后续分析建议"></a>🧭 五、结果解读与后续分析建议</h2><p>经过三步 R 脚本分析后，你将获得以下核心成果：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>文件名</th>
<th>内容说明</th>
</tr>
</thead>
<tbody><tr>
<td>基础分析图</td>
<td><code>_basic_analysis.png</code></td>
<td>SNP密度 + 曼哈顿图</td>
</tr>
<tr>
<td>热点分析图</td>
<td><code>_hotspot_corrected.png</code></td>
<td>基于密度的热点识别</td>
</tr>
<tr>
<td>显著热点图</td>
<td><code>_significant_hotspots.png</code></td>
<td>显著SNP聚集区</td>
</tr>
<tr>
<td>综合报告图</td>
<td><code>_final_analysis.png</code></td>
<td>曼哈顿 + 密度双图</td>
</tr>
<tr>
<td>LD推荐区域</td>
<td><code>_recommended_ld_regions.csv</code></td>
<td>建议LD分析区间</td>
</tr>
<tr>
<td>汇总统计</td>
<td><code>_analysis_summary.csv</code></td>
<td>关键参数表</td>
</tr>
</tbody></table>
<h3 id="🔬-下一步建议："><a href="#🔬-下一步建议：" class="headerlink" title="🔬 下一步建议："></a>🔬 下一步建议：</h3><ol>
<li>在推荐区域中进行 <strong>LD Block 分析</strong>；</li>
<li>使用 <code>plink --r2</code> 或 <code>haploview</code> 计算 LD；</li>
<li>结合 <strong>基因注释 / 转录组表达数据</strong>，筛选潜在功能基因；</li>
<li>若热点区域较集中，可进一步做 <strong>候选区域 GWAS 重分析</strong>。</li>
</ol>
<hr>
<h2 id="🔬-六、GWAS热点区域分析"><a href="#🔬-六、GWAS热点区域分析" class="headerlink" title="🔬 六、GWAS热点区域分析"></a>🔬 六、GWAS热点区域分析</h2><p>4.auto_gwas_hotspot_ld.sh</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 综合LD分析和LocusZoom图生成脚本 - 可配置版</span>
<span class="token comment"># 用法: ./combined_ld_locuszoom_configurable.sh &lt;热点区域名称&gt; &lt;染色体&gt; &lt;起始位置&gt; &lt;终止位置&gt;</span>

<span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>

<span class="token comment"># ========== 可配置参数 ==========</span>
<span class="token assign-left variable">SIGNIFICANCE_THRESHOLD</span><span class="token operator">=</span><span class="token string">"1e-8"</span>  <span class="token comment"># 显著性阈值，可修改为1e-6、5e-8等</span>
<span class="token assign-left variable">MAF_FILTER</span><span class="token operator">=</span><span class="token string">"0.4"</span>              <span class="token comment"># MAF过滤阈值</span>
<span class="token comment"># ===============================</span>

<span class="token assign-left variable">REGION_NAME</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token assign-left variable">CHROM</span><span class="token operator">=</span><span class="token variable">$2</span>
<span class="token assign-left variable">REGION_START</span><span class="token operator">=</span><span class="token variable">$3</span>
<span class="token assign-left variable">REGION_END</span><span class="token operator">=</span><span class="token variable">$4</span>

<span class="token builtin class-name">echo</span> <span class="token string">"=== 综合LD分析和LocusZoom图生成: <span class="token variable">$REGION_NAME</span> ==="</span>
<span class="token builtin class-name">echo</span> <span class="token string">"使用参数: 显著性阈值=<span class="token variable">$SIGNIFICANCE_THRESHOLD</span>, MAF过滤=<span class="token variable">$MAF_FILTER</span>"</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$REGION_NAME</span>"</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$CHROM</span>"</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$REGION_START</span>"</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span> <span class="token parameter variable">-z</span> <span class="token string">"<span class="token variable">$REGION_END</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"错误: 参数不完整"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"用法: <span class="token variable">$0</span> &lt;热点区域名称&gt; &lt;染色体&gt; &lt;起始位置&gt; &lt;终止位置&gt;"</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token comment"># 设置基础目录</span>
<span class="token assign-left variable">BASE_DIR</span><span class="token operator">=</span><span class="token string">"/mnt/usb/LD-block"</span>
<span class="token assign-left variable">VCF_FILE</span><span class="token operator">=</span><span class="token string">"/media/hhhh/5435CA8664BB5557/Desktop/闭壳肌痕/多组学/重测序/3.Variants/Filter.snp.vcf.gz"</span>
<span class="token assign-left variable">GWAS_FILE</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${BASE_DIR}</span>/color_GWAS.anno.xls"</span>
<span class="token assign-left variable">GFF_FILE</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${BASE_DIR}</span>/GCF_902806645.1_cgigas_uk_roslin_v1_genomic.gff.gz"</span>

<span class="token builtin class-name">echo</span> <span class="token string">"工作目录: <span class="token variable">$BASE_DIR</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"分析区域: <span class="token variable">$CHROM</span>:<span class="token variable">$REGION_START</span>-<span class="token variable">$REGION_END</span>"</span>

<span class="token comment"># 切换到工作目录</span>
<span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$BASE_DIR</span>"</span>

<span class="token comment"># 创建区域工作目录</span>
<span class="token assign-left variable">WORK_DIR</span><span class="token operator">=</span><span class="token string">"Complete_Analysis_<span class="token variable">${REGION_NAME}</span>"</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token string">"<span class="token variable">$WORK_DIR</span>"</span>
<span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable">$WORK_DIR</span>"</span>

<span class="token builtin class-name">echo</span> <span class="token string">"=== 阶段1: 基础数据准备 ==="</span>

<span class="token comment"># 步骤1: 准备GFF文件</span>
<span class="token builtin class-name">echo</span> <span class="token string">"步骤1: 准备GFF文件..."</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">$GFF_FILE</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"解压GFF文件..."</span>
    gunzip <span class="token parameter variable">-c</span> <span class="token string">"<span class="token variable">$GFF_FILE</span>"</span> <span class="token operator">&gt;</span> genomic.gff
    <span class="token assign-left variable">GFF_FILE_PATH</span><span class="token operator">=</span><span class="token string">"genomic.gff"</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"使用GFF文件: <span class="token variable">$GFF_FILE_PATH</span>"</span>
<span class="token keyword">else</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"警告: 未找到GFF文件，将生成无基因注释的图"</span>
    <span class="token assign-left variable">GFF_FILE_PATH</span><span class="token operator">=</span><span class="token string">""</span>
<span class="token keyword">fi</span>

<span class="token comment"># 步骤2: 提取显著SNP</span>
<span class="token builtin class-name">echo</span> <span class="token string">"步骤2: 提取显著SNP..."</span>
<span class="token function">awk</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">chrom</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$CHROM</span>"</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">start</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$REGION_START</span>"</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">end</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$REGION_END</span>"</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">threshold</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$SIGNIFICANCE_THRESHOLD</span>"</span> <span class="token string">'
BEGIN {FS="\t"; OFS="\t"}
$1 == chrom &amp;&amp; $2 &gt;= start &amp;&amp; $2 &lt;= end &amp;&amp; $5 &lt; threshold {
    print $0
}'</span> <span class="token punctuation">..</span>/color_GWAS.anno.xls <span class="token operator">&gt;</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_significant_snps.txt"</span>

<span class="token assign-left variable">SNP_COUNT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">wc</span> <span class="token parameter variable">-l</span> <span class="token operator">&lt;</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_significant_snps.txt"</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">"0"</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"找到 <span class="token variable">$SNP_COUNT</span> 个显著SNP (P &lt; <span class="token variable">$SIGNIFICANCE_THRESHOLD</span>)"</span>

<span class="token builtin class-name">echo</span> <span class="token string">"=== 阶段2: 完整LD分析 ==="</span>

<span class="token comment"># 步骤3: 提取VCF数据</span>
<span class="token builtin class-name">echo</span> <span class="token string">"步骤3: 提取VCF数据..."</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_significant_snps.txt"</span> <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$SNP_COUNT</span>"</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token comment"># 创建BED文件提取显著SNP</span>
    <span class="token function">awk</span> <span class="token parameter variable">-v</span> <span class="token assign-left variable">chrom</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$CHROM</span>"</span> <span class="token string">'{print chrom "\t" ($2-1) "\t" $2}'</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_significant_snps.txt"</span> <span class="token operator">&gt;</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_snps.bed"</span>
    bcftools view <span class="token parameter variable">-T</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_snps.bed"</span> <span class="token string">"<span class="token variable">$VCF_FILE</span>"</span> <span class="token parameter variable">-Ov</span> <span class="token parameter variable">-o</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_significant.vcf"</span>
<span class="token keyword">else</span>
    <span class="token comment"># 如果无显著SNP，提取整个区域</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"提取整个区域VCF数据..."</span>
    bcftools view <span class="token parameter variable">-r</span> <span class="token string">"<span class="token variable">${CHROM}</span>:<span class="token variable">${REGION_START}</span>-<span class="token variable">${REGION_END}</span>"</span> <span class="token string">"<span class="token variable">$VCF_FILE</span>"</span> <span class="token parameter variable">-Ov</span> <span class="token parameter variable">-o</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_significant.vcf"</span>
<span class="token keyword">fi</span>

<span class="token assign-left variable">EXTRACTED_COUNT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"^#"</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_significant.vcf"</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">"0"</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"提取到 <span class="token variable">$EXTRACTED_COUNT</span> 个SNP"</span>

<span class="token comment"># 修复样本名和染色体</span>
<span class="token builtin class-name">echo</span> <span class="token string">"修复样本名和染色体..."</span>
bcftools query <span class="token parameter variable">-l</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_significant.vcf"</span> <span class="token operator">&gt;</span> original_samples.txt
<span class="token function">sed</span> <span class="token string">'s/_/-/g'</span> original_samples.txt <span class="token operator">&gt;</span> new_samples.txt
bcftools reheader <span class="token parameter variable">-s</span> new_samples.txt <span class="token string">"<span class="token variable">${REGION_NAME}</span>_significant.vcf"</span> <span class="token parameter variable">-o</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_fixed_samples.vcf"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$CHROM</span> 1"</span> <span class="token operator">&gt;</span> chr_map.txt
bcftools annotate --rename-chrs chr_map.txt <span class="token string">"<span class="token variable">${REGION_NAME}</span>_fixed_samples.vcf"</span> <span class="token parameter variable">-Ov</span> <span class="token parameter variable">-o</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_numeric.vcf"</span>

<span class="token comment"># 压缩和索引</span>
bgzip <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_numeric.vcf"</span>
tabix <span class="token parameter variable">-p</span> vcf <span class="token string">"<span class="token variable">${REGION_NAME}</span>_numeric.vcf.gz"</span>

<span class="token comment"># 步骤4: 使用PLINK进行LD分析</span>
<span class="token builtin class-name">echo</span> <span class="token string">"步骤4: PLINK LD分析..."</span>
plink <span class="token parameter variable">--vcf</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_numeric.vcf.gz"</span> <span class="token punctuation">\</span>
      --allow-extra-chr <span class="token punctuation">\</span>
      --double-id <span class="token punctuation">\</span>
      <span class="token parameter variable">--r2</span> <span class="token punctuation">\</span>
      --ld-window <span class="token number">1000</span> <span class="token punctuation">\</span>
      --ld-window-kb <span class="token number">10000</span> <span class="token punctuation">\</span>
      --ld-window-r2 <span class="token number">0</span> <span class="token punctuation">\</span>
      <span class="token parameter variable">--out</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_plink_ld"</span> 

<span class="token builtin class-name">echo</span> <span class="token string">"=== 阶段3: 生成高质量LocusZoom图 ==="</span>

<span class="token comment"># 步骤5: 生成高质量LocusZoom图</span>
<span class="token builtin class-name">echo</span> <span class="token string">"步骤5: 生成高质量LocusZoom图..."</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> generate_high_quality_locuszoom.R <span class="token operator">&lt;&lt;</span> <span class="token string">EOF3
#!/usr/bin/env Rscript
library(ggplot2)
library(patchwork)
library(viridis)

cat("生成高质量LocusZoom图...<span class="token entity" title="\n">\n</span>")

args &lt;- commandArgs(trailingOnly = TRUE)
region_name &lt;- args[1]
region_start &lt;- as.numeric(args[2])
region_end &lt;- as.numeric(args[3])
significance_threshold &lt;- as.numeric(args[4])

cat("区域:", region_name, "<span class="token entity" title="\n">\n</span>")
cat("位置范围:", region_start, "-", region_end, "<span class="token entity" title="\n">\n</span>")
cat("显著性阈值:", significance_threshold, "<span class="token entity" title="\n">\n</span>")

# 读取显著SNP数据
sig_file &lt;- paste0(region_name, "_significant_snps.txt")
if(file.exists(sig_file) &amp;&amp; file.info(sig_file)\<span class="token variable">$size</span> &gt; 0) {
    cat("读取显著SNP文件:", sig_file, "<span class="token entity" title="\n">\n</span>")
    sig_snps &lt;- read.table(sig_file, sep="<span class="token entity" title="\t">\t</span>", header=FALSE,
                          col.names=c("CHROM","POS","REF","ALT","PVALUE","OBS","MAF","ANNO","GENE"))
    # 处理可能的NA值
    sig_snps\<span class="token variable">$PVALUE</span> &lt;- as.numeric(as.character(sig_snps\<span class="token variable">$PVALUE</span>))
    sig_snps\<span class="token variable">$MAF</span> &lt;- as.numeric(as.character(sig_snps\<span class="token variable">$MAF</span>))
    
    # 移除NA值
    sig_snps &lt;- sig_snps[!is.na(sig_snps\<span class="token variable">$PVALUE</span>) &amp; !is.na(sig_snps\<span class="token variable">$MAF</span>), ]
    
    cat("有效显著SNP数量:", nrow(sig_snps), "<span class="token entity" title="\n">\n</span>")
    
    if(nrow(sig_snps) &gt; 0) {
        # 创建专业LocusZoom图 - 上部：GWAS信号
        p1 &lt;- ggplot(sig_snps, aes(x = POS/1e6, y = -log10(PVALUE))) +
            geom_point(aes(color = ANNO, size = MAF), alpha = 0.8) +
            geom_hline(yintercept = -log10(significance_threshold), color = "red", linetype = "dashed", linewidth = 1) +
            scale_color_viridis_d(name = "注释类型") +
            scale_size_continuous(name = "MAF", range = c(3, 8)) +
            labs(title = paste("LocusZoom图 -", region_name),
                 subtitle = paste(nrow(sig_snps), "个显著SNP (P &lt;", format(significance_threshold, scientific=TRUE), ")"),
                 x = "", y = "-log10(P值)") +
            theme_minimal() +
            theme(legend.position = "top",
                  plot.title = element_text(size = 14, face = "bold"),
                  plot.subtitle = element_text(size = 12))
        
        # 下部：LD热图
        ld_file &lt;- paste0(region_name, "_plink_ld.ld")
        if(file.exists(ld_file) &amp;&amp; file.info(ld_file)\<span class="token variable">$size</span> &gt; 0) {
            cat("读取LD文件:", ld_file, "<span class="token entity" title="\n">\n</span>")
            ld_data &lt;- read.table(ld_file, header=TRUE)
            cat("LD数据记录数:", nrow(ld_data), "<span class="token entity" title="\n">\n</span>")
            
            if(nrow(ld_data) &gt; 0) {
                p2 &lt;- ggplot(ld_data, aes(x = BP_A/1e6, y = BP_B/1e6, color = R2)) +
                    geom_point(size = 3, alpha = 0.7) +
                    scale_color_viridis_c(name = "LD (R²)", limits = c(0, 1)) +
                    labs(x = "基因组位置 (Mb)", y = "基因组位置 (Mb)",
                         subtitle = "LD热图") +
                    theme_minimal()
            } else {
                p2 &lt;- ggplot() +
                    annotate("text", x = 0.5, y = 0.5, label = "LD数据为空", size = 6, color = "gray") +
                    labs(x = "基因组位置 (Mb)", y = "基因组位置 (Mb)") +
                    theme_void()
            }
        } else {
            p2 &lt;- ggplot() +
                annotate("text", x = 0.5, y = 0.5, label = "LD热图数据缺失", size = 6, color = "gray") +
                labs(x = "基因组位置 (Mb)", y = "基因组位置 (Mb)") +
                theme_void()
        }
        
        # 组合图形
        combined &lt;- p1 / p2 + 
            plot_layout(heights = c(1, 1))
        
        output_file &lt;- paste0("High_Quality_LocusZoom_", region_name, ".png")
        ggsave(output_file, combined, width = 12, height = 10, dpi = 300, bg = "white")
        cat("✓ 高质量LocusZoom图生成完成:", output_file, "<span class="token entity" title="\n">\n</span>")
        
    } else {
        cat("无有效显著SNP数据<span class="token entity" title="\n">\n</span>")
    }
} else {
    cat("显著SNP文件不存在或为空<span class="token entity" title="\n">\n</span>")
}

cat("✓ 高质量LocusZoom图生成完成<span class="token entity" title="\n">\n</span>")
EOF3</span>

Rscript generate_high_quality_locuszoom.R <span class="token string">"<span class="token variable">$REGION_NAME</span>"</span> <span class="token string">"<span class="token variable">$REGION_START</span>"</span> <span class="token string">"<span class="token variable">$REGION_END</span>"</span> <span class="token string">"<span class="token variable">$SIGNIFICANCE_THRESHOLD</span>"</span>

<span class="token builtin class-name">echo</span> <span class="token string">"=== 阶段4: 生成脚本4风格完整图 ==="</span>

<span class="token comment"># 步骤6: 准备GWAS文件</span>
<span class="token builtin class-name">echo</span> <span class="token string">"步骤6: 准备GWAS文件..."</span>
<span class="token function">awk</span> <span class="token string">'{print $1, $2, $5}'</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_significant_snps.txt"</span> <span class="token operator">&gt;</span> gwas_significant.pvalue

<span class="token comment"># 步骤7: 使用脚本4的完整方案生成图片</span>
<span class="token builtin class-name">echo</span> <span class="token string">"步骤7: 使用脚本4的完整方案生成图片..."</span>

<span class="token comment"># 直接运行，让LDBlockShow自己处理</span>
LDBlockShow <span class="token parameter variable">-InVCF</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_significant.vcf"</span> <span class="token punctuation">\</span>
            <span class="token parameter variable">-OutPut</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_LD"</span> <span class="token punctuation">\</span>
            <span class="token parameter variable">-InGWAS</span> <span class="token string">"gwas_significant.pvalue"</span> <span class="token punctuation">\</span>
            <span class="token parameter variable">-Region</span> <span class="token string">"<span class="token variable">${CHROM}</span>:<span class="token variable">${REGION_START}</span>:<span class="token variable">${REGION_END}</span>"</span> <span class="token punctuation">\</span>
            <span class="token parameter variable">-SeleVar</span> <span class="token number">3</span> <span class="token punctuation">\</span>
            <span class="token parameter variable">-OutPng</span> <span class="token punctuation">\</span>
            <span class="token parameter variable">-BlockType</span> <span class="token number">2</span> <span class="token punctuation">\</span>
            <span class="token parameter variable">-MAF</span> <span class="token number">0.05</span>

<span class="token comment"># 检查生成结果</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_LD.png"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"✓ 脚本4风格完整图生成成功: <span class="token variable">${REGION_NAME}</span>_LD.png"</span>
    <span class="token comment"># 复制一份作为最终结果</span>
    <span class="token function">cp</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_LD.png"</span> <span class="token string">"Script4_Complete_<span class="token variable">${REGION_NAME}</span>.png"</span>
<span class="token keyword">else</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"✗ 脚本4风格生成失败，尝试备选方案..."</span>
    
    <span class="token comment"># 备选方案：使用简化版本</span>
    LDBlockShow <span class="token parameter variable">-InVCF</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_significant.vcf"</span> <span class="token punctuation">\</span>
                <span class="token parameter variable">-OutPut</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_LD_simple"</span> <span class="token punctuation">\</span>
                <span class="token parameter variable">-Region</span> <span class="token string">"<span class="token variable">${CHROM}</span>:<span class="token variable">${REGION_START}</span>:<span class="token variable">${REGION_END}</span>"</span> <span class="token punctuation">\</span>
                <span class="token parameter variable">-SeleVar</span> <span class="token number">2</span> <span class="token punctuation">\</span>
                <span class="token parameter variable">-OutPng</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"Warning"</span> <span class="token operator">||</span> <span class="token boolean">true</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_LD_simple.png"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token function">cp</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_LD_simple.png"</span> <span class="token string">"Script4_Complete_<span class="token variable">${REGION_NAME}</span>.png"</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"✓ 使用简化版作为备选"</span>
    <span class="token keyword">fi</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token string">"=== 阶段5: 生成R版本备选图 ==="</span>

<span class="token comment"># 步骤8: 生成R_LocusZoom_Style.png作为备选</span>
<span class="token builtin class-name">echo</span> <span class="token string">"步骤8: 生成R_LocusZoom_Style.png作为备选..."</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> generate_r_locuszoom.R <span class="token operator">&lt;&lt;</span> <span class="token string">EOF2
#!/usr/bin/env Rscript
library(ggplot2)
library(gridExtra)
library(patchwork)

cat("创建R版LocusZoom风格图...<span class="token entity" title="\n">\n</span>")

args &lt;- commandArgs(trailingOnly = TRUE)
region_name &lt;- args[1]
region_start &lt;- as.numeric(args[2])
region_end &lt;- as.numeric(args[3])
significance_threshold &lt;- as.numeric(args[4])

cat("区域:", region_name, "<span class="token entity" title="\n">\n</span>")
cat("位置:", region_start, "-", region_end, "<span class="token entity" title="\n">\n</span>")
cat("显著性阈值:", significance_threshold, "<span class="token entity" title="\n">\n</span>")

# 读取GWAS数据
gwas_file &lt;- paste0(region_name, "_significant_snps.txt")
if(file.exists(gwas_file)) {
    gwas &lt;- read.table(gwas_file, sep="<span class="token entity" title="\t">\t</span>", header=FALSE,
                      col.names=c("CHROM","POS","REF","ALT","PVALUE","OBS","MAF","ANNO","GENE"))
    gwas\<span class="token variable">$PVALUE</span> &lt;- as.numeric(gwas\<span class="token variable">$PVALUE</span>)
    
    cat("区域内的GWAS SNP数量:", nrow(gwas), "<span class="token entity" title="\n">\n</span>")
    
    if(nrow(gwas) &gt; 0) {
        # 创建综合图
        p1 &lt;- ggplot(gwas, aes(x = POS/1e6, y = -log10(PVALUE))) +
            geom_point(aes(color = ANNO), size = 3, alpha = 0.7) +
            geom_hline(yintercept = -log10(significance_threshold), color = "red", linetype = "dashed", linewidth = 1) +
            scale_color_brewer(palette = "Set1", name = "注释类型") +
            labs(title = paste("GWAS信号 -", region_name, "(P &lt;", format(significance_threshold, scientific=TRUE), ")"),
                 x = "", y = "-log10(P值)") +
            theme_minimal() +
            theme(axis.text.x = element_blank())
        
        # 读取LD数据
        ld_file &lt;- paste0(region_name, "_plink_ld.ld")
        if(file.exists(ld_file)) {
            ld_data &lt;- read.table(ld_file, header = TRUE)
            
            p2 &lt;- ggplot(ld_data, aes(x = BP_A/1e6, y = BP_B/1e6, color = R2)) +
                geom_point(size = 2, alpha = 0.7) +
                scale_color_gradient2(name = "R²", low = "blue", mid = "yellow", high = "red", midpoint = 0.5, limits = c(0, 1)) +
                labs(x = "基因组位置 (Mb)", y = "基因组位置 (Mb)") +
                theme_minimal()
        } else {
            p2 &lt;- ggplot() + 
                geom_text(aes(x = 0.5, y = 0.5, label = "无LD数据")) +
                labs(x = "基因组位置 (Mb)", y = "基因组位置 (Mb)") +
                theme_minimal()
        }
        
        # 组合图形
        combined_plot &lt;- p1 / p2 + 
            plot_layout(heights = c(1, 1))
        
        ggsave("R_LocusZoom_Style.png", combined_plot, width = 10, height = 8, dpi = 300)
        cat("✓ R版LocusZoom风格图生成完成: R_LocusZoom_Style.png<span class="token entity" title="\n">\n</span>")
    } else {
        cat("错误: 在指定区域内未找到GWAS数据<span class="token entity" title="\n">\n</span>")
    }
} else {
    cat("错误: 未找到GWAS文件<span class="token entity" title="\n">\n</span>")
}
EOF2</span>

Rscript generate_r_locuszoom.R <span class="token string">"<span class="token variable">$REGION_NAME</span>"</span> <span class="token string">"<span class="token variable">$REGION_START</span>"</span> <span class="token string">"<span class="token variable">$REGION_END</span>"</span> <span class="token string">"<span class="token variable">$SIGNIFICANCE_THRESHOLD</span>"</span>

<span class="token builtin class-name">echo</span> <span class="token string">"=== 阶段6: 清理和总结 ==="</span>

<span class="token comment"># 清理临时文件</span>
<span class="token builtin class-name">echo</span> <span class="token string">"清理临时文件..."</span>
<span class="token function">rm</span> <span class="token parameter variable">-f</span> original_samples.txt new_samples.txt chr_map.txt <span class="token punctuation">\</span>
      original_samples_all.txt new_samples_all.txt <span class="token punctuation">\</span>
      <span class="token string">"<span class="token variable">${REGION_NAME}</span>_significant.vcf"</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_fixed_samples.vcf"</span> <span class="token punctuation">\</span>
      <span class="token string">"<span class="token variable">${REGION_NAME}</span>_numeric.vcf.gz"</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_numeric.vcf.gz.tbi"</span> <span class="token punctuation">\</span>
      <span class="token string">"<span class="token variable">${REGION_NAME}</span>_snps.bed"</span> gwas_significant.pvalue genomic.gff <span class="token punctuation">\</span>
      generate_high_quality_locuszoom.R generate_r_locuszoom.R <span class="token punctuation">\</span>
      <span class="token string">"<span class="token variable">${REGION_NAME}</span>_all_snps.vcf.gz"</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_all_snps.vcf.gz.tbi"</span> <span class="token punctuation">\</span>
      <span class="token string">"<span class="token variable">${REGION_NAME}</span>_all_snps_fixed.vcf.gz"</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_all_snps_fixed.vcf.gz.tbi"</span> <span class="token punctuation">\</span>
      <span class="token string">"<span class="token variable">${REGION_NAME}</span>_LD.png"</span> <span class="token string">"<span class="token variable">${REGION_NAME}</span>_LD_simple.png"</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null <span class="token operator">||</span> <span class="token boolean">true</span>

<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"=== 综合分析完成! ==="</span>
<span class="token builtin class-name">echo</span> <span class="token string">"📁 工作目录: <span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"📊 生成的所有图片文件:"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"=== 高质量LocusZoom图 (R版本) ==="</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> High_Quality_LocusZoom_*.png<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">size_kb</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">du</span> <span class="token parameter variable">-k</span> <span class="token string">"<span class="token variable">$file</span>"</span> <span class="token operator">|</span> <span class="token function">cut</span> <span class="token parameter variable">-f1</span><span class="token variable">)</span></span>
        <span class="token builtin class-name">echo</span> <span class="token string">"   📄 <span class="token variable">$file</span> (<span class="token variable">${size_kb}</span> KB)"</span>
    <span class="token keyword">fi</span>
<span class="token keyword">done</span>

<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"=== 脚本4风格完整图 ==="</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> Script4_Complete_*.png<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">size_kb</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">du</span> <span class="token parameter variable">-k</span> <span class="token string">"<span class="token variable">$file</span>"</span> <span class="token operator">|</span> <span class="token function">cut</span> <span class="token parameter variable">-f1</span><span class="token variable">)</span></span>
        <span class="token builtin class-name">echo</span> <span class="token string">"   📄 <span class="token variable">$file</span> (<span class="token variable">${size_kb}</span> KB) - 推荐使用"</span>
    <span class="token keyword">fi</span>
<span class="token keyword">done</span>

<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"=== 其他备选图 ==="</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">file</span> <span class="token keyword">in</span> R_LocusZoom_Style.png<span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">$file</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">size_kb</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">du</span> <span class="token parameter variable">-k</span> <span class="token string">"<span class="token variable">$file</span>"</span> <span class="token operator">|</span> <span class="token function">cut</span> <span class="token parameter variable">-f1</span><span class="token variable">)</span></span>
        <span class="token builtin class-name">echo</span> <span class="token string">"   📄 <span class="token variable">$file</span> (<span class="token variable">${size_kb}</span> KB)"</span>
    <span class="token keyword">fi</span>
<span class="token keyword">done</span>

<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"🔍 分析摘要:"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   显著SNP: <span class="token variable">$SNP_COUNT</span> 个 (P &lt; <span class="token variable">$SIGNIFICANCE_THRESHOLD</span>)"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   成功提取: <span class="token variable">$EXTRACTED_COUNT</span> 个SNP"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   区域SNP: <span class="token variable">$FINAL_SNP_COUNT</span> 个 (用于LDBlockShow)"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   使用参数:"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"     - 显著性阈值: <span class="token variable">$SIGNIFICANCE_THRESHOLD</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"     - MAF过滤: <span class="token variable">$MAF_FILTER</span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   推荐图片:"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"     - Script4_Complete_<span class="token variable">${REGION_NAME}</span>.png (脚本4风格，一气呵成)"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"     - High_Quality_LocusZoom_<span class="token variable">${REGION_NAME}</span>.png (高质量R版本)"</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"✅ 所有图片生成完成!"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-none"><code class="language-none"># 给脚本执行权限
chmod +x 4.auto_gwas_hotspot_ld.sh

# 用法1: 使用默认VCF文件分析热点区域
./4.auto_gwas_hotspot_ld.sh "hotspot_31.5_32.0Mb" "NC_047567.1" 31500000 32000000<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="📚-七、总结"><a href="#📚-七、总结" class="headerlink" title="📚 七、总结"></a>📚 七、总结</h2><p>本流程将传统 GWAS 结果从“显著性点的罗列”提升为“聚集信号的结构化分析”，实现了：</p>
<ul>
<li>🔹 从单点显著到区域热点的层级聚焦；</li>
<li>🔹 自动化 R + Shell 流程，避免人工重复操作；</li>
<li>🔹 为 LD block、候选基因挖掘提供清晰的定位依据。</li>
</ul>
<p>这套框架可无缝迁移至任意物种或 GWAS 项目，只需更换输入文件与染色体名称即可快速运行。</p>
<blockquote>
<p>💡 <strong>关键词：</strong> GWAS、热点区域、LD Block、显著性SNP、R可视化</p>
</blockquote>
<hr>
]]></content>
      <categories>
        <category>生物信息</category>
      </categories>
      <tags>
        <tag>Linux</tag>
        <tag>GWAS</tag>
      </tags>
  </entry>
  <entry>
    <title>Hexo + Butterfly 个人博客搭建</title>
    <url>/2025/10/09/hexo-butterfly-ge-ren-bo-ke-da-jian/</url>
    <content><![CDATA[<h1 id="Hexo-Butterfly-个人博客搭建"><a href="#Hexo-Butterfly-个人博客搭建" class="headerlink" title="Hexo + Butterfly 个人博客搭建"></a>Hexo + Butterfly 个人博客搭建</h1><p>在用了一周左右的时间搭建博客，沉浸于试效果、改 bug、试效果、改 bug……的循环后，我还是决定写一篇文章来记录一下，省得未来的自己再走一遍这痛苦的过程。</p>
<hr>
<h2 id="一、Hexo-静态网页生成"><a href="#一、Hexo-静态网页生成" class="headerlink" title="一、Hexo 静态网页生成"></a>一、Hexo 静态网页生成</h2><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/cmd.png" alt="cmd"></p>
<h3 id="1-Node-js-安装"><a href="#1-Node-js-安装" class="headerlink" title="1. Node.js 安装!"></a>1. Node.js 安装!</h3><p>首先我们需要下载 Node.js<br>👉 <a href="https://nodejs.org/">Node.js — 在任何地方运行 JavaScript</a></p>
<p>安装好之后我们可以输入以下指令，如果都能正常输出版本号则安装成功。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">node</span> <span class="token parameter variable">-v</span>
<span class="token function">npm</span> <span class="token parameter variable">-v</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<hr>
<h3 id="2-Git-安装"><a href="#2-Git-安装" class="headerlink" title="2. Git 安装"></a>2. Git 安装</h3><p>Git 可是个好东西，程序员必备。<br>官网在这里：<a href="https://git-scm.com/downloads">Git - Downloading Package</a></p>
<p>验证是否安装成功：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> <span class="token parameter variable">--version</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>正常显示版本即可。</p>
<hr>
<h3 id="3-Hexo-安装"><a href="#3-Hexo-安装" class="headerlink" title="3. Hexo 安装"></a>3. Hexo 安装</h3><p>在自己心仪的文件夹下（如 <code>E:/hexo</code>），鼠标右击选择 <strong>Git Bash Here</strong>，依次执行以下命令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-cli <span class="token parameter variable">-g</span>
<span class="token function">npm</span> <span class="token function">install</span> hexo <span class="token parameter variable">--save</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>如果已经安装过 hexo 或不确定装没装过也没关系，装过的执行完会显示 <em>update</em>。</p>
<p>查看版本：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo <span class="token parameter variable">-v</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>正常显示版本号说明安装成功。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251009212637204.png" alt="image-20251009212637204"></p>
<hr>
<h2 id="二、Hexo-初始化"><a href="#二、Hexo-初始化" class="headerlink" title="二、Hexo 初始化"></a>二、Hexo 初始化</h2><p>首先确保你要存放 Hexo 博客的文件夹下是空的。<br>随后在该文件夹右键选择 <strong>Git Bash Here</strong>，执行：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>执行完毕后就能看到 Hexo 框架的文件结构。</p>
<p>生成一个初始页面测试：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo g <span class="token operator">&amp;&amp;</span> hexo s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>在页面启动后，按住 <strong>Ctrl</strong> 点击终端中显示的<br><code>http://localhost:4000/</code>  即可自动跳转至浏览器预览。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251009212745176.png" alt="image-20251009212745176"></p>
<p>当你看到 Hexo 从地平线升起时，你就成功创建了一个本地静态博客网页。</p>
<hr>
<h2 id="三、部署到-GitHub"><a href="#三、部署到-GitHub" class="headerlink" title="三、部署到 GitHub"></a>三、部署到 GitHub</h2><h3 id="1-创建仓库"><a href="#1-创建仓库" class="headerlink" title="1. 创建仓库"></a>1. 创建仓库</h3><p>在 GitHub 创建一个公共仓库，命名为：</p>
<pre class="line-numbers language-none"><code class="language-none">username.github.io<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="2-配置账户并生成-SSH-密钥"><a href="#2-配置账户并生成-SSH-密钥" class="headerlink" title="2. 配置账户并生成 SSH 密钥"></a>2. 配置账户并生成 SSH 密钥</h3><p>在 Git Bash 中输入以下指令：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config <span class="token parameter variable">--global</span> user.name <span class="token string">"XXXX"</span>                       <span class="token comment"># 配置个人信息-username</span>
<span class="token function">git</span> config <span class="token parameter variable">--global</span> user.email <span class="token string">"XXXXXXXXX@XXX.com"</span>         <span class="token comment"># 配置个人信息-useremail</span>
ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-C</span> <span class="token string">"XXXXXXXXX@XXX.com"</span>	               <span class="token comment"># 生成密钥</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>生成过程中直接回车直到完成即可。<br>默认路径为：</p>
<pre class="line-numbers language-none"><code class="language-none">C:\Users\用户名\.ssh\id_rsa.pub<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>打开 GitHub 设置 → 添加 SSH 密钥 → 将文件内容粘贴进去。</p>
<hr>
<h3 id="3-添加密钥到本地-Git"><a href="#3-添加密钥到本地-Git" class="headerlink" title="3. 添加密钥到本地 Git"></a>3. 添加密钥到本地 Git</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">eval</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>ssh-agent <span class="token parameter variable">-s</span><span class="token variable">)</span></span>"</span>
ssh-add ~/.ssh/id_rsa<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>测试连接：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> <span class="token parameter variable">-T</span> git@github.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>若得到以下回复则说明连接成功。</p>
<pre class="line-numbers language-text" data-language="text"><code class="language-text">Hi username! You've successfully authenticated...<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h3 id="4-确保使用正确的密钥"><a href="#4-确保使用正确的密钥" class="headerlink" title="4. 确保使用正确的密钥"></a>4. 确保使用正确的密钥</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config <span class="token parameter variable">--global</span> core.sshCommand <span class="token string">"ssh -i ~/.ssh/id_rsa"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>若出现以下错误：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">The authenticity of <span class="token function">host</span> <span class="token string">'github.com (20.205.243.166)'</span> can't be established.
Host key verification failed.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>说明 SSH 客户端未信任 GitHub 的主机密钥。执行以下命令修复：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">touch</span> ~/.ssh/known_hosts
<span class="token function">chmod</span> <span class="token number">644</span> ~/.ssh/known_hosts
ssh-keyscan <span class="token parameter variable">-t</span> ed25519 github.com <span class="token operator">&gt;&gt;</span> ~/.ssh/known_hosts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>再次执行 <code>ssh -T git@github.com</code> 即可。</p>
<hr>
<h3 id="5-修改-Hexo-配置文件"><a href="#5-修改-Hexo-配置文件" class="headerlink" title="5. 修改 Hexo 配置文件"></a>5. 修改 Hexo 配置文件</h3><p>打开站点配置文件 <code>_config.yml</code>，修改 <code>deploy</code> 部分如下：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Deployment</span>
<span class="token comment">## Docs: https://hexo.io/docs/deployment.html</span>
<span class="token key atrule">deploy</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> git
  <span class="token key atrule">repo</span><span class="token punctuation">:</span> git@github.com<span class="token punctuation">:</span>XXXXX/XXXXX.github.io.git
  <span class="token key atrule">branch</span><span class="token punctuation">:</span> main<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后执行 Hexo 三连：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo cl <span class="token operator">&amp;&amp;</span> hexo g <span class="token operator">&amp;&amp;</span> hexo d<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>此时即可通过：</p>
<pre class="line-numbers language-none"><code class="language-none">https://username.github.io<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>访问你的博客啦！</p>
<hr>
<h2 id="四、安装-Butterfly-主题"><a href="#四、安装-Butterfly-主题" class="headerlink" title="四、安装 Butterfly 主题"></a>四、安装 Butterfly 主题</h2><h3 id="1-下载主题文件"><a href="#1-下载主题文件" class="headerlink" title="1. 下载主题文件"></a>1. 下载主题文件</h3><p>在 Git 中执行以下命令安装 Butterfly 主题：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/jerryc127/hexo-theme-butterfly.git themes/butterfly<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>如果没有修改代码的需求，也可以使用 npm 安装：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i hexo-theme-butterfly<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h3 id="2-安装渲染器"><a href="#2-安装渲染器" class="headerlink" title="2. 安装渲染器"></a>2. 安装渲染器</h3><p>Butterfly 主题依赖 <code>pug</code> 和 <code>stylus</code> 渲染器，否则启动后访问会报错。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-renderer-pug hexo-renderer-stylus <span class="token parameter variable">--save</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h3 id="3-启用主题"><a href="#3-启用主题" class="headerlink" title="3. 启用主题"></a>3. 启用主题</h3><p>在站点配置文件 <code>_config.yml</code> 中找到 <code>theme</code> 字段，修改为：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">theme: butterfly<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后再次 Hexo 三连：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hexo cl <span class="token operator">&amp;&amp;</span> hexo g <span class="token operator">&amp;&amp;</span> hexo s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>就完成了主题替换！</p>
<hr>
<h2 id="五、Butterfly-主题美化"><a href="#五、Butterfly-主题美化" class="headerlink" title="五、Butterfly 主题美化"></a>五、Butterfly 主题美化</h2><h3 id="1-网站资料修改"><a href="#1-网站资料修改" class="headerlink" title="1. 网站资料修改"></a>1. 网站资料修改</h3><p>修改网站标题、副标题、邮箱等个人信息，编辑 <code>_config.yml</code> 中对应字段。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>title</td>
<td>网站标题</td>
</tr>
<tr>
<td>subtitle</td>
<td>描述</td>
</tr>
<tr>
<td>description</td>
<td>网站描述</td>
</tr>
<tr>
<td>keywords</td>
<td>网站关键词，支持多个</td>
</tr>
<tr>
<td>author</td>
<td>作者名</td>
</tr>
<tr>
<td>language</td>
<td>网站语言（常用 zh-Hans 或 zh-CN）</td>
</tr>
<tr>
<td>timezone</td>
<td>时区（如 Asia/Shanghai）</td>
</tr>
</tbody></table>
<hr>
<h3 id="2-背景图片"><a href="#2-背景图片" class="headerlink" title="2. 背景图片"></a>2. 背景图片</h3><p>修改 <code>_config.yml</code> 中的 <code>background</code> 字段即可。</p>
<h3 id="3-网站副标题"><a href="#3-网站副标题" class="headerlink" title="3. 网站副标题"></a>3. 网站副标题</h3><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/a5601f8f68744cfe4195f6e04cd5b58e.gif" alt="img"><br>启用首页副标题，启用打字机效果，以及相关配置。<br>博客根目录下<code>_config.butterfly.yml</code>文件。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 首页副标题设置</span>
<span class="token key atrule">subtitle</span><span class="token punctuation">:</span>
  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>       <span class="token comment"># 是否启用副标题</span>
  <span class="token key atrule">effect</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>       <span class="token comment"># 是否启用打字机效果</span>
  <span class="token key atrule">loop</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>         <span class="token comment"># 是否循环播放打字机效果</span>
  <span class="token comment"># 自定义打字机效果配置（基于typed.js）</span>
  <span class="token comment"># 官方配置文档：https://github.com/mattboldt/typed.js/#customization</span>
  <span class="token key atrule">typed_option</span><span class="token punctuation">:</span>
  <span class="token comment"># 第三方文案来源（目前仅支持中文）</span>
  <span class="token comment"># 会先显示来源标识，再显示下方sub中的内容</span>
  <span class="token comment"># 可选值：false/1/2/3</span>
  <span class="token comment"># false - 禁用此功能</span>
  <span class="token comment"># 1 - 使用 hitokoto.cn 的API</span>
  <span class="token comment"># 2 - 使用 https://api.aa1.cn/doc/yiyan.html 的API</span>
  <span class="token comment"># 3 - 使用 jinrishici.com 的API</span>
  <span class="token key atrule">source</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># 如果关闭打字机效果，将只显示sub中的第一条内容</span>
  <span class="token key atrule">sub</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">'&lt;i class="fas fa-quote-left"&gt;&lt;/i&gt; 学无止境'</span>
    <span class="token punctuation">-</span> <span class="token string">'&lt;i class="fas fa-quote-left"&gt;&lt;/i&gt; 千里之行，始于足下 —— 老子'</span>
    <span class="token punctuation">-</span> <span class="token string">'&lt;i class="fas fa-quote-left"&gt;&lt;/i&gt; 读书破万卷，下笔如有神'</span>
    <span class="token punctuation">-</span> <span class="token string">'&lt;i class="fas fa-quote-left"&gt;&lt;/i&gt; 吾日三省吾身'</span>
    <span class="token punctuation">-</span> <span class="token string">'&lt;i class="fas fa-quote-left"&gt;&lt;/i&gt; 星光不问赶路人，时光不负有心人'</span>
    <span class="token punctuation">-</span> <span class="token string">'&lt;i class="fas fa-quote-left"&gt;&lt;/i&gt; 人生没有白走的路，每一步都算数'</span>
    <span class="token punctuation">-</span> <span class="token string">'&lt;i class="fas fa-quote-left"&gt;&lt;/i&gt; 保持热爱，奔赴山海'</span>
    <span class="token punctuation">-</span> <span class="token string">'&lt;i class="fas fa-quote-left"&gt;&lt;/i&gt; 纸上得来终觉浅，绝知此事要躬行'</span>
    <span class="token punctuation">-</span> <span class="token string">'&lt;i class="fas fa-quote-left"&gt;&lt;/i&gt; 成功的秘诀在于坚持'</span>
    <span class="token punctuation">-</span> <span class="token string">'&lt;i class="fas fa-quote-left"&gt;&lt;/i&gt; The best way to predict the future is to invent it'</span>
    <span class="token punctuation">-</span> <span class="token string">'&lt;i class="fas fa-quote-left"&gt;&lt;/i&gt; 生活是一场马拉松，你需要不断地奔跑'</span>
    <span class="token punctuation">-</span> <span class="token string">'&lt;i class="fas fa-quote-left"&gt;&lt;/i&gt; 成功不是将来才有的，而是从决定去做的那一刻起，持续累积而成'</span>
AI写代码yaml123456789101112131415161718192021222324252627282930<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-首页文章卡片双栏布局"><a href="#4-首页文章卡片双栏布局" class="headerlink" title="4. 首页文章卡片双栏布局"></a>4. 首页文章卡片双栏布局</h3><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/f11483f270f35e41af02eb7fc2fce019.png" alt="img"><br>首页文章双栏<a href="https://so.csdn.net/so/search?q=%E5%B8%83%E5%B1%80%E8%AE%BE%E7%BD%AE&amp;spm=1001.2101.3001.7020">布局设置</a>，文章摘要显示设置。<br>博客根目录下<code>_config.butterfly.yml</code>文件的<code>首页设置</code>的相关<a href="https://so.csdn.net/so/search?q=%E4%BF%AE%E6%94%B9%E4%BB%A3%E7%A0%81&amp;spm=1001.2101.3001.7020">修改代码</a>如下：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 首页文章布局方式</span>
<span class="token comment"># 1: 封面图在左，信息在右</span>
<span class="token comment"># 2: 封面图在右，信息在左</span>
<span class="token comment"># 3: 封面图与信息左右交替排列</span>
<span class="token comment"># 4: 封面图在上，信息在下</span>
<span class="token comment"># 5: 信息直接显示在封面图上</span>
<span class="token comment"># 6: 瀑布流布局 - 封面图在上，信息在下</span>
<span class="token comment"># 7: 瀑布流布局 - 信息直接显示在封面图上</span>
<span class="token key atrule">index_layout</span><span class="token punctuation">:</span> <span class="token number">6</span>
AI写代码yaml123456789<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-首页文章摘要显示设置"><a href="#5-首页文章摘要显示设置" class="headerlink" title="5. 首页文章摘要显示设置"></a>5. 首页文章摘要显示设置</h3><p>博客根目录下<code>_config.butterfly.yml</code>文件。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># 首页文章摘要显示设置</span>
<span class="token comment"># 1: 显示文章描述的description</span>
<span class="token comment"># 2: 智能显示（存在description则显示，否则显示自动截取的内容）</span>
<span class="token comment"># 3: 自动截取内容（默认，从前N个字符截取）</span>
<span class="token comment"># false: 不显示文章摘要</span>
<span class="token key atrule">index_post_content</span><span class="token punctuation">:</span>
  <span class="token key atrule">method</span><span class="token punctuation">:</span> <span class="token number">1</span>         <span class="token comment"># 选择摘要显示方式</span>
  <span class="token key atrule">length</span><span class="token punctuation">:</span> <span class="token number">300</span>       <span class="token comment"># 当method为2或3时，指定截取长度（单位：字符）</span>
AI写代码yaml12345678<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="6-首页文章置顶轮播插件及设置"><a href="#6-首页文章置顶轮播插件及设置" class="headerlink" title="6. 首页文章置顶轮播插件及设置"></a>6. 首页文章置顶轮播插件及设置</h3><p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/07aa1c63a5e70ff25f99187f5bc8d880.gif" alt="img"></p>
<ol>
<li>安装插件</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> hexo-butterfly-swiper <span class="token parameter variable">--save</span>
AI写代码bash1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ol>
<li>在根目录的<code>_config.butterfly.yml</code>文件后添加以下代码：</li>
</ol>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># hexo-butterfly-swiper</span>
<span class="token comment"># see https://akilar.top/posts/8e1264d1/</span>
<span class="token key atrule">swiper</span><span class="token punctuation">:</span>
  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 开关</span>
  <span class="token key atrule">priority</span><span class="token punctuation">:</span> <span class="token number">5</span> <span class="token comment">#过滤器优先权</span>
  <span class="token key atrule">enable_page</span><span class="token punctuation">:</span> / <span class="token comment"># 应用页面</span>
  <span class="token key atrule">timemode</span><span class="token punctuation">:</span> date <span class="token comment">#date/updated</span>
  <span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token comment"># 挂载容器类型</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> id
    <span class="token key atrule">name</span><span class="token punctuation">:</span> recent<span class="token punctuation">-</span>posts
    <span class="token key atrule">index</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">default_descr</span><span class="token punctuation">:</span> 再怎么看我也不知道怎么描述它的啦！
  <span class="token key atrule">swiper_css</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//npm.elemecdn.com/hexo<span class="token punctuation">-</span>butterfly<span class="token punctuation">-</span>swiper/lib/swiper.min.css <span class="token comment">#swiper css依赖</span>
  <span class="token key atrule">swiper_js</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//npm.elemecdn.com/hexo<span class="token punctuation">-</span>butterfly<span class="token punctuation">-</span>swiper/lib/swiper.min.js <span class="token comment">#swiper js依赖</span>
  <span class="token key atrule">custom_css</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//npm.elemecdn.com/hexo<span class="token punctuation">-</span>butterfly<span class="token punctuation">-</span>swiper/lib/swiperstyle.css <span class="token comment"># 适配主题样式补丁</span>
  <span class="token key atrule">custom_js</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//npm.elemecdn.com/hexo<span class="token punctuation">-</span>butterfly<span class="token punctuation">-</span>swiper/lib/swiper_init.js <span class="token comment"># swiper初始化方法</span>
AI写代码yaml12345678910111213141516<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ol>
<li>在文章的头部添加属性<code>swiper_index</code>，置顶轮播图顺序，需填非负整数，数字越大越靠前</li>
</ol>
<hr>
<h3 id="7-更多美化参考"><a href="#7-更多美化参考" class="headerlink" title="7. 更多美化参考"></a>7. 更多美化参考</h3><ul>
<li><a href="https://blog.csdn.net/">【Hexo系列】【7】Butterfly主题使用及美化 - CSDN 博客</a></li>
<li><a href="https://tangzhiyuan.top/">基于 Hexo 从零开始搭建个人博客（五） | 唐志远</a></li>
<li>[butterfly主题魔改06：首页页面美化](<a href="https://blog.csdn.net/weixin_74811095/article/details/147955459#:~:text=%E6%9C%AC%E6%96%87%E4%BB%8B%E7%BB%8D%E4%BA%86%E5%A6%82%E4%BD%95%E5%AF%B9Butterfly%E4%B8%BB%E9%A2%98%E7%9A%84%E9%A6%96%E9%A1%B5%E8%BF%9B%E8%A1%8C%E7%BE%8E%E5%8C%96%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%8C%85%E6%8B%AC%E4%BB%A5%E4%B8%8B%E5%87%A0%E4%B8%AA%E6%96%B9%E9%9D%A2%E7%9A%84%E4%BF%AE%E6%94%B9%EF%BC%9A%E9%A6%96%E5%85%88%EF%BC%8C%E8%B0%83%E6%95%B4%E4%BA%86%E9%A6%96%E9%A1%B5%E9%A1%B6%E9%83%A8%E5%9B%BE%E7%9A%84%E5%A4%A7%E5%B0%8F%E5%92%8C%E4%B8%BB%E9%A1%B5%E6%A0%87%E9%A2%98%E7%9A%84%E9%A1%B6%E9%83%A8%E8%B7%9D%E7%A6%BB%EF%BC%9B%E5%85%B6%E6%AC%A1%EF%BC%8C%E5%90%AF%E7%94%A8%E4%BA%86%E7%BD%91%E7%AB%99%E5%89%AF%E6%A0%87%E9%A2%98%E5%B9%B6%E9%85%8D%E7%BD%AE%E4%BA%86%E6%89%93%E5%AD%97%E6%9C%BA%E6%95%88%E6%9E%9C%EF%BC%9B%E6%8E%A5%E7%9D%80%EF%BC%8C%E8%AE%BE%E7%BD%AE%E4%BA%86%E9%A6%96%E9%A1%B5%E6%96%87%E7%AB%A0%E5%8D%A1%E7%89%87%E7%9A%84%E5%8F%8C%E6%A0%8F%E5%B8%83%E5%B1%80%E5%92%8C%E6%91%98%E8%A6%81%E6%98%BE%E7%A4%BA%E6%96%B9%E5%BC%8F%EF%BC%9B%E6%9C%80%E5%90%8E%EF%BC%8C%E4%BB%8B%E7%BB%8D%E4%BA%86%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%E9%A6%96%E9%A1%B5%E6%96%87%E7%AB%A0%E7%BD%AE%E9%A1%B6%E8%BD%AE%E6%92%AD%E6%8F%92%E4%BB%B6%EF%BC%8C%E5%B9%B6%E6%8F%90%E4%BE%9B%E4%BA%86%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E4%BB%A3%E7%A0%81%E3%80%82,%E9%80%9A%E8%BF%87%E8%BF%99%E4%BA%9B%E6%AD%A5%E9%AA%A4%EF%BC%8C%E7%94%A8%E6%88%B7%E5%8F%AF%E4%BB%A5%E6%98%BE%E8%91%97%E6%8F%90%E5%8D%87%E5%8D%9A%E5%AE%A2%E9%A6%96%E9%A1%B5%E7%9A%84%E8%A7%86%E8%A7%89%E6%95%88%E6%9E%9C%E5%92%8C%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C%E3%80%82">https://blog.csdn.net/weixin_74811095/article/details/147955459#:~:text=本文介绍了如何对Butterfly主题的首页进行美化，主要包括以下几个方面的修改：首先，调整了首页顶部图的大小和主页标题的顶部距离；其次，启用了网站副标题并配置了打字机效果；接着，设置了首页文章卡片的双栏布局和摘要显示方式；最后，介绍了如何安装和使用首页文章置顶轮播插件，并提供了相关配置代码。,通过这些步骤，用户可以显著提升博客首页的视觉效果和用户体验。</a> _butterfly主题配置中间大标题怎么改)</li>
</ul>
<p><strong>原文链接</strong>：<a href="https://xbxyftx.top/2025/01/26/butterfly%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%96/index.html">https://xbxyftx.top/2025/01/26/butterfly%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%96/index.html</a>  </p>
]]></content>
      <categories>
        <category>默认分类</category>
      </categories>
  </entry>
  <entry>
    <title>根据SNP位点进行快速引物设计——网页版</title>
    <url>/2025/12/02/gemini/</url>
    <content><![CDATA[<blockquote>
<p>Run and deploy your AI Studio app</p>
</blockquote>
<blockquote>
<p>This contains everything you need to run your app locally.</p>
</blockquote>
<blockquote>
<p>View your app in AI Studio: <a href="https://ai.studio/apps/drive/142qvfoA6tUObrpGFY1mbNTx8p-5CW_NC">https://ai.studio/apps/drive/142qvfoA6tUObrpGFY1mbNTx8p-5CW_NC</a></p>
</blockquote>
<hr>
<h2 id="🎯-痛点与目标：为何需要快速引物设计？"><a href="#🎯-痛点与目标：为何需要快速引物设计？" class="headerlink" title="🎯 痛点与目标：为何需要快速引物设计？"></a>🎯 痛点与目标：为何需要快速引物设计？</h2><p>在基因分型（Genotyping）和分子标记开发中，<strong>SNP（Single Nucleotide Polymorphism，单核苷酸多态性）</strong>是最常用的遗传标记之一。针对某个 SNP 位点设计特异性的 PCR 引物，是后续实验（如 KASP、SNP-RFLP 或简单的 PCR 扩增）的关键第一步。</p>
<p>传统的引物设计软件（如 Primer Premier 或 Primer3）虽然功能强大，但操作流程相对复杂，且通常需要预先下载目标序列。本项目旨在利用 <strong>Google Gemini API</strong> 的强大能力，结合现代 <strong>Web 技术栈 (React/Vite)<strong>，构建一个</strong>网页版、无需安装、操作便捷</strong>的 SNP 位点引物设计工具。</p>
<hr>
<h2 id="核心功能与技术亮点-✨"><a href="#核心功能与技术亮点-✨" class="headerlink" title="核心功能与技术亮点 ✨"></a>核心功能与技术亮点 ✨</h2><p>本项目是基于 AI Studio App 模板开发的，但其核心逻辑（目前的代码段所示）主要侧重于前端实现高效的生物信息学计算和数据处理。</p>
<h3 id="1-多数据源支持"><a href="#1-多数据源支持" class="headerlink" title="1. 多数据源支持"></a>1. 多数据源支持</h3><p>为了满足不同科研场景的需求，本工具支持三种输入模式：</p>
<ul>
<li><strong>手动输入 (Manual):</strong> 直接粘贴 FASTA 格式的目标序列和 SNP 位点坐标。</li>
<li><strong>NCBI 抓取 (NCBI Fetch):</strong> 用户输入 <strong>基因组 ID (e.g., <code>GCF_902806645.1</code>)<strong>、</strong>Accession ID (e.g., <code>NC_047567.1</code>)</strong> 和 <strong>SNP 位置</strong>，工具通过 NCBI E-Utilities API 自动获取包含 SNP 位点的侧翼序列（Flanking Sequence）。</li>
<li><strong>文件解析 (File):</strong> 允许上传大型 FASTA 文件，并通过流式解析（<code>parseChromosomesFromFile</code>）快速识别文件中的染色体 ID，避免一次性加载大文件导致的内存崩溃。</li>
</ul>
<h3 id="2-基于经典规则的引物筛选"><a href="#2-基于经典规则的引物筛选" class="headerlink" title="2. 基于经典规则的引物筛选"></a>2. 基于经典规则的引物筛选</h3><p>引物设计的核心在于平衡<strong>特异性、稳定性和扩增效率</strong>。我们的 <code>getPrimerCandidates</code> 函数严格遵循了以下经典生物信息学规则进行高效筛选：</p>
<table>
<thead>
<tr>
<th align="left">规则</th>
<th align="left">理想参数范围 (可配置)</th>
<th align="left">代码中使用的阈值</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>引物长度 (Len)</strong></td>
<td align="left">$18 \sim 25$ bp</td>
<td align="left">$18 \sim 22$ bp</td>
</tr>
<tr>
<td align="left"><strong>GC 含量 (GC)</strong></td>
<td align="left">$40% \sim 60%$</td>
<td align="left">$40% \sim 60%$</td>
</tr>
<tr>
<td align="left"><strong>熔解温度 (Tm)</strong></td>
<td align="left">$55^\circ \text{C} \sim 65^\circ \text{C}$</td>
<td align="left">$55^\circ \text{C} \sim 65^\circ \text{C}$</td>
</tr>
<tr>
<td align="left"><strong>3’ 端稳定性</strong></td>
<td align="left">3’ 端应避免低复杂度区域</td>
<td align="left"><code>end3</code> 检查，避免 Homopolymer</td>
</tr>
<tr>
<td align="left"><strong>产物大小</strong></td>
<td align="left">根据实验要求设置</td>
<td align="left"><code>idealProductSize</code> ± <code>tolerance</code></td>
</tr>
</tbody></table>
<h3 id="3-未来的AI集成-Gemini-API-的潜力"><a href="#3-未来的AI集成-Gemini-API-的潜力" class="headerlink" title="3. (未来的AI集成) Gemini API 的潜力"></a>3. <strong>(未来的AI集成)</strong> Gemini API 的潜力</h3><p>虽然目前的版本主要依赖于传统的计算逻辑，但 Gemini API 可以进一步增强本工具：</p>
<ul>
<li><strong>引物特异性检查:</strong> 使用 Gemini 强大的文本理解能力，通过 API 提交候选引物序列和目标物种基因组，请求检查<strong>引物二聚体、自身二聚体</strong>以及在整个基因组上的<strong>非特异性结合位点</strong>，提供比传统算法更智能的评分。</li>
<li><strong>报告生成:</strong> 自动将选出的最佳引物对、Tm、GC% 和扩增产物序列整理成标准的 Markdown 或 PDF 报告。</li>
</ul>
<hr>
<h2 id="🚀-部署与运行指南"><a href="#🚀-部署与运行指南" class="headerlink" title="🚀 部署与运行指南"></a>🚀 部署与运行指南</h2><p>本项目是基于 Node.js 环境运行的 Web 应用（React/Vite）。</p>
<h3 id="Run-Locally"><a href="#Run-Locally" class="headerlink" title="Run Locally"></a>Run Locally</h3><p><strong>Prerequisites:</strong> Node.js (推荐使用 <code>nvm</code> 安装)</p>
<ol>
<li><strong>安装依赖:</strong> 在项目根目录下运行，如果遇到网络问题，请使用国内镜像加速：<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span>
<span class="token comment"># 或使用淘宝镜像加速：</span>
<span class="token comment"># npm install --registry=[https://registry.npmmirror.com](https://registry.npmmirror.com)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li>
<li><strong>设置 API 密钥:</strong> 创建或编辑项目根目录下的 <strong><code>.env.local</code></strong> 文件，设置您的 Gemini API 密钥。<pre class="line-numbers language-none"><code class="language-none">GEMINI_API_KEY="YOUR_GEMINI_API_KEY"<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><strong>运行应用:</strong> 启动本地开发服务器。<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> run dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<p>应用通常会在 <code>http://localhost:3000</code> 等地址启动，在浏览器中打开即可开始使用。</p>
<hr>
<h2 id="🔍-部分关键代码解析"><a href="#🔍-部分关键代码解析" class="headerlink" title="🔍 部分关键代码解析"></a>🔍 部分关键代码解析</h2><h3 id="DNA-核心计算函数"><a href="#DNA-核心计算函数" class="headerlink" title="DNA 核心计算函数"></a>DNA 核心计算函数</h3><p>以下函数定义了引物设计中的关键生物物理参数计算。</p>
<h4 id="1-互补和-GC-Tm-计算"><a href="#1-互补和-GC-Tm-计算" class="headerlink" title="1. 互补和 GC/Tm 计算"></a>1. 互补和 GC/Tm 计算</h4><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">reverseComplement</span><span class="token punctuation">(</span>seq<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... (反向互补逻辑)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">calculateGC</span><span class="token punctuation">(</span>seq<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token punctuation">(</span>seq<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[GC]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> count<span class="token punctuation">)</span> <span class="token operator">/</span> seq<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">calculateTm</span><span class="token punctuation">(</span>seq<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 采用简单的 Wallace 公式: 2*(A+T) + 4*(G+C)</span>
  <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">(</span>seq<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">A</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token comment">// ... (完整 Tm 计算逻辑)</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> t<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">(</span>g <span class="token operator">+</span> c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-引物候选人生成与筛选"><a href="#2-引物候选人生成与筛选" class="headerlink" title="2. 引物候选人生成与筛选"></a>2. 引物候选人生成与筛选</h4><p><code>getPrimerCandidates</code> 函数是引物设计的主循环，它在目标 SNP 位点两侧的序列中，尝试所有符合长度要求的子序列，并筛选出满足 GC 和 Tm 要求的候选引物。</p>
<p>TypeScript</p>
<pre class="line-numbers language-none"><code class="language-none">function getPrimerCandidates(
  seq: string,
  start: number,
  end: number,
  minLen: number,
  maxLen: number,
  isForward: boolean
): PrimerCandidate[] {
  // ... 循环长度 (minLen to maxLen)
  // ... 循环位置 (start to end)
  // ... 计算 GC 和 Tm
  if (gc &lt; 40 || gc &gt; 60) continue; // 筛选
  if (tm &lt; 55 || tm &gt; 65) continue; // 筛选
  if (hasHomopolymer(primerSeq)) continue; // 筛选

  // ... (返回 PrimerCandidate 列表)
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="各文件"><a href="#各文件" class="headerlink" title="各文件"></a>各文件</h2><h3 id="index-tsx"><a href="#index-tsx" class="headerlink" title="index.tsx"></a>index.tsx</h3><pre class="line-numbers language-none"><code class="language-none">import React, { useState, useEffect, useRef } from "react";
import { createRoot } from "react-dom/client";

// --- Types &amp; Constants ---

interface PrimerParams {
  idealProductSize: number;
  tolerance: number;
  minLen: number;
  maxLen: number;
}

interface DNAAnalysisResult {
  strand: "Forward" | "Reverse";
  base: string;
  relPos: number; // 0-based relative to the sequence string
  genomicPos: number; // The user input position
  totalLen: number;
  highlightedSeq: {
    pre: string;
    target: string;
    post: string;
  };
}

interface PrimerCandidate {
  seq: string;
  pos: number;
  len: number;
  gc: number;
  tm: number;
  end3: string;
}

interface PrimerResult {
  forward: PrimerCandidate;
  reverse: PrimerCandidate;
  productSize: number;
  score: number;
  productSeq: string;
}

type InputMode = "manual" | "ncbi" | "file";

const EXAMPLE_SEQUENCE = `&gt;ref|NC_047567.1|:c31905813-31888694 Crassostrea gigas (Example)
AATGATTAAAAAGTGGATATATAAAAAAGTTATACGTTGAAAGTTATGATAAGATCCTAACAGTTGCTAC
GTAATTAAATCTTTAATGAAGTTCTTTTTTAATGTAATGGTAACTGCAGTATGATAACAATAAAAAAATA
GATAATAATACATGTAATATGCATATCAATTGAAAAATTGACTGCAATTATTACGAACAGCTAATACAGA
AAAAGAATGCTTGTTTGTGTTGAGGGAGGGGGTGAGGTCATAGGGATAATTTTTTATGCCGAAGGGGAAG
GGTGTGGATGGTATTTTCACGATGAAAATTTTATGACTTTGAATTTTCCAGTGGGCCCAGGGCCGACCCC
CCAATCTTGTTCCCAGCCTCTGGATTTTTAATGCGTACTGCGGTATTTGATCCCAAGTAATTTTAAAAAC
AGTTTACTGATTTGCAAGTTTAACAGAAATCATTTTCAGGTTCTTAACTGTAAAGAATTACATATATAAC
TCTCTTGGTAATGAAATTTAAAAGACGAATTGCCTATTACTTGGTACATGTATTTCAAATATTACAGTTT
CTCATTTAATATTGTGATAATGGTAAGATTTGTATGTATGCTGCCATATACATGTATATATGAGTGTTAT
ATAAAATATAAATATTAAAAACATGGATTATGATACATATATGGGTATACAACAGTTTATGTCCGTCTCC
TTACAATTATATTTGGATGGAAACTCTCTTATCATAGACACTGTATTGACGCCGTGCGATTATGGAATCG
ATTGCTGACAATGGAGGACAATCGGCTAACAAAGCGTGTATTTTTGTGGCACTTTAATCAAACTGGTATA
TCTAGATGGACATCACGAATTAAATCACTGTTTGAATCTATGAATCTTTTACATATTTATGATAATTTAT
CAGTCTGTGATGTTAATGAATTTGAAAACAAGCTGTTTCTTACTTATGAAAATGAATGGTTAGGAAAGAT
AAACCAACTACCAAAGTTGCGATTATATAAAGGCGTTAAAACAAATTTTAAAACTGAAAATTACCTTGAA
ATGAACATTTCAAAATCTCAAAGATTTATTTTGGCACAATTCAGATGTGGGATTCTCCCAATTAGAATTG
AAACAGAGCGATATAAGGGGGAACCTCTCGATGAAAGAATATGTAATTTTTGTGTATTAATGAAATAGAA
GACGAGAGTCATTTTCTTTTGAATTGTGCAATGTTATCTGATTTTAGAAGGGAATTATTTAATAATGTAG
GATGTAATCCAACACTAGTAATGTCAAATTTAGACTGTATAATTTTTCTACTGTCAAACTTTCCGAGACA
AAGATCTAAATATTTACTTGAATCTTACCTTTACAGACAATCATTATTGTATAAAATACGCAATGCGTAA
TATGTGTATATATGTTATAATTGTATTTTCAGTGACATATAGGCCCAATAGGCCGGGTGTTTCATTATCT
AATTTGTATAACATTTTGTATTTTGTTATAACACATGTCACTATAATAAATTATTTACTTACTTACTTAT
ATCACTCGTTCCCTCTTGTGTATACTTGTGTTTATTGATAATATTGTGCATGTTGTTTATTTACATAACT
GTACCATATCATCCTGCTGCCCCCTGAGAGTCCCTGATTTGTCAATAAATTGGTTTTTCTTAAAAATTTG
ATTAAGTTAAACTACAAAGTATCCCTCATCCTAAACTATATCTCTCTTGCTGAACTTCTCATAGATTTGT
CATTCACACACTTGATACCTTCGCTAAATACTGTCGATGGACTAGGTCTAGGATTCGGGGAAAAACCTAA
TAGCCAAAGGGATGGTCGTCTTGACCCTAACCTTTACCATGCGATTTTCGGAAAATTGGTTTAAAGATCA
CCACGTGTTTGTTTTGTTTATCAATGATTTTCATTAAAAGTTTTTATCACTAGCCGACTTACTCCCACAG
GTAAACCCGGACCGGTGGTTTTCCCTCCCTATGACTCACTCGATCAATAAAAGTCAAAATGAAAGTAGAA
GATTCTCGGAATAGAATGTTGTACAGGTTGACCTATATTGAGCCTTGAACGTAAGATAGGTGAGGACTGA
TAGAGCTGATGTGACCACAGTCCACGACAGGTGTGTACACTAGTTACTTATGATTGACACATGTTGATAT
TATTGCGATAGTGTGTGTGCCGAATGATAACATATTTCAGATATGACTGATTACGAAACGTAGCGCATAC
GTGCATCTGATAACTTCTGTAAAAAAGAAGATGTGTCTATATTTCGTAACATTTAATTTTTGATACATGT
TTAAAAACAATTAAGTCTGTTAGTAGAAGTAGATTTATAAATGTATGCATAAAACTGGATGTATATGTAT
GTACCGTACCTTTTTAAATTTTATATTTTCGACTACATTTACAAAGAAGTCGGATATTTTGATATGGATA
TAGCAAAAAAGGTAAAAACTGGCCATGGTGTATAAATACTGAAACCCAAACGAGAAAAGAATCCGAATTA
ATTTCATTAAGTTAATGGACGTATGTTAAATTTTGAATAAGCTAGGTGAATCACTGAATGTCAATACAAA
ATTTACGTTATGACATACATGGCACCCTGATAGTAAATTCATGACTTAGTAAAAGCAAAGAGGTGTGATA
TTTTTGTCCATGGAATATTAAATTCTACTTGGACATTGGATGAAAAAATTGCTCATCTCAGATGAAGGTA
AAAACTATAATCAACTTGAAAATGTTAATCCTTTTCATATTCTGGTTTAGGCCATGTGAAAAACATTTTA
TGGGGTTATTTAGGAGGGCCCTATGTGCCCCCGGGCATAGCAAGGACTAGGTAGGTACATGTAGGTTTGG
AGGTTAGCAAAAATATGTTTTTAAAACCATTTTATTCGTGGTAGTAAAATCTCCTACTTCGTAAGTTATG
GTTTCCTAGTTATAAGGATCAACAACATAAATTCAGTAAGTACAGACACTCGGAGGTTTCCGATTACAGG
GCTTAGGCAATGTTGTAAAACCATCGTAGTATGAATAATAGAACATTATCTGGCGAAATATCCATTTAGC
TCAAATTTTGTCTCCTTGTGTCGTATAAAGATATTTGTTAAACTACTTTGTATTATATATTTTCTCAAAA
TAACCAACTACTTTTTTTTTATTCTCGCATACTTCGCACCCGAGAAATAGAGGTAGGAATTAGTTGTTTT
ATGCGTCTTTTCCGTTACTTATATAAATAGTCTTTTAAAAGTTGCATGTAGCACGAGGCAAAATGTTACC
GTGTTACAATATAGCTGTAAGAATGAACAATGCAGCCTCTAGGGAAAACTCAGGTCGATTGACATCTTCC
CTAGCCAAGGGTTTGCGATCCGCTCCTCTCATCTACAGTTGAGGAGTGGATCGTAACCATTGGCTAGCGG
AGATAGTTGATAGATTAGACGAGGAACATTACTGCACAAAATAAAATGCTTAAGTATTGAATTTGCATGA
TTGTATGTTTCATAATTCCTTATTTAATGTATCAATAAAGTGGATTTCAACATGAGTATACTTTCATCGG
ACGCTCTCTCAAGCCTCAGTGCGTTTGTTTATTAGGTAAATTGGTAACACCTGTTAATCGAAAAATTGAT
GGACTTCAAATTTCAACTATTTAAATAAAAAGGCAATATATTAAAGCTTATTTCAAAGTCCATACACTCT
GAGGCCGAAAATGTCACTAAGTACTGCAAATGTATCTTGCATTGACAGTGCACTTACGTTTGAACAAGAC
TTGTTGAAACACTAACCCCACTTTAACATCAATGATAAAAACCAAGCACTTCAGACAAAGCAGACGATAC
TTTTTTCTTCCAGTCGTGAAATCAGCGCGCAAATGTAAAAAAAAAACCCACCAAACTTTAAGGGCGTTAA
GCTTGGTATTTTGTAAAAAATAAAATGAATATTTATTTCTTCAATTGCTGAATAATGAGAGAGCATTCAA
GCAGAAACGTGATGCGTATGTCGATAACAGCTATACTTGCAGCTTTATTTTTATAGAAATAATTCCACTT
ACATTTTTTTAATGAAAAACCTTTGATAGGAAATGACAGAATGGCCTTTGATATTACCAAATTAAATTTG
CCAAATTTTCGTCTCCACTTTCACGCTTACAATGATTTCATACTTTCCTGAAATAATGACATAATTCAAA
TGCAGATAATATGAAATGTCAAAATTAAGTCAAATATCAAGTTATAGGCAAGATACAGGGTTCAGAGTTC
TTTGTTTTGTAAACAAAGCTCGAATATTGTAATTTTTTTTACATATGTGTTTTATTGATGTAAGTTTATA
TCAAATGTAACTTTCTTTTGTTGATTATAGTGTTTATGAAGATATTGAGTTACTTTAAATTGTTTTTTAC
ATATAATTTTGTCTTAGAAATGGTAATTCTCTACATTTCATTTTTTGTAAACAACTATAAGACTCGTCCT
TTGTTTACATACCAATCAACTCTTACCTCTCTATCTCGCTTGTAACTTGATTTTGACATTCAATATTTTG
GTCAATCATTTAAAATGCACGAGAAAACCATTTTATACATAAAAAGTAAAAAGAAAAATTTTGATCTCGA
ATCGTGTCCAAGTCCTTTTGAGGGAGGGGGATTTTTTTTACGGCTGCATGGAACTACATGTATGTATTCT
GTTCAGTATTTCTTCGATTCGGTTATTTTTTGAAAAAAAAAAGTCAGTTCGGAAAGTCTTTCACGCTTAT
TCAATTTTTAAATTAGCCAGTAAACATTTCTGAATACATGTATATGAACTGATACGAACAAATTATATAA
AAACTTTTGATTAAAAAAAAATCTTTGTACTTTTAACTACAGATATTCAAAATAAACCTTAATAGAATAC
TTGTACGTCATATAAACGGTATACGTTATTTCCTAAAACAGAGATAAATGTTAGATGATAAGTATCTCAT
ATGAGGTAACAAAAACATTTGATTGTTTAAGCTGAACAGCACTCCTTGAAACCAAGCGATTTCATGAGTG
CTCGAGGATCTGTCTAAACGTGAACAACTTGTATCAGTAAACCAGGCCCTGTATATCAGTAAATGGCTAC
TGAACGTTCCTTTCAGAAAACTTTAAAATTTGACGTCGTCAATAGCGGTTTGGAGGTAACAGGCGTTTGC
TTGTGAAAAGTGAGCTATCTTTATGTTATCATTTTCTACCTACCTTCATAACATTTAAAAGAAACGTTTA
CGGAGCCCTATTAATGAAATTTTCCAAACATTTATTCTACTTTTGTGCCACTCTGTAAACCAAAGTAACT
ATGTGCGTATTGCATGCATGTTTAAGGATGTTCTTGAATCAAGCATGATGTACAAACTTCCATCAGTCGT
TACTCAGCCTCAAGCCTGAGTATTGACTTCAAATTTTTGAGTTTTTGAGTTGAGGAATAAGTTGAGTGAT
TTGAAAATTTTGATGAAGGCAGGGTCTGACCATAACATAGGTAATCAACTAATCATCGAGTAAATTCAAT
ACAAAATAACTTTTAAAAATGCGCTATATTTCAGGATATCAGCGCTATGGTTTTCAAATGCCCTATTTGT
AAAAGGGACGATTTCCAGAGTGAGGGAGGACTCAGCAGTCACATAACATGGAAACATTCAGGTAGCTCAG
ACGGCAGAGGATCGCGACCATCTACTGGTGGACGTGGCAGGAAAGACGATAGGGTAAGGATAACAATACA
CGCTACACGGCCTCTAGATCAGGACACTCACCGCTGATTAATGCTATTGTAAATGGCGTTTAAAGTTATT
AATCAAAAGAAGTTAAGAGGGCACGATGGTTGTGGTCATTTGCAGACTATATTGATCTTCTTTAGAAGAA
GAGCTCAATATAGAACTACAGAAAAATACCAAAATTTTAAAGGTGAAATATATGGATATTTTTTCTTTCC
TTAATAATAGTTTATAGGCAATCAAATGATATCTCCAAATTTTAGGCAGATCCGATGGTTAATTGGTTGA
CCATCTAGTATCCTTAAAGAATACACGCTATTGAATGTGTAAACACCCAGGATAAAATTATTTAATATGA
TTTGTATTTGGGATAAATAAATTGAAAAACAGTTAGCAAATTATGATTAAATTTTTAGTTGCTATGTTAA
AATATCACTTTTATCGAATATTACTTTTCACTAAGATATAAGTCAAGTAGGGTTAAAAAAAATGTACCAT
TTTTGAAGTTTTACAATATATTTTTTTTTCATTTCAAACATTTGTAGCCGATACACAGTTCGAATACATA
TTGTTTATTGCAACAGAACTATGAGTGCTAAAACTGATACCATTAGTCTAAATATGTTACCAATGGGGAC
ACACGAAATCATAAAAAATTCCAACTAGTAGTTTGGGGAAACAATTTTTTAGCGTTAATCGACTGCTTGT
AAGACCAACTAACTATGTCTACAGACAAAAAGATATTGTTTGTAAATAAACGTAGTATACTTTAATTTGA
AAAGTAAAACATCCCATTTTTGACGAATTCGCCAATTAGGTATAGAGTAGTCAAATGTTGTATAGAATCT
AACCTAAGAAAGAAAGATATAATACATGTAGGTATGATATACAATGTGAATACCTTAATTTTTGTGGATT
TATTTCCCAGGATATCAAAGCCAGGGTTTTCAAATGCCCTATTTGCAAAAGGGACGATTTCCAGAATGAA
AGAGGACTCAGCTGTCATATATCACGAATGCACCTGAGTGGCTCAGACGGCAGAGGATCGCGACCATCCA
GTGGTGCATGTGGCAGGAGTGACGATAGGGTAAGGACAACAATACACGCTACACGGTTTCTAGATCAGGA
CACTCACAGCTAATCAAGGATATAACAAATGACTTACCAAAAAATTAAATAAATCAATTGTTCAATTTTT
TGGGATGGGCAAAAACAAACAACCCCCCCCCCCCCGCCCCCCCAAAAAACAAAGCAAAAGACCCCCCCCC
CCCCCTAAAAAAGAAAAAAACAAAACAAAATCCGATCAAACAAAAATACCAATACATAGCAGATGGAATC
TATAACAAATTTAACAGGAAATAAAGTTTGTAGATCAATCCATAAATAAAAGAACGCAAAAATTCTTTTA
AAATTTTCACTAATTTGTCAGTAACAAAACTAATGAAGTACTGTTTGCAAAAGGGACGAATTCAGTTTTT
GACAGCCACGGTGTGATTATTTCAAACAGTATACATATTTTAATTTTTTTATTCAGGATGTTAACGCTAT
GGTTATCAAATGTCATATTTGCGGTAAGGACGATTTCAAGAGTGAGGGAGGACTGAGCCGTCATATAACG
ACTGTGCACCAAGGTAGCGCAAATGGCAAGGGATCTCGACCGTCTTCTTGTACAAATGGCAAAAGGGACG
ACGGAGCAAGACCAAAAACTCACACGCCACGTCATAGAGACCACGAGAGACACAACAGTGACAGAGATGT
TGTAAGGGGTGTTGCAAGAGTACAGAGGGAATCACCCCAAAGGGGTTCTCTAGACGATTTTCCGTTCAAA
GTAAATATGTTATTTTTATATATGTTTTGCTTCTGAAAAGATTTGCAATGATAACTAATTCGCTTGTATT
AATAAAATAGAATCATCGTTAGTCTATTGTAACGATTAAAATTTTATTTGCATAGTAAAAGTCAGGGAAA
AGTTTTTTAATTTATAATCACCTTCATGATAAATTTGTATATTACATTAATTTTGTAAACATGTTTCCTT
ATTTGAACCTATTGACTAACAAAAGCATTCATTTCTATATATTTACATTTGCAAAATTTCTTCCTAATAT
GAACCTTTAAAATAGCGAAAAGATTTGATTCTTTATGTTAAAATTGCAAAAATGTTTCCTTATATGAACC
TGTAGAATAGCCAAAACGCTAAGTCTATTGTGAACGTTTACGTGACGTGAACATGATAATCACAGGCGAT
TATCGTTTGCATTTTTGTAAACATTAAAATACGGATATGTTAATAACTATGAACGATTTGACTTTAAACG
TAAATATAAGTAATAAATTAAACAAGACGGGATATGAACTTGGTTGTTACGTGATCAAATCTTTTGAGAA
GTCCTACCTGTTTCACGTGACCAACCAAGTTCATATATTTGAGAACTTTTTAAGGTGCTGTTTATTTCTT
GTGTAAACTTTTTAATGACGTCACAATGAATACAACGCCCTCTTATCGTTTGACGGTTGCATTACTGTAA
GTTCATGTTTTAAAACACGATTATGTTAAAAATTATGAACAATTTGCCTTTCTTAAACGTATATATAAGT
AACAAACAACAATGTTATAAAATCAATGGGGATCTGAACTTTTGTTTGTCACATGATCAAATCATATGAA
GCCTTCACAGTATTTAATTACGTGACAAACTAAGTTCATATCCCGTTTAACTTTTATACTTGTTGTTTTT
TTTCTAATATAACTTGTCAATAGTTAGGCCATGGTGTCCCTTAAAGAGTTTTTGCTGATCAAATCTTAAT
GTATAAGATGGTCTTCCATGGCAAGTTAATGATTCCCTTTGATCCTAAAGTCAAATGATAAACGGCATTG
TTATGCCTTTATTAATCTTCCTCTTAATTATTCTACCCAACAAAAAGTCAAATGTTAGTTCAACCGGCCG
CGGTATAACAAACTAGATGTTTGACCGGTCGCTTCGCTACAACTATTTAACCGTTGTTCAATCTTGGCGA
GATAGAAGAAACGGAAAGAATGCAAGTGCTTTGCGACAAGAGTGGCTTGGTGCAACTTGAAATGATCCCT
GCGTCTGCAGTGAAAGATAACACAAAATAGCTATTGGATCGGATTTGGACAACATGTCATCTGTTGGACC
ATCTGACAGAAGTATTGTCTTAGATGTTTAACCTTGGGCAACGTTTGTGTCGTGTCTGTAAAAGTCCAAC
AAATGATATGTTGTCTCATACCCCGGCAATATGTGAATGAGACTGTATTTCAAAAGTTGACCGTACGATA
ACTTGAGAGTTATATTATTACTTATTAGGTTTGTTACTGACTGTTTACAGAAATTTGTGGGGTCGGTAAA
GTCCATAGAAGGCGAGGCGGAGCCGAGCCTTCTGTGGACTTTACTGACACCACCAATTTCTGTAAACAGT
CAGCAACAAACCTAATAAGTGTTTTGTTTTGTCGAGGACCCTAAATTTGATATGTAAACAACAAAAGAGA
ATACATACCAATTAAATTCATAGGCTTATTATCTAATTTTGTACCTTTCTCGTCAGTCGTCTGTGTAAAC
TTGGATGCCATTGTATATAGGATCGTTTTATTACGTCACGGGCAAAGGGGGAGTCACTCTAAATATTTTG
GGGCTTAAAAATTATAGGTATGGTTGAACGTTTGTGTTAAAAATAAGCTCAACTAACGTTACGTCCGCCA
TGTTGCCGTATAAATTTTAACGCACGCCGTGTAAAGAAATTTATAAGGCAATCACGTGACGTGATTCATC
CAATGACGTCGAGACATTCTAGTCCGAGGCAAAACAAATTTACATATAAGTCACCATTCACCATTTCTAT
CAATTACGATTTAACAATTATTGGAGAATCATTTTTAAGACATTTTATCTTATGACACAGGATGGTGCAG
GAGGAGCAACATGGAAATCGAGCTCAGCAAAGTATAAAGGTAACAAGACAGAGTTGTTTTTATAGTCCAA
GCAATCCAGCTTTACGTAGTGTTGGCCATATAATAATATAAGCTATCTCAGAAGAACAATTTCTTCTTTA
TCAAAACCGTTGGACACTCGGCAACTAGATTTATCAAATTTTAAATGGAAAGGCACTAATTTAAAGAAGC
TTTAAATTATTTGTCATTTATTGACCTGTTCCCTGATATTGATAATGAAAATATAGGAAGCATTTGATTT
GTTTCTATTTCATCAATAGAATCTCCAAAACAAAGCAGAAAAACAGAGGAACCTCGTGAAAGACCCTCAT
CATCAGATTTAAGTAAGAACTGTTTTAGTGTGAAATTAGCATCATCTATATGTAAGGGAATGAAACGGTC
ACTTGCAGGTTGTCTATATTCAGTCCTTGTAGTAAAGTTTACTTATATATGACTGAGCCATTCAGTTTGC
TTTTCAGACCTTTTTGTAAATATTCAGTTGACTGAACATCAGAATCTCTTGTGATAATTGTAATTGCTGC
ATCAGGAAGTTGTTAAAGTTAAAAATGCTTTAGTTGATCAAAGGGCAGAACTTCTTGCGATAATTATATT
GGTAAATCAGGAAATAGTTAAAAGTAAAAATTCATTAGGTGACGAAATTGCAGGACCTTTGGGAAAACTT
GTATTGCTCTATTAGGAATTTGTTAAACATTTTTCAGTTGATCAAATGGCAGAACTTCTAATGATAATTG
CAAGGGTGTGTATCAGGAAATAGTAAAAAAGGAAACAATCTTTTGTTGACCAAGTGGCAGGACCTTTTGT
GAAAATTGTAATGATGTATCAGAAAAGGGTAAAAAATGAAAATTCTTTACTTGACCATATAACAGAACGT
CTTGTGGTAATTGTATTGCTGTATACGAAAATTGTTAAAGTTAAGATTTTTTCAGTTGATCCAATGTCAG
AAGCTTTTGCAATAATTGTTTTGGTTTATCAGAAAATAGTAAAAAGGTTAAAAAAACAAAACCTCTTGTG
ATTATCGTATTGATGTACATAGAAACTATTAAAGTAAAAACATATTCAGTAGAATGTCAGAACTTCTTGT
GAAAATCTTTTATTTGTGTATCAGAAAATGGTGAGAAGTAAATTTTCCTTAGTTGATTTAATGGCAAAGG
TTTTGTGAAAACTGTATTGCTGTATCAGAAAATAATTAAACACAGAAAATGATAAAAGTAAAAATTTCTT
ACAGATTTATCGCTGTCGTTCAATGCTCCAAATTTTGAGAAATTTGTGGGAATGATAGAGGGCAGCATTG
TACGTCCGAGGGAAGACAGTACACTTAGGACAGACAGCATAAACAAGTTCATTGATGACTTATTGGTTGT
GATGGATAGGATATCTGATATACCGATAAAGCTCATGAGATCCGGGTCTTACTATGACAGAACGAAGGTA
ACTGTAAAAAGAAAGTGGTACCATGTTAGGCGCCTTGAAAATATGACTTTTATGTTTACATTTATGTATT
TGTCTGTAATAACAGTATGGGTCGTATTTGTAACGTATTCTTCAATGCATTTCATGAATAACGCAATTGA
GATGCCCCTGGAGAGCAAGCGGGGTTTGGGGGGTTGTTGGTCGGTCCTCCCCCCCCCCCCCCCCCAAGCA
CCTGTGTATTCGATTAACTCATAAACTCAAGGAATGGTTCCTTATTCCTAATTCACTGTGAAAAGATGTT
TTTATGAATAAAATCATCTTTAAGGGTCAATCATGAGAAAAAAAAAAAAAACAAGTGTCTCCATTGAGAC
ACTTATTGTTAGATCATAATTAATCACCTAATTGTGTACGGATTTTCCTTTCTTTCCGATTTCGACAAAG
AGCACCCGGGGATGTGACCGGTCAGCAGAGGATGCTTTACTCCTCAACGGCACCTGATTCTACCTCTAAT
TTTTTTTATGAGGTCTTTGTTTGCTCTCCTCCTGACTTGTGATTTTCCTTTTGACTTTTGATGTTTGTTA
TCACCAAATGCCTGTTATTTTAAAGCGAAATATTTAAGAACGAGGAAGAACGTTATAATTCTACCTAGTA
TTTCATACACCTTTCTTTTAATTTCTTTGAACAGATCGACTACAACGATGAATTCGATTTTATGTTTTAT
GCTGACATCAGAATGGAAGCAGATTTTACAAACTGTCCCCCAGGATATTGTAAAATTCGGAAAGGAATGA
CTGTAAAACCGGATCTTGATCCGTTCATCGACAGGAACGGGTACCTTGTTCCTGAAAAGTACAAAGCCCA
TATGTTCGATATATTCGAAAAATGTCGGACTGATTCCAGTTTTAGACAAGGGAGGAGAACCCAAAGTAAG
TGATCTAATTTTAGTTTTTTTTTATTTAGAAGCCTTTTTAAATATTTTGGCATATGGCGTGTTATGCATT
GATATATAACTAATATTGTTTGCTATTCGGCAGATCAGAGGCAGACTAATTTGTTACCAAGTAACTGTAA
ATTTGCATAGAACTAGCACAAAGAGAAAGTCTTCCTCTCCTAAACACTTCAAATAAACTCTAACTAGGCA
TGACGTCGTGTACACGTTATCCTAAAAATGATTATATTACCCTCAGACGCATTTTGTTTATACTTAATTC
AATCATAAATGAATAACTTGAAATCTTATGTTCCAGAACAAGATCGCAAACCTGAGAGCCCAGCATACAC
ATTACTGTTCGATTTAGGAATTTCTGGTAAACCCCCAATCGACATTGATTTAGTTCCTGCAATAAAAATT
GATGGCTGGCCAAAACCTGCAAGAAAAATCGGTCCTAGTAAATGGATAGAAAAAAGCATGGCTGAGAGAG
CTATGCAATGCTTCCACGTCGTTACCAAGAAGTTTCAAGAAGGTATACTTTTGTTCATTACATTTTAAGT
CATCTGTTAGAAAAGAAACATTTAAAATGATTTGGATAAAAAAAATGAGAATTGTTTGATCACATCATTA
ATTTCATACGGTTTTGTAGTATACAATTTTAATCAATATAGTTATAAAAAATAACGCTATTGCATCGTAT
GATACTATACAATATCGTGCCATATGATATATCATCTGATACAGGAAATTGAAGAAAATTAACTTTCTGC
ATATGCATTGTACTGAAATTGTTGGGCAAATACTATCCATAAACTAGATTAATTTAAAAATAAAAATCTT
AAAACTGAGTTCAGTTGCAAACAGTATACAGCAATTAACTTTTATGGTAAACAAAACAAAAAGAAAAATG
CGAAAATGTTTTTCTTTTCTAAAAATGAACATTAACAATGAAATGCGATATGATTCGCCGGAATTTTATT
TTTTTCATATGATTTCATTTATAGCTCACCAAGACAGTCGCCTGCTATGGAGGATTTCCTTCTCGCACGC
AGAAAAAGAACTTATTCTTCACGCTAACATGTCGGACAATGGTTGTCGGAAGGATGTTTTTAAAATTCTG
AAGAGAATTAAGGAAAACATGAAGTCTAAAAACCCAACTGAAATGGACAAGTTCTGTAGTTACCATCTTA
AAATGTTCATTCTAAGGTTTTATGATAAACACGGTGATTTTAGTAAGGAGAGGAAGTTGGACTTGCTTAA
GGAGAGTATAAAGCAGCTCGCGAAATGTGTACGTGAGGGAACCATTGAAAATTACTTCATTCCTAAGGAC
AATGTTCTACAGTCAGTCCCAGAGAAAGAAAGGTTGTCTGTTGTCAGGGAACTAGATGGTCTCTTACAAT
AAATGGTGCTGAAATGTTACATGTTTTCGTTGATATCCATACCAACATATGTTCAAGTTAACTAATTCTT
TTTACAGGTTTCGTGTTCAGGAGATGTTTTATATATTTTTTTTTTATATTTTCAGTATGTCTGGTGCATT
ATTATAAATCATGACACAAGATAGCTTGTAACTTTGTACCAATTAACTTATTGGTCTGTCTTTGTTGCAT
CATCGTTGTGTGTTAAGGTGGTAAGATTTTGTAAGGATACTGAATGAAACGCATAGCTCTTATTAGGTAA
AAGTGTCTCTGCATACACATTTTAAACCAATGACTTTATTTCTAGGCCTGTGCATAATGGTACAATCAGT
ACTTTGTAAATTTGCAAATGTTGATTTTTTTTTAAATAATCGTTTGTTGGATTTTTTGTGAGAAAGAGGA
ACACGGTGTGTGTTTTTAACCTGGCCTCTTTGTTCAGCTTTTGTGCTAAAAAGGTAAAATTGGATGATGA
TTGTTTTAAATAAATATATCATAGACGATAGTATTTTAATATTGAGTTTTACGATCTTGTCATCATTATG
AACTGCTGATTGCGTATAACTGTAATGTAATGTACAAGGTATAATCAAGCATTTGTGAAGTGAATGAAAT
TCTAAATTATCTATTCTTTACAAAACAAGTCTGCTTTATATATTATCTGTAAAATGTGTCGCATATAATT
CGATGTTTGGCTTTAGCATATGAGCAAAACTACTTAACACTGCCATTTAATAACAATATTTTGAATAATA
TCTTTACTTCACATTACTGTCTCCAAGTACATATAATAGTATCTACGTTGTGACGTTTTTATTTGTGAGG
CCATATTTTCTTTATCTTTTATTTTACTTATAATCGATAATTGATCATAAAGTTTGTTAAAAGATTTAAA
GCAATATGAGCTGTAATTTTTAGAATTTTATTTTGCTGCAAAAACCTGCCAGTATGATAAGTCTGCATGT
AACTTAAACTCTTATGATAAATAAAATTTGAAAGAATTATTAATTTCGTCAGATGAAAGATTTCTCTTAT
GAAGAATATATAGCAGATCAATTTTGGTAGAGGACGACAATAATTCAATTTTGCTTCAATTAAGGCTTCT
TTACGGCTTTTAAAATAAACATATGCCTAACAGAACTTTAAAAACCATGATATGTTTGTTAATTTAATAG
AAAATAACATTTTCGTAAAAAAAAAAAATCAGCATGAAAATTGCAGCTCATATTGCTTTAAACTGTATAT
TGATATATGTAAACTATTGATTACAGAGAATAAATAATGTTCAAATTTCAAAACTTTATTTTCAAATACT
TTTATCGTATGATCAAAACTATTGAATGTGATTACCATTTGCACAGTGATCAGGTTTTATAGAAAGATGC
ATAATTTAAAAAAAATATATTGCGGTTGTGCTTTGGTTTTTTTTCTATCTCTAAACATTTACTCTTATTT
TTTTGTTTCATTTGACATGGCATTTTGTATCCATTGTAAAAAAATGTTTTACTAGGATATAGTAATTAGA
ACCCAATAACTGTTGTCAATAATAATACACAGTTCATAATTTTGACGATTACAATTTAGTTATTTGAATA
AAGTTAACAAGTTATTTTCTGGAAAGTAGATTGGTTGTAGCATGATTTGTCAAACACTGTAAGTACCTTT
GCATATAAAAAGATTATTTGATAATCCTTAATTTTTATCATTTAAAGCGTAGATGATGATGATGATACTG
TATGCATAAGCGAATTTCTTCCCATTGGGTAGCATTTAGGAACATCTCGAGTGTATATTGCAGGGGGAAT
TGATGACATAATTTGCGGAATATATCATTAATATACAAAAAATCCAATATCAGCGATATCGGAAAAAAAC
ATCAGAAAAAATTTGAGATCACAGTATTGTGTAATATACGTCGAACACCGAACATTTAAAGGGGCATGGT
CACGATTATGGTCAAAAATCATTCTTCCGAATTCAATGTTAACAATGCTTCAGTAAGGCATTCTTTATAG
GCAACCAAAAATTGAGTGTCATTCATTGAGTTAAAAGCGAGTTACAGAGCTTAAATTTTTTTCTATGTAA
AGAAAGCTTTTGTTTACTTTTTGAATGTAGAAGGGAAAATTCCAGTTTTAGACCTAAAATGAATGTGTTG
AATGTTTAAAAATACTGTTAATTTTATGCTTTAAATGAATAAGAAGATAAACAAATCAGCTTTATATAGT
ATATTTCATCTTTGTAAACAAAAACAGGGCACGAGTCTTGTTTACATTACAAAGAGTTGTGACCCATGTA
TCTTGCTCATAACTCTACGACTGACTCTCAAATTTATTTGAATATAGAAATGCATTTCTAAAGCATTGTA
AATAATAAAAACTGAAGAACTAAATTTGACCAAAATCGTAACCATGCCCTTTATCGCAAACGATATAGGA
AAGTGTTTTGAGAAAAGAAACCAATGAAACACGATACAAAACAGATATATTTAAAAGTTTCACATTTACA
GACGTTACTCTGTGTTAGTTTGTCAAAACATGTACTGCAATAGATCAAGCAGAGACATCGTGGACTTAAA
AACGTGTTGTTAATTTGAAATAAATTTTACCTACTACGTGTATTGTATCCTCGTCTATAGACAACGCTGG
TAAGAGAACGAGGGTATGCAATTATATTGGAAAGTTGAAAAAGCCCCTTTTGATGTGCACTCACAGCGAA
ATTACTCGTTTTGTGCAAGAAAATCCTAATACTTTGTATTCTTCCAATAAATGCAACATTAAAATAAATA
CCGGTATGAAATTTTGCTTAATATTACGAATTCACCATTGCAATTTCATTTATTTTCTGTTCAAATTTGT
TATCTTAAATTGAATTTTGCATGGTCTACTTGTTAGGACCCCGCTCTGCGGGTGACTTATAGTGAGCAGT
CCATCCATCCATTTTTGTTTCTTTCTGTCTGTCCGTCCGTCCGAGATCTCTTGTCAGGAGCATTTTGTCT
CCCCCTTGGCCTATTTTTGCTGTTACTTCCCCAAGTTTTAAGGCGAAATGTGAAGATCATAGCAGATCTC
TTTATAATCCAGTTTTAGAACATACATTTATTCTCAAATGCTTAATTTTGCTCAGATTGAACAAATAAAT
ACATGTAAGTAAGAGTAATGACATTGAATTATTTAAACTTCTATGCCAGCTGGAACATTTTTAAGTCATA
GGTTAAGGTCAAAGCAAATTATCTGAAACACTTTTCATTCTATTGTCCATTATTTGAGTAGGCCCTTTGA
GATGCTTACCTTCTTAATGATGCCTAGATACTGTCAATTTTATATTCCTGTCATGCAAACGTGTATTGCG
CTATGTTGATTTGATAAGGTTGATTTTTTCCCTATGTCTGTCATAATTGTAATTAAAGTGTTCTTTTCAG
GAGGAGAGGGTTACTCAAGGAAGCTATACTATCCTATTTAAAGTAATAGGCAGTAGACCCTTTTTCATAT
AACTTGATAAATGCCTTTTAAACTTAATTTTAAAAAGATTAAATTGTACACAAATTTGTCAGTTTAAAGG
TAAATACTCACGAGTATGAAAGGTAGTTAATCCAAAATCAATAAATGATAAAACGAATAAAGGGTCCATT
TTGTATTAATCAACAAATAACATTTCATTTTGATTAAATT`;

// --- DNA Logic Functions ---

function getCleanSequence(rawText: string) {
  const lines = rawText.split("\n");
  const header = lines[0];
  const seq = lines
    .slice(1)
    .filter((line) =&gt; line &amp;&amp; !line.startsWith("&gt;"))
    .map((line) =&gt; line.trim())
    .join("")
    .toUpperCase();
  return { header, seq };
}

function parseCoordinates(header: string) {
  try {
    if (header.includes(":c")) {
      const coordPart = header.split(":c")[1].split(" ")[0];
      const [start, end] = coordPart.split("-").map(Number);
      return { start, end, isReverse: true };
    } else if (header.toLowerCase().includes("complement(")) {
      const coordPart = header.split("(")[1].split(")")[0];
      const [start, end] = coordPart.split("-").map(Number);
      return { start, end, isReverse: true };
    } else if (header.includes(":")) {
      const coordPart = header.split(":")[1].split(" ")[0];
      if (coordPart.includes("-")) {
        const [start, end] = coordPart.split("-").map(Number);
        return { start, end, isReverse: false };
      } else {
        const pos = Number(coordPart);
        return { start: pos, end: pos, isReverse: false };
      }
    }
    throw new Error("Could not parse coordinates from header.");
  } catch (e) {
    throw new Error(`Coordinate parsing error: ${(e as Error).message}`);
  }
}

function reverseComplement(seq: string) {
  const comp: Record&lt;string, string&gt; = { A: "T", T: "A", C: "G", G: "C", N: "N" };
  return seq
    .split("")
    .reverse()
    .map((base) =&gt; comp[base] || "N")
    .join("");
}

function calculateGC(seq: string) {
  const count = (seq.match(/[GC]/g) || []).length;
  return Math.round((100 * count) / seq.length);
}

function calculateTm(seq: string) {
  const a = (seq.match(/A/g) || []).length;
  const t = (seq.match(/T/g) || []).length;
  const g = (seq.match(/G/g) || []).length;
  const c = (seq.match(/C/g) || []).length;
  return Math.round((2 * (a + t) + 4 * (g + c)) * 10) / 10;
}

function hasHomopolymer(seq: string, maxRepeat = 4) {
  const bases = ["A", "T", "C", "G"];
  for (const base of bases) {
    if (seq.includes(base.repeat(maxRepeat + 1))) return true;
  }
  return false;
}

function hasDimer(seq1: string, seq2: string, minMatch = 4) {
  const rc2 = reverseComplement(seq2);
  for (let i = 0; i &lt;= seq1.length - minMatch; i++) {
    const tail = seq1.slice(-(i + minMatch));
    if (rc2.includes(tail)) return true;
  }
  for (let i = 0; i &lt;= rc2.length - minMatch; i++) {
    const tail = rc2.slice(-(i + minMatch));
    if (seq1.includes(tail)) return true;
  }
  return false;
}

function getPrimerCandidates(
  seq: string,
  start: number,
  end: number,
  minLen: number,
  maxLen: number,
  isForward: boolean
): PrimerCandidate[] {
  const candidates: PrimerCandidate[] = [];
  for (let length = minLen; length &lt;= maxLen; length++) {
    for (let i = start; i &lt;= end - length; i++) {
      const sub = seq.slice(i, i + length);
      const primerSeq = isForward ? sub : reverseComplement(sub);

      if (primerSeq.length !== length) continue;

      const gc = calculateGC(primerSeq);
      const tm = calculateTm(primerSeq);

      if (gc &lt; 40 || gc &gt; 60) continue;
      if (tm &lt; 55 || tm &gt; 65) continue;
      if (hasHomopolymer(primerSeq)) continue;

      candidates.push({
        seq: primerSeq,
        pos: i,
        len: length,
        gc,
        tm,
        end3: primerSeq.slice(-5),
      });
    }
  }
  return candidates;
}

// --- Components ---

function App() {
  const [inputMode, setInputMode] = useState&lt;InputMode&gt;("manual");
  
  // Manual / Main State
  const [fastaInput, setFastaInput] = useState("");
  const [targetPosInput, setTargetPosInput] = useState("31898289");
  
  // NCBI Fetch State
  const [genomeId, setGenomeId] = useState("GCF_902806645.1"); // 基因组ID
  const [genomeChromosomes, setGenomeChromosomes] = useState&lt;Array&lt;{id: string, name: string}&gt;&gt;([]);
  const [isLoadingGenome, setIsLoadingGenome] = useState(false);
  const [ncbiAccession, setNcbiAccession] = useState("NC_047567.1");
  const [ncbiPos, setNcbiPos] = useState("31898289");
  const [ncbiFlank, setNcbiFlank] = useState(1000);
  const [isFetching, setIsFetching] = useState(false);

  // File State
  const [fileObj, setFileObj] = useState&lt;File | null&gt;(null);
  const [fileChr, setFileChr] = useState("");
  const [availableChromosomes, setAvailableChromosomes] = useState&lt;string[]&gt;([]);
  const [isParsingChr, setIsParsingChr] = useState(false);
  const [filePos, setFilePos] = useState("31898289");
  const [fileFlank, setFileFlank] = useState(1000);
  const [isFileProcessing, setIsFileProcessing] = useState(false);

  const [params, setParams] = useState&lt;PrimerParams&gt;({
    idealProductSize: 500,
    tolerance: 200,
    minLen: 18,
    maxLen: 22,
  });

  const [analysisResult, setAnalysisResult] = useState&lt;DNAAnalysisResult | null&gt;(null);
  const [primerResult, setPrimerResult] = useState&lt;PrimerResult | null&gt;(null);
  const [errorMsg, setErrorMsg] = useState("");
  const [successMsg, setSuccessMsg] = useState("");
  const [fetchSuccessMsg, setFetchSuccessMsg] = useState("");

  const seqViewRef = useRef&lt;HTMLDivElement&gt;(null);

  // Auto-scroll to highlight
  useEffect(() =&gt; {
    if (analysisResult &amp;&amp; seqViewRef.current) {
      const mark = seqViewRef.current.querySelector("mark");
      if (mark) {
        mark.scrollIntoView({ behavior: "smooth", block: "center" });
      }
    }
  }, [analysisResult]);

  const loadExample = () =&gt; {
    setInputMode("manual");
    setFastaInput(EXAMPLE_SEQUENCE);
    setTargetPosInput("31898289");
    setAnalysisResult(null);
    setPrimerResult(null);
    setErrorMsg("");
  };
  
  // 基因组数据库 - 只包含我们知道的基因组
  const KNOWN_GENOMES = {
      "GCF_902806645.1": [
          { id: "NC_047559.1", name: "LG1 (NC_047559.1)", group: "Chromosomes" },
          { id: "NC_047560.1", name: "LG2 (NC_047560.1)", group: "Chromosomes" },
          { id: "NC_047561.1", name: "LG3 (NC_047561.1)", group: "Chromosomes" },
          { id: "NC_047562.1", name: "LG4 (NC_047562.1)", group: "Chromosomes" },
          { id: "NC_047563.1", name: "LG5 (NC_047563.1)", group: "Chromosomes" },
          { id: "NC_047564.1", name: "LG6 (NC_047564.1)", group: "Chromosomes" },
          { id: "NC_047565.1", name: "LG7 (NC_047565.1)", group: "Chromosomes" },
          { id: "NC_047566.1", name: "LG8 (NC_047566.1)", group: "Chromosomes" },
          { id: "NC_047567.1", name: "LG9 (NC_047567.1)", group: "Chromosomes" },
          { id: "NC_047568.1", name: "LG10 (NC_047568.1)", group: "Chromosomes" },
      ],
  };
  
  const fetchGenomeInfo = async (genomeId: string) =&gt; {
      console.log("加载基因组:", genomeId);
      setIsLoadingGenome(true);
      setGenomeChromosomes([]);
      setErrorMsg("");
      setFetchSuccessMsg("");
      
      try {
          // 检查是否是我们已知的基因组
          if (KNOWN_GENOMES[genomeId]) {
              // 模拟网络延迟
              await new Promise(resolve =&gt; setTimeout(resolve, 300));
              
              const chromosomes = KNOWN_GENOMES[genomeId];
              setGenomeChromosomes(chromosomes);
              setNcbiAccession(chromosomes[0].id);
              setFetchSuccessMsg(`加载 ${chromosomes.length} 条染色体 (示例数据)`);
          } else {
              // 对于未知的基因组，不加载染色体列表，只给出提示
              setFetchSuccessMsg(`未找到 ${genomeId} 的预定义染色体数据。请手动输入Accession ID。`);
              setNcbiAccession(""); // 清空Accession ID，让用户自己输入
          }
          
      } catch (error) {
          console.error("加载基因组信息失败:", error);
          setErrorMsg(`加载失败: ${error.message}`);
      } finally {
          setIsLoadingGenome(false);
      }
  };

const handleFetchNCBI = async () =&gt; {
    setErrorMsg("");
    setFetchSuccessMsg("");
    setIsFetching(true);
    setAnalysisResult(null);
    
    try {
        const acc = ncbiAccession.trim();
        const center = parseInt(ncbiPos.trim());
        const flank = Number(ncbiFlank);

        if (!acc) throw new Error("请输入Accession ID (如 NC_047567.1)。");
        if (isNaN(center)) throw new Error("请输入有效的位置。");
        if (isNaN(flank) || flank &lt; 50) throw new Error("请输入有效的侧翼长度 (最小50)。");

        const start = Math.max(1, center - flank);
        const end = center + flank;
        
        // E-utils fetch (Note: 1-based coordinates)
        const url = `https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=nuccore&amp;id=${acc}&amp;from=${start}&amp;to=${end}&amp;rettype=fasta&amp;retmode=text`;
        
        const response = await fetch(url);
        if (!response.ok) throw new Error(`NCBI获取失败: ${response.statusText}`);
        
        const text = await response.text();
        if (!text.startsWith("&gt;")) {
            // Error response from NCBI usually isn't FASTA
            throw new Error("NCBI返回无效响应。请检查Accession ID和范围。");
        }

        setFastaInput(text);
        setTargetPosInput(center.toString());
        setFetchSuccessMsg(`成功获取 ${acc}:${start}-${end} 的序列。`);
        
        // 切换到Manual标签页让用户验证
        setInputMode("manual");

    } catch (e) {
        setErrorMsg((e as Error).message);
    } finally {
        setIsFetching(false);
    }
};
  
  // 格式化序列，每行固定长度
  const formatSequence = (seq: string, lineLength: number = 60): string =&gt; {
      const chunks: string[] = [];
      for (let i = 0; i &lt; seq.length; i += lineLength) {
          chunks.push(seq.slice(i, i + lineLength));
      }
      return chunks.join('\n');
  };
  
  // 你可以把这个函数添加到组件中，在handleProcessFile上面
  const resetFileState = () =&gt; {
      setFileObj(null);
      setFileChr("");
      setFilePos("");
      setFileFlank(0);
      setAvailableChromosomes([]);
      setErrorMsg("");
      setFetchSuccessMsg("");
  };

  const parseChromosomesFromFile = async (file: File) =&gt; {
      console.log("快速扫描染色体，文件:", file.name, "大小:", (file.size / 1024 / 1024).toFixed(2), "MB");
      
      setAvailableChromosomes([]);
      setFileChr("");
      
      try {
          // 使用stream API快速扫描文件中的染色体头
          const stream = file.stream();
          const decoder = new TextDecoder();
          const reader = stream.getReader();
          
          let buffer = "";
          const chromosomes = new Set&lt;string&gt;();
          let bytesRead = 0;
          const updateFrequency = 1024 * 1024 * 10; // 每10MB更新一次进度
          
          // 解析染色体ID的辅助函数
          const extractChrId = (headerLine: string) =&gt; {
              if (!headerLine.startsWith("&gt;")) return null;
              
              const header = headerLine.substring(1);
              let chrId = header.split(/\s+/)[0];
              chrId = chrId.replace(/^[&gt;\|:]+/, '').replace(/[\|:]+$/, '');
              
              return chrId &amp;&amp; chrId.length &gt; 0 ? chrId : null;
          };
          
          while (true) {
              const { done, value } = await reader.read();
              if (done) break;
              
              bytesRead += value.length;
              buffer += decoder.decode(value, { stream: true });
              
              // 按行分割并查找染色体头
              const lines = buffer.split(/\r?\n/);
              
              // 保留最后一行（可能不完整）
              buffer = lines.pop() || "";
              
              for (const line of lines) {
                  const chrId = extractChrId(line);
                  if (chrId) {
                      chromosomes.add(chrId);
                      console.log("找到染色体:", chrId);
                  }
              }
              
              // 每读取10MB更新一次进度
              if (bytesRead % updateFrequency &lt; value.length) {
                  console.log(`已扫描 ${(bytesRead / 1024 / 1024).toFixed(1)}MB, 找到 ${chromosomes.size} 个染色体`);
              }
              
              // 如果已经找到足够多的染色体，可以提前停止
              if (chromosomes.size &gt; 50) {
                  console.log("找到超过50个染色体，提前停止扫描");
                  break;
              }
          }
          
          // 处理缓冲区中剩余的内容
          if (buffer) {
              const chrId = extractChrId(buffer);
              if (chrId) {
                  chromosomes.add(chrId);
              }
          }
          
          await reader.cancel();
          
          const chrList = Array.from(chromosomes).sort();
          console.log("扫描完成，找到染色体:", chrList.length, "个");
          console.log("染色体列表:", chrList);
          
          setAvailableChromosomes(chrList);
          if (chrList.length &gt; 0) {
              setFileChr(chrList[0]);
          }
          
      } catch (error) {
          console.error("流式扫描染色体出错:", error);
          // 回退到原来的方法
          fallbackParseChromosomes(file);
      }
  };
  
  // 回退方法
  const fallbackParseChromosomes = (file: File) =&gt; {
      console.log("使用回退方法解析染色体");
      
      // 读取文件前5MB
      const chunkSize = Math.min(file.size, 5 * 1024 * 1024);
      const blob = file.slice(0, chunkSize);
      const reader = new FileReader();
      
      reader.onload = (e) =&gt; {
          try {
              const text = e.target?.result as string;
              const chromosomes = new Set&lt;string&gt;();
              
              // 简单按行分割查找
              const lines = text.split(/\r?\n/);
              for (let i = 0; i &lt; Math.min(lines.length, 1000); i++) {
                  const line = lines[i];
                  if (line.startsWith("&gt;")) {
                      const header = line.substring(1);
                      let chrId = header.split(/\s+/)[0];
                      chrId = chrId.replace(/^[&gt;\|:]+/, '').replace(/[\|:]+$/, '');
                      
                      if (chrId &amp;&amp; chrId.length &gt; 0) {
                          chromosomes.add(chrId);
                      }
                  }
              }
              
              const chrList = Array.from(chromosomes);
              console.log("回退方法找到染色体:", chrList);
              
              setAvailableChromosomes(chrList);
              if (chrList.length &gt; 0) {
                  setFileChr(chrList[0]);
              }
              
          } catch (error) {
              console.error("回退方法解析出错:", error);
          }
      };
      
      reader.readAsText(blob);
  };
    
  
  
  const handleProcessFile = async () =&gt; {
      setErrorMsg("");
      setFetchSuccessMsg("");
      setIsFileProcessing(true);
      setAnalysisResult(null);
  
      if (!fileObj) {
          setErrorMsg("Please select a file.");
          setIsFileProcessing(false);
          return;
      }
  
      try {
          const center = parseInt(filePos.trim());
          const flank = Number(fileFlank);
          const targetChr = fileChr.trim();
          
          if (isNaN(center)) throw new Error("Invalid position.");
          if (!targetChr) throw new Error("Please select a chromosome.");
          
          // 检查文件大小，给出提示
          const fileSizeMB = fileObj.size / (1024 * 1024);
          if (fileSizeMB &gt; 50) {
              console.log(`处理大文件: ${fileSizeMB.toFixed(1)}MB`);
              setFetchSuccessMsg(`Processing large file (${fileSizeMB.toFixed(1)}MB), please wait...`);
          }
          
          // 对于大文件，我们只提取所需的部分，而不是读取整个文件
          const result = await extractSequenceFromLargeFile(fileObj, targetChr, center, flank);
          
          const { sequence, startPos, endPos, chromosome } = result;
          
          // 生成新的FASTA格式
          const fileName = fileObj.name;
          const newHeader = `&gt;Local|${chromosome}|${fileName}|:${startPos}-${endPos}`;
          const newFasta = `${newHeader}\n${formatSequence(sequence, 60)}`;
          
          // 更新状态
          setFastaInput(newFasta);
          setTargetPosInput(center.toString());
          setFetchSuccessMsg(
              `Extracted ${sequence.length}bp from ${chromosome}:${startPos}-${endPos}`
          );
          setInputMode("manual");
          
      } catch (err) {
          const error = err as Error;
          console.error("Error processing file:", error);
          setErrorMsg(error.message || "Failed to process file.");
      } finally {
          setIsFileProcessing(false);
      }
  };

  // 新的函数：从大文件中提取序列
  const extractSequenceFromLargeFile = async (
      file: File, 
      targetChr: string, 
      center: number, 
      flank: number
  ): Promise&lt;{sequence: string, startPos: number, endPos: number, chromosome: string}&gt; =&gt; {
      
      return new Promise((resolve, reject) =&gt; {
          const fileSize = file.size;
          const chunkSize = 1024 * 1024; // 每次读取1MB
          let chunksToRead = Math.ceil(fileSize / chunkSize);
          
          console.log(`开始流式读取文件，总块数: ${chunksToRead}`);
          
          let currentChunk = 0;
          let foundTargetChr = false;
          let inTargetChr = false;
          let currentChr = "";
          let accumulatedSeq = "";
          let chrStartIndex = 0;
          let chrEndIndex = 0;
          
          // 用于跟踪位置
          let globalPosition = 0;
          let inSequence = false;
          
          const reader = new FileReader();
          
          const readNextChunk = () =&gt; {
              if (currentChunk &gt;= chunksToRead) {
                  reject(new Error(`Chromosome "${targetChr}" not found in file.`));
                  return;
              }
              
              const start = currentChunk * chunkSize;
              const end = Math.min(start + chunkSize, fileSize);
              const blob = file.slice(start, end);
              
              reader.readAsText(blob);
          };
          
          reader.onload = (e) =&gt; {
              try {
                  const text = e.target?.result as string;
                  currentChunk++;
                  
                  // 更新进度
                  const progress = Math.min((currentChunk / chunksToRead) * 100, 100);
                  console.log(`读取进度: ${progress.toFixed(1)}%`);
                  
                  const lines = text.split(/\r?\n/);
                  
                  for (let i = 0; i &lt; lines.length; i++) {
                      const line = lines[i];
                      
                      if (line.startsWith("&gt;")) {
                          // 新的序列头
                          inSequence = false;
                          const header = line.substring(1);
                          currentChr = header.split(/\s+/)[0];
                          
                          // 清理染色体ID
                          currentChr = currentChr.replace(/^[&gt;\|:]+/, '').replace(/[\|:]+$/, '');
                          
                          if (currentChr === targetChr) {
                              foundTargetChr = true;
                              inTargetChr = true;
                              chrStartIndex = globalPosition;
                              console.log(`找到目标染色体: ${targetChr}`);
                          } else if (inTargetChr) {
                              // 已经离开目标染色体
                              inTargetChr = false;
                              chrEndIndex = globalPosition;
                              console.log(`离开目标染色体，累积序列长度: ${accumulatedSeq.length}`);
                              break; // 停止处理，我们已经得到目标染色体的所有数据
                          }
                      } else if (inTargetChr &amp;&amp; line.trim()) {
                          // 在目标染色体中，累积序列
                          accumulatedSeq += line.trim().toUpperCase();
                          globalPosition += line.trim().length;
                          inSequence = true;
                      } else if (line.trim()) {
                          // 不在目标染色体中，但也需要计数
                          globalPosition += line.trim().length;
                      }
                  }
                  
                  // 如果已经找到目标染色体并且累积了足够的序列，或者已经读取完文件
                  if (foundTargetChr &amp;&amp; (!inTargetChr || currentChunk &gt;= chunksToRead)) {
                      if (currentChunk &gt;= chunksToRead &amp;&amp; inTargetChr) {
                          chrEndIndex = globalPosition;
                      }
                      
                      // 现在提取目标区域的序列
                      const centerIdx = center - 1;
                      const startIdx = Math.max(0, centerIdx - flank);
                      const endIdx = Math.min(accumulatedSeq.length, centerIdx + flank + 1);
                      
                      const regionSeq = accumulatedSeq.slice(startIdx, endIdx);
                      
                      if (!regionSeq || regionSeq.length === 0) {
                          reject(new Error(
                              `Position ${center} is out of range for "${targetChr}". ` +
                              `Chromosome length: ${accumulatedSeq.length}`
                          ));
                          return;
                      }
                      
                      const dispStart = startIdx + 1;
                      const dispEnd = startIdx + regionSeq.length;
                      
                      resolve({
                          sequence: regionSeq,
                          startPos: dispStart,
                          endPos: dispEnd,
                          chromosome: targetChr
                      });
                      
                  } else {
                      // 继续读取下一块
                      readNextChunk();
                  }
                  
              } catch (error) {
                  reject(error);
              }
          };
          
          reader.onerror = (error) =&gt; {
              reject(new Error(`File read error: ${error.type}`));
          };
          
          // 开始读取
          readNextChunk();
      });
  };

  
  

  const handleAnalyze = () =&gt; {
    setErrorMsg("");
    setPrimerResult(null);
    try {
      if (!fastaInput.trim()) throw new Error("Please enter a FASTA sequence.");
      const { header, seq } = getCleanSequence(fastaInput);
      const { start, end, isReverse } = parseCoordinates(header);
      const targetPos = parseInt(targetPosInput);
      
      if (isNaN(targetPos)) throw new Error("Invalid target position.");

      const minCoord = Math.min(start, end);
      const maxCoord = Math.max(start, end);

      if (targetPos &lt; minCoord || targetPos &gt; maxCoord) {
        throw new Error(`Position ${targetPos} is outside range (${minCoord}-${maxCoord})`);
      }

      let relPos: number;
      let workingSeq: string;
      let strand: "Forward" | "Reverse";

      if (isReverse) {
         // Logic from python: distance_from_end = max(start, end) - target_pos
         // rel_pos = seq_length - distance_from_end - 1
         const distFromEnd = maxCoord - targetPos;
         workingSeq = reverseComplement(seq);
         relPos = workingSeq.length - distFromEnd - 1; 
         strand = "Reverse";
      } else {
        relPos = targetPos - minCoord;
        workingSeq = seq;
        strand = "Forward";
      }

      if (relPos &lt; 0 || relPos &gt;= workingSeq.length) {
         throw new Error("Calculated relative position is out of bounds.");
      }

      const base = workingSeq[relPos];

      // Prepare highlight parts
      const pre = workingSeq.substring(0, relPos);
      const target = workingSeq.substring(relPos, relPos + 1);
      const post = workingSeq.substring(relPos + 1);

      setAnalysisResult({
        strand,
        base,
        relPos,
        genomicPos: targetPos,
        totalLen: workingSeq.length,
        highlightedSeq: { pre, target, post }
      });

    } catch (e) {
      setErrorMsg((e as Error).message);
      setAnalysisResult(null);
    }
  };

  const handleDesignPrimer = () =&gt; {
    setErrorMsg("");
    if (!analysisResult) {
      setErrorMsg("Please locate the base first before designing primers.");
      return;
    }

    try {
      const { header, seq } = getCleanSequence(fastaInput);
      const { isReverse } = parseCoordinates(header);
      
      // Reconstruct working sequence (same as in analysis)
      const workingSeq = isReverse ? reverseComplement(seq) : seq;
      const relPos = analysisResult.relPos;

      let bestResult: PrimerResult | null = null;
      let bestScore = -1;

      // Search Loop
      const step = 50;
      for (
        let pSize = params.idealProductSize - params.tolerance;
        pSize &lt;= params.idealProductSize + params.tolerance;
        pSize += step
      ) {
        if (pSize &lt; 50) continue; // safety

        const half = Math.floor(pSize / 2);
        const regionStart = Math.max(0, relPos - half);
        const regionEnd = Math.min(workingSeq.length, relPos + half);

        if (regionStart &gt;= regionEnd) continue;

        const fwdCandidates = getPrimerCandidates(
          workingSeq,
          regionStart,
          relPos,
          params.minLen,
          params.maxLen,
          true
        );

        const revCandidates = getPrimerCandidates(
          workingSeq,
          relPos,
          regionEnd,
          params.minLen,
          params.maxLen,
          false
        );

        // Evaluate Pairs
        for (const fwd of fwdCandidates) {
          for (const rev of revCandidates) {
            const productLen = rev.pos - fwd.pos + fwd.len;
            if (productLen &lt; 200 || productLen &gt; 800) continue;
            if (hasDimer(fwd.seq, rev.seq)) continue;

            const sizeDiff = Math.abs(productLen - params.idealProductSize);
            const tmDiff = Math.abs(fwd.tm - rev.tm);
            const gcDiff = Math.abs(fwd.gc - rev.gc);

            const score = 100 - 0.2 * sizeDiff - 2 * tmDiff - gcDiff;

            if (score &gt; bestScore) {
              bestScore = score;
              // Calc product seq
              // fwd.pos is start index in workingSeq
              // rev is reverse complement. rev.pos is the start index of the reverse primer in the forward strand? 
              // Wait, getPrimerCandidates 'pos' for Reverse primer returns 'i' which is the start index in 'seq'.
              // For reverse primer, the sequence is RC of seq[i:i+len].
              // The PCR product spans from fwd.pos to (rev.pos + rev.len).
              const productSeq = workingSeq.slice(fwd.pos, rev.pos + rev.len);
              
              bestResult = {
                forward: fwd,
                reverse: rev,
                productSize: productLen,
                score,
                productSeq
              };
            }
          }
        }
      }

      if (!bestResult) {
        throw new Error("No suitable primers found. Try adjusting parameters (e.g., widen tolerance).");
      }

      setPrimerResult(bestResult);

    } catch (e) {
      setErrorMsg((e as Error).message);
    }
  };

const copyToClipboard = () =&gt; {
    if (!primerResult) return;
    
    const text = `
Forward Primer: ${primerResult.forward.seq}
Reverse Primer: ${primerResult.reverse.seq}
Product Size: ${primerResult.productSize} bp
Product: ${primerResult.productSeq} 
Tm Difference: ${Math.abs(primerResult.forward.tm - primerResult.reverse.tm).toFixed(1)}°C
    `.trim();
    
    // 创建textarea元素
    const textArea = document.createElement("textarea");
    textArea.value = text;
    
    // 避免屏幕闪烁
    textArea.style.position = "fixed";
    textArea.style.top = "0";
    textArea.style.left = "0";
    textArea.style.width = "2em";
    textArea.style.height = "2em";
    textArea.style.padding = "0";
    textArea.style.border = "none";
    textArea.style.outline = "none";
    textArea.style.boxShadow = "none";
    textArea.style.background = "transparent";
    
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        // 尝试使用execCommand
        const successful = document.execCommand("copy");
        if (successful) {
            setSuccessMsg("Copied to clipboard!");
        } else {
            setSuccessMsg("Copy failed. Please copy manually.");
        }
    } catch (err) {
        console.error("Copy failed:", err);
        setSuccessMsg("Copy failed. Please copy manually.");
    }
    
    // 清理
    document.body.removeChild(textArea);
    
    // 清除消息
    setTimeout(() =&gt; setSuccessMsg(""), 3000);
};

  return (
    &lt;div className="container"&gt;
      &lt;header style={{ marginBottom: "2rem", borderBottom: "1px solid #e2e8f0", paddingBottom: "1rem" }}&gt;
        &lt;h1 style={{ fontSize: "1.5rem", fontWeight: "bold", color: "#1e293b" }}&gt;DNA Sequence &amp; Primer Tool&lt;/h1&gt;
        &lt;p style={{ color: "#64748b" }}&gt;Locate genomic coordinates and design PCR primers directly in your browser.&lt;/p&gt;
      &lt;/header&gt;

      &lt;div className="grid grid-cols-2" style={{ gap: "2rem", gridTemplateColumns: window.innerWidth &lt; 800 ? "1fr" : "2fr 1fr" }}&gt;
        {/* Left Column: Inputs */}
        &lt;div&gt;
          {/* Input Tabs */}
          &lt;div style={{ display: "flex", gap: "0.5rem", marginBottom: "1rem" }}&gt;
              &lt;button 
                  className={`btn ${inputMode === 'manual' ? 'btn-primary' : 'btn-secondary'}`} 
                  onClick={() =&gt; setInputMode('manual')}
              &gt;
                  Manual Sequence
              &lt;/button&gt;
              &lt;button 
                  className={`btn ${inputMode === 'ncbi' ? 'btn-primary' : 'btn-secondary'}`} 
                  onClick={() =&gt; setInputMode('ncbi')}
              &gt;
                  NCBI Fetch
              &lt;/button&gt;
              &lt;button 
                  className={`btn ${inputMode === 'file' ? 'btn-primary' : 'btn-secondary'}`} 
                  onClick={() =&gt; setInputMode('file')}
              &gt;
                  Local File
              &lt;/button&gt;
          &lt;/div&gt;

          {/* Tab Content: NCBI */}
          {inputMode === 'ncbi' &amp;&amp; (
              &lt;div className="card" style={{ borderLeft: "4px solid #8b5cf6" }}&gt;
                  &lt;h2 style={{ fontSize: "1.1rem", fontWeight: "bold", marginBottom: "1rem" }}&gt;Fetch from NCBI&lt;/h2&gt;
                  &lt;p style={{ fontSize: "0.9rem", color: "#64748b", marginBottom: "1rem" }}&gt;
                      输入基因组ID或直接输入Accession ID获取序列。
                      {genomeId === "GCF_902806645.1" &amp;&amp; (
                          &lt;span style={{ color: "#059669", fontWeight: "bold" }}&gt;
                               {" "}(已预定义染色体列表)
                          &lt;/span&gt;
                      )}
                  &lt;/p&gt;
                  
                  {/* 基因组ID输入 */}
                  &lt;div className="input-group"&gt;
                      &lt;label className="input-label"&gt;Genome ID (可选)&lt;/label&gt;
                      &lt;div style={{ display: "flex", gap: "0.5rem" }}&gt;
                          &lt;input 
                              type="text" 
                              className="input-field flex-1" 
                              value={genomeId} 
                              onChange={e =&gt; setGenomeId(e.target.value)} 
                              placeholder="例如: GCF_902806645.1"
                          /&gt;
                          &lt;button 
                              className="btn btn-secondary"
                              onClick={() =&gt; genomeId &amp;&amp; fetchGenomeInfo(genomeId)}
                              disabled={isLoadingGenome || !genomeId}
                              style={{ 
                                  whiteSpace: "nowrap",
                                  opacity: (isLoadingGenome || !genomeId) ? 0.5 : 1,
                                  cursor: (isLoadingGenome || !genomeId) ? "not-allowed" : "pointer"
                              }}
                          &gt;
                              {isLoadingGenome ? "加载中..." : "检查基因组"}
                          &lt;/button&gt;
                      &lt;/div&gt;
                      &lt;p style={{ fontSize: "0.75rem", color: "#6b7280", marginTop: "0.25rem" }}&gt;
                          目前仅支持 GCF_902806645.1 的预定义染色体列表
                      &lt;/p&gt;
                  &lt;/div&gt;
                  
                  {/* 染色体选择器 - 只有当有染色体列表时才显示 */}
                  {genomeChromosomes.length &gt; 0 &amp;&amp; (
                      &lt;div className="input-group"&gt;
                          &lt;label className="input-label"&gt;选择染色体&lt;/label&gt;
                          &lt;select
                              className="input-field"
                              value={ncbiAccession}
                              onChange={e =&gt; setNcbiAccession(e.target.value)}
                              style={{
                                  width: "100%",
                                  padding: "0.5rem 0.75rem",
                                  border: "1px solid #d1d5db",
                                  borderRadius: "0.375rem"
                              }}
                          &gt;
                              &lt;option value=""&gt;请选择染色体...&lt;/option&gt;
                              
                              {/* Chromosomes 组 */}
                              &lt;optgroup label="Chromosomes"&gt;
                                  {genomeChromosomes
                                      .filter(chr =&gt; chr.group === "Chromosomes")
                                      .map(chr =&gt; (
                                          &lt;option key={chr.id} value={chr.id}&gt;
                                              {chr.name}
                                          &lt;/option&gt;
                                      ))
                                  }
                              &lt;/optgroup&gt;
                          &lt;/select&gt;
                          &lt;p style={{ fontSize: "0.75rem", color: "#059669", marginTop: "0.25rem" }}&gt;
                              ✓ 找到 {genomeChromosomes.length} 条染色体
                          &lt;/p&gt;
                      &lt;/div&gt;
                  )}
                  
                  {/* 直接输入Accession ID (始终显示) */}
                  &lt;div className="input-group"&gt;
                      &lt;label className="input-label"&gt;
                          {genomeChromosomes.length &gt; 0 ? "或手动输入Accession ID:" : "输入Accession ID:"}
                      &lt;/label&gt;
                      &lt;input 
                          type="text" 
                          className="input-field" 
                          value={ncbiAccession} 
                          onChange={e =&gt; setNcbiAccession(e.target.value)} 
                          placeholder="例如: NC_047567.1"
                      /&gt;
                      &lt;p style={{ fontSize: "0.75rem", color: "#6b7280", marginTop: "0.25rem" }}&gt;
                          必须是有效的NCBI Accession ID (如 NC_xxxxxxx.x)
                      &lt;/p&gt;
                  &lt;/div&gt;
                  
                  &lt;div className="grid grid-cols-2"&gt;
                      &lt;div className="input-group"&gt;
                          &lt;label className="input-label"&gt;目标位置 (1-based)&lt;/label&gt;
                          &lt;input 
                              type="number" 
                              min="1"
                              className="input-field" 
                              value={ncbiPos} 
                              onChange={e =&gt; setNcbiPos(e.target.value)} 
                              placeholder="例如: 1000"
                          /&gt;
                      &lt;/div&gt;
                      
                      &lt;div className="input-group"&gt;
                          &lt;label className="input-label"&gt;侧翼长度 (bp)&lt;/label&gt;
                          &lt;input 
                              type="number" 
                              min="50"
                              max="100000"
                              className="input-field" 
                              value={ncbiFlank} 
                              onChange={e =&gt; setNcbiFlank(parseInt(e.target.value) || 500)} 
                              placeholder="例如: 500"
                          /&gt;
                      &lt;/div&gt;
                  &lt;/div&gt;
                  
                  &lt;button 
                      className="btn btn-primary" 
                      onClick={handleFetchNCBI} 
                      disabled={isFetching || !ncbiAccession}
                      style={{
                          opacity: (isFetching || !ncbiAccession) ? 0.5 : 1,
                          cursor: (isFetching || !ncbiAccession) ? "not-allowed" : "pointer",
                          marginTop: "1rem"
                      }}
                  &gt;
                      {isFetching ? (
                          &lt;span style={{ display: "flex", alignItems: "center", gap: "0.5rem" }}&gt;
                              &lt;span style={{
                                  display: "inline-block",
                                  width: "1rem",
                                  height: "1rem",
                                  border: "2px solid transparent",
                                  borderTop: "2px solid white",
                                  borderRadius: "50%",
                                  animation: "spin 1s linear infinite"
                              }}&gt;&lt;/span&gt;
                              正在获取序列...
                          &lt;/span&gt;
                      ) : "获取序列"}
                  &lt;/button&gt;
                  
                  {/* 添加CSS动画 */}
                  &lt;style&gt;{`
                      @keyframes spin {
                          0% { transform: rotate(0deg); }
                          100% { transform: rotate(360deg); }
                      }
                  `}&lt;/style&gt;
              &lt;/div&gt;
          )}

          {/* Tab Content: File */}
          {inputMode === 'file' &amp;&amp; (
              &lt;div className="card" style={{ borderLeft: "4px solid #10b981" }}&gt;
                  &lt;h2 style={{ fontSize: "1.1rem", fontWeight: "bold", marginBottom: "1rem" }}&gt;Extract from Local File&lt;/h2&gt;
                  &lt;p style={{ fontSize: "0.9rem", color: "#64748b", marginBottom: "1rem" }}&gt;
                      Select a chromosome/genome FASTA file. We will extract a window around your target position.
                      &lt;br /&gt;
                      &lt;span style={{ color: "#f59e0b", fontWeight: "bold" }}&gt;
                          Note: Large files (over 100MB) may take longer to process.
                      &lt;/span&gt;
                  &lt;/p&gt;
                  
                  {/* 文件上传部分 */}
                  &lt;div className="input-group"&gt;
                      &lt;label className="input-label"&gt;Select FASTA File&lt;/label&gt;
                      &lt;input 
                          type="file" 
                          className="input-field" 
                          accept=".fasta,.fa,.txt,.fna,.gz"
                          onChange={e =&gt; {
                              const file = e.target.files?.[0] || null;
                              if (file) {
                                  const fileSizeMB = file.size / (1024 * 1024);
                                  console.log(`选择文件: ${file.name}, 大小: ${fileSizeMB.toFixed(1)}MB`);
                                  
                                  if (fileSizeMB &gt; 200) {
                                      if (!confirm(`This file is ${fileSizeMB.toFixed(0)}MB. Processing may take a while. Continue?`)) {
                                          e.target.value = ""; // 清空选择
                                          return;
                                      }
                                  }
                                  
                                  setFileObj(file);
                                  // 重置状态
                                  setAvailableChromosomes([]);
                                  setFileChr("");
                                  setFilePos("");
                                  setFileFlank(1000);
                                  
                                  // 开始解析染色体（只读取头部）
                                  parseChromosomesFromFile(file);
                              }
                          }} 
                      /&gt;
                      {/* 在文件上传部分添加进度反馈 */}
                      {fileObj &amp;&amp; (
                          &lt;div style={{ marginTop: "0.5rem" }}&gt;
                              &lt;p style={{ fontSize: "0.8rem", color: "#059669", margin: 0 }}&gt;
                                  Selected: {fileObj.name} 
                                  ({(fileObj.size / 1024 / 1024).toFixed(1)}MB)
                              &lt;/p&gt;
                              {availableChromosomes.length === 0 &amp;&amp; (
                                  &lt;p style={{ fontSize: "0.8rem", color: "#f59e0b", margin: "0.25rem 0 0 0" }}&gt;
                                      Scanning file for chromosomes...
                                  &lt;/p&gt;
                              )}
                              {availableChromosomes.length &gt; 0 &amp;&amp; (
                                  &lt;p style={{ fontSize: "0.8rem", color: "#059669", margin: "0.25rem 0 0 0" }}&gt;
                                      Found {availableChromosomes.length} chromosome(s)
                                  &lt;/p&gt;
                              )}
                          &lt;/div&gt;
                      )}
                  &lt;/div&gt;
                  
                  &lt;div className="grid grid-cols-2"&gt;
                      {/* 染色体选择部分 */}
                      &lt;div className="input-group"&gt;
                          &lt;label className="input-label"&gt;Chromosome/Contig&lt;/label&gt;
                          &lt;select
                              className="input-field"
                              value={fileChr}
                              onChange={e =&gt; setFileChr(e.target.value)}
                              disabled={!fileObj || availableChromosomes.length === 0}
                              style={{
                                  width: "100%",
                                  padding: "0.5rem 0.75rem",
                                  border: "1px solid #d1d5db",
                                  borderRadius: "0.375rem",
                                  backgroundColor: (!fileObj || availableChromosomes.length === 0) ? "#f3f4f6" : "white",
                                  cursor: (!fileObj || availableChromosomes.length === 0) ? "not-allowed" : "pointer"
                              }}
                          &gt;
                              {!fileObj ? (
                                  &lt;option value=""&gt;Upload a file first&lt;/option&gt;
                              ) : availableChromosomes.length === 0 ? (
                                  &lt;option value=""&gt;Parsing chromosomes...&lt;/option&gt;
                              ) : (
                                  &lt;&gt;
                                      &lt;option value=""&gt;Select a chromosome...&lt;/option&gt;
                                      {availableChromosomes.map(chr =&gt; (
                                          &lt;option key={chr} value={chr}&gt;
                                              {chr.length &gt; 30 ? `${chr.substring(0, 27)}...` : chr}
                                          &lt;/option&gt;
                                      ))}
                                  &lt;/&gt;
                              )}
                          &lt;/select&gt;
                          
                          {availableChromosomes.length &gt; 0 &amp;&amp; (
                              &lt;p style={{ fontSize: "0.75rem", color: "#059669", marginTop: "0.25rem" }}&gt;
                                  Found {availableChromosomes.length} chromosome{availableChromosomes.length !== 1 ? 's' : ''}
                              &lt;/p&gt;
                          )}
                          {fileObj &amp;&amp; availableChromosomes.length === 0 &amp;&amp; (
                              &lt;p style={{ fontSize: "0.75rem", color: "#ef4444", marginTop: "0.25rem" }}&gt;
                                  No chromosomes detected. Check file format (must start with '&gt;'). 
                                  For large files, only the first 1MB is scanned for headers.
                              &lt;/p&gt;
                          )}
                      &lt;/div&gt;
                      
                      {/* 目标位置 */}
                      &lt;div className="input-group"&gt;
                          &lt;label className="input-label"&gt;Target Position (1-based)&lt;/label&gt;
                          &lt;input 
                              type="number" 
                              min="1"
                              className="input-field" 
                              value={filePos} 
                              onChange={e =&gt; setFilePos(e.target.value)} 
                              placeholder="e.g., 31898289"
                          /&gt;
                      &lt;/div&gt;
                      
                      {/* 侧翼长度 */}
                      &lt;div className="input-group"&gt;
                          &lt;label className="input-label"&gt;Flanking (bp)&lt;/label&gt;
                          &lt;input 
                              type="number" 
                              min="0"
                              max="100000"
                              className="input-field" 
                              value={fileFlank} 
                              onChange={e =&gt; setFileFlank(parseInt(e.target.value) || 0)} 
                              placeholder="e.g., 1000"
                          /&gt;
                          &lt;p style={{ fontSize: "0.75rem", color: "#6b7280", marginTop: "0.25rem" }}&gt;
                              Maximum extraction: 200,000bp total
                          &lt;/p&gt;
                      &lt;/div&gt;
                  &lt;/div&gt;
                  
                  {/* 处理按钮 */}
                  &lt;button 
                      className="btn btn-primary" 
                      onClick={handleProcessFile} 
                      disabled={isFileProcessing || !fileObj || !fileChr || !filePos}
                      style={{
                          opacity: (isFileProcessing || !fileObj || !fileChr || !filePos) ? 0.6 : 1,
                          cursor: (isFileProcessing || !fileObj || !fileChr || !filePos) ? "not-allowed" : "pointer",
                          position: "relative"
                      }}
                  &gt;
                      {isFileProcessing ? (
                          &lt;&gt;
                              &lt;span style={{
                                  position: "absolute",
                                  left: "1rem",
                                  display: "inline-block",
                                  width: "1rem",
                                  height: "1rem",
                                  border: "2px solid transparent",
                                  borderTop: "2px solid white",
                                  borderRadius: "50%",
                                  animation: "spin 1s linear infinite"
                              }}&gt;&lt;/span&gt;
                              Processing Large File...
                          &lt;/&gt;
                      ) : "Extract &amp; Load"}
                  &lt;/button&gt;
                  
                  {/* 警告信息 */}
                  {fileObj &amp;&amp; (fileObj.size &gt; 100 * 1024 * 1024) &amp;&amp; (
                      &lt;div style={{
                          marginTop: "1rem",
                          padding: "0.75rem",
                          backgroundColor: "#fffbeb",
                          border: "1px solid #f59e0b",
                          borderRadius: "0.375rem"
                      }}&gt;
                          &lt;p style={{ fontSize: "0.875rem", color: "#92400e", margin: 0 }}&gt;
                              ⚠️ &lt;strong&gt;Large File Detected&lt;/strong&gt; - This file is {(fileObj.size / 1024 / 1024).toFixed(0)}MB. 
                              Extraction may take 10-30 seconds. Please be patient.
                          &lt;/p&gt;
                      &lt;/div&gt;
                  )}
                  
                  &lt;style&gt;{`
                      @keyframes spin {
                          0% { transform: rotate(0deg); }
                          100% { transform: rotate(360deg); }
                      }
                  `}&lt;/style&gt;
              &lt;/div&gt;
          )}




          {/* Main Manual View (Always visible if Manual, or used for Verification) */}
          {(inputMode === 'manual') &amp;&amp; (
            &lt;div className="card"&gt;
                {fetchSuccessMsg &amp;&amp; (
                    &lt;div style={{ background: "#dcfce7", color: "#166534", padding: "0.75rem", borderRadius: "0.375rem", marginBottom: "1rem" }}&gt;
                        {fetchSuccessMsg}
                    &lt;/div&gt;
                )}
                
                &lt;div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: "1rem" }}&gt;
                    &lt;h2 style={{ fontSize: "1.1rem", fontWeight: "bold", margin: 0 }}&gt;Input Sequence&lt;/h2&gt;
                    &lt;button className="btn btn-secondary" style={{ fontSize: "0.75rem", padding: "0.25rem 0.5rem" }} onClick={loadExample}&gt;Load Example&lt;/button&gt;
                &lt;/div&gt;

                &lt;div className="input-group"&gt;
                &lt;label className="input-label"&gt;FASTA Sequence (Verify here)&lt;/label&gt;
                &lt;textarea
                    className="input-field font-mono"
                    rows={10}
                    value={fastaInput}
                    onChange={(e) =&gt; setFastaInput(e.target.value)}
                    placeholder="&gt;Header
ATCG..."
                &gt;&lt;/textarea&gt;
                &lt;/div&gt;
                
                &lt;div className="input-group"&gt;
                &lt;label className="input-label"&gt;Genomic Position (to Locate)&lt;/label&gt;
                &lt;input
                    type="text"
                    className="input-field"
                    value={targetPosInput}
                    onChange={(e) =&gt; setTargetPosInput(e.target.value)}
                /&gt;
                &lt;/div&gt;

                &lt;div style={{ marginTop: "1rem" }}&gt;
                    &lt;button className="btn btn-primary" onClick={handleAnalyze}&gt;Locate Base&lt;/button&gt;
                &lt;/div&gt;
            &lt;/div&gt;
          )}

          {/* Analysis View */}
          {errorMsg &amp;&amp; (
            &lt;div style={{ background: "#fee2e2", color: "#b91c1c", padding: "1rem", borderRadius: "0.5rem", marginBottom: "1rem" }}&gt;
              {errorMsg}
            &lt;/div&gt;
          )}

          {analysisResult &amp;&amp; (
            &lt;div className="card"&gt;
                &lt;div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: "1rem" }}&gt;
                    &lt;h2 style={{ fontSize: "1.1rem", fontWeight: "bold", margin:0 }}&gt;Sequence View&lt;/h2&gt;
                    &lt;div&gt;
                        &lt;span className="badge badge-blue"&gt;{analysisResult.strand} Strand&lt;/span&gt;
                        &lt;span className="badge badge-green" style={{ marginLeft: "0.5rem" }}&gt;
                            Base {analysisResult.base} @ {analysisResult.relPos + 1}
                        &lt;/span&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                &lt;div className="sequence-viewer font-mono" ref={seqViewRef}&gt;
                    {analysisResult.highlightedSeq.pre}
                    &lt;mark&gt;{analysisResult.highlightedSeq.target}&lt;/mark&gt;
                    {analysisResult.highlightedSeq.post}
                &lt;/div&gt;
            &lt;/div&gt;
          )}
        &lt;/div&gt;

        {/* Right Column: Parameters &amp; Primer Results */}
        &lt;div&gt;
           &lt;div className="card"&gt;
             &lt;h2 style={{ fontSize: "1.1rem", fontWeight: "bold", marginBottom: "1rem" }}&gt;Settings&lt;/h2&gt;
             &lt;div className="grid grid-cols-2" style={{ gap: "1rem" }}&gt;
                &lt;div className="input-group"&gt;
                    &lt;label className="input-label"&gt;Product Size&lt;/label&gt;
                    &lt;input 
                        type="number" className="input-field" 
                        value={params.idealProductSize}
                        onChange={(e) =&gt; setParams({...params, idealProductSize: parseInt(e.target.value)})}
                    /&gt;
                &lt;/div&gt;
                &lt;div className="input-group"&gt;
                    &lt;label className="input-label"&gt;Tolerance (+/-)&lt;/label&gt;
                    &lt;input 
                        type="number" className="input-field" 
                        value={params.tolerance}
                        onChange={(e) =&gt; setParams({...params, tolerance: parseInt(e.target.value)})}
                    /&gt;
                &lt;/div&gt;
                &lt;div className="input-group"&gt;
                    &lt;label className="input-label"&gt;Min Primer Len&lt;/label&gt;
                    &lt;input 
                        type="number" className="input-field" 
                        value={params.minLen}
                        onChange={(e) =&gt; setParams({...params, minLen: parseInt(e.target.value)})}
                    /&gt;
                &lt;/div&gt;
                &lt;div className="input-group"&gt;
                    &lt;label className="input-label"&gt;Max Primer Len&lt;/label&gt;
                    &lt;input 
                        type="number" className="input-field" 
                        value={params.maxLen}
                        onChange={(e) =&gt; setParams({...params, maxLen: parseInt(e.target.value)})}
                    /&gt;
                &lt;/div&gt;
             &lt;/div&gt;
             &lt;button 
                className="btn btn-primary" 
                style={{ width: "100%", marginTop: "1rem" }}
                onClick={handleDesignPrimer}
                disabled={!analysisResult}
             &gt;
                Design Primers
             &lt;/button&gt;
           &lt;/div&gt;

           {primerResult &amp;&amp; (
               &lt;div className="card" style={{ borderLeft: "4px solid #2563eb" }}&gt;
                   &lt;h2 style={{ fontSize: "1.1rem", fontWeight: "bold", marginBottom: "1rem" }}&gt;Primer Result&lt;/h2&gt;
                   
                   &lt;div style={{ marginBottom: "0.5rem", fontSize: "0.9rem" }}&gt;
                       &lt;strong&gt;Score:&lt;/strong&gt; {primerResult.score.toFixed(1)} &lt;br/&gt;
                       &lt;strong&gt;Product Size:&lt;/strong&gt; {primerResult.productSize} bp &lt;br/&gt;
                       &lt;strong&gt;Tm Diff:&lt;/strong&gt; {Math.abs(primerResult.forward.tm - primerResult.reverse.tm).toFixed(1)}°C
                   &lt;/div&gt;
                   
                   &lt;div style={{ marginTop: "1rem" }}&gt;
                       &lt;label className="input-label"&gt;Forward Primer (5'→3')&lt;/label&gt;
                       &lt;div className="font-mono" style={{ background: "#f1f5f9", padding: "0.5rem", borderRadius: "4px", fontSize: "0.85rem", wordBreak: "break-all" }}&gt;
                           {primerResult.forward.seq}
                       &lt;/div&gt;
                       &lt;div style={{ fontSize: "0.75rem", color: "#64748b", marginTop: "2px" }}&gt;
                           Tm: {primerResult.forward.tm}°C | GC: {primerResult.forward.gc}%
                       &lt;/div&gt;
                   &lt;/div&gt;

                   &lt;div style={{ marginTop: "1rem" }}&gt;
                       &lt;label className="input-label"&gt;Reverse Primer (5'→3')&lt;/label&gt;
                       &lt;div className="font-mono" style={{ background: "#f1f5f9", padding: "0.5rem", borderRadius: "4px", fontSize: "0.85rem", wordBreak: "break-all" }}&gt;
                           {primerResult.reverse.seq}
                       &lt;/div&gt;
                       &lt;div style={{ fontSize: "0.75rem", color: "#64748b", marginTop: "2px" }}&gt;
                           Tm: {primerResult.reverse.tm}°C | GC: {primerResult.reverse.gc}%
                       &lt;/div&gt;
                   &lt;/div&gt;

                   &lt;div style={{ marginTop: "1rem" }}&gt;
                       &lt;label className="input-label"&gt;Product Seq (5'→3')&lt;/label&gt;
                       &lt;div className="font-mono" style={{ background: "#f1f5f9", padding: "0.5rem", borderRadius: "4px", fontSize: "0.85rem", wordBreak: "break-all" }}&gt;
                             {primerResult.productSeq}
                       &lt;/div&gt;
                   &lt;/div&gt;

                   &lt;button 
                    className="btn btn-primary" 
                    style={{ width: "100%", marginTop: "1.5rem", fontSize: "0.85rem" }}
                    onClick={copyToClipboard}
                    disabled={!primerResult}
                   &gt;
                    {successMsg ? (
                        &lt;span style={{ color: "#f3e8ff" }}&gt;
                            ✓ {successMsg}
                        &lt;/span&gt;
                    ) : "Copy Sequences"}
                  &lt;/button&gt;
               &lt;/div&gt;
           )}
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  );
}

const root = createRoot(document.getElementById("root")!);
root.render(&lt;App /&gt;);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><pre class="line-numbers language-none"><code class="language-none">{
  "name": "find_seq",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "cors-anywhere": "^0.4.4",
    "react": "^19.2.0",
    "react-dom": "^19.2.0"
  },
  "devDependencies": {
    "@types/node": "^22.14.0",
    "@vitejs/plugin-react": "^5.0.0",
    "typescript": "~5.8.2",
    "vite": "^6.2.0"
  }
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="package-lock-json"><a href="#package-lock-json" class="headerlink" title="package-lock.json"></a>package-lock.json</h3><pre class="line-numbers language-none"><code class="language-none">{
  "name": "find_seq",
  "version": "0.0.0",
  "lockfileVersion": 3,
  "requires": true,
  "packages": {
    "": {
      "name": "find_seq",
      "version": "0.0.0",
      "dependencies": {
        "cors-anywhere": "^0.4.4",
        "react": "^19.2.0",
        "react-dom": "^19.2.0"
      },
      "devDependencies": {
        "@types/node": "^22.14.0",
        "@vitejs/plugin-react": "^5.0.0",
        "typescript": "~5.8.2",
        "vite": "^6.2.0"
      }
    },
    "node_modules/@babel/code-frame": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/code-frame/-/code-frame-7.27.1.tgz",
      "integrity": "sha512-cjQ7ZlQ0Mv3b47hABuTevyTuYN4i+loJKGeV9flcCgIK37cCXRh+L1bd3iBHlynerhQ7BhCkn2BPbQUL+rGqFg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/helper-validator-identifier": "^7.27.1",
        "js-tokens": "^4.0.0",
        "picocolors": "^1.1.1"
      },
      "engines": {
        "node": "&gt;=6.9.0"
      }
    },
    "node_modules/@babel/compat-data": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/compat-data/-/compat-data-7.28.5.tgz",
      "integrity": "sha512-6uFXyCayocRbqhZOB+6XcuZbkMNimwfVGFji8CTZnCzOHVGvDqzvitu1re2AU5LROliz7eQPhB8CpAMvnx9EjA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "&gt;=6.9.0"
      }
    },
    "node_modules/@babel/core": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/core/-/core-7.28.5.tgz",
      "integrity": "sha512-e7jT4DxYvIDLk1ZHmU/m/mB19rex9sv0c2ftBtjSBv+kVM/902eh0fINUzD7UwLLNR+jU585GxUJ8/EBfAM5fw==",
      "dev": true,
      "license": "MIT",
      "peer": true,
      "dependencies": {
        "@babel/code-frame": "^7.27.1",
        "@babel/generator": "^7.28.5",
        "@babel/helper-compilation-targets": "^7.27.2",
        "@babel/helper-module-transforms": "^7.28.3",
        "@babel/helpers": "^7.28.4",
        "@babel/parser": "^7.28.5",
        "@babel/template": "^7.27.2",
        "@babel/traverse": "^7.28.5",
        "@babel/types": "^7.28.5",
        "@jridgewell/remapping": "^2.3.5",
        "convert-source-map": "^2.0.0",
        "debug": "^4.1.0",
        "gensync": "^1.0.0-beta.2",
        "json5": "^2.2.3",
        "semver": "^6.3.1"
      },
      "engines": {
        "node": "&gt;=6.9.0"
      },
      "funding": {
        "type": "opencollective",
        "url": "https://opencollective.com/babel"
      }
    },
    "node_modules/@babel/generator": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/generator/-/generator-7.28.5.tgz",
      "integrity": "sha512-3EwLFhZ38J4VyIP6WNtt2kUdW9dokXA9Cr4IVIFHuCpZ3H8/YFOl5JjZHisrn1fATPBmKKqXzDFvh9fUwHz6CQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/parser": "^7.28.5",
        "@babel/types": "^7.28.5",
        "@jridgewell/gen-mapping": "^0.3.12",
        "@jridgewell/trace-mapping": "^0.3.28",
        "jsesc": "^3.0.2"
      },
      "engines": {
        "node": "&gt;=6.9.0"
      }
    },
    "node_modules/@babel/helper-compilation-targets": {
      "version": "7.27.2",
      "resolved": "https://registry.npmjs.org/@babel/helper-compilation-targets/-/helper-compilation-targets-7.27.2.tgz",
      "integrity": "sha512-2+1thGUUWWjLTYTHZWK1n8Yga0ijBz1XAhUXcKy81rd5g6yh7hGqMp45v7cadSbEHc9G3OTv45SyneRN3ps4DQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/compat-data": "^7.27.2",
        "@babel/helper-validator-option": "^7.27.1",
        "browserslist": "^4.24.0",
        "lru-cache": "^5.1.1",
        "semver": "^6.3.1"
      },
      "engines": {
        "node": "&gt;=6.9.0"
      }
    },
    "node_modules/@babel/helper-globals": {
      "version": "7.28.0",
      "resolved": "https://registry.npmjs.org/@babel/helper-globals/-/helper-globals-7.28.0.tgz",
      "integrity": "sha512-+W6cISkXFa1jXsDEdYA8HeevQT/FULhxzR99pxphltZcVaugps53THCeiWA8SguxxpSp3gKPiuYfSWopkLQ4hw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "&gt;=6.9.0"
      }
    },
    "node_modules/@babel/helper-module-imports": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-module-imports/-/helper-module-imports-7.27.1.tgz",
      "integrity": "sha512-0gSFWUPNXNopqtIPQvlD5WgXYI5GY2kP2cCvoT8kczjbfcfuIljTbcWrulD1CIPIX2gt1wghbDy08yE1p+/r3w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/traverse": "^7.27.1",
        "@babel/types": "^7.27.1"
      },
      "engines": {
        "node": "&gt;=6.9.0"
      }
    },
    "node_modules/@babel/helper-module-transforms": {
      "version": "7.28.3",
      "resolved": "https://registry.npmjs.org/@babel/helper-module-transforms/-/helper-module-transforms-7.28.3.tgz",
      "integrity": "sha512-gytXUbs8k2sXS9PnQptz5o0QnpLL51SwASIORY6XaBKF88nsOT0Zw9szLqlSGQDP/4TljBAD5y98p2U1fqkdsw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/helper-module-imports": "^7.27.1",
        "@babel/helper-validator-identifier": "^7.27.1",
        "@babel/traverse": "^7.28.3"
      },
      "engines": {
        "node": "&gt;=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0"
      }
    },
    "node_modules/@babel/helper-plugin-utils": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-plugin-utils/-/helper-plugin-utils-7.27.1.tgz",
      "integrity": "sha512-1gn1Up5YXka3YYAHGKpbideQ5Yjf1tDa9qYcgysz+cNCXukyLl6DjPXhD3VRwSb8c0J9tA4b2+rHEZtc6R0tlw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "&gt;=6.9.0"
      }
    },
    "node_modules/@babel/helper-string-parser": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-string-parser/-/helper-string-parser-7.27.1.tgz",
      "integrity": "sha512-qMlSxKbpRlAridDExk92nSobyDdpPijUq2DW6oDnUqd0iOGxmQjyqhMIihI9+zv4LPyZdRje2cavWPbCbWm3eA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "&gt;=6.9.0"
      }
    },
    "node_modules/@babel/helper-validator-identifier": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/helper-validator-identifier/-/helper-validator-identifier-7.28.5.tgz",
      "integrity": "sha512-qSs4ifwzKJSV39ucNjsvc6WVHs6b7S03sOh2OcHF9UHfVPqWWALUsNUVzhSBiItjRZoLHx7nIarVjqKVusUZ1Q==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "&gt;=6.9.0"
      }
    },
    "node_modules/@babel/helper-validator-option": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/helper-validator-option/-/helper-validator-option-7.27.1.tgz",
      "integrity": "sha512-YvjJow9FxbhFFKDSuFnVCe2WxXk1zWc22fFePVNEaWJEu8IrZVlda6N0uHwzZrUM1il7NC9Mlp4MaJYbYd9JSg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "&gt;=6.9.0"
      }
    },
    "node_modules/@babel/helpers": {
      "version": "7.28.4",
      "resolved": "https://registry.npmjs.org/@babel/helpers/-/helpers-7.28.4.tgz",
      "integrity": "sha512-HFN59MmQXGHVyYadKLVumYsA9dBFun/ldYxipEjzA4196jpLZd8UjEEBLkbEkvfYreDqJhZxYAWFPtrfhNpj4w==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/template": "^7.27.2",
        "@babel/types": "^7.28.4"
      },
      "engines": {
        "node": "&gt;=6.9.0"
      }
    },
    "node_modules/@babel/parser": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/parser/-/parser-7.28.5.tgz",
      "integrity": "sha512-KKBU1VGYR7ORr3At5HAtUQ+TV3SzRCXmA/8OdDZiLDBIZxVyzXuztPjfLd3BV1PRAQGCMWWSHYhL0F8d5uHBDQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/types": "^7.28.5"
      },
      "bin": {
        "parser": "bin/babel-parser.js"
      },
      "engines": {
        "node": "&gt;=6.0.0"
      }
    },
    "node_modules/@babel/plugin-transform-react-jsx-self": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-react-jsx-self/-/plugin-transform-react-jsx-self-7.27.1.tgz",
      "integrity": "sha512-6UzkCs+ejGdZ5mFFC/OCUrv028ab2fp1znZmCZjAOBKiBK2jXD1O+BPSfX8X2qjJ75fZBMSnQn3Rq2mrBJK2mw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": "&gt;=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/plugin-transform-react-jsx-source": {
      "version": "7.27.1",
      "resolved": "https://registry.npmjs.org/@babel/plugin-transform-react-jsx-source/-/plugin-transform-react-jsx-source-7.27.1.tgz",
      "integrity": "sha512-zbwoTsBruTeKB9hSq73ha66iFeJHuaFkUbwvqElnygoNbj/jHRsSeokowZFN3CZ64IvEqcmmkVe89OPXc7ldAw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/helper-plugin-utils": "^7.27.1"
      },
      "engines": {
        "node": "&gt;=6.9.0"
      },
      "peerDependencies": {
        "@babel/core": "^7.0.0-0"
      }
    },
    "node_modules/@babel/template": {
      "version": "7.27.2",
      "resolved": "https://registry.npmjs.org/@babel/template/-/template-7.27.2.tgz",
      "integrity": "sha512-LPDZ85aEJyYSd18/DkjNh4/y1ntkE5KwUHWTiqgRxruuZL2F1yuHligVHLvcHY2vMHXttKFpJn6LwfI7cw7ODw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/code-frame": "^7.27.1",
        "@babel/parser": "^7.27.2",
        "@babel/types": "^7.27.1"
      },
      "engines": {
        "node": "&gt;=6.9.0"
      }
    },
    "node_modules/@babel/traverse": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/traverse/-/traverse-7.28.5.tgz",
      "integrity": "sha512-TCCj4t55U90khlYkVV/0TfkJkAkUg3jZFA3Neb7unZT8CPok7iiRfaX0F+WnqWqt7OxhOn0uBKXCw4lbL8W0aQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/code-frame": "^7.27.1",
        "@babel/generator": "^7.28.5",
        "@babel/helper-globals": "^7.28.0",
        "@babel/parser": "^7.28.5",
        "@babel/template": "^7.27.2",
        "@babel/types": "^7.28.5",
        "debug": "^4.3.1"
      },
      "engines": {
        "node": "&gt;=6.9.0"
      }
    },
    "node_modules/@babel/types": {
      "version": "7.28.5",
      "resolved": "https://registry.npmjs.org/@babel/types/-/types-7.28.5.tgz",
      "integrity": "sha512-qQ5m48eI/MFLQ5PxQj4PFaprjyCTLI37ElWMmNs0K8Lk3dVeOdNpB3ks8jc7yM5CDmVC73eMVk/trk3fgmrUpA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/helper-string-parser": "^7.27.1",
        "@babel/helper-validator-identifier": "^7.28.5"
      },
      "engines": {
        "node": "&gt;=6.9.0"
      }
    },
    "node_modules/@esbuild/aix-ppc64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/aix-ppc64/-/aix-ppc64-0.25.12.tgz",
      "integrity": "sha512-Hhmwd6CInZ3dwpuGTF8fJG6yoWmsToE+vYgD4nytZVxcu1ulHpUQRAB1UJ8+N1Am3Mz4+xOByoQoSZf4D+CpkA==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "aix"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/android-arm": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/android-arm/-/android-arm-0.25.12.tgz",
      "integrity": "sha512-VJ+sKvNA/GE7Ccacc9Cha7bpS8nyzVv0jdVgwNDaR4gDMC/2TTRc33Ip8qrNYUcpkOHUT5OZ0bUcNNVZQ9RLlg==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/android-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/android-arm64/-/android-arm64-0.25.12.tgz",
      "integrity": "sha512-6AAmLG7zwD1Z159jCKPvAxZd4y/VTO0VkprYy+3N2FtJ8+BQWFXU+OxARIwA46c5tdD9SsKGZ/1ocqBS/gAKHg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/android-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/android-x64/-/android-x64-0.25.12.tgz",
      "integrity": "sha512-5jbb+2hhDHx5phYR2By8GTWEzn6I9UqR11Kwf22iKbNpYrsmRB18aX/9ivc5cabcUiAT/wM+YIZ6SG9QO6a8kg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/darwin-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/darwin-arm64/-/darwin-arm64-0.25.12.tgz",
      "integrity": "sha512-N3zl+lxHCifgIlcMUP5016ESkeQjLj/959RxxNYIthIg+CQHInujFuXeWbWMgnTo4cp5XVHqFPmpyu9J65C1Yg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/darwin-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/darwin-x64/-/darwin-x64-0.25.12.tgz",
      "integrity": "sha512-HQ9ka4Kx21qHXwtlTUVbKJOAnmG1ipXhdWTmNXiPzPfWKpXqASVcWdnf2bnL73wgjNrFXAa3yYvBSd9pzfEIpA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/freebsd-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/freebsd-arm64/-/freebsd-arm64-0.25.12.tgz",
      "integrity": "sha512-gA0Bx759+7Jve03K1S0vkOu5Lg/85dou3EseOGUes8flVOGxbhDDh/iZaoek11Y8mtyKPGF3vP8XhnkDEAmzeg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/freebsd-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/freebsd-x64/-/freebsd-x64-0.25.12.tgz",
      "integrity": "sha512-TGbO26Yw2xsHzxtbVFGEXBFH0FRAP7gtcPE7P5yP7wGy7cXK2oO7RyOhL5NLiqTlBh47XhmIUXuGciXEqYFfBQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/linux-arm": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-arm/-/linux-arm-0.25.12.tgz",
      "integrity": "sha512-lPDGyC1JPDou8kGcywY0YILzWlhhnRjdof3UlcoqYmS9El818LLfJJc3PXXgZHrHCAKs/Z2SeZtDJr5MrkxtOw==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/linux-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-arm64/-/linux-arm64-0.25.12.tgz",
      "integrity": "sha512-8bwX7a8FghIgrupcxb4aUmYDLp8pX06rGh5HqDT7bB+8Rdells6mHvrFHHW2JAOPZUbnjUpKTLg6ECyzvas2AQ==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/linux-ia32": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-ia32/-/linux-ia32-0.25.12.tgz",
      "integrity": "sha512-0y9KrdVnbMM2/vG8KfU0byhUN+EFCny9+8g202gYqSSVMonbsCfLjUO+rCci7pM0WBEtz+oK/PIwHkzxkyharA==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/linux-loong64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-loong64/-/linux-loong64-0.25.12.tgz",
      "integrity": "sha512-h///Lr5a9rib/v1GGqXVGzjL4TMvVTv+s1DPoxQdz7l/AYv6LDSxdIwzxkrPW438oUXiDtwM10o9PmwS/6Z0Ng==",
      "cpu": [
        "loong64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/linux-mips64el": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-mips64el/-/linux-mips64el-0.25.12.tgz",
      "integrity": "sha512-iyRrM1Pzy9GFMDLsXn1iHUm18nhKnNMWscjmp4+hpafcZjrr2WbT//d20xaGljXDBYHqRcl8HnxbX6uaA/eGVw==",
      "cpu": [
        "mips64el"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/linux-ppc64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-ppc64/-/linux-ppc64-0.25.12.tgz",
      "integrity": "sha512-9meM/lRXxMi5PSUqEXRCtVjEZBGwB7P/D4yT8UG/mwIdze2aV4Vo6U5gD3+RsoHXKkHCfSxZKzmDssVlRj1QQA==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/linux-riscv64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-riscv64/-/linux-riscv64-0.25.12.tgz",
      "integrity": "sha512-Zr7KR4hgKUpWAwb1f3o5ygT04MzqVrGEGXGLnj15YQDJErYu/BGg+wmFlIDOdJp0PmB0lLvxFIOXZgFRrdjR0w==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/linux-s390x": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-s390x/-/linux-s390x-0.25.12.tgz",
      "integrity": "sha512-MsKncOcgTNvdtiISc/jZs/Zf8d0cl/t3gYWX8J9ubBnVOwlk65UIEEvgBORTiljloIWnBzLs4qhzPkJcitIzIg==",
      "cpu": [
        "s390x"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/linux-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/linux-x64/-/linux-x64-0.25.12.tgz",
      "integrity": "sha512-uqZMTLr/zR/ed4jIGnwSLkaHmPjOjJvnm6TVVitAa08SLS9Z0VM8wIRx7gWbJB5/J54YuIMInDquWyYvQLZkgw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/netbsd-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/netbsd-arm64/-/netbsd-arm64-0.25.12.tgz",
      "integrity": "sha512-xXwcTq4GhRM7J9A8Gv5boanHhRa/Q9KLVmcyXHCTaM4wKfIpWkdXiMog/KsnxzJ0A1+nD+zoecuzqPmCRyBGjg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "netbsd"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/netbsd-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/netbsd-x64/-/netbsd-x64-0.25.12.tgz",
      "integrity": "sha512-Ld5pTlzPy3YwGec4OuHh1aCVCRvOXdH8DgRjfDy/oumVovmuSzWfnSJg+VtakB9Cm0gxNO9BzWkj6mtO1FMXkQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "netbsd"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/openbsd-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/openbsd-arm64/-/openbsd-arm64-0.25.12.tgz",
      "integrity": "sha512-fF96T6KsBo/pkQI950FARU9apGNTSlZGsv1jZBAlcLL1MLjLNIWPBkj5NlSz8aAzYKg+eNqknrUJ24QBybeR5A==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openbsd"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/openbsd-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/openbsd-x64/-/openbsd-x64-0.25.12.tgz",
      "integrity": "sha512-MZyXUkZHjQxUvzK7rN8DJ3SRmrVrke8ZyRusHlP+kuwqTcfWLyqMOE3sScPPyeIXN/mDJIfGXvcMqCgYKekoQw==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openbsd"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/openharmony-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/openharmony-arm64/-/openharmony-arm64-0.25.12.tgz",
      "integrity": "sha512-rm0YWsqUSRrjncSXGA7Zv78Nbnw4XL6/dzr20cyrQf7ZmRcsovpcRBdhD43Nuk3y7XIoW2OxMVvwuRvk9XdASg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openharmony"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/sunos-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/sunos-x64/-/sunos-x64-0.25.12.tgz",
      "integrity": "sha512-3wGSCDyuTHQUzt0nV7bocDy72r2lI33QL3gkDNGkod22EsYl04sMf0qLb8luNKTOmgF/eDEDP5BFNwoBKH441w==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "sunos"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/win32-arm64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-arm64/-/win32-arm64-0.25.12.tgz",
      "integrity": "sha512-rMmLrur64A7+DKlnSuwqUdRKyd3UE7oPJZmnljqEptesKM8wx9J8gx5u0+9Pq0fQQW8vqeKebwNXdfOyP+8Bsg==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/win32-ia32": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-ia32/-/win32-ia32-0.25.12.tgz",
      "integrity": "sha512-HkqnmmBoCbCwxUKKNPBixiWDGCpQGVsrQfJoVGYLPT41XWF8lHuE5N6WhVia2n4o5QK5M4tYr21827fNhi4byQ==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@esbuild/win32-x64": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/@esbuild/win32-x64/-/win32-x64-0.25.12.tgz",
      "integrity": "sha512-alJC0uCZpTFrSL0CCDjcgleBXPnCrEAhTBILpeAp7M/OFgoqtAetfBzX0xM00MUsVVPpVjlPuMbREqnZCXaTnA==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ],
      "engines": {
        "node": "&gt;=18"
      }
    },
    "node_modules/@jridgewell/gen-mapping": {
      "version": "0.3.13",
      "resolved": "https://registry.npmjs.org/@jridgewell/gen-mapping/-/gen-mapping-0.3.13.tgz",
      "integrity": "sha512-2kkt/7niJ6MgEPxF0bYdQ6etZaA+fQvDcLKckhy1yIQOzaoKjBBjSj63/aLVjYE3qhRt5dvM+uUyfCg6UKCBbA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/sourcemap-codec": "^1.5.0",
        "@jridgewell/trace-mapping": "^0.3.24"
      }
    },
    "node_modules/@jridgewell/remapping": {
      "version": "2.3.5",
      "resolved": "https://registry.npmjs.org/@jridgewell/remapping/-/remapping-2.3.5.tgz",
      "integrity": "sha512-LI9u/+laYG4Ds1TDKSJW2YPrIlcVYOwi2fUC6xB43lueCjgxV4lffOCZCtYFiH6TNOX+tQKXx97T4IKHbhyHEQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/gen-mapping": "^0.3.5",
        "@jridgewell/trace-mapping": "^0.3.24"
      }
    },
    "node_modules/@jridgewell/resolve-uri": {
      "version": "3.1.2",
      "resolved": "https://registry.npmjs.org/@jridgewell/resolve-uri/-/resolve-uri-3.1.2.tgz",
      "integrity": "sha512-bRISgCIjP20/tbWSPWMEi54QVPRZExkuD9lJL+UIxUKtwVJA8wW1Trb1jMs1RFXo1CBTNZ/5hpC9QvmKWdopKw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "&gt;=6.0.0"
      }
    },
    "node_modules/@jridgewell/sourcemap-codec": {
      "version": "1.5.5",
      "resolved": "https://registry.npmjs.org/@jridgewell/sourcemap-codec/-/sourcemap-codec-1.5.5.tgz",
      "integrity": "sha512-cYQ9310grqxueWbl+WuIUIaiUaDcj7WOq5fVhEljNVgRfOUhY9fy2zTvfoqWsnebh8Sl70VScFbICvJnLKB0Og==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@jridgewell/trace-mapping": {
      "version": "0.3.31",
      "resolved": "https://registry.npmjs.org/@jridgewell/trace-mapping/-/trace-mapping-0.3.31.tgz",
      "integrity": "sha512-zzNR+SdQSDJzc8joaeP8QQoCQr8NuYx2dIIytl1QeBEZHJ9uW6hebsrYgbz8hJwUQao3TWCMtmfV8Nu1twOLAw==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@jridgewell/resolve-uri": "^3.1.0",
        "@jridgewell/sourcemap-codec": "^1.4.14"
      }
    },
    "node_modules/@rolldown/pluginutils": {
      "version": "1.0.0-beta.47",
      "resolved": "https://registry.npmjs.org/@rolldown/pluginutils/-/pluginutils-1.0.0-beta.47.tgz",
      "integrity": "sha512-8QagwMH3kNCuzD8EWL8R2YPW5e4OrHNSAHRFDdmFqEwEaD/KcNKjVoumo+gP2vW5eKB2UPbM6vTYiGZX0ixLnw==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@rollup/rollup-android-arm-eabi": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-android-arm-eabi/-/rollup-android-arm-eabi-4.53.3.tgz",
      "integrity": "sha512-mRSi+4cBjrRLoaal2PnqH82Wqyb+d3HsPUN/W+WslCXsZsyHa9ZeQQX/pQsZaVIWDkPcpV6jJ+3KLbTbgnwv8w==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ]
    },
    "node_modules/@rollup/rollup-android-arm64": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-android-arm64/-/rollup-android-arm64-4.53.3.tgz",
      "integrity": "sha512-CbDGaMpdE9sh7sCmTrTUyllhrg65t6SwhjlMJsLr+J8YjFuPmCEjbBSx4Z/e4SmDyH3aB5hGaJUP2ltV/vcs4w==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "android"
      ]
    },
    "node_modules/@rollup/rollup-darwin-arm64": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-darwin-arm64/-/rollup-darwin-arm64-4.53.3.tgz",
      "integrity": "sha512-Nr7SlQeqIBpOV6BHHGZgYBuSdanCXuw09hon14MGOLGmXAFYjx1wNvquVPmpZnl0tLjg25dEdr4IQ6GgyToCUA==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ]
    },
    "node_modules/@rollup/rollup-darwin-x64": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-darwin-x64/-/rollup-darwin-x64-4.53.3.tgz",
      "integrity": "sha512-DZ8N4CSNfl965CmPktJ8oBnfYr3F8dTTNBQkRlffnUarJ2ohudQD17sZBa097J8xhQ26AwhHJ5mvUyQW8ddTsQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ]
    },
    "node_modules/@rollup/rollup-freebsd-arm64": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-freebsd-arm64/-/rollup-freebsd-arm64-4.53.3.tgz",
      "integrity": "sha512-yMTrCrK92aGyi7GuDNtGn2sNW+Gdb4vErx4t3Gv/Tr+1zRb8ax4z8GWVRfr3Jw8zJWvpGHNpss3vVlbF58DZ4w==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ]
    },
    "node_modules/@rollup/rollup-freebsd-x64": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-freebsd-x64/-/rollup-freebsd-x64-4.53.3.tgz",
      "integrity": "sha512-lMfF8X7QhdQzseM6XaX0vbno2m3hlyZFhwcndRMw8fbAGUGL3WFMBdK0hbUBIUYcEcMhVLr1SIamDeuLBnXS+Q==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "freebsd"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm-gnueabihf": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm-gnueabihf/-/rollup-linux-arm-gnueabihf-4.53.3.tgz",
      "integrity": "sha512-k9oD15soC/Ln6d2Wv/JOFPzZXIAIFLp6B+i14KhxAfnq76ajt0EhYc5YPeX6W1xJkAdItcVT+JhKl1QZh44/qw==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm-musleabihf": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm-musleabihf/-/rollup-linux-arm-musleabihf-4.53.3.tgz",
      "integrity": "sha512-vTNlKq+N6CK/8UktsrFuc+/7NlEYVxgaEgRXVUVK258Z5ymho29skzW1sutgYjqNnquGwVUObAaxae8rZ6YMhg==",
      "cpu": [
        "arm"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm64-gnu": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm64-gnu/-/rollup-linux-arm64-gnu-4.53.3.tgz",
      "integrity": "sha512-RGrFLWgMhSxRs/EWJMIFM1O5Mzuz3Xy3/mnxJp/5cVhZ2XoCAxJnmNsEyeMJtpK+wu0FJFWz+QF4mjCA7AUQ3w==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-arm64-musl": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-arm64-musl/-/rollup-linux-arm64-musl-4.53.3.tgz",
      "integrity": "sha512-kASyvfBEWYPEwe0Qv4nfu6pNkITLTb32p4yTgzFCocHnJLAHs+9LjUu9ONIhvfT/5lv4YS5muBHyuV84epBo/A==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-loong64-gnu": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-loong64-gnu/-/rollup-linux-loong64-gnu-4.53.3.tgz",
      "integrity": "sha512-JiuKcp2teLJwQ7vkJ95EwESWkNRFJD7TQgYmCnrPtlu50b4XvT5MOmurWNrCj3IFdyjBQ5p9vnrX4JM6I8OE7g==",
      "cpu": [
        "loong64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-ppc64-gnu": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-ppc64-gnu/-/rollup-linux-ppc64-gnu-4.53.3.tgz",
      "integrity": "sha512-EoGSa8nd6d3T7zLuqdojxC20oBfNT8nexBbB/rkxgKj5T5vhpAQKKnD+h3UkoMuTyXkP5jTjK/ccNRmQrPNDuw==",
      "cpu": [
        "ppc64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-riscv64-gnu": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-riscv64-gnu/-/rollup-linux-riscv64-gnu-4.53.3.tgz",
      "integrity": "sha512-4s+Wped2IHXHPnAEbIB0YWBv7SDohqxobiiPA1FIWZpX+w9o2i4LezzH/NkFUl8LRci/8udci6cLq+jJQlh+0g==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-riscv64-musl": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-riscv64-musl/-/rollup-linux-riscv64-musl-4.53.3.tgz",
      "integrity": "sha512-68k2g7+0vs2u9CxDt5ktXTngsxOQkSEV/xBbwlqYcUrAVh6P9EgMZvFsnHy4SEiUl46Xf0IObWVbMvPrr2gw8A==",
      "cpu": [
        "riscv64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-s390x-gnu": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-s390x-gnu/-/rollup-linux-s390x-gnu-4.53.3.tgz",
      "integrity": "sha512-VYsFMpULAz87ZW6BVYw3I6sWesGpsP9OPcyKe8ofdg9LHxSbRMd7zrVrr5xi/3kMZtpWL/wC+UIJWJYVX5uTKg==",
      "cpu": [
        "s390x"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-x64-gnu": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-x64-gnu/-/rollup-linux-x64-gnu-4.53.3.tgz",
      "integrity": "sha512-3EhFi1FU6YL8HTUJZ51imGJWEX//ajQPfqWLI3BQq4TlvHy4X0MOr5q3D2Zof/ka0d5FNdPwZXm3Yyib/UEd+w==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-linux-x64-musl": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-linux-x64-musl/-/rollup-linux-x64-musl-4.53.3.tgz",
      "integrity": "sha512-eoROhjcc6HbZCJr+tvVT8X4fW3/5g/WkGvvmwz/88sDtSJzO7r/blvoBDgISDiCjDRZmHpwud7h+6Q9JxFwq1Q==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "linux"
      ]
    },
    "node_modules/@rollup/rollup-openharmony-arm64": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-openharmony-arm64/-/rollup-openharmony-arm64-4.53.3.tgz",
      "integrity": "sha512-OueLAWgrNSPGAdUdIjSWXw+u/02BRTcnfw9PN41D2vq/JSEPnJnVuBgw18VkN8wcd4fjUs+jFHVM4t9+kBSNLw==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "openharmony"
      ]
    },
    "node_modules/@rollup/rollup-win32-arm64-msvc": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-arm64-msvc/-/rollup-win32-arm64-msvc-4.53.3.tgz",
      "integrity": "sha512-GOFuKpsxR/whszbF/bzydebLiXIHSgsEUp6M0JI8dWvi+fFa1TD6YQa4aSZHtpmh2/uAlj/Dy+nmby3TJ3pkTw==",
      "cpu": [
        "arm64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@rollup/rollup-win32-ia32-msvc": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-ia32-msvc/-/rollup-win32-ia32-msvc-4.53.3.tgz",
      "integrity": "sha512-iah+THLcBJdpfZ1TstDFbKNznlzoxa8fmnFYK4V67HvmuNYkVdAywJSoteUszvBQ9/HqN2+9AZghbajMsFT+oA==",
      "cpu": [
        "ia32"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@rollup/rollup-win32-x64-gnu": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-x64-gnu/-/rollup-win32-x64-gnu-4.53.3.tgz",
      "integrity": "sha512-J9QDiOIZlZLdcot5NXEepDkstocktoVjkaKUtqzgzpt2yWjGlbYiKyp05rWwk4nypbYUNoFAztEgixoLaSETkg==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@rollup/rollup-win32-x64-msvc": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/@rollup/rollup-win32-x64-msvc/-/rollup-win32-x64-msvc-4.53.3.tgz",
      "integrity": "sha512-UhTd8u31dXadv0MopwGgNOBpUVROFKWVQgAg5N1ESyCz8AuBcMqm4AuTjrwgQKGDfoFuz02EuMRHQIw/frmYKQ==",
      "cpu": [
        "x64"
      ],
      "dev": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "win32"
      ]
    },
    "node_modules/@types/babel__core": {
      "version": "7.20.5",
      "resolved": "https://registry.npmjs.org/@types/babel__core/-/babel__core-7.20.5.tgz",
      "integrity": "sha512-qoQprZvz5wQFJwMDqeseRXWv3rqMvhgpbXFfVyWhbx9X47POIA6i/+dXefEmZKoAgOaTdaIgNSMqMIU61yRyzA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/parser": "^7.20.7",
        "@babel/types": "^7.20.7",
        "@types/babel__generator": "*",
        "@types/babel__template": "*",
        "@types/babel__traverse": "*"
      }
    },
    "node_modules/@types/babel__generator": {
      "version": "7.27.0",
      "resolved": "https://registry.npmjs.org/@types/babel__generator/-/babel__generator-7.27.0.tgz",
      "integrity": "sha512-ufFd2Xi92OAVPYsy+P4n7/U7e68fex0+Ee8gSG9KX7eo084CWiQ4sdxktvdl0bOPupXtVJPY19zk6EwWqUQ8lg==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/types": "^7.0.0"
      }
    },
    "node_modules/@types/babel__template": {
      "version": "7.4.4",
      "resolved": "https://registry.npmjs.org/@types/babel__template/-/babel__template-7.4.4.tgz",
      "integrity": "sha512-h/NUaSyG5EyxBIp8YRxo4RMe2/qQgvyowRwVMzhYhBCONbW8PUsg4lkFMrhgZhUe5z3L3MiLDuvyJ/CaPa2A8A==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/parser": "^7.1.0",
        "@babel/types": "^7.0.0"
      }
    },
    "node_modules/@types/babel__traverse": {
      "version": "7.28.0",
      "resolved": "https://registry.npmjs.org/@types/babel__traverse/-/babel__traverse-7.28.0.tgz",
      "integrity": "sha512-8PvcXf70gTDZBgt9ptxJ8elBeBjcLOAcOtoO/mPJjtji1+CdGbHgm77om1GrsPxsiE+uXIpNSK64UYaIwQXd4Q==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/types": "^7.28.2"
      }
    },
    "node_modules/@types/estree": {
      "version": "1.0.8",
      "resolved": "https://registry.npmjs.org/@types/estree/-/estree-1.0.8.tgz",
      "integrity": "sha512-dWHzHa2WqEXI/O1E9OjrocMTKJl2mSrEolh1Iomrv6U+JuNwaHXsXx9bLu5gG7BUWFIN0skIQJQ/L1rIex4X6w==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/@types/node": {
      "version": "22.19.1",
      "resolved": "https://registry.npmjs.org/@types/node/-/node-22.19.1.tgz",
      "integrity": "sha512-LCCV0HdSZZZb34qifBsyWlUmok6W7ouER+oQIGBScS8EsZsQbrtFTUrDX4hOl+CS6p7cnNC4td+qrSVGSCTUfQ==",
      "dev": true,
      "license": "MIT",
      "peer": true,
      "dependencies": {
        "undici-types": "~6.21.0"
      }
    },
    "node_modules/@vitejs/plugin-react": {
      "version": "5.1.1",
      "resolved": "https://registry.npmjs.org/@vitejs/plugin-react/-/plugin-react-5.1.1.tgz",
      "integrity": "sha512-WQfkSw0QbQ5aJ2CHYw23ZGkqnRwqKHD/KYsMeTkZzPT4Jcf0DcBxBtwMJxnu6E7oxw5+JC6ZAiePgh28uJ1HBA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@babel/core": "^7.28.5",
        "@babel/plugin-transform-react-jsx-self": "^7.27.1",
        "@babel/plugin-transform-react-jsx-source": "^7.27.1",
        "@rolldown/pluginutils": "1.0.0-beta.47",
        "@types/babel__core": "^7.20.5",
        "react-refresh": "^0.18.0"
      },
      "engines": {
        "node": "^20.19.0 || &gt;=22.12.0"
      },
      "peerDependencies": {
        "vite": "^4.2.0 || ^5.0.0 || ^6.0.0 || ^7.0.0"
      }
    },
    "node_modules/baseline-browser-mapping": {
      "version": "2.8.32",
      "resolved": "https://registry.npmjs.org/baseline-browser-mapping/-/baseline-browser-mapping-2.8.32.tgz",
      "integrity": "sha512-OPz5aBThlyLFgxyhdwf/s2+8ab3OvT7AdTNvKHBwpXomIYeXqpUUuT8LrdtxZSsWJ4R4CU1un4XGh5Ez3nlTpw==",
      "dev": true,
      "license": "Apache-2.0",
      "bin": {
        "baseline-browser-mapping": "dist/cli.js"
      }
    },
    "node_modules/browserslist": {
      "version": "4.28.0",
      "resolved": "https://registry.npmjs.org/browserslist/-/browserslist-4.28.0.tgz",
      "integrity": "sha512-tbydkR/CxfMwelN0vwdP/pLkDwyAASZ+VfWm4EOwlB6SWhx1sYnWLqo8N5j0rAzPfzfRaxt0mM/4wPU/Su84RQ==",
      "dev": true,
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/browserslist"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/browserslist"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "peer": true,
      "dependencies": {
        "baseline-browser-mapping": "^2.8.25",
        "caniuse-lite": "^1.0.30001754",
        "electron-to-chromium": "^1.5.249",
        "node-releases": "^2.0.27",
        "update-browserslist-db": "^1.1.4"
      },
      "bin": {
        "browserslist": "cli.js"
      },
      "engines": {
        "node": "^6 || ^7 || ^8 || ^9 || ^10 || ^11 || ^12 || &gt;=13.7"
      }
    },
    "node_modules/caniuse-lite": {
      "version": "1.0.30001757",
      "resolved": "https://registry.npmjs.org/caniuse-lite/-/caniuse-lite-1.0.30001757.tgz",
      "integrity": "sha512-r0nnL/I28Zi/yjk1el6ilj27tKcdjLsNqAOZr0yVjWPrSQyHgKI2INaEWw21bAQSv2LXRt1XuCS/GomNpWOxsQ==",
      "dev": true,
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/browserslist"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/caniuse-lite"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "CC-BY-4.0"
    },
    "node_modules/convert-source-map": {
      "version": "2.0.0",
      "resolved": "https://registry.npmjs.org/convert-source-map/-/convert-source-map-2.0.0.tgz",
      "integrity": "sha512-Kvp459HrV2FEJ1CAsi1Ku+MY3kasH19TFykTz2xWmMeq6bk2NU3XXvfJ+Q61m0xktWwt+1HSYf3JZsTms3aRJg==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/cors-anywhere": {
      "version": "0.4.4",
      "resolved": "https://registry.npmjs.org/cors-anywhere/-/cors-anywhere-0.4.4.tgz",
      "integrity": "sha512-8OBFwnzMgR4mNrAeAyOLB2EruS2z7u02of2bOu7i9kKYlZG+niS7CTHLPgEXKWW2NAOJWRry9RRCaL9lJRjNqg==",
      "license": "MIT",
      "dependencies": {
        "http-proxy": "1.11.1",
        "proxy-from-env": "0.0.1"
      },
      "engines": {
        "node": "&gt;=0.10.0"
      }
    },
    "node_modules/debug": {
      "version": "4.4.3",
      "resolved": "https://registry.npmjs.org/debug/-/debug-4.4.3.tgz",
      "integrity": "sha512-RGwwWnwQvkVfavKVt22FGLw+xYSdzARwm0ru6DhTVA3umU5hZc28V3kO4stgYryrTlLpuvgI9GiijltAjNbcqA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "ms": "^2.1.3"
      },
      "engines": {
        "node": "&gt;=6.0"
      },
      "peerDependenciesMeta": {
        "supports-color": {
          "optional": true
        }
      }
    },
    "node_modules/electron-to-chromium": {
      "version": "1.5.262",
      "resolved": "https://registry.npmjs.org/electron-to-chromium/-/electron-to-chromium-1.5.262.tgz",
      "integrity": "sha512-NlAsMteRHek05jRUxUR0a5jpjYq9ykk6+kO0yRaMi5moe7u0fVIOeQ3Y30A8dIiWFBNUoQGi1ljb1i5VtS9WQQ==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/esbuild": {
      "version": "0.25.12",
      "resolved": "https://registry.npmjs.org/esbuild/-/esbuild-0.25.12.tgz",
      "integrity": "sha512-bbPBYYrtZbkt6Os6FiTLCTFxvq4tt3JKall1vRwshA3fdVztsLAatFaZobhkBC8/BrPetoa0oksYoKXoG4ryJg==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "bin": {
        "esbuild": "bin/esbuild"
      },
      "engines": {
        "node": "&gt;=18"
      },
      "optionalDependencies": {
        "@esbuild/aix-ppc64": "0.25.12",
        "@esbuild/android-arm": "0.25.12",
        "@esbuild/android-arm64": "0.25.12",
        "@esbuild/android-x64": "0.25.12",
        "@esbuild/darwin-arm64": "0.25.12",
        "@esbuild/darwin-x64": "0.25.12",
        "@esbuild/freebsd-arm64": "0.25.12",
        "@esbuild/freebsd-x64": "0.25.12",
        "@esbuild/linux-arm": "0.25.12",
        "@esbuild/linux-arm64": "0.25.12",
        "@esbuild/linux-ia32": "0.25.12",
        "@esbuild/linux-loong64": "0.25.12",
        "@esbuild/linux-mips64el": "0.25.12",
        "@esbuild/linux-ppc64": "0.25.12",
        "@esbuild/linux-riscv64": "0.25.12",
        "@esbuild/linux-s390x": "0.25.12",
        "@esbuild/linux-x64": "0.25.12",
        "@esbuild/netbsd-arm64": "0.25.12",
        "@esbuild/netbsd-x64": "0.25.12",
        "@esbuild/openbsd-arm64": "0.25.12",
        "@esbuild/openbsd-x64": "0.25.12",
        "@esbuild/openharmony-arm64": "0.25.12",
        "@esbuild/sunos-x64": "0.25.12",
        "@esbuild/win32-arm64": "0.25.12",
        "@esbuild/win32-ia32": "0.25.12",
        "@esbuild/win32-x64": "0.25.12"
      }
    },
    "node_modules/escalade": {
      "version": "3.2.0",
      "resolved": "https://registry.npmjs.org/escalade/-/escalade-3.2.0.tgz",
      "integrity": "sha512-WUj2qlxaQtO4g6Pq5c29GTcWGDyd8itL8zTlipgECz3JesAiiOKotd8JU6otB3PACgG6xkJUyVhboMS+bje/jA==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "&gt;=6"
      }
    },
    "node_modules/eventemitter3": {
      "version": "1.2.0",
      "resolved": "https://registry.npmjs.org/eventemitter3/-/eventemitter3-1.2.0.tgz",
      "integrity": "sha512-DOFqA1MF46fmZl2xtzXR3MPCRsXqgoFqdXcrCVYM3JNnfUeHTm/fh/v/iU7gBFpwkuBmoJPAm5GuhdDfSEJMJA==",
      "license": "MIT"
    },
    "node_modules/fdir": {
      "version": "6.5.0",
      "resolved": "https://registry.npmjs.org/fdir/-/fdir-6.5.0.tgz",
      "integrity": "sha512-tIbYtZbucOs0BRGqPJkshJUYdL+SDH7dVM8gjy+ERp3WAUjLEFJE+02kanyHtwjWOnwrKYBiwAmM0p4kLJAnXg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "&gt;=12.0.0"
      },
      "peerDependencies": {
        "picomatch": "^3 || ^4"
      },
      "peerDependenciesMeta": {
        "picomatch": {
          "optional": true
        }
      }
    },
    "node_modules/fsevents": {
      "version": "2.3.3",
      "resolved": "https://registry.npmjs.org/fsevents/-/fsevents-2.3.3.tgz",
      "integrity": "sha512-5xoDfX+fL7faATnagmWPpbFtwh/R77WmMMqqHGS65C3vvB0YHrgF+B1YmZ3441tMj5n63k0212XNoJwzlhffQw==",
      "dev": true,
      "hasInstallScript": true,
      "license": "MIT",
      "optional": true,
      "os": [
        "darwin"
      ],
      "engines": {
        "node": "^8.16.0 || ^10.6.0 || &gt;=11.0.0"
      }
    },
    "node_modules/gensync": {
      "version": "1.0.0-beta.2",
      "resolved": "https://registry.npmjs.org/gensync/-/gensync-1.0.0-beta.2.tgz",
      "integrity": "sha512-3hN7NaskYvMDLQY55gnW3NQ+mesEAepTqlg+VEbj7zzqEMBVNhzcGYYeqFo/TlYz6eQiFcp1HcsCZO+nGgS8zg==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "&gt;=6.9.0"
      }
    },
    "node_modules/http-proxy": {
      "version": "1.11.1",
      "resolved": "https://registry.npmjs.org/http-proxy/-/http-proxy-1.11.1.tgz",
      "integrity": "sha512-qz7jZarkVG3G6GMq+4VRJPSN4NkIjL4VMTNhKGd8jc25BumeJjWWvnY3A7OkCGa8W1TTxbaK3dcE0ijFalITVA==",
      "license": "MIT",
      "dependencies": {
        "eventemitter3": "1.x.x",
        "requires-port": "0.x.x"
      },
      "engines": {
        "node": "&gt;=0.10.0"
      }
    },
    "node_modules/js-tokens": {
      "version": "4.0.0",
      "resolved": "https://registry.npmjs.org/js-tokens/-/js-tokens-4.0.0.tgz",
      "integrity": "sha512-RdJUflcE3cUzKiMqQgsCu06FPu9UdIJO0beYbPhHN4k6apgJtifcoCtT9bcxOpYBtpD2kCM6Sbzg4CausW/PKQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/jsesc": {
      "version": "3.1.0",
      "resolved": "https://registry.npmjs.org/jsesc/-/jsesc-3.1.0.tgz",
      "integrity": "sha512-/sM3dO2FOzXjKQhJuo0Q173wf2KOo8t4I8vHy6lF9poUp7bKT0/NHE8fPX23PwfhnykfqnC2xRxOnVw5XuGIaA==",
      "dev": true,
      "license": "MIT",
      "bin": {
        "jsesc": "bin/jsesc"
      },
      "engines": {
        "node": "&gt;=6"
      }
    },
    "node_modules/json5": {
      "version": "2.2.3",
      "resolved": "https://registry.npmjs.org/json5/-/json5-2.2.3.tgz",
      "integrity": "sha512-XmOWe7eyHYH14cLdVPoyg+GOH3rYX++KpzrylJwSW98t3Nk+U8XOl8FWKOgwtzdb8lXGf6zYwDUzeHMWfxasyg==",
      "dev": true,
      "license": "MIT",
      "bin": {
        "json5": "lib/cli.js"
      },
      "engines": {
        "node": "&gt;=6"
      }
    },
    "node_modules/lru-cache": {
      "version": "5.1.1",
      "resolved": "https://registry.npmjs.org/lru-cache/-/lru-cache-5.1.1.tgz",
      "integrity": "sha512-KpNARQA3Iwv+jTA0utUVVbrh+Jlrr1Fv0e56GGzAFOXN7dk/FviaDW8LHmK52DlcH4WP2n6gI8vN1aesBFgo9w==",
      "dev": true,
      "license": "ISC",
      "dependencies": {
        "yallist": "^3.0.2"
      }
    },
    "node_modules/ms": {
      "version": "2.1.3",
      "resolved": "https://registry.npmjs.org/ms/-/ms-2.1.3.tgz",
      "integrity": "sha512-6FlzubTLZG3J2a/NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq/s5xXI6/XXP6tz7R9xAOtHnSO/tXtF3WRTlA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/nanoid": {
      "version": "3.3.11",
      "resolved": "https://registry.npmjs.org/nanoid/-/nanoid-3.3.11.tgz",
      "integrity": "sha512-N8SpfPUnUp1bK+PMYW8qSWdl9U+wwNWI4QKxOYDy9JAro3WMX7p2OeVRF9v+347pnakNevPmiHhNmZ2HbFA76w==",
      "dev": true,
      "funding": [
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "bin": {
        "nanoid": "bin/nanoid.cjs"
      },
      "engines": {
        "node": "^10 || ^12 || ^13.7 || ^14 || &gt;=15.0.1"
      }
    },
    "node_modules/node-releases": {
      "version": "2.0.27",
      "resolved": "https://registry.npmjs.org/node-releases/-/node-releases-2.0.27.tgz",
      "integrity": "sha512-nmh3lCkYZ3grZvqcCH+fjmQ7X+H0OeZgP40OierEaAptX4XofMh5kwNbWh7lBduUzCcV/8kZ+NDLCwm2iorIlA==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/picocolors": {
      "version": "1.1.1",
      "resolved": "https://registry.npmjs.org/picocolors/-/picocolors-1.1.1.tgz",
      "integrity": "sha512-xceH2snhtb5M9liqDsmEw56le376mTZkEX/jEb/RxNFyegNul7eNslCXP9FDj/Lcu0X8KEyMceP2ntpaHrDEVA==",
      "dev": true,
      "license": "ISC"
    },
    "node_modules/picomatch": {
      "version": "4.0.3",
      "resolved": "https://registry.npmjs.org/picomatch/-/picomatch-4.0.3.tgz",
      "integrity": "sha512-5gTmgEY/sqK6gFXLIsQNH19lWb4ebPDLA4SdLP7dsWkIXHWlG66oPuVvXSGFPppYZz8ZDZq0dYYrbHfBCVUb1Q==",
      "dev": true,
      "license": "MIT",
      "peer": true,
      "engines": {
        "node": "&gt;=12"
      },
      "funding": {
        "url": "https://github.com/sponsors/jonschlinkert"
      }
    },
    "node_modules/postcss": {
      "version": "8.5.6",
      "resolved": "https://registry.npmjs.org/postcss/-/postcss-8.5.6.tgz",
      "integrity": "sha512-3Ybi1tAuwAP9s0r1UQ2J4n5Y0G05bJkpUIO0/bI9MhwmD70S5aTWbXGBwxHrelT+XM1k6dM0pk+SwNkpTRN7Pg==",
      "dev": true,
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/postcss/"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/postcss"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "nanoid": "^3.3.11",
        "picocolors": "^1.1.1",
        "source-map-js": "^1.2.1"
      },
      "engines": {
        "node": "^10 || ^12 || &gt;=14"
      }
    },
    "node_modules/proxy-from-env": {
      "version": "0.0.1",
      "resolved": "https://registry.npmjs.org/proxy-from-env/-/proxy-from-env-0.0.1.tgz",
      "integrity": "sha512-B9Hnta3CATuMS0q6kt5hEezOPM+V3dgaRewkFtFoaRQYTVNsHqUvFXmndH06z3QO1ZdDnRELv5vfY6zAj/gG7A==",
      "license": "MIT"
    },
    "node_modules/react": {
      "version": "19.2.0",
      "resolved": "https://registry.npmjs.org/react/-/react-19.2.0.tgz",
      "integrity": "sha512-tmbWg6W31tQLeB5cdIBOicJDJRR2KzXsV7uSK9iNfLWQ5bIZfxuPEHp7M8wiHyHnn0DD1i7w3Zmin0FtkrwoCQ==",
      "license": "MIT",
      "peer": true,
      "engines": {
        "node": "&gt;=0.10.0"
      }
    },
    "node_modules/react-dom": {
      "version": "19.2.0",
      "resolved": "https://registry.npmjs.org/react-dom/-/react-dom-19.2.0.tgz",
      "integrity": "sha512-UlbRu4cAiGaIewkPyiRGJk0imDN2T3JjieT6spoL2UeSf5od4n5LB/mQ4ejmxhCFT1tYe8IvaFulzynWovsEFQ==",
      "license": "MIT",
      "dependencies": {
        "scheduler": "^0.27.0"
      },
      "peerDependencies": {
        "react": "^19.2.0"
      }
    },
    "node_modules/react-refresh": {
      "version": "0.18.0",
      "resolved": "https://registry.npmjs.org/react-refresh/-/react-refresh-0.18.0.tgz",
      "integrity": "sha512-QgT5//D3jfjJb6Gsjxv0Slpj23ip+HtOpnNgnb2S5zU3CB26G/IDPGoy4RJB42wzFE46DRsstbW6tKHoKbhAxw==",
      "dev": true,
      "license": "MIT",
      "engines": {
        "node": "&gt;=0.10.0"
      }
    },
    "node_modules/requires-port": {
      "version": "0.0.1",
      "resolved": "https://registry.npmjs.org/requires-port/-/requires-port-0.0.1.tgz",
      "integrity": "sha512-AzPDCliPoWDSvEVYRQmpzuPhGGEnPrQz9YiOEvn+UdB9ixBpw+4IOZWtwctmpzySLZTy7ynpn47V14H4yaowtA==",
      "license": "MIT"
    },
    "node_modules/rollup": {
      "version": "4.53.3",
      "resolved": "https://registry.npmjs.org/rollup/-/rollup-4.53.3.tgz",
      "integrity": "sha512-w8GmOxZfBmKknvdXU1sdM9NHcoQejwF/4mNgj2JuEEdRaHwwF12K7e9eXn1nLZ07ad+du76mkVsyeb2rKGllsA==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "@types/estree": "1.0.8"
      },
      "bin": {
        "rollup": "dist/bin/rollup"
      },
      "engines": {
        "node": "&gt;=18.0.0",
        "npm": "&gt;=8.0.0"
      },
      "optionalDependencies": {
        "@rollup/rollup-android-arm-eabi": "4.53.3",
        "@rollup/rollup-android-arm64": "4.53.3",
        "@rollup/rollup-darwin-arm64": "4.53.3",
        "@rollup/rollup-darwin-x64": "4.53.3",
        "@rollup/rollup-freebsd-arm64": "4.53.3",
        "@rollup/rollup-freebsd-x64": "4.53.3",
        "@rollup/rollup-linux-arm-gnueabihf": "4.53.3",
        "@rollup/rollup-linux-arm-musleabihf": "4.53.3",
        "@rollup/rollup-linux-arm64-gnu": "4.53.3",
        "@rollup/rollup-linux-arm64-musl": "4.53.3",
        "@rollup/rollup-linux-loong64-gnu": "4.53.3",
        "@rollup/rollup-linux-ppc64-gnu": "4.53.3",
        "@rollup/rollup-linux-riscv64-gnu": "4.53.3",
        "@rollup/rollup-linux-riscv64-musl": "4.53.3",
        "@rollup/rollup-linux-s390x-gnu": "4.53.3",
        "@rollup/rollup-linux-x64-gnu": "4.53.3",
        "@rollup/rollup-linux-x64-musl": "4.53.3",
        "@rollup/rollup-openharmony-arm64": "4.53.3",
        "@rollup/rollup-win32-arm64-msvc": "4.53.3",
        "@rollup/rollup-win32-ia32-msvc": "4.53.3",
        "@rollup/rollup-win32-x64-gnu": "4.53.3",
        "@rollup/rollup-win32-x64-msvc": "4.53.3",
        "fsevents": "~2.3.2"
      }
    },
    "node_modules/scheduler": {
      "version": "0.27.0",
      "resolved": "https://registry.npmjs.org/scheduler/-/scheduler-0.27.0.tgz",
      "integrity": "sha512-eNv+WrVbKu1f3vbYJT/xtiF5syA5HPIMtf9IgY/nKg0sWqzAUEvqY/xm7OcZc/qafLx/iO9FgOmeSAp4v5ti/Q==",
      "license": "MIT"
    },
    "node_modules/semver": {
      "version": "6.3.1",
      "resolved": "https://registry.npmjs.org/semver/-/semver-6.3.1.tgz",
      "integrity": "sha512-BR7VvDCVHO+q2xBEWskxS6DJE1qRnb7DxzUrogb71CWoSficBxYsiAGd+Kl0mmq/MprG9yArRkyrQxTO6XjMzA==",
      "dev": true,
      "license": "ISC",
      "bin": {
        "semver": "bin/semver.js"
      }
    },
    "node_modules/source-map-js": {
      "version": "1.2.1",
      "resolved": "https://registry.npmjs.org/source-map-js/-/source-map-js-1.2.1.tgz",
      "integrity": "sha512-UXWMKhLOwVKb728IUtQPXxfYU+usdybtUrK/8uGE8CQMvrhOpwvzDBwj0QhSL7MQc7vIsISBG8VQ8+IDQxpfQA==",
      "dev": true,
      "license": "BSD-3-Clause",
      "engines": {
        "node": "&gt;=0.10.0"
      }
    },
    "node_modules/tinyglobby": {
      "version": "0.2.15",
      "resolved": "https://registry.npmjs.org/tinyglobby/-/tinyglobby-0.2.15.tgz",
      "integrity": "sha512-j2Zq4NyQYG5XMST4cbs02Ak8iJUdxRM0XI5QyxXuZOzKOINmWurp3smXu3y5wDcJrptwpSjgXHzIQxR0omXljQ==",
      "dev": true,
      "license": "MIT",
      "dependencies": {
        "fdir": "^6.5.0",
        "picomatch": "^4.0.3"
      },
      "engines": {
        "node": "&gt;=12.0.0"
      },
      "funding": {
        "url": "https://github.com/sponsors/SuperchupuDev"
      }
    },
    "node_modules/typescript": {
      "version": "5.8.3",
      "resolved": "https://registry.npmjs.org/typescript/-/typescript-5.8.3.tgz",
      "integrity": "sha512-p1diW6TqL9L07nNxvRMM7hMMw4c5XOo/1ibL4aAIGmSAt9slTE1Xgw5KWuof2uTOvCg9BY7ZRi+GaF+7sfgPeQ==",
      "dev": true,
      "license": "Apache-2.0",
      "bin": {
        "tsc": "bin/tsc",
        "tsserver": "bin/tsserver"
      },
      "engines": {
        "node": "&gt;=14.17"
      }
    },
    "node_modules/undici-types": {
      "version": "6.21.0",
      "resolved": "https://registry.npmjs.org/undici-types/-/undici-types-6.21.0.tgz",
      "integrity": "sha512-iwDZqg0QAGrg9Rav5H4n0M64c3mkR59cJ6wQp+7C4nI0gsmExaedaYLNO44eT4AtBBwjbTiGPMlt2Md0T9H9JQ==",
      "dev": true,
      "license": "MIT"
    },
    "node_modules/update-browserslist-db": {
      "version": "1.1.4",
      "resolved": "https://registry.npmjs.org/update-browserslist-db/-/update-browserslist-db-1.1.4.tgz",
      "integrity": "sha512-q0SPT4xyU84saUX+tomz1WLkxUbuaJnR1xWt17M7fJtEJigJeWUNGUqrauFXsHnqev9y9JTRGwk13tFBuKby4A==",
      "dev": true,
      "funding": [
        {
          "type": "opencollective",
          "url": "https://opencollective.com/browserslist"
        },
        {
          "type": "tidelift",
          "url": "https://tidelift.com/funding/github/npm/browserslist"
        },
        {
          "type": "github",
          "url": "https://github.com/sponsors/ai"
        }
      ],
      "license": "MIT",
      "dependencies": {
        "escalade": "^3.2.0",
        "picocolors": "^1.1.1"
      },
      "bin": {
        "update-browserslist-db": "cli.js"
      },
      "peerDependencies": {
        "browserslist": "&gt;= 4.21.0"
      }
    },
    "node_modules/vite": {
      "version": "6.4.1",
      "resolved": "https://registry.npmjs.org/vite/-/vite-6.4.1.tgz",
      "integrity": "sha512-+Oxm7q9hDoLMyJOYfUYBuHQo+dkAloi33apOPP56pzj+vsdJDzr+j1NISE5pyaAuKL4A3UD34qd0lx5+kfKp2g==",
      "dev": true,
      "license": "MIT",
      "peer": true,
      "dependencies": {
        "esbuild": "^0.25.0",
        "fdir": "^6.4.4",
        "picomatch": "^4.0.2",
        "postcss": "^8.5.3",
        "rollup": "^4.34.9",
        "tinyglobby": "^0.2.13"
      },
      "bin": {
        "vite": "bin/vite.js"
      },
      "engines": {
        "node": "^18.0.0 || ^20.0.0 || &gt;=22.0.0"
      },
      "funding": {
        "url": "https://github.com/vitejs/vite?sponsor=1"
      },
      "optionalDependencies": {
        "fsevents": "~2.3.3"
      },
      "peerDependencies": {
        "@types/node": "^18.0.0 || ^20.0.0 || &gt;=22.0.0",
        "jiti": "&gt;=1.21.0",
        "less": "*",
        "lightningcss": "^1.21.0",
        "sass": "*",
        "sass-embedded": "*",
        "stylus": "*",
        "sugarss": "*",
        "terser": "^5.16.0",
        "tsx": "^4.8.1",
        "yaml": "^2.4.2"
      },
      "peerDependenciesMeta": {
        "@types/node": {
          "optional": true
        },
        "jiti": {
          "optional": true
        },
        "less": {
          "optional": true
        },
        "lightningcss": {
          "optional": true
        },
        "sass": {
          "optional": true
        },
        "sass-embedded": {
          "optional": true
        },
        "stylus": {
          "optional": true
        },
        "sugarss": {
          "optional": true
        },
        "terser": {
          "optional": true
        },
        "tsx": {
          "optional": true
        },
        "yaml": {
          "optional": true
        }
      }
    },
    "node_modules/yallist": {
      "version": "3.1.1",
      "resolved": "https://registry.npmjs.org/yallist/-/yallist-3.1.1.tgz",
      "integrity": "sha512-a4UGQaWPH59mOXUYnAG2ewncQS4i4F43Tv3JoAM+s2VDAmS9NsK8GpDMLrCHPksFT7h3K6TOoUNn2pb7RoXx4g==",
      "dev": true,
      "license": "ISC"
    }
  }
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="index-html"><a href="#index-html" class="headerlink" title="index.html"></a>index.html</h3><pre class="line-numbers language-none"><code class="language-none">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;DNA Sequence &amp; Primer Tool&lt;/title&gt;
    &lt;style&gt;
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --highlight: #fde047;
            --error: #ef4444;
            --success: #22c55e;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.5;
        }

        * {
            box-sizing: border-box;
        }

        #root {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        h1, h2, h3 {
            margin-top: 0;
        }

        /* Utility classes for the React app */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
            font-size: 0.875rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        .btn-primary:hover {
            background-color: var(--primary-hover);
        }

        .btn-secondary {
            background-color: #f8fafc;
            border-color: #c4b5fd;
            color: #7c3aed;  /* 紫色文字 */
        }
        .btn-secondary:hover {
            background-color: #e9d5ff;
        }

        .card {
            background: var(--card-bg);
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
        }

        .input-group {
            margin-bottom: 1rem;
        }

        .input-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .input-field {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            font-family: inherit;
            font-size: 0.875rem;
        }
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.1);
        }

        .font-mono {
            font-family: "Courier New", Courier, monospace;
        }
        
        /* Custom scrollbar for sequence view */
        .sequence-viewer {
            overflow-y: auto;
            max-height: 300px;
            background: #f8fafc;
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            padding: 1rem;
            white-space: pre-wrap;
            word-break: break-all;
            line-height: 1.6;
        }

        mark {
            background-color: var(--highlight);
            color: black;
            font-weight: bold;
            padding: 0 2px;
            border-radius: 2px;
        }

        .grid {
            display: grid;
            gap: 1rem;
        }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
        
        @media (max-width: 768px) {
            .grid-cols-2, .grid-cols-4 { grid-template-columns: 1fr; }
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .badge-blue { background: #dbeafe; color: #1e40af; }
        .badge-green { background: #dcfce7; color: #166534; }
    &lt;/style&gt;
&lt;script type="importmap"&gt;
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
&lt;/script&gt;
&lt;link rel="stylesheet" href="/index.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="root"&gt;&lt;/div&gt;
    &lt;script type="module" src="./index.tsx"&gt;&lt;/script&gt;
&lt;script type="module" src="/index.tsx"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="env-local"><a href="#env-local" class="headerlink" title=".env.local"></a>.env.local</h3><pre class="line-numbers language-none"><code class="language-none">GEMINI_API_KEY=PLACEHOLDER_API_KEY<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="metadata-json"><a href="#metadata-json" class="headerlink" title="metadata.json"></a>metadata.json</h3><pre class="line-numbers language-none"><code class="language-none">{
  "description": "Generated by Gemini.",
  "requestFramePermissions": [],
  "name": "Find_Seq"
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="tsconfig-json"><a href="#tsconfig-json" class="headerlink" title="tsconfig.json"></a>tsconfig.json</h3><pre class="line-numbers language-none"><code class="language-none">{
  "compilerOptions": {
    "target": "ES2022",
    "experimentalDecorators": true,
    "useDefineForClassFields": false,
    "module": "ESNext",
    "lib": [
      "ES2022",
      "DOM",
      "DOM.Iterable"
    ],
    "skipLibCheck": true,
    "types": [
      "node"
    ],
    "moduleResolution": "bundler",
    "isolatedModules": true,
    "moduleDetection": "force",
    "allowJs": true,
    "jsx": "react-jsx",
    "paths": {
      "@/*": [
        "./*"
      ]
    },
    "allowImportingTsExtensions": true,
    "noEmit": true
  }
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="vite-config-ts"><a href="#vite-config-ts" class="headerlink" title="vite.config.ts"></a>vite.config.ts</h3><pre class="line-numbers language-none"><code class="language-none">import path from 'path';
import { defineConfig, loadEnv } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig(({ mode }) =&gt; {
    const env = loadEnv(mode, '.', '');
    return {
      server: {
        port: 3000,
        host: '0.0.0.0',
      },
      plugins: [react()],
      define: {
        'process.env.API_KEY': JSON.stringify(env.GEMINI_API_KEY),
        'process.env.GEMINI_API_KEY': JSON.stringify(env.GEMINI_API_KEY)
      },
      resolve: {
        alias: {
          '@': path.resolve(__dirname, '.'),
        }
      }
    };
});<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="gitignore"><a href="#gitignore" class="headerlink" title=".gitignore"></a>.gitignore</h3><pre class="line-numbers language-none"><code class="language-none"># Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>SNP</category>
        <category>Gemini</category>
      </categories>
  </entry>
  <entry>
    <title>LD-Block 连锁不平衡分析</title>
    <url>/2025/10/31/ld-block-lian-suo-bu-ping-heng-fen-xi/</url>
    <content><![CDATA[<p><strong>关键词</strong>：LD Block分析、连锁不平衡、LDBlockShow、群体遗传学、VCF处理、基因组可视化</p>
<hr>
<h1 id="使用LDBlockShow进行LD-Block分析"><a href="#使用LDBlockShow进行LD-Block分析" class="headerlink" title="使用LDBlockShow进行LD Block分析"></a>使用LDBlockShow进行LD Block分析</h1><blockquote>
<p>在群体遗传学研究中，连锁不平衡（Linkage Disequilibrium, LD）分析是理解基因组结构和识别候选基因的重要工具。本文将介绍如何使用LDBlockShow工具对特定基因组区域进行LD block分析。本文详细介绍如何使用LDBlockShow工具对特定基因组区域进行连锁不平衡（LD）Block分析，涵盖从数据预处理、样本名修正、目标区域提取到最终可视化分析的完整流程。</p>
</blockquote>
<h2 id="1-分析背景与工具准备"><a href="#1-分析背景与工具准备" class="headerlink" title="1. 分析背景与工具准备"></a>1. 分析背景与工具准备</h2><h3 id="1-1-分析目标"><a href="#1-1-分析目标" class="headerlink" title="1.1 分析目标"></a>1.1 分析目标</h3><p>对基因LOC105322102区域（NC_047567.1:32646664-32667511）进行LD Block分析，了解该区域的连锁不平衡结构。</p>
<h3 id="1-2-所需工具安装"><a href="#1-2-所需工具安装" class="headerlink" title="1.2 所需工具安装"></a>1.2 所需工具安装</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 生物信息学工具</span>
conda create <span class="token parameter variable">-n</span> vcftools_env <span class="token parameter variable">-c</span> bioconda <span class="token parameter variable">-c</span> conda-forge <span class="token punctuation">\</span>
    bcftools <span class="token punctuation">\</span>
    ldblockshow <span class="token punctuation">\</span>
    plink <span class="token punctuation">\</span>
    tabix <span class="token punctuation">\</span>
    vcftools <span class="token punctuation">\</span>
    ldblockshow <span class="token punctuation">\</span>
    r-base <span class="token punctuation">\</span>
    r-tidyverse <span class="token punctuation">\</span>
    r-hexbin <span class="token punctuation">\</span>
    r-patchwork <span class="token punctuation">\</span>
    r-viridis <span class="token parameter variable">-y</span>
    
<span class="token comment"># R包（用于可视化）</span>
R <span class="token parameter variable">-e</span> <span class="token string">"install.packages(c('tidyverse', 'hexbin', 'patchwork', 'viridis'))"</span>

conda activate vcftools_env<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2-数据预处理"><a href="#2-数据预处理" class="headerlink" title="2. 数据预处理"></a>2. 数据预处理</h2><h3 id="2-1-原始数据"><a href="#2-1-原始数据" class="headerlink" title="2.1 原始数据"></a>2.1 原始数据</h3><ul>
<li>输入文件：<code>/home/wanglab/Ywh/adductor_muscle_scar/Variants/NC_047567.1_results_snps.vcf.gz</code></li>
</ul>
<h3 id="2-2-解决样本名问题"><a href="#2-2-解决样本名问题" class="headerlink" title="2.2 解决样本名问题"></a>2.2 解决样本名问题</h3><p>原始VCF文件中的样本名包含下划线，会导致PLINK（LDBlockShow内部调用）报错：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 导出样本名并替换下划线</span>
bcftools query <span class="token parameter variable">-l</span> /home/wanglab/Ywh/adductor_muscle_scar/Variants/NC_047567.1_results_snps.vcf.gz <span class="token operator">&gt;</span> samples.txt
<span class="token function">sed</span> <span class="token string">'s/_/-/g'</span> samples.txt <span class="token operator">&gt;</span> new_samples.txt

<span class="token comment"># 重新写入header生成修正后的VCF文件</span>
bcftools reheader <span class="token parameter variable">-s</span> new_samples.txt /home/wanglab/Ywh/adductor_muscle_scar/Variants/NC_047567.1_results_snps.vcf.gz <span class="token parameter variable">-o</span> fixed_samples.vcf.gz
tabix <span class="token parameter variable">-p</span> vcf fixed_samples.vcf.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3-目标SNP位点提取"><a href="#3-目标SNP位点提取" class="headerlink" title="3. 目标SNP位点提取"></a>3. 目标SNP位点提取</h2><h3 id="3-1-创建目标位点列表"><a href="#3-1-创建目标位点列表" class="headerlink" title="3.1 创建目标位点列表"></a>3.1 创建目标位点列表</h3><p>创建包含108个目标SNP位点的列表文件：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> <span class="token operator">&gt;</span> selected_positions.txt <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
32667511
32661831
32661817
32661895
...（此处省略具体位点列表）
32646664
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-2-提取目标SNP"><a href="#3-2-提取目标SNP" class="headerlink" title="3.2 提取目标SNP"></a>3.2 提取目标SNP</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 转换为BED格式</span>
<span class="token function">awk</span> <span class="token string">'{print "NC_047567.1\t"$1-1"\t"$1}'</span> selected_positions.txt <span class="token operator">&gt;</span> selected_snps.bed

<span class="token comment"># 从修正后的VCF文件中提取目标SNP</span>
bcftools view <span class="token parameter variable">-T</span> selected_snps.bed fixed_samples.vcf.gz <span class="token parameter variable">-Oz</span> <span class="token parameter variable">-o</span> selected_snps.vcf.gz
tabix <span class="token parameter variable">-p</span> vcf selected_snps.vcf.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="4-LD-Block分析"><a href="#4-LD-Block分析" class="headerlink" title="4. LD Block分析"></a>4. LD Block分析</h2><h3 id="4-1-运行LDBlockShow"><a href="#4-1-运行LDBlockShow" class="headerlink" title="4.1 运行LDBlockShow"></a>4.1 运行LDBlockShow</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">LDBlockShow <span class="token parameter variable">-InVCF</span> selected_snps.vcf.gz <span class="token punctuation">\</span>
            <span class="token parameter variable">-OutPut</span> LOC105322102_selected_snps <span class="token punctuation">\</span>
            <span class="token parameter variable">-Region</span> <span class="token string">"NC_047567.1:32646281:32669029"</span> <span class="token punctuation">\</span>
            <span class="token parameter variable">-SeleVar</span> <span class="token number">2</span> <span class="token punctuation">\</span>
            <span class="token parameter variable">-MAF</span> <span class="token number">0.05</span> <span class="token punctuation">\</span>
            <span class="token parameter variable">-OutPng</span> <span class="token punctuation">\</span>
            <span class="token parameter variable">-OutPdf</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-2-参数详解"><a href="#4-2-参数详解" class="headerlink" title="4.2 参数详解"></a>4.2 参数详解</h3><ul>
<li><code>-InVCF selected_snps.vcf.gz</code>：输入提取的目标SNP VCF文件</li>
<li><code>-OutPut LOC105322102_selected_snps</code>：输出文件前缀</li>
<li><code>-Region "NC_047567.1:32646281:32669029"</code>：分析区域</li>
<li><code>-SeleVar 2</code>：选择算法</li>
<li><code>-MAF 0.05</code>：过滤次要等位基因频率&lt;5%的位点</li>
<li><code>-OutPng -OutPdf</code>：生成PNG和PDF格式图片</li>
</ul>
<h3 id="4-3-结果文件与解读"><a href="#4-3-结果文件与解读" class="headerlink" title="4.3. 结果文件与解读"></a>4.3. 结果文件与解读</h3><h3 id="4-3-1-生成文件"><a href="#4-3-1-生成文件" class="headerlink" title="4.3.1 生成文件"></a>4.3.1 生成文件</h3><ul>
<li><code>LOC105322102_selected_snps.blocks</code>：LD block定义文件</li>
<li><code>LOC105322102_selected_snps.blocks.gz</code>：压缩的block文件</li>
<li><code>LOC105322102_selected_snps.png</code>：LD block可视化图（PNG格式）</li>
<li><code>LOC105322102_selected_snps.pdf</code>：LD block可视化图（PDF格式）</li>
</ul>
<h3 id="4-3-2-结果解读"><a href="#4-3-2-结果解读" class="headerlink" title="4.3.2 结果解读"></a>4.3.2 结果解读</h3><p>LD block图中：</p>
<ul>
<li><strong>颜色深浅</strong>：表示SNP对之间的LD强度（r²值）</li>
<li><strong>Block边界</strong>：黑色三角标记表示LD block的边界</li>
<li><strong>Block内部</strong>：高度连锁的SNP集合，通常作为一个整体遗传</li>
</ul>
<h2 id="5-全基因组LD分析可视化（R脚本）"><a href="#5-全基因组LD分析可视化（R脚本）" class="headerlink" title="5. 全基因组LD分析可视化（R脚本）"></a>5. 全基因组LD分析可视化（R脚本）</h2><p>对于更全面的LD分析，可以使用以下R脚本进行可视化：</p>
<h3 id="5-1-准备LD数据"><a href="#5-1-准备LD数据" class="headerlink" title="5.1 准备LD数据"></a>5.1 准备LD数据</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 使用PLINK计算全基因组LD</span>
plink <span class="token parameter variable">--vcf</span> fixed_samples.vcf.gz <span class="token punctuation">\</span>
      --double-id <span class="token punctuation">\</span>
      --make-bed <span class="token punctuation">\</span>
      <span class="token parameter variable">--out</span> full_data
      
plink <span class="token parameter variable">--bfile</span> full_data <span class="token punctuation">\</span>
      <span class="token parameter variable">--r2</span> <span class="token punctuation">\</span>
      --ld-window <span class="token number">100</span> <span class="token punctuation">\</span>
      --ld-window-kb <span class="token number">10000</span> <span class="token punctuation">\</span>
      --ld-window-r2 <span class="token number">0</span> <span class="token punctuation">\</span>
      <span class="token parameter variable">--out</span> full_ld_results<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-2-R可视化脚本"><a href="#5-2-R可视化脚本" class="headerlink" title="5.2 R可视化脚本"></a>5.2 R可视化脚本</h3><p><code>conda activate py310</code></p>
<p><code>jupyter notebook --allow-root</code></p>
<p>创建 <code>ld_visualization.R</code> 文件：</p>
<pre class="line-numbers language-r" data-language="r"><code class="language-r"><span class="token comment">#!/usr/bin/env Rscript</span>

<span class="token comment"># 加载必要的包</span>
library<span class="token punctuation">(</span>tidyverse<span class="token punctuation">)</span>
library<span class="token punctuation">(</span>hexbin<span class="token punctuation">)</span>
library<span class="token punctuation">(</span>patchwork<span class="token punctuation">)</span>

cat<span class="token punctuation">(</span><span class="token string">"=== LD分析可视化 ===\n"</span><span class="token punctuation">)</span>

<span class="token comment"># 1. 读取LD结果数据</span>
ld_data <span class="token operator">&lt;-</span> read.table<span class="token punctuation">(</span><span class="token string">"full_ld_results.ld"</span><span class="token punctuation">,</span> header <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> 
                     stringsAsFactors <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">,</span> comment.char <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span>

<span class="token comment"># 移除可能的空行</span>
ld_data <span class="token operator">&lt;-</span> ld_data<span class="token punctuation">[</span>complete.cases<span class="token punctuation">(</span>ld_data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span>

cat<span class="token punctuation">(</span><span class="token string">"数据维度:"</span><span class="token punctuation">,</span> dim<span class="token punctuation">(</span>ld_data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
cat<span class="token punctuation">(</span><span class="token string">"总SNP对数量:"</span><span class="token punctuation">,</span> format<span class="token punctuation">(</span>nrow<span class="token punctuation">(</span>ld_data<span class="token punctuation">)</span><span class="token punctuation">,</span> big.mark <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
cat<span class="token punctuation">(</span><span class="token string">"平均r²值:"</span><span class="token punctuation">,</span> round<span class="token punctuation">(</span>mean<span class="token punctuation">(</span>ld_data<span class="token operator">$</span>R2<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>

<span class="token comment"># 2. 随机抽样用于可视化</span>
set.seed<span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>
sample_size <span class="token operator">&lt;-</span> min<span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span> nrow<span class="token punctuation">(</span>ld_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
ld_sample <span class="token operator">&lt;-</span> ld_data <span class="token percent-operator operator">%&gt;%</span> sample_n<span class="token punctuation">(</span>sample_size<span class="token punctuation">)</span>

<span class="token comment"># 计算距离</span>
ld_sample<span class="token operator">$</span>distance <span class="token operator">&lt;-</span> abs<span class="token punctuation">(</span>ld_sample<span class="token operator">$</span>BP_B <span class="token operator">-</span> ld_sample<span class="token operator">$</span>BP_A<span class="token punctuation">)</span>
ld_sample<span class="token operator">$</span>distance_kb <span class="token operator">&lt;-</span> ld_sample<span class="token operator">$</span>distance <span class="token operator">/</span> <span class="token number">1000</span>

<span class="token comment"># 3. 创建高质量LD衰减图</span>
png<span class="token punctuation">(</span><span class="token string">"ld_decay_high_quality.png"</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">"in"</span><span class="token punctuation">,</span> res<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">)</span>

p1 <span class="token operator">&lt;-</span> ggplot<span class="token punctuation">(</span>ld_sample<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> distance_kb<span class="token punctuation">,</span> y <span class="token operator">=</span> R2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  stat_binhex<span class="token punctuation">(</span>bins <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  scale_fill_viridis_c<span class="token punctuation">(</span>trans <span class="token operator">=</span> <span class="token string">"log10"</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"SNP pairs\n(log10)"</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  geom_smooth<span class="token punctuation">(</span>color <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">"loess"</span><span class="token punctuation">,</span> span <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">,</span> 
              size <span class="token operator">=</span> <span class="token number">1.5</span><span class="token punctuation">,</span> se <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">,</span> fill <span class="token operator">=</span> <span class="token string">"pink"</span><span class="token punctuation">,</span> alpha <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  labs<span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">"A. LD Decay: r² vs Distance"</span><span class="token punctuation">,</span>
       x <span class="token operator">=</span> <span class="token string">"Distance between SNPs (kb)"</span><span class="token punctuation">,</span>
       y <span class="token operator">=</span> expression<span class="token punctuation">(</span>LD<span class="token operator">~</span><span class="token punctuation">(</span>r<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  theme_minimal<span class="token punctuation">(</span><span class="token punctuation">)</span>

p2 <span class="token operator">&lt;-</span> ggplot<span class="token punctuation">(</span>ld_sample<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> R2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  geom_histogram<span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token string">"lightblue"</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">"black"</span><span class="token punctuation">,</span> bins <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">,</span> alpha <span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  geom_vline<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>xintercept <span class="token operator">=</span> mean<span class="token punctuation">(</span>R2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">"red"</span><span class="token punctuation">,</span> 
             linetype <span class="token operator">=</span> <span class="token string">"dashed"</span><span class="token punctuation">,</span> size <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  labs<span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">"B. Distribution of r² values"</span><span class="token punctuation">,</span>
       x <span class="token operator">=</span> expression<span class="token punctuation">(</span>r<span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token string">"Frequency"</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  theme_minimal<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 组合图形</span>
combined_plot <span class="token operator">&lt;-</span> p1 <span class="token operator">/</span> p2 <span class="token operator">+</span> 
  plot_annotation<span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">"Linkage Disequilibrium Analysis"</span><span class="token punctuation">,</span>
                  subtitle <span class="token operator">=</span> paste<span class="token punctuation">(</span><span class="token string">"Based on"</span><span class="token punctuation">,</span> format<span class="token punctuation">(</span>sample_size<span class="token punctuation">,</span> big.mark <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"SNP pairs"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

print<span class="token punctuation">(</span>combined_plot<span class="token punctuation">)</span>
dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 4. 创建距离分箱的LD衰减图</span>
png<span class="token punctuation">(</span><span class="token string">"ld_by_distance_bins.png"</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> units<span class="token operator">=</span><span class="token string">"in"</span><span class="token punctuation">,</span> res<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">)</span>

distance_breaks <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">Inf</span><span class="token punctuation">)</span>
distance_labels <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">"0-1"</span><span class="token punctuation">,</span> <span class="token string">"1-5"</span><span class="token punctuation">,</span> <span class="token string">"5-10"</span><span class="token punctuation">,</span> <span class="token string">"10-50"</span><span class="token punctuation">,</span> <span class="token string">"50-100"</span><span class="token punctuation">,</span> 
                    <span class="token string">"100-500"</span><span class="token punctuation">,</span> <span class="token string">"500-1000"</span><span class="token punctuation">,</span> <span class="token string">"&gt;1000"</span><span class="token punctuation">)</span>

ld_sample<span class="token operator">$</span>distance_bin <span class="token operator">&lt;-</span> cut<span class="token punctuation">(</span>ld_sample<span class="token operator">$</span>distance_kb<span class="token punctuation">,</span> 
                             breaks <span class="token operator">=</span> distance_breaks<span class="token punctuation">,</span>
                             labels <span class="token operator">=</span> distance_labels<span class="token punctuation">)</span>

ld_summary <span class="token operator">&lt;-</span> ld_sample <span class="token percent-operator operator">%&gt;%</span>
  group_by<span class="token punctuation">(</span>distance_bin<span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  summarise<span class="token punctuation">(</span>mean_r2 <span class="token operator">=</span> mean<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sd_r2 <span class="token operator">=</span> sd<span class="token punctuation">(</span>R2<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            n_pairs <span class="token operator">=</span> n<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token percent-operator operator">%&gt;%</span>
  filter<span class="token punctuation">(</span>n_pairs <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span>

ggplot<span class="token punctuation">(</span>ld_summary<span class="token punctuation">,</span> aes<span class="token punctuation">(</span>x <span class="token operator">=</span> distance_bin<span class="token punctuation">,</span> y <span class="token operator">=</span> mean_r2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  geom_col<span class="token punctuation">(</span>fill <span class="token operator">=</span> <span class="token string">"steelblue"</span><span class="token punctuation">,</span> alpha <span class="token operator">=</span> <span class="token number">0.8</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  geom_errorbar<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>ymin <span class="token operator">=</span> mean_r2 <span class="token operator">-</span> sd_r2<span class="token punctuation">,</span> ymax <span class="token operator">=</span> mean_r2 <span class="token operator">+</span> sd_r2<span class="token punctuation">)</span><span class="token punctuation">,</span> 
                width <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">,</span> color <span class="token operator">=</span> <span class="token string">"darkred"</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  geom_text<span class="token punctuation">(</span>aes<span class="token punctuation">(</span>label <span class="token operator">=</span> format<span class="token punctuation">(</span>n_pairs<span class="token punctuation">,</span> big.mark <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
            vjust <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> size <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  labs<span class="token punctuation">(</span>title <span class="token operator">=</span> <span class="token string">"LD Decay by Distance Intervals"</span><span class="token punctuation">,</span>
       x <span class="token operator">=</span> <span class="token string">"Distance (kb)"</span><span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token string">"Mean r²"</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  theme_minimal<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
  theme<span class="token punctuation">(</span>axis.text.x <span class="token operator">=</span> element_text<span class="token punctuation">(</span>angle <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">,</span> hjust <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

dev.off<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 5. 生成统计报告</span>
ld_stats <span class="token operator">&lt;-</span> data.frame<span class="token punctuation">(</span>
  Statistic <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">"Total SNP pairs"</span><span class="token punctuation">,</span> <span class="token string">"Sampled pairs"</span><span class="token punctuation">,</span> <span class="token string">"Mean r²"</span><span class="token punctuation">,</span> <span class="token string">"Median r²"</span><span class="token punctuation">,</span>
                <span class="token string">"Pairs with r² &gt; 0.8"</span><span class="token punctuation">,</span> <span class="token string">"Pairs with r² &gt; 0.5"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  Value <span class="token operator">=</span> c<span class="token punctuation">(</span>format<span class="token punctuation">(</span>nrow<span class="token punctuation">(</span>ld_data<span class="token punctuation">)</span><span class="token punctuation">,</span> big.mark <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            format<span class="token punctuation">(</span>sample_size<span class="token punctuation">,</span> big.mark <span class="token operator">=</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            round<span class="token punctuation">(</span>mean<span class="token punctuation">(</span>ld_data<span class="token operator">$</span>R2<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            round<span class="token punctuation">(</span>median<span class="token punctuation">(</span>ld_data<span class="token operator">$</span>R2<span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sum<span class="token punctuation">(</span>ld_data<span class="token operator">$</span>R2 <span class="token operator">&gt;</span> <span class="token number">0.8</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            sum<span class="token punctuation">(</span>ld_data<span class="token operator">$</span>R2 <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">,</span> na.rm <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>

write.csv<span class="token punctuation">(</span>ld_stats<span class="token punctuation">,</span> <span class="token string">"ld_detailed_statistics.csv"</span><span class="token punctuation">,</span> row.names <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span>

cat<span class="token punctuation">(</span><span class="token string">"分析完成！生成3个可视化文件\n"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行R脚本：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> +x ld_visualization.R
Rscript ld_visualization.R<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>版本2</p>
<pre class="line-numbers language-none"><code class="language-none">library(tidyverse)

plot_ld_decay &lt;- function(ld_file, output="ld_decay.png", nsample=1e5,
                          region=NULL) {
  message("=== 清洁版LD分析可视化 ===")
  ld_data &lt;- read.table(ld_file, header=TRUE)
  message("数据维度: ", paste(dim(ld_data), collapse=" x "))
  message("列名: ", paste(colnames(ld_data), collapse=" "))

  # 区间筛选
  if (!is.null(region)) {
    parts &lt;- strsplit(region, "[:]", fixed=FALSE)[[1]]
    if (length(parts) != 3) stop("区间格式错误，应为 chr:start:end")
    
    region_chr &lt;- parts[1]
    start_pos  &lt;- as.numeric(parts[2])
    end_pos    &lt;- as.numeric(parts[3])
    
    ld_data &lt;- ld_data %&gt;%
      filter(CHR_A == region_chr &amp; CHR_B == region_chr) %&gt;%
      filter(BP_A &gt;= start_pos &amp; BP_A &lt;= end_pos &amp;
             BP_B &gt;= start_pos &amp; BP_B &lt;= end_pos)
    
    message("筛选区间: ", region)
    message("区间 SNP对数量: ", nrow(ld_data))
  }

  # 统计信息
  message("\n=== LD统计摘要 ===")
  message("总SNP对数量: ", nrow(ld_data))
  message("平均r²值: ", round(mean(ld_data$R2, na.rm=TRUE), 4))
  message("r²值范围: ", paste(range(ld_data$R2, na.rm=TRUE), collapse=" - "))

  # 抽样
  set.seed(42)
  if (nrow(ld_data) &gt; nsample) {
    ld_plot &lt;- ld_data %&gt;% sample_n(nsample)
  } else {
    ld_plot &lt;- ld_data
  }

  # 画图
  plot &lt;- ggplot(ld_plot, aes(x=abs(BP_B - BP_A), y=R2)) +
    geom_point(alpha=0.3, size=0.6) +
    geom_smooth(method="loess", formula=y~x, se=FALSE, linewidth=1, color="red") +
    theme_minimal(base_size=14) +
    labs(
      title="LD Decay",
      x="Distance (bp)",
      y=expression(r^2)
    )
  
  ggsave(output, plot, width=8, height=6, dpi=300)
  print(plot)
  message("LD衰减图已保存到: ", output)
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="6-结果文件与解读"><a href="#6-结果文件与解读" class="headerlink" title="6. 结果文件与解读"></a>6. 结果文件与解读</h2><h3 id="6-1-LDBlockShow生成文件"><a href="#6-1-LDBlockShow生成文件" class="headerlink" title="6.1 LDBlockShow生成文件"></a>6.1 LDBlockShow生成文件</h3><ul>
<li><code>LOC105322102_selected_snps.blocks</code>：LD block定义文件</li>
<li><code>LOC105322102_selected_snps.png/pdf</code>：LD block可视化图</li>
</ul>
<h3 id="6-2-R脚本生成文件"><a href="#6-2-R脚本生成文件" class="headerlink" title="6.2 R脚本生成文件"></a>6.2 R脚本生成文件</h3><ul>
<li><code>ld_decay_high_quality.png</code>：LD衰减组合图</li>
<li><code>ld_by_distance_bins.png</code>：距离分箱分析图  </li>
<li><code>ld_detailed_statistics.csv</code>：详细统计表格</li>
</ul>
<h3 id="6-3-结果解读"><a href="#6-3-结果解读" class="headerlink" title="6.3 结果解读"></a>6.3 结果解读</h3><ul>
<li><strong>LD Block图</strong>：显示特定区域的连锁区块结构</li>
<li><strong>LD衰减图</strong>：展示基因组范围内LD随距离衰减的趋势</li>
<li><strong>r²分布</strong>：反映整体LD强度分布</li>
<li><strong>统计表格</strong>：提供量化的LD分析指标</li>
</ul>
<h2 id="7-常见问题与解决方案"><a href="#7-常见问题与解决方案" class="headerlink" title="7. 常见问题与解决方案"></a>7. 常见问题与解决方案</h2><h3 id="问题1：样本名包含下划线"><a href="#问题1：样本名包含下划线" class="headerlink" title="问题1：样本名包含下划线"></a>问题1：样本名包含下划线</h3><p><strong>错误信息</strong>：<code>Multiple instances of '_' in sample ID</code><br><strong>解决方案</strong>：使用<code>bcftools reheader</code>修改样本名</p>
<h3 id="问题2：区域格式错误"><a href="#问题2：区域格式错误" class="headerlink" title="问题2：区域格式错误"></a>问题2：区域格式错误</h3><p><strong>错误信息</strong>：<code>Para [-Region] should be [chr:Start:End]</code><br><strong>解决方案</strong>：确保区域格式为<code>chr:start:end</code></p>
<h3 id="问题3：R包缺失"><a href="#问题3：R包缺失" class="headerlink" title="问题3：R包缺失"></a>问题3：R包缺失</h3><p><strong>解决方案</strong>：</p>
<pre class="line-numbers language-r" data-language="r"><code class="language-r">install.packages<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">"tidyverse"</span><span class="token punctuation">,</span> <span class="token string">"hexbin"</span><span class="token punctuation">,</span> <span class="token string">"patchwork"</span><span class="token punctuation">,</span> <span class="token string">"viridis"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="8-技术要点总结"><a href="#8-技术要点总结" class="headerlink" title="8. 技术要点总结"></a>8. 技术要点总结</h2><ol>
<li><strong>数据预处理是关键</strong>：确保VCF文件格式正确</li>
<li><strong>精确提取目标区域</strong>：使用bcftools根据位点列表精确提取</li>
<li><strong>多层次分析</strong>：结合LDBlockShow的区块分析和R的全基因组可视化</li>
<li><strong>结果验证</strong>：检查生成的图片和统计文件，确保分析质量</li>
</ol>
<h2 id="9-应用价值"><a href="#9-应用价值" class="headerlink" title="9. 应用价值"></a>9. 应用价值</h2><p>这个完整流程可以：</p>
<ul>
<li><strong>精细分析</strong>：对候选基因区域进行精细LD Block分析</li>
<li><strong>全局视角</strong>：通过全基因组LD分析了解整体遗传结构</li>
<li><strong>科研发表</strong>：生成高质量的发表级图片</li>
<li><strong>育种应用</strong>：为分子标记辅助选择提供依据</li>
</ul>
<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>

<h2 id="看不懂的！"><a href="#看不懂的！" class="headerlink" title="看不懂的！"></a>看不懂的！</h2><pre class="line-numbers language-none"><code class="language-none">#!/bin/bash

# 傻瓜式一键基因LD分析脚本
# 用法: ./auto_gene_ld_oneclick.sh &lt;基因名&gt;

set -e

# 配置参数
GENE_NAME=$1
VCF_FILE="/home/wanglab/Ywh/adductor_muscle_scar/Variants/NC_047567.1_results_snps.vcf.gz"
GFF_FILE="/path/to/your/genome.gff"  # 请修改为你的GFF文件路径
EXTEND_UPSTREAM=50000
EXTEND_DOWNSTREAM=50000
MAF_THRESHOLD=0.05

echo "=== 傻瓜式一键基因LD分析: $GENE_NAME ==="

# 检查输入参数
if [ -z "$GENE_NAME" ]; then
    echo "错误: 请提供基因名作为参数"
    echo "用法: $0 &lt;基因名&gt;"
    exit 1
fi

# 检查必要文件
if [ ! -f "$VCF_FILE" ]; then
    echo "错误: VCF文件不存在: $VCF_FILE"
    exit 1
fi

if [ ! -f "$GFF_FILE" ]; then
    echo "错误: GFF文件不存在: $GFF_FILE"
    echo "请修改脚本中的GFF_FILE路径"
    exit 1
fi

# 创建工作目录
WORK_DIR="LD_analysis_${GENE_NAME}"
mkdir -p "$WORK_DIR"
cd "$WORK_DIR"

echo "工作目录: $(pwd)"

# 步骤1: 从GFF文件自动提取基因坐标
echo "步骤1: 从GFF文件提取基因坐标..."

# 从GFF中提取基因信息（支持多种GFF格式）
GENE_INFO=$(grep -w "$GENE_NAME" "$GFF_FILE" | grep -E "(gene|mRNA|transcript)" | head -1)

if [ -z "$GENE_INFO" ]; then
    echo "错误: 在GFF文件中未找到基因 $GENE_NAME"
    echo "尝试模糊匹配..."
    GENE_INFO=$(grep "$GENE_NAME" "$GFF_FILE" | grep -E "(gene|mRNA|transcript)" | head -1)
    if [ -z "$GENE_INFO" ]; then
        echo "错误: 模糊匹配也失败，请检查基因名是否正确"
        exit 1
    fi
    echo "警告: 使用模糊匹配结果"
fi

echo "找到基因信息: $GENE_INFO"

# 解析GFF行（第1列: 染色体, 第4列: 起始, 第5列: 终止）
CHROM=$(echo "$GENE_INFO" | awk '{print $1}')
GENE_START=$(echo "$GENE_INFO" | awk '{print $4}')
GENE_END=$(echo "$GENE_INFO" | awk '{print $5}')

# 验证坐标
if [ -z "$CHROM" ] || [ -z "$GENE_START" ] || [ -z "$GENE_END" ]; then
    echo "错误: 无法从GFF行中解析坐标"
    echo "GFF行: $GENE_INFO"
    exit 1
fi

echo "✓ 成功提取基因坐标: $CHROM:$GENE_START-$GENE_END"

# 计算分析区域
REGION_START=$((GENE_START - EXTEND_UPSTREAM))
REGION_END=$((GENE_END + EXTEND_DOWNSTREAM))

# 确保起始位置不小于1
if [ $REGION_START -lt 1 ]; then
    REGION_START=1
fi

echo "分析区域: $CHROM:$REGION_START-$REGION_END"
echo "区域大小: $(( (REGION_END - REGION_START) / 1000 )) kb"

# 步骤2: 提取目标区域SNP
echo "步骤2: 提取目标区域SNP..."

# 方法1: 使用bcftools view -r
bcftools view -r "$CHROM:$REGION_START-$REGION_END" "$VCF_FILE" -Ov -o "${GENE_NAME}_region.vcf" 2&gt;/dev/null || {
    echo "方法1失败，尝试方法2: 使用BED文件"
    echo -e "$CHROM\t$REGION_START\t$REGION_END" &gt; "${GENE_NAME}_region.bed"
    bcftools view -T "${GENE_NAME}_region.bed" "$VCF_FILE" -Ov -o "${GENE_NAME}_region.vcf"
}

# 检查是否提取到SNP
SNP_COUNT=$(grep -v "^#" "${GENE_NAME}_region.vcf" | wc -l)
echo "提取到 $SNP_COUNT 个SNP"

if [ "$SNP_COUNT" -eq 0 ]; then
    echo "错误: 在目标区域未找到任何SNP"
    exit 1
fi

if [ "$SNP_COUNT" -lt 10 ]; then
    echo "警告: SNP数量较少($SNP_COUNT)，LD分析可能不理想"
fi

# 步骤3: 样本名处理
echo "步骤3: 处理样本名..."
bcftools query -l "${GENE_NAME}_region.vcf" &gt; original_samples.txt
if [ $? -ne 0 ]; then
    echo "错误: 无法读取样本名，VCF文件可能损坏"
    exit 1
fi

sed 's/_/-/g' original_samples.txt &gt; new_samples.txt
bcftools reheader -s new_samples.txt "${GENE_NAME}_region.vcf" -o "${GENE_NAME}_region_fixed.vcf"

# 步骤4: 转换为压缩格式
echo "步骤4: 准备分析文件..."
bgzip -f "${GENE_NAME}_region_fixed.vcf"
tabix -p vcf "${GENE_NAME}_region_fixed.vcf.gz"

# 步骤5: 运行LDBlockShow
echo "步骤5: 进行LD Block分析..."
LDBlockShow -InVCF "${GENE_NAME}_region_fixed.vcf.gz" \
            -OutPut "${GENE_NAME}_ld_block" \
            -Region "$CHROM:$REGION_START:$REGION_END" \
            -SeleVar 2 \
            -MAF $MAF_THRESHOLD \
            -OutPng \
            -OutPdf 2&gt;&amp;1 | grep -v "Warning" || {
    echo "LDBlockShow完成（可能有一些警告信息）"
}

# 步骤6: PLINK补充分析
echo "步骤6: 进行PLINK LD分析..."
plink --vcf "${GENE_NAME}_region_fixed.vcf.gz" \
      --double-id \
      --make-bed \
      --out "${GENE_NAME}_plink" --silent

plink --bfile "${GENE_NAME}_plink" \
      --r2 \
      --ld-window 100 \
      --ld-window-kb 1000 \
      --ld-window-r2 0 \
      --out "${GENE_NAME}_pairwise_ld" --silent

# 步骤7: 生成统计报告
echo "步骤7: 生成统计报告..."
Rscript - &lt;&lt;EOF
#!/usr/bin/env Rscript
library(tidyverse)

cat("生成统计报告...\n")

if (file.exists("${GENE_NAME}_pairwise_ld.ld")) {
    ld_data &lt;- read.table("${GENE_NAME}_pairwise_ld.ld", header = TRUE)
    
    # 基本统计
    total_pairs &lt;- nrow(ld_data)
    mean_r2 &lt;- mean(ld_data\$R2, na.rm = TRUE)
    median_r2 &lt;- median(ld_data\$R2, na.rm = TRUE)
    
    stats &lt;- data.frame(
        统计项 = c("基因名", "分析区域", "SNP数量", "SNP对数量", 
                  "平均r²", "中位数r²", "最大r²", "最小r²",
                  "强LD对(r²&gt;0.8)", "中等LD对(r²&gt;0.5)", "弱LD对(r²&lt;0.1)"),
        数值 = c(
            "${GENE_NAME}",
            paste0("${CHROM}:${REGION_START}-${REGION_END}"),
            "${SNP_COUNT}",
            format(total_pairs, big.mark = ","),
            round(mean_r2, 4),
            round(median_r2, 4),
            round(max(ld_data\$R2, na.rm = TRUE), 4),
            round(min(ld_data\$R2, na.rm = TRUE), 4),
            paste0(sum(ld_data\$R2 &gt; 0.8, na.rm = TRUE), " (", 
                   round(sum(ld_data\$R2 &gt; 0.8, na.rm = TRUE)/total_pairs*100, 1), "%)"),
            paste0(sum(ld_data\$R2 &gt; 0.5, na.rm = TRUE), " (", 
                   round(sum(ld_data\$R2 &gt; 0.5, na.rm = TRUE)/total_pairs*100, 1), "%)"),
            paste0(sum(ld_data\$R2 &lt; 0.1, na.rm = TRUE), " (", 
                   round(sum(ld_data\$R2 &lt; 0.1, na.rm = TRUE)/total_pairs*100, 1), "%)")
        )
    )
    
    write.csv(stats, "${GENE_NAME}_ld_statistics.csv", row.names = FALSE, fileEncoding = "UTF-8")
    
    # 生成简单的文本报告
    sink("${GENE_NAME}_analysis_report.txt")
    cat("=== 基因LD分析报告 ===\n")
    cat("基因名: ${GENE_NAME}\n")
    cat("分析时间: ", format(Sys.time(), "%Y-%m-%d %H:%M:%S"), "\n")
    cat("分析区域: ${CHROM}:${REGION_START}-${REGION_END}\n")
    cat("SNP数量: ${SNP_COUNT}\n")
    cat("SNP对数量: ", format(total_pairs, big.mark = ","), "\n")
    cat("平均LD(r²): ", round(mean_r2, 4), "\n")
    cat("LD强度分布:\n")
    cat("  强LD(r²&gt;0.8): ", sum(ld_data\$R2 &gt; 0.8, na.rm = TRUE), 
        "(", round(sum(ld_data\$R2 &gt; 0.8, na.rm = TRUE)/total_pairs*100, 1), "%)\n")
    cat("  中等LD(r²&gt;0.5): ", sum(ld_data\$R2 &gt; 0.5, na.rm = TRUE), 
        "(", round(sum(ld_data\$R2 &gt; 0.5, na.rm = TRUE)/total_pairs*100, 1), "%)\n")
    cat("  弱LD(r²&lt;0.1): ", sum(ld_data\$R2 &lt; 0.1, na.rm = TRUE), 
        "(", round(sum(ld_data\$R2 &lt; 0.1, na.rm = TRUE)/total_pairs*100, 1), "%)\n")
    sink()
    
    cat("✓ 统计报告生成完成\n")
} else {
    cat("警告: 未找到PLINK LD结果文件\n")
}
EOF

# 步骤8: 清理和总结
echo "步骤8: 清理临时文件..."
rm -f original_samples.txt new_samples.txt "${GENE_NAME}_region.vcf" "${GENE_NAME}_region.bed"

echo ""
echo "=== 分析完成! ==="
echo "📁 工作目录: $(pwd)"
echo ""
echo "📊 生成的结果文件:"
echo "   📈 ${GENE_NAME}_ld_block.png    - LD Block图"
echo "   📄 ${GENE_NAME}_ld_block.pdf    - LD Block图(矢量)"
echo "   📋 ${GENE_NAME}_ld_statistics.csv - 详细统计表格"
echo "   📝 ${GENE_NAME}_analysis_report.txt - 分析报告"
echo "   💾 ${GENE_NAME}_pairwise_ld.ld  - 原始LD数据"
echo ""
echo "🔍 分析摘要:"
echo "   基因: $GENE_NAME"
echo "   区域: $CHROM:$REGION_START-$REGION_END"
echo "   SNP数量: $SNP_COUNT"
echo "   上下游扩展: ${EXTEND_UPSTREAM}bp"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><h3 id="1-首先修改脚本中的GFF文件路径："><a href="#1-首先修改脚本中的GFF文件路径：" class="headerlink" title="1. 首先修改脚本中的GFF文件路径："></a>1. 首先修改脚本中的GFF文件路径：</h3><pre class="line-numbers language-none"><code class="language-none"># 编辑脚本，修改这一行：
GFF_FILE="/path/to/your/genome.gff"  # 改为你实际的GFF文件路径

# 如：/home/wanglab/Ywh/adductor_muscle_scar/GCF_902806645.1_cgigas_uk_roslin_v1_genomic.gff<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-给脚本执行权限："><a href="#2-给脚本执行权限：" class="headerlink" title="2. 给脚本执行权限："></a>2. 给脚本执行权限：</h3><pre class="line-numbers language-none"><code class="language-none">chmod +x auto_gene_ld_oneclick.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="3-一键运行："><a href="#3-一键运行：" class="headerlink" title="3. 一键运行："></a>3. 一键运行：</h3><pre class="line-numbers language-none"><code class="language-none">./auto_gene_ld_oneclick.sh LOC105322102
./auto_gene_ld_oneclick.sh LOC105325689
./auto_gene_ld_oneclick.sh 任何基因名<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="脚本特点"><a href="#脚本特点" class="headerlink" title="脚本特点"></a>脚本特点</h2><p>✅ <strong>完全自动化</strong>：只需提供基因名<br>✅ <strong>智能解析</strong>：自动从GFF提取基因坐标<br>✅ <strong>错误处理</strong>：多种备选方案，提高成功率<br>✅ <strong>详细报告</strong>：生成完整的分析报告<br>✅ <strong>友好输出</strong>：清晰的进度提示和结果汇总</p>
<h2 id="支持的GFF格式"><a href="#支持的GFF格式" class="headerlink" title="支持的GFF格式"></a>支持的GFF格式</h2><ul>
<li>NCBI GFF3</li>
<li>Ensembl GFF3</li>
<li>其他标准GFF格式</li>
<li>自动识别gene/mRNA/transcript行</li>
</ul>
<div style="height:3px;background:linear-gradient(90deg,#ff6c6c,#73aaff);margin:2rem 0;border-radius:2px;"></div>

<p>通过LDBlockShow和R的有机结合，研究人员可以从不同尺度全面理解基因组的连锁不平衡结构，为群体遗传学和育种研究提供强有力的技术支持。</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
  <entry>
    <title>LaTeX详细教程+技巧总结</title>
    <url>/2025/11/24/latex/</url>
    <content><![CDATA[<blockquote>
<p>转载自: <a href="https://blog.csdn.net/NSJim/article/details/109066847">https://blog.csdn.net/NSJim/article/details/109066847</a></p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>若想直接学习LaTeX数学公式，请参见我的另一篇博客：<a href="https://blog.csdn.net/NSJim/article/details/109045914">LaTeX数学公式-详细教程</a> 。</p>
<p>本篇文章介绍LaTeX的基本用法，并有自己的经验和总结。另外，可以从LaTeX的官方文档进行学习，官方文档大部分是英文文档，链接：<a href="http://www.ctex.org/OnlineDocuments">LaTeX在线文档</a> ，<a href="http://www.ctex.org/documents/packages/index.htm">LaTex宏包文档</a>。</p>
<p>本篇文章内容包含LaTeX工具，<a href="https://so.csdn.net/so/search?q=LaTeX%E6%A8%A1%E6%9D%BF&amp;spm=1001.2101.3001.7020">LaTeX模板</a>，LaTeX技巧，LaTeX基础，文章架构，字体、大小和颜色，链接，列表，图片，表格，数学公式，算法（伪代码），代码块，论文写作，等等。</p>
<h2 id="LaTeX工具"><a href="#LaTeX工具" class="headerlink" title="LaTeX工具"></a>LaTeX工具</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>LaTeX工具分为在线工具和本地工具，本地工具又分为前台和后台。在线工具推荐Overleaf，本地工具推荐前台使用TeXStudio，后台推荐使用TeXLive（后台工具有TeXLive，MikTeX，CTeX等）。</p>
<p>各个后台的比较：TeXLive有跨平台的性质，适用于Linux、Mac以及Windows系统；TeXLive是完全安装，大小大概为5G左右；每年有一次更新。TeXStudio只适用于Windows系统；它只安装基本的东西，其他任何需要的东西可以动态安装；只有发生重大变化时才会更新。CTeX只适用于Windows系统；默认编码不是UTF-8；已经不再维护，不再更新了，容易出Bug。</p>
<p>可以根据需求选择合适的本地后台，若觉得安装配置比较麻烦，则可以使用Overleaf在线工具，有网络即可使用，更重要的是国内也可以使用，并支持中文界面。详细使用方法在下文介绍。</p>
<h3 id="Overleaf（推荐）"><a href="#Overleaf（推荐）" class="headerlink" title="Overleaf（推荐）"></a>Overleaf（推荐）</h3><p>网址：<a href="https://www.overleaf.com/">Overleaf</a> 。<br>注册账户并登录后即可使用。</p>
<h4 id="使用流程"><a href="#使用流程" class="headerlink" title="使用流程"></a>使用流程</h4><p>点击<code>New Project</code>后还可以使用<code>Templates</code>模板，如下图：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/39fa00e68d7ffbdd5c3d3167e023971d.png" alt="在这里插入图片描述"><br>新建项目后，左边为源代码视图，右边为预览视图。可以点击左上角的<code>Menu</code>下载源文件，PDF文件，或设置编译器，如下图：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/8e7851a57992dd06a3b1b55c7205a34f.png" alt="在这里插入图片描述"><br>展开<code>Recompile</code>按钮可以设置自动编译，并忽略语法检查，如下图：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/68becbf190957cc52ce795c0108f9b69.png" alt="在这里插入图片描述"></p>
<h4 id="切换界面语言"><a href="#切换界面语言" class="headerlink" title="切换界面语言"></a>切换界面语言</h4><p><strong>方法1</strong></p>
<p>点击Overleaf界面左下角的国旗标志可以切换界面语言，切换成中文的操作如下图：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/1393c3043d906b6aa79b2167d8df5a98.png" alt="在这里插入图片描述"></p>
<p><strong>方法2</strong></p>
<p>直接更改网址如下：<code>https://cn.overleaf.com/project</code><br>即可切换界面语言为中文。</p>
<h4 id="更改编译器"><a href="#更改编译器" class="headerlink" title="更改编译器"></a>更改编译器</h4><p>在项目<code>菜单</code>的<code>设置</code>中可以更改，如下图：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/c320de6eb4aced8679f56c80c5056e69.png" alt="在这里插入图片描述"></p>
<h4 id="文档定位"><a href="#文档定位" class="headerlink" title="文档定位"></a>文档定位</h4><p>在项目中线顶部有2个箭头样式的按钮，可以使tex文档和PDF文档相互定位，如下图：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/769778c3d5c145f7f6b3f37d8cf3e21d.png" alt="在这里插入图片描述"><br>补充：<br>左键双击PDF文档的特定位置，tex文档会跳转到对应位置。</p>
<h4 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h4><p>Overleaf内置了很多快捷键，本人分类为常用快捷键和全部快捷键如下：</p>
<p><strong>常用快捷键</strong><br><code>Ctrl+B</code>：粗体<br><code>Ctrl+I</code>：斜体<br><code>Ctrl+/</code>：注释<br><code>Ctrl+Z</code>：撤销<br><code>Ctrl+Y</code>：重做<br><code>Ctrl+F</code>：查找和替换<br><code>Ctrl+Home</code>：到文档顶部<br><code>Ctrl+End</code>：到文档底部<br><code>Ctrl+S</code>：重新编译<br><code>Ctrl+Enter</code>：重新编译</p>
<p><strong>全部快捷键</strong><br>可以在Overleaf项目中点击<code>菜单</code>中的<code>快捷键</code>选项查看，如下图：</p>
<p>2021年5月<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/c738ce43b0fa42d886df60b770a82c5a.png" alt="在这里插入图片描述"></p>
<h3 id="TeXLive和TeXStudio"><a href="#TeXLive和TeXStudio" class="headerlink" title="TeXLive和TeXStudio"></a>TeXLive和TeXStudio</h3><p>安装及配置详情可参见其他人的博客：<a href="https://blog.csdn.net/zywhehe/article/details/83113214">LaTeX新手入门以及TeXlive和TeXstudio的安装使用</a> 。</p>
<p>本人一般使用在线工具Overleaf，因此个人教程暂略，后期若安装本地环境再进行完善。</p>
<h2 id="LaTeX模板"><a href="#LaTeX模板" class="headerlink" title="LaTeX模板"></a>LaTeX模板</h2><p>LaTeX有很多模板，可以直接使用，方便用户排版。</p>
<p>Overleaf中一些常用模板，包含Project，Resume，Homework，Letter，Memo，Poster，Book，Journal，Thesis。</p>
<p>用户可以直接在Overleaf中使用，也可以下载到本地进行使用。</p>
<h2 id="LaTeX技巧"><a href="#LaTeX技巧" class="headerlink" title="LaTeX技巧"></a>LaTeX技巧</h2><h3 id="LaTeX"><a href="#LaTeX" class="headerlink" title="LaTeX"></a>LaTeX</h3><p>LaTeX编辑器中，内置了一个语句，用来展现LaTeX的Logo，代码和效果如下：</p>
<p>代码：</p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\LaTex</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/cf2da4b179a665908abac9dadc694a0b.png" alt="在这里插入图片描述"></p>
<h3 id="中文支持"><a href="#中文支持" class="headerlink" title="中文支持"></a>中文支持</h3><p>无论是在线工具还是本地工具，LaTeX默认都是不支持中文的，因此需要在源代码和配置上稍作修改才可以让LaTeX支持中文，步骤如下：</p>
<ol>
<li><p>编译器配置：<code>XeLaTeX</code>，可在Overleaf的<code>菜单 - 编译器</code>处修改。</p>
</li>
<li><p><code>tex</code>文件编码：<code>utf-8</code>，一般默认为<code>utf-8</code>编码，无需修改。</p>
</li>
<li><p>代码开头添加：</p>
<p>方式1（推荐）：添加宏包</p>
<pre class="line-numbers language-none"><code class="language-none">\usepackage[UTF8]{ctex}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>方式2：设置文档类型</p>
<pre class="line-numbers language-none"><code class="language-none">\documentclass[UTF8]{ctexart}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<h3 id="首行缩进"><a href="#首行缩进" class="headerlink" title="首行缩进"></a>首行缩进</h3><h4 id="进行缩进"><a href="#进行缩进" class="headerlink" title="进行缩进"></a>进行缩进</h4><p>若LaTeX默认没有段首缩进，因此要首行缩进需要进行修改。在导言区加入如下代码（距离单位一般为<code>pt</code>或<code>em</code>，<code>pt</code>是绝对单位；<code>em</code>是相对单位，表示1个中文字符宽度；本人比较喜欢<code>em</code>）：</p>
<pre class="line-numbers language-none"><code class="language-none">% 使用indentfirst宏包
\usepackage{indentfirst}
% 设置首行缩进距离
\setlength{\parindent}{2em}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="不进行缩进"><a href="#不进行缩进" class="headerlink" title="不进行缩进"></a>不进行缩进</h4><p>若LaTeX已经是段首缩进的，因此要段首不进行缩进需要进行修改。</p>
<p><strong>方式1（推荐）：</strong> 单段取消缩进，放在段首即可。</p>
<pre class="line-numbers language-none"><code class="language-none">\noindent<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>方式2：</strong> 全局取消缩进，在想缩进的段落再进行缩进。<br>放在导言区：</p>
<pre class="line-numbers language-none"><code class="language-none">\setlength{\parindent}{0pt}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>放在想要缩进的段落：</p>
<pre class="line-numbers language-none"><code class="language-none">\hspace*{2em}段落\\<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="显示下划线"><a href="#显示下划线" class="headerlink" title="显示下划线"></a>显示下划线</h3><p><strong>方法1</strong><br>使用转义字符：<code>\_</code></p>
<p><strong>方法2</strong><br>使用LaTeX命令：<code>\textunderscore</code></p>
<p><strong>方法3</strong><br>导入宏包：<code>\usepackage{underscore}</code></p>
<p>例子1（方法1和2）：</p>
<pre class="line-numbers language-none"><code class="language-none">a\_b

a\textunderscore b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/2846c8cfab95dca6c9623d2d7115070c.png" alt="在这里插入图片描述"></p>
<p>例子2（方法3）：</p>
<pre class="line-numbers language-none"><code class="language-none">\usepackage{underscore}

a_b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/188304638c7a9e1900c239e3639c9a20.png" alt="在这里插入图片描述"></p>
<h2 id="LaTeX基础"><a href="#LaTeX基础" class="headerlink" title="LaTeX基础"></a>LaTeX基础</h2><h3 id="导言区与正文区"><a href="#导言区与正文区" class="headerlink" title="导言区与正文区"></a>导言区与正文区</h3><p>在<code>begin{document}</code>和<code>end{document}</code>之间的就是正文区，而在这之前的就是导言区。</p>
<h3 id="文档类型"><a href="#文档类型" class="headerlink" title="文档类型"></a>文档类型</h3><p><code>\documentclass{article}</code>是确定了文档类型为<code>article</code>，一般LaTeX提供三种基本文档，此外两种是<code>report</code>和<code>book</code>。三者分别用来写小篇幅的文章、中篇幅的报告和长篇幅的书籍。</p>
<h3 id="宏包"><a href="#宏包" class="headerlink" title="宏包"></a>宏包</h3><p>LaTeX导言区可以导入各种宏包，以使用相应宏包的功能，一条语句中可以导入多个宏包，语法如下：</p>
<pre class="line-numbers language-none"><code class="language-none">\usepackage{宏包1, 宏包2}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>常用的宏包：<br>ctex：中文支持<br>amsmath：<a href="https://so.csdn.net/so/search?q=latex%E6%95%B0%E5%AD%A6%E5%85%AC%E5%BC%8F&amp;spm=1001.2101.3001.7020">latex数学公式</a>支持<br>graphicx：插入图片<br>algorithm和algorithmic：算法排版<br>listings：插入代码块<br>等等</p>
<h3 id="编译器"><a href="#编译器" class="headerlink" title="编译器"></a>编译器</h3><p>LaTeX的编译器有<code>pdfLaTeX</code>，<code>LaTeX</code>，<code>XeLaTeX</code>，<code>LuaLaTeX</code>，在设置中可以进行更改。Overleaf默认的编译器为<code>pdfLaTeX</code>，因此要使其支持中文需要改为<code>XeLaTeX</code>。</p>
<h3 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h3><p>Overleaf等工具中可以使用快捷键<code>Ctrl+/</code>来批量注释或批量取消注释。</p>
<h4 id="单行注释"><a href="#单行注释" class="headerlink" title="单行注释"></a>单行注释</h4><pre class="line-numbers language-none"><code class="language-none">% 注释内容<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="多行注释"><a href="#多行注释" class="headerlink" title="多行注释"></a>多行注释</h4><p>方式1（推荐）：</p>
<pre class="line-numbers language-none"><code class="language-none">\iffalse
注释内容
\fi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>方式2：<br>使用<code>\usepackage{verbatim}</code>宏包</p>
<pre class="line-numbers language-none"><code class="language-none">\begin{comment}
注释内容
\end{comment} <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="英文引号"><a href="#英文引号" class="headerlink" title="英文引号"></a>英文引号</h3><p>在LaTeX中输入英文引号时，导出的PDF显示的是顺撇的，如下：</p>
<p>代码：</p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex">'English'

''English''<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/d29e424c7071faf291abdd38c81f5202.png" alt="在这里插入图片描述"><br>要想正确输入英文引号，把左侧的引号用 ` 代替即可，如下：</p>
<p>代码：</p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex">`English'

``English''<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/29c080f321f400dd38e741a4834d769a.png" alt="在这里插入图片描述"></p>
<h3 id="空格"><a href="#空格" class="headerlink" title="空格"></a>空格</h3><p><strong>LaTeX支持</strong></p>
<table>
<thead>
<tr>
<th>空格方式</th>
<th>源代码</th>
<th>显示</th>
<th>宽度</th>
</tr>
</thead>
<tbody><tr>
<td>quad空格</td>
<td>a \quad b</td>
<td>a b a \quad b<em>a**b</em></td>
<td>1个中文字符的宽度</td>
</tr>
<tr>
<td>qquad空格</td>
<td>a \qquad b</td>
<td>a b a \qquad b<em>a**b</em></td>
<td>2个中文字符的宽度</td>
</tr>
<tr>
<td>大空格</td>
<td>a\ b</td>
<td>a  b a\ b<em>a</em> <em>b</em></td>
<td>1/3字符宽度</td>
</tr>
<tr>
<td>没有空格</td>
<td>ab</td>
<td>a b ab<em>ab</em></td>
<td></td>
</tr>
</tbody></table>
<p><strong>LaTeX数学公式支持</strong></p>
<p>除上述空格以外，还支持如下空格：</p>
<table>
<thead>
<tr>
<th>空格方式</th>
<th>源代码</th>
<th>显示</th>
<th>宽度</th>
</tr>
</thead>
<tbody><tr>
<td>中等空格</td>
<td><code>$a\;b$</code></td>
<td>a    b a;b<em>a**b</em></td>
<td>2/7字符宽度</td>
</tr>
<tr>
<td>小空格</td>
<td><code>$a\,b$</code></td>
<td>a   b a,b<em>a**b</em></td>
<td>1/6字符宽度</td>
</tr>
<tr>
<td>紧贴</td>
<td><code>$a\!b$</code></td>
<td>a  ⁣ b a!b<em>a**b</em></td>
<td>缩进1/6字符宽度</td>
</tr>
</tbody></table>
<h3 id="换行"><a href="#换行" class="headerlink" title="换行"></a>换行</h3><p><code>\\</code>：换行，一般在一行的最后写。<br><code>\\[offset]</code>：换行，并且与下一行的行间距为原来行间距+offset，offset单位一般是<code>em</code>或<code>pt</code>。</p>
<p><strong>注意：</strong><br>若要在表格单元格内换行，无法使用<code>\\</code>进行换行，需要在导言区导入<code>\usepackage{makecell}</code>宏包进行换行，详情见<strong>表格</strong>章节。</p>
<h3 id="换段"><a href="#换段" class="headerlink" title="换段"></a>换段</h3><p>源代码空一行即可进行换段（推荐）。<br>也可以使用代码<code>\par</code>进行换段，一般在一段的最后写。</p>
<h3 id="新页"><a href="#新页" class="headerlink" title="新页"></a>新页</h3><p>使用<code>\newpage</code>进行换页，一般在一页的最后写。</p>
<h3 id="转义字符"><a href="#转义字符" class="headerlink" title="转义字符"></a>转义字符</h3><p>写法：<code>\+字符</code></p>
<p>用途：当某些特殊字符与LaTeX语法冲突时，使用转义字符可以使字符强制显示。</p>
<p>示例：<code>\%</code>，可以显示出百分号，而不是注释的含义；<code>\_</code>，显示下划线，而不是下标；<code>\^</code>显示符号本身，而不是上标。</p>
<p>例子：</p>
<pre class="line-numbers language-none"><code class="language-none">\%home\_name\%=honor<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/f8c4a3625d492de03606da8791546a8d.png" alt="在这里插入图片描述"><br>补充：若想不使用转义字符显示下划线，有2种方法，详情请见 <strong>LaTeX技巧-显示下划线</strong> 章节。</p>
<h3 id="可选参数-htbp"><a href="#可选参数-htbp" class="headerlink" title="可选参数[htbp]"></a>可选参数[htbp]</h3><p>LaTeX插入图片、表格等元素时，第一行后面有一个可选参数<code>[htbp]</code>，例如，<code>\begin{figure}[htbp]</code>。</p>
<p><code>[htbp]</code>是个可选参数项，允许用户指定图片、表格等元素被放置的位置。这一可选参数项可以是下列字母的任意组合。</p>
<p>h(here): 当前位置；将图形放置在 正文文本中给出该图形环境的地方。如果本页所剩的页面不够， 这一参数将不起作用。<br>t(top): 顶部；将图形放置在页面的顶部。<br>b(bottom): 底部；将图形放置在页面的底部。<br>p(page): 浮动页；将图形放置在一只允许有浮动对象的页面上。</p>
<p>注意：在使用这些参数时：</p>
<ol>
<li>如果在图形环境中没有给出上述任一参数，则缺省为 <code>[tbp]</code>。</li>
<li>给出参数的顺序不会影响到最后的结果。因为在考虑这些参数时LaTeX总是尝试以 <code>h-t-b-p</code> 的顺序来确定图形的位置。所以 <code>[hb]</code> 和 <code>[bh]</code> 都以<code>h-b</code> 的顺序来排版。</li>
<li>给出的参数越多，LaTeX的排版结果就会越好。<code>[htbp], [tbp], [htp], [tp]</code> 这些组合得到的效果不错，<code>[h]</code>也是常用的选择。</li>
</ol>
<h2 id="文章架构"><a href="#文章架构" class="headerlink" title="文章架构"></a>文章架构</h2><h3 id="纸张布局"><a href="#纸张布局" class="headerlink" title="纸张布局"></a>纸张布局</h3><pre class="line-numbers language-none"><code class="language-none">% 设置页面的环境,a4纸张大小，左右上下边距信息
\usepackage[a4paper,left=10mm,right=10mm,top=15mm,bottom=15mm]{geometry}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="标题级别"><a href="#标题级别" class="headerlink" title="标题级别"></a>标题级别</h3><p>例子：</p>
<pre class="line-numbers language-none"><code class="language-none">\section{一级标题}
\subsection{二级标题} 
\subsubsection{二级标题} <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/f8d4d5a7983e97f44e4187d8efbeed02.png" alt="在这里插入图片描述"></p>
<h3 id="标题、作者、时间"><a href="#标题、作者、时间" class="headerlink" title="标题、作者、时间"></a>标题、作者、时间</h3><p>注意：<code>\maketitle</code>这一行一定要在<code>\begin{document}</code>的后面，否则LaTeX会判定为语法错误。</p>
<p>例子：</p>
<pre class="line-numbers language-none"><code class="language-none">\documentclass{article} % article 文档
\usepackage[UTF8]{ctex}  % 使用宏包(为了能够显示汉字)
% 设置页面的环境,a4纸张大小，左右上下边距信息
\usepackage[a4paper,left=10mm,right=10mm,top=15mm,bottom=15mm]{geometry}

\title{NSJim的文章}  % 文章标题
\author{NSJim}   % 作者的名称
\date{\today}       % 当天日期

% 正文开始
\begin{document}

\maketitle          % 添加这一句才能够显示标题等信息

% 正文结束
\end{document}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/15f00dd995f7af1f8d900a79bb703e08.png" alt="在这里插入图片描述"></p>
<h3 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h3><p>在<code>\maketitle</code>下添加内容，如下：</p>
<pre class="line-numbers language-none"><code class="language-none">\maketitle          %添加这一句才能够显示标题等信息
%摘要开始部分
\begin{abstract}
该部分内容是放置摘要信息的。该部分内容是放置摘要信息的。该部分内容是放置摘要信息的。该部分内容是放置摘要信息的。该部分内容是放置摘要信息的。
\end{abstract}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://i-blog.csdnimg.cn/blog_migrate/cbcad212c6cd56d55f4fb375a1b0448a.png#pic_center" alt="在这里插入图片描述"></p>
<h3 id="引用、脚注"><a href="#引用、脚注" class="headerlink" title="引用、脚注"></a>引用、脚注</h3><p>引用：写在<code>\begin{quote}</code>和<code>\end{quote}</code>之间。<br>脚注：在需要添加脚注的文字后添加<code>\footnote{脚注内容}</code>即可。</p>
<p>例子：</p>
<pre class="line-numbers language-none"><code class="language-none">西游记\footnote{中国古典四大名著之一}小说开头写道：
\begin{quote}
{\kaishu 东胜神洲有一花果山，山顶一石，受日月精华，生出一石猴。之后因为成功闯入水帘洞，被花果山诸猴拜为“美猴王”。}
\end{quote}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/04545b613491aa492b626a0d83121ae0.png" alt="在这里插入图片描述"><br><img src="https://i-blog.csdnimg.cn/blog_migrate/f46fd5f2a0548164c88ed243e5fdc7d3.png" alt="在这里插入图片描述"></p>
<h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><p>标题设置：一级标题<code>\section{}</code>，耳机标题<code>\subsection{}</code>，三级标题<code>\subsubsection{}</code>；<br>段落设置：在一段的最后添加<code>\par</code>代表一段的结束；<br>目录设置：在<code>\begin{document}</code>内容中添加：<code>\tableofcontents</code></p>
<p>以下为一个示例：</p>
<pre class="line-numbers language-none"><code class="language-none">\documentclass{article} % article 文档
\usepackage[UTF8]{ctex}  % 使用宏包(为了能够显示汉字)
% 设置页面的环境,a4纸张大小，左右上下边距信息
\usepackage[a4paper,left=10mm,right=10mm,top=15mm,bottom=15mm]{geometry}

\title{NSJim的文章}  % 文章标题
\author{NSJim}   % 作者的名称
\date{\today}       % 当天日期

% 正文开始
\begin{document}

\maketitle          % 添加这一句才能够显示标题等信息

% 生成目录设置
\renewcommand{\contentsname}{目录} %将content转为目录
\tableofcontents

% 摘要开始部分
\begin{abstract}
该部分内容是放置摘要信息的。该部分内容是放置摘要信息的。该部分内容是放置摘要信息的。该部分内容是放置摘要信息的。该部分内容是放置摘要信息的。
\end{abstract}

% 标题开始
\section{一级标题1}
第一段一级标题下的内容，一级标题下的内容，一级标题下的内容，一级标题下的内容，一级标题下的内容，一级标题下的内容，一级标题下的内容，一级标题下的内容。\par
第二段一级标题下的内容，一级标题下的内容，一级标题下的内容，一级标题下的内容，一级标题下的内容，一级标题下的内容，一级标题下的内容，一级标题下的内容。

\subsection{二级标题1.1}
二级标题下的内容。

\subsubsection{三级标题下的内容1.1.1}
三级标题下的内容。

\section{一级标题2}
一级标题2中的内容

% 正文结束
\end{document}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/77ea4dbcda2ccf25b515a55207a7dbe6.png" alt="在这里插入图片描述"></p>
<h2 id="字体，大小，颜色"><a href="#字体，大小，颜色" class="headerlink" title="字体，大小，颜色"></a>字体，大小，颜色</h2><p><strong>字体</strong></p>
<p>使用代码：<code>{\字体 内容}</code>（推荐），有时可使用<code>\字体{内容}</code>（不推荐，容易出问题）。</p>
<p>例子：</p>
<pre class="line-numbers language-none"><code class="language-none">{\songti 宋体}
{\heiti 黑体}
{\fangsong 仿宋}
{\kaishu 楷书}

{\bf 粗体}
{\it 斜体}
{\sl 斜体}

\textbf{粗体}
\textit{斜体}
\textsl{斜体}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/1de6158b0f9a068c3291d4aa4bc02da2.png" alt="在这里插入图片描述"></p>
<p><strong>大小</strong></p>
<p>例子：</p>
<pre class="line-numbers language-none"><code class="language-none">{\tiny Hello} \\
{\scriptsize Hello} \\
{\footnotesize Hello} \\
{\small Hello} \\
{\normalsize Hello} \\
{\large Hello} \\<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/fadf838e2821f43c676724fdd1136b2f.png" alt="在这里插入图片描述"><br><strong>颜色</strong></p>
<p>需要导入宏包<code>\usepackage{xcolor}</code></p>
<pre class="line-numbers language-none"><code class="language-none">\documentclass{article}
\usepackage[UTF8]{ctex}
\usepackage{color,xcolor}

\setlength{\parindent}{0pt}

% 预先定义好的颜色： red, green, blue, white, black, yellow, gray, darkgray, lightgray, brown, cyan, lime, magenta, olive, orange, pink, purple, teal, violet.

% 定义颜色的5种方式
\definecolor{light-gray}{gray}{0.95}    % 1.灰度
\definecolor{orange}{rgb}{1,0.5,0}      % 2.rgb
\definecolor{orange}{RGB}{255,127,0}    % 3.RGB
\definecolor{orange}{HTML}{FF7F00}      % 4.HTML
\definecolor{orange}{cmyk}{0,0.5,1,0}   % 5.cmyk

\begin{document}

% \pagecolor{yellow}          %设置背景色为黄色

% 使用颜色的常用方式
\textcolor{green}{绿色} % textcolor+颜色
\color{orange}{橙色} % color+颜色
\textcolor[rgb]{0,1,0}{绿色} % textcolor+rgb
\color[rgb]{1,0,0}{红色} % color+rgb

% 使用底色
\colorbox{red}{\color{black}红底黑字}
\fcolorbox{red}{green}{红框绿底} % 框色+背景色

\end{document} <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/00bb12343ad32a159d28d7a08f3e1acc.png" alt="在这里插入图片描述"></p>
<h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><p>导入宏包：<code>\usepackage{url}</code><br>插入超链接：<code>\url{www.baidu.com}</code></p>
<h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><p>未完，待续。</p>
<h2 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h2><h3 id="可选参数-htbp-1"><a href="#可选参数-htbp-1" class="headerlink" title="可选参数[htbp]"></a>可选参数[htbp]</h3><p>LaTeX插入图片、表格等元素时，第一行后面有一个可选参数<code>[htbp]</code>，例如，<code>\begin{figure}[htbp]</code>。</p>
<p><code>[htbp]</code>是个可选参数项，允许用户指定图片、表格等元素被放置的位置。这一可选参数项可以是下列字母的任意组合。</p>
<p>h(here): 当前位置；将图形放置在 正文文本中给出该图形环境的地方。如果本页所剩的页面不够， 这一参数将不起作用。<br>t(top): 顶部；将图形放置在页面的顶部。<br>b(bottom): 底部；将图形放置在页面的底部。<br>p(page): 浮动页；将图形放置在允许有浮动对象的页面上。</p>
<p>注意：在使用这些参数时：</p>
<ol>
<li>如果在图形环境中没有给出上述任一参数，则缺省为 <code>[tbp]</code>。</li>
<li>给出参数的顺序不会影响到最后的结果。因为在考虑这些参数时LaTeX总是尝试以 <code>h-t-b-p</code> 的顺序来确定图形的位置。所以 <code>[hb]</code> 和 <code>[bh]</code> 都以<code>h-b</code> 的顺序来排版。</li>
<li>给出的参数越多，LaTeX的排版结果就会越好。<code>[htbp], [tbp], [htp], [tp]</code> 这些组合得到的效果不错，<code>[h]</code>也是常用的选择。</li>
</ol>
<h3 id="单张图片"><a href="#单张图片" class="headerlink" title="单张图片"></a>单张图片</h3><p>需要导入宏包：<code>\usepackage{graphicx}</code></p>
<p>例子：</p>
<pre class="line-numbers language-none"><code class="language-none">%开始插入图片
\begin{figure}[htbp] % htbp代表图片插入位置的设置
\centering %图片居中
%添加图片；[]中为可选参数，可以设置图片的宽高；{}中为图片的相对位置
\includegraphics[width=6cm]{image.jpg}
\caption{达尔文游戏} % 图片标题
\label{pic1} % 图片标签
\end{figure}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/c87040c5dd7b87907aee4250f7c951c2.png" alt="在这里插入图片描述"></p>
<h3 id="多张图片"><a href="#多张图片" class="headerlink" title="多张图片"></a>多张图片</h3><p><strong>并排插入两张图片</strong><br>方式1：图片编号增加1<br>两张图片公用一个大的图题，图片的编号只增加一个。</p>
<pre class="line-numbers language-none"><code class="language-none">\begin{figure}[ht]
\centering
\subfigure[11-1]{               %小图题的名称
\includegraphics[width=4cm]{11-1}}
\hspace{10pt}  %2张图片的水平距离
\subfigure[11-2]{
\includegraphics[width=4cm]{11-2}}
\caption{两张图片公用的图题}
\end{figure}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>方式2：图片编号增加2<br>每张图片有自己的图题，这种方法会使LaTeX中图片的编号顺序向后增加。</p>
<pre class="line-numbers language-none"><code class="language-none">\begin{figure}[h]
\begin{minipage}[t]{0.45\linewidth}
\centering
\includegraphics[width=5.5cm,height=3.5cm]{10}
\caption{第一张图片的图题.}
\end{minipage}
\begin{minipage}[t]{0.45\linewidth}        %图片占用一行宽度的45%
\hspace{10pt}
\includegraphics[width=5.5cm,height=3.5cm]{11}
\caption{第二章图片的图题.}
\end{minipage}
\end{figure}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>并排插入多张图片</strong></p>
<pre class="line-numbers language-none"><code class="language-none">\begin{figure}
\centering
{
\includegraphics[width=2.5cm]{10-1}}
\hspace{10pt}    %每张图片水平距离
{
\includegraphics[width=2.5cm]{10-2}}
\hspace{10pt}
{
\includegraphics[width=2.5cm]{10-3}}
\hspace{10pt}
{
\includegraphics[width=2.5cm]{10-4}}
\hspace{10pt}
\caption{并排插入4张图片}
\end{figure}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>竖排插入多张图片</strong></p>
<pre class="line-numbers language-none"><code class="language-none">\begin{figure}[h]
\centering
\subfigure[场景1]{
\begin{minipage}[t]{0.45\textwidth}
\centering
\includegraphics[width=0.8\textwidth]{wolf2} \\
\vspace{10pt} %2张图片的垂直距离
\includegraphics[width=0.8\textwidth]{wolf3}
\end{minipage}
\end{figure}
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><p>技巧：若不想手动输入LaTeX语法生成表格，可以使用<a href="https://www.tablesgenerator.com/">在线生成LaTeX表格</a>的网站。可以从Excel里面粘贴或导入，可以实现单元格合并，而且会在合并行或合并列的时候提醒要引入对应的宏包。<br>网址：<code>https://www.tablesgenerator.com/</code></p>
<p>当然，也可以使用LaTeX语法生成表格，示例如下：</p>
<p>例子：</p>
<pre class="line-numbers language-none"><code class="language-none">\begin{table}[htbp] % htbp代表表格浮动位置
% 表格居中
\centering
% 添加表头
\caption{变量表}
% 创建table环境
\begin{tabular}{|cc|c|} % 3个c代表3列都居中，也可以设置l或r，|代表竖线位置
% 表格的输入
\hline  % 一条水平线
x &amp; y &amp; z \\ % \\为换行符
\hline
11 &amp; 22 &amp; 33 \\
\hline
\end{tabular}
\end{table}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/13dbb39eebe7b30121c961dd55dabe4f.png" alt="在这里插入图片描述"></p>
<p><strong>表格单元格内换行</strong><br>需要使用<code>\usepackage{makecell}</code>宏包。将单元格的内容替换为<code>\makecell{XX\\XXXX}</code>，<code>\makecell{}</code>中的<code>\\</code>可以在单元格内换行。</p>
<p>例子：</p>
<pre class="line-numbers language-none"><code class="language-none">\begin{table}[htbp] % htbp代表表格浮动位置
\centering
\caption{变量表}
\begin{tabular}{|cc|c|}
\hline
x &amp; y &amp; z \\
\hline
11 &amp; \makecell{Long\\text} &amp; 33 \\
\hline
\end{tabular}
\end{table}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/5fd5b3942e1bd198ea35063764963d4f.png" alt="在这里插入图片描述"></p>
<h2 id="数学公式"><a href="#数学公式" class="headerlink" title="数学公式"></a>数学公式</h2><h3 id="公式支持"><a href="#公式支持" class="headerlink" title="公式支持"></a>公式支持</h3><p>LaTeX要输入数学公式需要导入宏包<code>\usepackage{amsmath}</code>；若要对公式的字体进行修改，还需要引入宏包<code>\usepackage{amsfonts}</code>。</p>
<p>LaTeX数学公式的各种细节请参见我的另一篇博客：<a href="https://blog.csdn.net/NSJim/article/details/109045914"><em>LaTeX数学公式-详细教程</em></a> 。</p>
<ol>
<li>官方文档：<br>传送门：<a href="https://math.meta.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference"><em>官方文档</em></a><br>网址：<code>https://math.meta.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference</code></li>
<li>中文教程：<br>传送门：<a href="https://www.jianshu.com/p/25f0139637b7"><em>中文教程</em></a><br>网址：<code>https://www.jianshu.com/p/25f0139637b7</code></li>
<li>技巧：使用<a href="https://private.codecogs.com/latex/eqneditor.php"><em>在线LaTeX公式编辑器</em></a>，来生成LaTeX公式代码，然后复制到Markdown编辑器中，并在两边加上<code>$</code>或<code>$$</code>即可。<br>在线LaTeX公式编辑器网址：<code>https://private.codecogs.com/latex/eqneditor.php</code></li>
<li>插入公式<br>左对齐公式（行中公式）：<code>$数学公式$</code><br>居中公式（独立公式）：<code>$$数学公式$$</code><br>注意：使用<code>$</code>行中公式时，<code>数学公式</code>与<code>$</code>连接处不要有空格，否则公式不会显示；使用<code>$$</code>居中公式时，<code>数学公式</code>与<code>$$</code>连接处可以有空格。即<code>$ 数学公式 $</code> 不显示公式。</li>
<li>注释：<code>%</code>为单行注释，例子详见后文。</li>
<li>细节：请参见我的另一篇博客：<a href="https://blog.csdn.net/NSJim/article/details/109045914"><em>LaTeX数学公式-详细教程</em></a> 。</li>
</ol>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li>使用<code>$</code>，即行中公式时，<code>数学公式</code>与<code>$</code>连接处不要有空格，否则公式不会显示。</li>
<li>使用<code>$$</code>，即居中公式时，<code>数学公式</code>与<code>$$</code>连接处可以有空格。即<code>$ 数学公式 $</code> 不显示公式。</li>
<li>使用<code>$$</code>时，上方要空一行。</li>
<li><code>=</code>不要单独打一行，否则可能会出错。</li>
<li><code>+ - * / = ( ) | , . '</code>等符号直接在<code>$</code>或<code>$$</code>之间输入即可识别。</li>
</ol>
<h3 id="公式编号"><a href="#公式编号" class="headerlink" title="公式编号"></a>公式编号</h3><h4 id="自动编号"><a href="#自动编号" class="headerlink" title="自动编号"></a>自动编号</h4><p>使用<code>\begin{equation}</code>和<code>\end{equation}</code>进行公式输入，要同时使用，且编号不能够修改。</p>
<p>例子：</p>
<pre class="line-numbers language-none"><code class="language-none">\begin{equation}
a^2+b^2=c^2
\end{equation}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/dad5baa00648089323340c3fbc5f4ff2.png" alt="在这里插入图片描述"></p>
<h4 id="手动编号"><a href="#手动编号" class="headerlink" title="手动编号"></a>手动编号</h4><p>在公式末尾使用<code>\tag{编号}</code>来实现公式手动编号，大括号内的内容可以自定义。需要使用<code>\usepackage{amsmath}</code>宏包，不能写在<code>$</code>或<code>$$</code>中，会报错。</p>
<p>例子：</p>
<pre class="line-numbers language-none"><code class="language-none">\begin{equation}
a^2+b^2=c^2
\tag{2}
\end{equation}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/df680e3efbedf6adbba35b02e83c8fdb.png" alt="在这里插入图片描述"></p>
<h2 id="自定义标题样式"><a href="#自定义标题样式" class="headerlink" title="自定义标题样式"></a>自定义标题样式</h2><p>在导言区使用<code>\newtheorem{example}{Example}[section]</code>可以自定义标题样式，例子如下。</p>
<p>例子：</p>
<pre class="line-numbers language-none"><code class="language-none">\newtheorem{example}{Example}[section] % 自定义example样式

\begin{document}

\maketitle

\section{Introduction}

\begin{example}{Test1}

Hello world!

\end{example}

\begin{example}{Test2}

Hello world!

\end{example}

\end{document}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/d67ce3fb6d9fc0080c104b98f20344c7.png" alt="在这里插入图片描述"></p>
<h2 id="算法（伪代码）"><a href="#算法（伪代码）" class="headerlink" title="算法（伪代码）"></a>算法（伪代码）</h2><p>需要使用<code>\usepackage{algorithm}</code>和<code>\usepackage{algorithmic}</code>宏包，<code>if</code>、<code>for</code>等关键字要按照规范书写，如<code>\IF \ENDIF</code>。</p>
<p>例子：</p>
<pre class="line-numbers language-none"><code class="language-none">\documentclass{article}
\usepackage[UTF8]{ctex}
\usepackage{algorithm} % 排版算法
\usepackage{algorithmic} % 排版算法

\title{Algorithm}
\author{NSJim Green}
\date{October 2020}

\begin{document}

\maketitle

\section{Algorithm 1}

\begin{algorithm}
\caption{CheckSum(A,x)} %算法标题
\label{alg2} %标签
\begin{algorithmic} %算法开始
\STATE {\bf Input:} An array A and a value x  %也可以用\textbf{Input:}
\STATE {\bf Output:} A bool value show if there is two elements in A whose sum is x
\STATE A $\gets$ SORT(A)
\STATE n $\gets$ length(n)
\FOR{i $\gets$ 0 to n}
    \IF{Binary-search(A,x-A[i],1,n)}
    \STATE return true
    \ENDIF
\ENDFOR
\STATE return false
\end{algorithmic}
\end{algorithm}

\end{document}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/f75b779e5c296161d721546696e8cbef.png" alt="在这里插入图片描述"></p>
<h2 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h2><h3 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h3><p>使用<code>\usepackage{listings}</code>宏包，并使用<code>\lstset{}</code>进行基础设置，然后使用<code>\begin{lstlisting}[language=xxx]</code>和<code>\end{lstlisting}</code>插入代码块。</p>
<p>基础设置包括行号，不显示字符串空格，代码块边框，不包含颜色等设置，要设置颜色和字体请见下文的高级用法。</p>
<p>例子：</p>
<pre class="line-numbers language-none"><code class="language-none">\documentclass{article}
\usepackage[UTF8]{ctex}
\usepackage{listings}

% 代码块基础设置
\lstset{
numbers=left,                          	% 在左侧显示行号
showstringspaces=false,        			% 不显示字符串中的空格
frame=single,                         	% 设置代码块边框
}

\title{Code block}
\author{NSJim Green}
\date{October 2020}

\begin{document}

\maketitle

\section{C Language}

\begin{lstlisting}[language=c]
#include &lt;stdio.h&gt;

// main function
int main() {
    printf("Hello World!");
    return 0;
}
\end{lstlisting}

\end{document}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/b1b393090a2265beb7d979acdce1b89b.png" alt="在这里插入图片描述"></p>
<h3 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h3><p>使用<code>\usepackage{listings}</code>和<code>\usepackage{xcolor}</code>宏包，并使用<code>\lstset{}</code>进行高级设置，然后使用<code>\begin{lstlisting}[language=xxx]</code>和<code>\end{lstlisting}</code>插入代码块。</p>
<p>高级设置除基础设置外，还包括关键字格式，字符串格式等设置。</p>
<p>例子：</p>
<pre class="line-numbers language-none"><code class="language-none">\documentclass{article}
\usepackage[UTF8]{ctex}
\usepackage{listings}
\usepackage{xcolor}

% 代码块高级设置
\lstset{
% basicstyle=\footnotesize,                 % 设置整体的字体大小
showstringspaces=false,                     % 不显示字符串中的空格
frame=single,                               % 设置代码块边框
numbers=left,                               % 在左侧显示行号
% numberstyle=\footnotesize\color{gray},    % 设置行号格式
numberstyle=\color{darkgray},               % 设置行号格式
backgroundcolor=\color{white},              % 设置背景颜色
keywordstyle=\color{blue},                  % 设置关键字颜色
commentstyle=\it\color[RGB]{0,100,0},       % 设置代码注释的格式
stringstyle=\sl\color{red},                 % 设置字符串格式
}

\title{Code block}
\author{NSJim Green}
\date{October 2020}

\begin{document}

\maketitle

\section{C Language}

\begin{lstlisting}[language=c]
#include &lt;stdio.h&gt;

// main function
int main() {
    printf("Hello World!");
    return 0;
}
\end{lstlisting}

\end{document}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/9ddb7cf110f2c53c7ad37cc12cd7694f.png" alt="在这里插入图片描述"></p>
<h2 id="论文写作"><a href="#论文写作" class="headerlink" title="论文写作"></a>论文写作</h2><h3 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h3><p>论文写作可以使用合适的模板，例如<code>IEEE</code>的模板，只需在文档类型处修改即可，代码如下：</p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">[</span>conference<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token keyword">IEEEtran</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="双栏"><a href="#双栏" class="headerlink" title="双栏"></a>双栏</h3><p>更改文档的单双栏模式，只需更改文档类型处的选项即可，代码如下：<br>单栏：</p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">[</span>onecolumn<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token keyword">article</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>双栏：</p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\documentclass</span><span class="token punctuation">[</span>twocolumn<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token keyword">article</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="跨栏图表"><a href="#跨栏图表" class="headerlink" title="跨栏图表"></a>跨栏图表</h3><p>在双栏编辑模式下，图片只能在一栏中显示，而且如果图片的宽度超过单栏文本宽度，则只能显示其中一部分，剩下的部分会溢出。</p>
<p>若想在双栏模式下插入跨栏图表可将环境替换为带<code>*</code>的<code>figure</code>或<code>table</code>环境，代码如下：</p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">figure*</span><span class="token punctuation">}</span>
……
<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">figure*</span><span class="token punctuation">}</span>
或
<span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">talbe*</span><span class="token punctuation">}</span>
……
<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">table*</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="无自动编号的标题"><a href="#无自动编号的标题" class="headerlink" title="无自动编号的标题"></a>无自动编号的标题</h3><p>LaTeX中的标题都是自动编号的，若想使用无编号的标题，可使用带<code>*</code>的<code>section</code>代码，如下：</p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\section*</span><span class="token punctuation">{</span><span class="token headline class-name">References</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><p>LaTeX中的公式，图表，参考文献都是自动编号的，添加<code>\label</code>语句后可以进行引用，还可以设置引用格式，使用方法如下：</p>
<h4 id="公式引用"><a href="#公式引用" class="headerlink" title="公式引用"></a>公式引用</h4><p>需导入<code>amsmath</code>宏包，代码为<code>\usepackage{amsmath}</code>。</p>
<p><strong>公式</strong></p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">equation</span><span class="token punctuation">}</span><span class="token equation string">
z=x+y
<span class="token equation-command regex">\label</span>{eq1}
</span><span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">equation</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>引用</strong></p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex">Eq. (<span class="token function selector">\ref</span><span class="token punctuation">{</span><span class="token keyword">eq1</span><span class="token punctuation">}</span>)
或导入amsmath宏包，使用如下代码（推荐）：
Eq. <span class="token function selector">\eqref</span><span class="token punctuation">{</span>eq1<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="图片引用"><a href="#图片引用" class="headerlink" title="图片引用"></a>图片引用</h4><p>需导入<code>graphicx</code>宏包，代码为<code>\usepackage{graphicx}</code>。</p>
<p><strong>图片</strong></p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">figure</span><span class="token punctuation">}</span><span class="token punctuation">[</span>htbp<span class="token punctuation">]</span>
<span class="token function selector">\centering</span>
<span class="token function selector">\includegraphics</span><span class="token punctuation">[</span>width=8cm<span class="token punctuation">]</span><span class="token punctuation">{</span>image/fig01-network model.png<span class="token punctuation">}</span>
<span class="token function selector">\caption</span><span class="token punctuation">{</span>Network model.<span class="token punctuation">}</span>
<span class="token function selector">\label</span><span class="token punctuation">{</span><span class="token keyword">fig1</span><span class="token punctuation">}</span>
<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">figure</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>引用</strong></p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex">Fig. <span class="token function selector">\ref</span><span class="token punctuation">{</span><span class="token keyword">fig1</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="表格引用"><a href="#表格引用" class="headerlink" title="表格引用"></a>表格引用</h4><p><strong>表格</strong></p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">table</span><span class="token punctuation">}</span><span class="token punctuation">[</span>htbp<span class="token punctuation">]</span>
<span class="token function selector">\caption</span><span class="token punctuation">{</span>Parameters for simulation<span class="token punctuation">}</span>
<span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">center</span><span class="token punctuation">}</span>
<span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">tabular</span><span class="token punctuation">}</span><span class="token punctuation">{</span>|c|c|c|c|<span class="token punctuation">}</span>
<span class="token function selector">\hline</span>
<span class="token function selector">\textbf</span><span class="token punctuation">{</span>Parameters<span class="token punctuation">}</span><span class="token punctuation">&amp;</span><span class="token function selector">\textbf</span><span class="token punctuation">{</span>Values<span class="token punctuation">}</span> <span class="token function selector">\\</span>
<span class="token function selector">\hline</span>
Count of Nodes <span class="token punctuation">&amp;</span> 2 to 160 <span class="token function selector">\\</span>
Simulation time <span class="token punctuation">&amp;</span> 60s <span class="token function selector">\\</span>
Layer used <span class="token punctuation">&amp;</span> Logical Link Layer <span class="token function selector">\\</span>
Type of Antenna <span class="token punctuation">&amp;</span> Omni Directional <span class="token function selector">\\</span>
Queue type <span class="token punctuation">&amp;</span> Drop tail <span class="token function selector">\\</span>
MAC <span class="token punctuation">&amp;</span> 802.11 <span class="token function selector">\\</span>
<span class="token function selector">\hline</span>
<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">tabular</span><span class="token punctuation">}</span>
<span class="token function selector">\label</span><span class="token punctuation">{</span><span class="token keyword">tab1</span><span class="token punctuation">}</span>
<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">center</span><span class="token punctuation">}</span>
<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">table</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>引用</strong></p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex">Table. <span class="token function selector">\ref</span><span class="token punctuation">{</span><span class="token keyword">tab1</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="页面内参考文献引用"><a href="#页面内参考文献引用" class="headerlink" title="页面内参考文献引用"></a>页面内参考文献引用</h4><p><strong>参考文献</strong></p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\begin</span><span class="token punctuation">{</span><span class="token keyword">thebibliography</span><span class="token punctuation">}</span><span class="token punctuation">{</span>00<span class="token punctuation">}</span>
<span class="token function selector">\bibitem</span><span class="token punctuation">{</span>b1<span class="token punctuation">}</span> Ben-Othman J, Yahya B. Energy efficient and QoS based routing protocol for wireless sensor networks. J Parallel Distrib Comput 2010;2010(70):849–57.
<span class="token function selector">\bibitem</span><span class="token punctuation">{</span>b2<span class="token punctuation">}</span> Younis M, Youssef M, Arisha K. Energy-aware routing in cluster-based sensor networks. In: Proceedings of the IEEE 20th international symposium on modeling, analysis and simulation of computer and telecommunication systems; 2012. p. 0129. https://doi.org/10.1109/MASCOT.2002.1167069.
<span class="token function selector">\bibitem</span><span class="token punctuation">{</span>b3<span class="token punctuation">}</span> Al-Karaki JN, Kamal AE. Routing techniques in wireless sensor networks: a survey. IEEE J Wirel Commun 2004;11(6):6–28. 2004.
<span class="token function selector">\end</span><span class="token punctuation">{</span><span class="token keyword">thebibliography</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>引用</strong></p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\cite</span><span class="token punctuation">{</span><span class="token keyword">b1</span><span class="token punctuation">}</span>
<span class="token function selector">\cite</span><span class="token punctuation">{</span><span class="token keyword">b2</span><span class="token punctuation">}</span>
<span class="token function selector">\cite</span><span class="token punctuation">{</span><span class="token keyword">b3</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="bib参考文献引用"><a href="#bib参考文献引用" class="headerlink" title="bib参考文献引用"></a>bib参考文献引用</h4><p><strong>流程</strong></p>
<ol>
<li>在论文投稿官方网站上获取论文LaTeX模板，其中包含bib文件，可对bib文件重命名。</li>
<li>在tex文件中找到bib文件声明位置，进行修改，若没有bib文件声明，则添加声明。</li>
<li>在谷歌学术等文献检索网站上检索参考文献，在引用中复制<code>BibTeX</code>格式的代码，粘贴到bib文件的末尾。</li>
<li>在tex文件中需要引用参考文献的位置使用<code>\cite{BibTexName}</code>语法进行引用，其中<code>BibTeXName</code>为<code>BibTeX</code>代码中的第一行的名称。</li>
</ol>
<p><strong>bib声明</strong><br>在<code>tex</code>文件中，结尾处，<code>\end{document}</code>之前，找到如下代码：</p>
<pre class="line-numbers language-none"><code class="language-none">\bibliographystyle{FormatName}
\bibliography{BibName}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>可进行修改，其中，<code>FormatName</code>为格式名称，<code>BibName</code>为bib文件名称。</p>
<p>示例：</p>
<pre class="line-numbers language-none"><code class="language-none">\bibliographystyle{ACM-Reference-Format}
\bibliography{ref}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>BibTeX代码</strong><br>在谷歌学术等文献检索软件中检索需要的参考文献，以<code>Conditional generative adversarial nets</code>为例，在文献处点击<code>引用</code>，选择<code>BibTeX</code>格式，如下图：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/fca90976b4271c4b9dbae0d94c383c40.png" alt="在这里插入图片描述"></p>
<p>复制<code>BibTeX</code>代码，示例如下。将其粘贴到bib文件的末尾。</p>
<pre class="line-numbers language-none"><code class="language-none">@article{mirza2014conditional,
  title={Conditional generative adversarial nets},
  author={Mirza, Mehdi and Osindero, Simon},
  journal={arXiv preprint arXiv:1411.1784},
  year={2014}
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>引用</strong><br>在<code>tex</code>文件中，要引用参考文献时，使用<code>\cite{}</code>语法进行引用，中括号的内容为<code>BibTeX</code>代码的第一行内容。</p>
<p>以上文的<code>BibTeX</code>为例，进行引用：</p>
<pre class="line-numbers language-none"><code class="language-none">Conditional GAN (CGAN) \cite{mirza2014conditional}.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>显示：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/95b7f365d4584b8f5f6935f887c7dbe8.png" alt="在这里插入图片描述"></p>
<h4 id="改变引用颜色"><a href="#改变引用颜色" class="headerlink" title="改变引用颜色"></a>改变引用颜色</h4><p>改变引用颜色前最好在导言区导入<code>xcolor</code>宏包，代码为<code>\usepackage{xcolor}</code>。<br>改变引用颜色需要在导言区添加如下代码：</p>
<pre class="line-numbers language-latex" data-language="latex"><code class="language-latex"><span class="token function selector">\usepackage</span><span class="token punctuation">[</span>colorlinks,bookmarksopen,bookmarksnumbered,citecolor=green, linkcolor=red, urlcolor=blue<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token keyword">hyperref</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><code>citecolor</code>为参考文献颜色，<code>linkcolor</code>为图表和公式引用的颜色，<code>urlcolor</code>为超链接颜色。各颜色可根据偏好或要求自行更改。</p>
<p>显示效果如下：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/7d1bd017c3aa6e21851d106a60c2b92c.png" alt="在这里插入图片描述"></p>
]]></content>
      <categories>
        <category>Latex</category>
      </categories>
  </entry>
  <entry>
    <title>【新手入门】PyMOL绘制蛋白-配体相互作用图：从PDB到发表质量图片</title>
    <url>/2025/11/03/pymol/</url>
    <content><![CDATA[<h1 id="【新手入门】PyMOL绘制蛋白-配体相互作用图：从PDB到发表质量图片"><a href="#【新手入门】PyMOL绘制蛋白-配体相互作用图：从PDB到发表质量图片" class="headerlink" title="【新手入门】PyMOL绘制蛋白-配体相互作用图：从PDB到发表质量图片"></a>【新手入门】PyMOL绘制蛋白-配体相互作用图：从PDB到发表质量图片</h1><blockquote>
<p>转载自：<code>https://blog.csdn.net/qq_37126941/article/details/115793062</code>。</p>
<p>本文将以D715-2441抑制剂与PB2蛋白复合物为例，手把手教你用PyMOL制作专业的结合模式图</p>
</blockquote>
<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>本文将带大家使用免费开源的PyMOL软件绘制D715-2441蛋白与与<a href="https://link.zhihu.com/?target=https://www.rcsb.org/structure/4CB4">PB2cap配体分子</a>的结合模式图。</p>
<p>我们先来看一张成品图：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/5bb95a5e415241b5719ec50baf888d67.jpeg" alt="在这里插入图片描述"></p>
<h2 id="研究背景"><a href="#研究背景" class="headerlink" title="研究背景"></a>研究背景</h2><p>流感病毒PB2蛋白是重要的药物靶点，D715-2441是一个新型抗流感病毒化合物。通过分子对接分析，我们发现以下关键相互作用：</p>
<p>1、化合物D715-2441的<code>芳环</code>夹在氨基酸残基<code>H357</code>和<code>F404</code>之间并形成<code>π-π</code>堆积作用，还与<code>F404</code>形成疏水作用；</p>
<p>2、化合物苯环上的<code>羟基</code>与E361的<code>羧基</code>和K376的<code>N+原子</code>形成氢键作用，另一个<code>羟基</code>与F404的<code>O原子</code>形成氢键作用；</p>
<p>3、化合物吡喃酮环酯基与K339的<code>N+原子</code>和H357的<code>咪唑基</code>形成盐桥作用。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><blockquote>
<p>PyMOL作图通常是对特定对象进行展示形式、颜色、字体等方面的修饰。PyMOL的精髓在于命令行与鼠标的配合使用，本文高度依赖命令行，请做好心理准备。大多数命令格式较为一致，请注意总结归纳。</p>
</blockquote>
<h3 id="1-下载蛋白结构"><a href="#1-下载蛋白结构" class="headerlink" title="1. 下载蛋白结构"></a>1. 下载蛋白结构</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 在PyMOL中直接下载PDB结构</span>
fetch 4cb4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="2-获取配体结构"><a href="#2-获取配体结构" class="headerlink" title="2. 获取配体结构"></a>2. 获取配体结构</h3><p>由于D715-2441不在PDB中，我们需要自行准备：</p>
<p><strong>方法一：在线SMILES转换</strong></p>
<p>​	1.使用<strong>PubChem</strong>: <a href="https://pubchem.ncbi.nlm.nih.gov/">https://pubchem.ncbi.nlm.nih.gov/</a></p>
<p>​	2.绘制完后，SIMLES：<code>C1=CC=CC3=C1C2=C(C=C(C=C2O[H])O[H])OC3=O</code></p>
<p>​	3.访问：<strong><a href="https://cactus.nci.nih.gov/translate/">https://cactus.nci.nih.gov/translate/</a></strong></p>
<p>​	4.在输入框粘贴：<code>C1=CC=CC3=C1C2=C(C=C(C=C2O[H])O[H])OC3=O</code></p>
<p>​	5.选择格式：<strong>Protein Data Bank (pdb)</strong></p>
<p>​	6.点击 <strong>Translate</strong></p>
<p>​	7.下载文件并在PyMOL中加载</p>
<p><strong>方法二：手动构建</strong><br>在PyMOL中使用Builder工具逐步绘制分子结构</p>
<h2 id="基础操作流程"><a href="#基础操作流程" class="headerlink" title="基础操作流程"></a>基础操作流程</h2><h3 id="1-初始设置"><a href="#1-初始设置" class="headerlink" title="1. 初始设置"></a>1. 初始设置</h3><p>打开<code>PyMOL</code>软件，导入刚才下载的复合物PDB文件（rli-D715-2441-1.pdb）。</p>
<p>注意：有两种方法导入文件，一种是鼠标点击菜单栏File -&gt; Open…，另一种是通过命令行。在这里，我们采用命令来操作，因为这样可以同时把工作目录设置好，方便后续保存文件。</p>
<p>假设我们的工作目录为<code>D:\demo</code>。注意：路径中不要有中文和空格，这是导致很多计算类软件（尤其是免费软件）出现问题的原因。</p>
<pre class="line-numbers language-none"><code class="language-none"># 设置工作目录
cd E:\下载\Pymol\test

# 基本显示设置
hide everything
show cartoon, 4cb4
show sticks, resn MGT  # 参考配体
color gray, 4cb4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在PyMOL上界面或下界面的命令输入框输入以下命令（PyMOL&gt;表示这是PyMOL的命令），每行输入完毕后按【Enter】键：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/a777cf49858f76eec599ecfd8f881301.jpeg" alt="在这里插入图片描述"></p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/fa8eaf9a056c73c583d30921f453ab60.png" alt="在这里插入图片描述"></p>
<h3 id="2-设置操作对象"><a href="#2-设置操作对象" class="headerlink" title="2 设置操作对象"></a>2 设置操作对象</h3><p><strong>结合模式图</strong>通常涉及到<code>受体</code>（蛋白）与<code>配体</code>（小分子化合物）两部分（有的还可能涉及<code>水分子</code>、<code>金属离子</code>、<code>辅酶</code>等等），需为之分别设置对象，以便后续操作。<strong>设置配体对象</strong>：按照下图顺序，将配体设置为<code>lig</code>对象。<img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/2568e1b24aca318f02d497b946f2635b.png" alt="在这里插入图片描述"></p>
<p><strong>设置关键残基对象</strong>: 关键残基包括：A链的K339、H357、E361、K376和F404。由于该蛋白只有一条链，在使用命令选择残基时，可以不用指定链名。按照下图顺序，将关键残基设置为res对象。</p>
<p><code>select res, resi 339+357+361+376+404</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/3a9fd3f025f59f1e691f72009f398653.png" alt="在这里插入图片描述"></p>
<h3 id="3-显示样式优化"><a href="#3-显示样式优化" class="headerlink" title="3. 显示样式优化"></a>3. 显示样式优化</h3><p>在PyMOL中输入以下命令：</p>
<pre class="line-numbers language-none"><code class="language-none"># 基本显示设置
hide everything
show sticks, lig | res
hide sticks, h.
zoom lig | res
# 颜色设置
color wheat, lig &amp; name C*
# 标签设置
set label_size, 30
set label_font_id, 9<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/8eec91dbd5bb84f2cc2a553f8aaca60c.jpeg" alt="在这里插入图片描述"><br>然后，进行鼠标操作：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/3f3c38acd7270f0ad5a310dbfa8b8189.png" alt="在这里插入图片描述"></p>
<h4 id="绘制相互作用力"><a href="#绘制相互作用力" class="headerlink" title="绘制相互作用力"></a>绘制相互作用力</h4><p>前面说过，命令行和鼠标的配合是很重要的。这里再简单讲讲鼠标的几个操作用法：</p>
<p>​	A） 拖动鼠标左键：按住右键，任意方向拖动鼠标，使视图转动；</p>
<p>​	B） 上下拖动鼠标右键：按住右键，上下拖动鼠标，使视图缩放；</p>
<p>​	C） 拖动鼠标中间滚轮：按住滚轮，任意方向拖动鼠标，使视图移动；</p>
<p>​	D）滚动鼠标中间滚轮：拉进或拉远镜头，使近处原子逐渐显示或隐藏。</p>
<p>我们参照平台给出的结合模式图（本文第二张图），通过下面的键鼠操作来绘制相互作用力。</p>
<h6 id="·-绘制π-π堆积与盐桥作用"><a href="#·-绘制π-π堆积与盐桥作用" class="headerlink" title="· 绘制π-π堆积与盐桥作用"></a>· 绘制π-π堆积与盐桥作用</h6><p>首先，确保鼠标模式（Mouse Mode）为Viewing状态，选择（Selecting）模式为<code>Atoms</code>状态（位置在PyMOL右下方）。然后，按照下面步骤操作：</p>
<p>新建文件<code>center_of_mass.py</code>，<code>run /PATH/TO/center_of_mass.py</code></p>
<pre class="line-numbers language-none"><code class="language-none">from pymol import cmd
from chempy import cpv

def center_of_mass(selection, state=1, object=None, color=None, quiet=1):
    """
    Calculate the center of mass (COM) for a selection and optionally create a pseudo-atom at that position.
    
    Parameters:
    selection (str): atom selection
    state (int): object state (default=1)
    object (str): name of pseudo-atom to create (default=None)
    color (str): color for the pseudo-atom (default=None)
    quiet (int): suppress output (default=1)
    """
    quiet = int(quiet)
    
    # Get the coordinates and masses
    model = cmd.get_model(selection, state)
    if not model.atom:
        print("Error: No atoms selected")
        return
    
    # Calculate center of mass
    total_mass = 0.0
    com = [0.0, 0.0, 0.0]
    
    for atom in model.atom:
        mass = atom.get_mass()
        total_mass += mass
        com[0] += atom.coord[0] * mass
        com[1] += atom.coord[1] * mass
        com[2] += atom.coord[2] * mass
    
    if total_mass == 0:
        print("Error: Total mass is zero")
        return
    
    com[0] /= total_mass
    com[1] /= total_mass
    com[2] /= total_mass
    
    if not quiet:
        print("Center of Mass: %.3f, %.3f, %.3f" % (com[0], com[1], com[2]))
    
    # Create pseudo-atom if requested
    if object:
        if color:
            cmd.pseudoatom(object, pos=com, color=color)
        else:
            cmd.pseudoatom(object, pos=com)
        
        # 自动设置显示属性
        cmd.set("sphere_scale", 0.3, object)
        cmd.show("spheres", object)
        
        if not quiet:
            print("Created pseudo-atom '%s' at COM" % object)
    
    return com

# Add the command to PyMOL
cmd.extend("com", center_of_mass)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none"># 导入必要插件
run /PATH/TO/center_of_mass.py
# 创建小球的命令序列
com sele, object=p1
com sele, object=p2  
com sele, object=p3
com sele, object=p4
com sele, object=p5
com sele, object=p6
com sele, object=p7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/4c73e3f7a2e524d6d72641c589585b53.jpeg" alt="在这里插入图片描述">然后，点击PyMOL菜单栏的Wizard -&gt; Measurement，然后根据示意图点击刚才创建的小球，两两一组，便画出虚线（相应地，生成对象measure01~05）。<img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/cdcb8f03c0f348271b32051bd021c1cd.png" alt="在这里插入图片描述"></p>
<h6 id="·-绘制其他作用力"><a href="#·-绘制其他作用力" class="headerlink" title="· 绘制其他作用力"></a>· 绘制其他作用力</h6><p>采用相同的办法，把<code>氢键</code>和<code>疏水作用</code>也画出来。由于这些作用力的两端刚好落在原子上，因此，不用绘制小球。<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/6da4239d1e6785671f043216731b13b4.png" alt="在这里插入图片描述"></p>
<h3 id="图像美化与输出"><a href="#图像美化与输出" class="headerlink" title="图像美化与输出"></a>图像美化与输出</h3><p>为方便调整，也为图片规格符合要求（通常，出版社要求全版图片宽度≤2000像素，半版图片宽度≤1000像素，分辨率≥300 dpi)，我们将PyMOL界面放大或靠边最大化，并将上半部分的对话框往上拉到最小，让视图最大。然后放大、摆动视图至合适的角度，使尽可能清晰地看到各关键细节。</p>
<p>基本的创建工作已经完成，接下来进行细致的修饰。</p>
<p><strong>🎯 隐藏和显示控制</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 居中显示</span>
zoom ligand <span class="token keyword">or</span> key_residues

<span class="token comment"># 小球显示控制</span>
hide everything<span class="token punctuation">,</span> p<span class="token operator">*</span>
show spheres<span class="token punctuation">,</span> p<span class="token operator">*</span>

<span class="token comment"># 标签显示控制</span>
hide labels<span class="token punctuation">,</span> measure<span class="token operator">*</span>
show labels<span class="token punctuation">,</span> measure06
show labels<span class="token punctuation">,</span> measure07  
show labels<span class="token punctuation">,</span> measure08<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>🎨 虚线样式设置</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 虚线外观调整</span>
<span class="token builtin">set</span> dash_length<span class="token punctuation">,</span> <span class="token number">0.3</span>
<span class="token builtin">set</span> dash_radius<span class="token punctuation">,</span> <span class="token number">0.08</span>
<span class="token builtin">set</span> dash_gap<span class="token punctuation">,</span> <span class="token number">0.3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>🌈 虚线颜色设置</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 相互作用颜色编码</span>
color magenta<span class="token punctuation">,</span> measure04    <span class="token comment"># 盐桥</span>
color magenta<span class="token punctuation">,</span> measure05    <span class="token comment"># 盐桥  </span>
color green<span class="token punctuation">,</span> measure06      <span class="token comment"># 氢键</span>
color green<span class="token punctuation">,</span> measure07      <span class="token comment"># 氢键</span>
color green<span class="token punctuation">,</span> measure08      <span class="token comment"># 氢键</span>
color gray70<span class="token punctuation">,</span> measure09     <span class="token comment"># 疏水作用</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>🖼️ 背景和蛋白显示</strong></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 背景设置</span>
bg_color white

<span class="token comment"># 蛋白结构显示</span>
show cartoon
color smudge<span class="token punctuation">,</span> lig <span class="token keyword">and</span> name C<span class="token operator">*</span>
<span class="token builtin">set</span> cartoon_transparency<span class="token punctuation">,</span> <span class="token number">0.3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/243fc636fd2a30ce86bd04121d969461.jpeg" alt="在这里插入图片描述"></p>
<p>我们还可按下图步骤微调cartoon样式：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/9988aba7cb104fd00f608bd0f601c6e3.png" alt="在这里插入图片描述"><br>还可移动label的位置（设置Mouse Mode为Editing模式后，按住Ctrl键，用鼠标左键或右键拖动label；必要时，可先将cartoo隐藏起来，等调整好label后，再显示出来），让视图更清晰。经过上述一系列操作，得到下图：<br><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/f1c0110ffc04461492536e39811d4eba.png" alt="在这里插入图片描述"></p>
<p>✅ 一、目标效果</p>
<ul>
<li>整体蛋白以 <strong>cartoon 灰色显示</strong>（作为背景板）</li>
<li>配体（<code>lig</code>）与特定残基（<code>res</code>）<strong>前置显示、保持高亮颜色</strong></li>
<li>cartoon 不遮挡配体和关键残基</li>
<li>其余部分颜色偏淡，突出关键信息</li>
</ul>
<hr>
<p>✅ 二、实现命令步骤（PyMOL 命令行版）</p>
<pre class="line-numbers language-pymol" data-language="pymol"><code class="language-pymol"># 1. 全局设置
bg_color white
set cartoon_transparency, 0.6      # 半透明背景板感觉更好
set depth_cue, 0                   # 去掉景深影响

# 2. 设置蛋白主链为灰色 cartoon
show cartoon, all
color grey80, all

# 3. 高亮配体与特定残基
show sticks, (lig or res)
util.cbag (lig or res)             # 让配体/残基彩色显示（carbon by atom type）

# 4. 把配体、残基显示在最前层（不被遮挡）
# set cartoon_side_chain_helper, on
set transparency_mode, 2           # 优化透明度混合效果
set ray_opaque_background, off

# 5. 可以单独调整颜色
# color red, lig
# color yellow, res

color yellow, measure01
color yellow, measure02
color yellow, measure03
color green, measure04
color green, measure05
color green, measure06
color gray70, measure07

color yellow, p1
color yellow, p2
color yellow, p3
color yellow, p4
color purple, p6
color purple, p7

# 6. 重新绘制（Ray tracing 渲染可选）
ray 1200,900<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<p>✅ 三、可选优化效果</p>
<p>如果你发现 <strong>cartoon 仍挡住配体/残基</strong>，可进一步操作：</p>
<pre class="line-numbers language-pymol" data-language="pymol"><code class="language-pymol"># 让 cartoon 更透明
set cartoon_transparency, 0.7

# 或者单独隐藏关键区域的 cartoon
hide cartoon, (byres (lig around 3))  # 隐藏配体周围3Å范围的cartoon<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<blockquote>
<p>这样配体周围的 cartoon 会消失，配体完全露出；蛋白其他部分仍然是灰色背景板。</p>
</blockquote>
<hr>
<p>✅ 四、额外技巧</p>
<p>你还可以使用分层渲染的方式，例如：</p>
<pre class="line-numbers language-pymol" data-language="pymol"><code class="language-pymol"># 生成两层视图（适合高质量图）
disable all
enable protein
color grey80, protein
set cartoon_transparency, 0.7
enable lig, res
show sticks, lig or res<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>再用：</p>
<pre class="line-numbers language-pymol" data-language="pymol"><code class="language-pymol">ray 2000,1500
png output.png, dpi=300<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>7 生成图片<br>上面的图已经可以发表文章了，但为了更好看，还需要进行一步：光线追踪（Ray tracing)。</p>
<p>继续使用命令：</p>
<p>💾 保存工作文件</p>
<pre class="line-numbers language-none"><code class="language-none">save focus.pse
save overview.pse<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>📷 图像保存命令</p>
<pre class="line-numbers language-none"><code class="language-none"># 保存标签图像
png label.png
# 保存焦点图像（高分辨率）
png focus.png, 16.93cm, 16.93cm, dpi=300
# 保存概览图像（高分辨率）
png overview.png, 16.93cm, 16.93cm, dpi=300<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>🎨 显示调整命令</p>
<pre class="line-numbers language-none"><code class="language-none"># 标签控制
hide labels
# 视图调整
zoom
# 透明度设置
set cartoon_transparency, 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>✨ 渲染命令</p>
<pre class="line-numbers language-none"><code class="language-none"># 光线追踪渲染
ray<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/5a2bf78817d4276796571a66229be702.jpeg" alt="在这里插入图片描述"><br>至此，我们拿到3张图片：focus.png、label.png和overview.png。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/label.png" alt="label"></p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/overview.png" alt="overview"></p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/focus.png" alt="focus"></p>
]]></content>
      <categories>
        <category>PyMOL</category>
      </categories>
  </entry>
  <entry>
    <title>Planck-Pi学习</title>
    <url>/2025/10/26/planck-pi/</url>
    <content><![CDATA[<h1 id="1-配置编译环境"><a href="#1-配置编译环境" class="headerlink" title="1. 配置编译环境"></a>1. 配置编译环境</h1><pre class="line-numbers language-none"><code class="language-none">1.1 编译过程中需要的依赖
sudo apt update
sudo apt install xz-utils nano wget unzip build-essential git bc swig libncurses5-dev libpython3-dev libssl-dev pkg-config zlib1g-dev libusb-dev libusb-1.0-0-dev python3-pip gawk bison flex -y
sudo apt install python python-dev lib32ncurses5 lib32z1 vim dwarves -y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="1-2-交叉编译工具链"><a href="#1-2-交叉编译工具链" class="headerlink" title="1.2 交叉编译工具链"></a>1.2 交叉编译工具链</h2><pre class="line-numbers language-none"><code class="language-none"># 下载
wget http://releases.linaro.org/components/toolchain/binaries/7.2-2017.11/arm-linux-gnueabi/gcc-linaro-7.2.1-2017.11-x86_64_arm-linux-gnueabi.tar.xz

$ wget https://releases.linaro.org/components/toolchain/binaries/7.5-2019.12/arm-linux-gnueabi/gcc-linaro-7.5.0-2019.12-x86_64_arm-linux-gnueabi.tar.xz
# 解压
sudo mkdir /usr/local/arm
sudo tar -vxf gcc-linaro-7.2.1-2017.11-x86_64_arm-linux-gnueabi.tar.xz -C /usr/local/arm
# 配置
sudo nano /etc/profile
# 在末尾添加
PATH=$PATH:/usr/local/arm/gcc-linaro-7.2.1-2017.11-x86_64_arm-linux-gnueabi/bin
# 使之生效
source /etc/profile 
# 验证
arm-linux-gnueabi-gcc -v<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="1-3-TF卡分区"><a href="#1-3-TF卡分区" class="headerlink" title="1.3 TF卡分区"></a>1.3 TF卡分区</h2><pre class="line-numbers language-none"><code class="language-none"># 可以使用gparted进行分区
sudo apt-get install gparted -y
分3个分区

volume	1M		FAT16
boot	32M		EXT4
rootfs	--		EXT4<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="1-4-TF卡上传命令"><a href="#1-4-TF卡上传命令" class="headerlink" title="1.4 TF卡上传命令"></a>1.4 TF卡上传命令</h2><pre class="line-numbers language-none"><code class="language-none"># volume	1M
sudo dd if=/home/hhhh/Downloads/Planck-Pi/Planck-Pi/buildroot/output/images/u-boot-sunxi-with-spl.bin of=/dev/sdc bs=1024 seek=8

# boot	32M

setenv bootcmd "load mmc 0:2 0x80008000 zImage; load mmc 0:2 0x80C00000 suniv-f1c100s-generic.dtb; bootz 0x80008000 - 0x80C00000"
或
setenv bootcmd "load mmc 0:2 0x80008000 zImage; load mmc 0:2 0x80C00000 suniv-f1c100s-licheepi-nano.dtb; bootz 0x80008000 - 0x80C00000"

# 设置启动参数，使用第三分区
setenv bootargs "console=tty0 console=ttyS0,115200 root=/dev/mmcblk0p3 rootwait rw"

# 保存并启动
saveenv
boot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none"># kernel
sudo cp /home/hhhh/Downloads/Planck-Pi/buildroot/linux/arch/arm/boot/dts/allwinner/suniv-f1c100s-licheepi-nano.dtb .

sudo mv suniv-f1c100s-licheepi-nano.dtb suniv-f1c100s-generic.dtb

sudo cp /home/hhhh/Downloads/Planck-Pi/buildroot/linux/arch/arm/boot/zImage .<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-none"><code class="language-none"># rootfs 复制rootfs文件到第三个分区
sudo mount /dev/sdc3 /mnt
sudo tar -xf rootfs.tar -C /mnt

sudo umount /mnt

sync<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h1 id="2-uboot，kernel和rootfs编译"><a href="#2-uboot，kernel和rootfs编译" class="headerlink" title="2.uboot，kernel和rootfs编译"></a>2.uboot，kernel和rootfs编译</h1><p>一部分来自<code> https://github.com/916BGAI/Planck-Pi</code>，包含uboot，kernel和rootfs</p>
<pre class="line-numbers language-none"><code class="language-none">git clone -b linux_6.5.2 --single-branch https://github.com/916BGAI/Planck-Pi.git
cd Planck-Pi/
git submodule update --init --recursive<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>u-boot源码 （2）</p>
<pre class="line-numbers language-none"><code class="language-none">git clone https://github.com/Lichee-Pi/u-boot.git -b nano-v2018.01
cd u-boot
//git branch -a
//git checkout nano-v2018.01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<p><strong>Compile命令</strong></p>
<pre class="line-numbers language-none"><code class="language-none">cd u-boot
make planck_pi_defconfig
make menuconfig
make -j65535
cd linux
make planck_pi_defconfig
make menuconfig
make -j65535
cd Buildroot
make planck_pi_defconfig
make menuconfig
make<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="1-u-boot"><a href="#1-u-boot" class="headerlink" title="1.u-boot"></a>1.u-boot</h2><p>为了方便后边编译在248行添加 目标构架是arm，交叉编译器是</p>
<pre class="line-numbers language-none"><code class="language-none">vim Makefile

ARCH=arm CROSS_COMPILE=arm-linux-gnueabi-<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>在uboot根目录进行编译配置为不带spi，来在根目录生成.config</p>
<pre class="line-numbers language-none"><code class="language-none">make licheepi_nano_defconfig<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>图形化配置</p>
<pre class="line-numbers language-none"><code class="language-none">make menuconfig
#Enable boot arguments
console=ttyS0,115200 panic=5 rootwait root=/dev/mmcblk0p2 earlyprintk rw
#bootcmd value
load mmc 0:1 0x80008000 zImage;load mmc 0:1 0x80c08000 suniv-f1c100s-licheepi-nano.dtb;bootz 0x80008000 - 0x80c08000;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>回到uboot根目录进行编译</p>
<pre class="line-numbers language-none"><code class="language-none">make -j4<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>确定已经生成了u-boot-sunxi-with-spl.bin文件</p>
<pre class="line-numbers language-none"><code class="language-none">sudo dd if=u-boot-sunxi-with-spl.bin of=/dev/sdb bs=1024 seek=8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="2-linux-kernel"><a href="#2-linux-kernel" class="headerlink" title="2. linux kernel"></a>2. linux kernel</h2><p>事实上对于F1C100S/F1C200S，Linux官方源码已经对licheepi nano进行支持。所以我们完全可以通过licheepi nano的配置文件进行移植。</p>
<h3 id="2-1-下载内核源码"><a href="#2-1-下载内核源码" class="headerlink" title="2.1. 下载内核源码#"></a>2.1. 下载内核源码<a href="https://www.cnblogs.com/twzy/p/15355842.html#1.1.-%E4%B8%8B%E8%BD%BD%E5%86%85%E6%A0%B8%E6%BA%90%E7%A0%81">#</a></h3><p>进入Linux系统官网：<a href="https://www.kernel.org/">https://www.kernel.org/</a></p>
<p>[<img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20210930145110377-1315647665.png" alt="img"></p>
<p>这里面列出的都是一些主要版本，如主线版本，上时间支持版本，个人推荐使用最新的长时间支持版本（5.10.69）。但是因为我这个项目是在参考一位大神的文档的基础上构建的，所以使用的是5.7.1版本，接下来就给一个选择其他版本的方式。选择任意一项点击 [browse]</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930145220044-1573759475.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20210930145220044-1573759475.png" alt="img"></a></p>
<p>在新打开页面选择 【summary】点击【tag】中的【…】切换下载</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930145316299-265231365.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20210930145316299-265231365.png" alt="img"></a></p>
<p> 如果想要直接下载5.7.1版本，请直接使用下面的连接</p>
<p><a href="https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.7.1.tar.gz">https://mirrors.edge.kernel.org/pub/linux/kernel/v5.x/linux-5.7.1.tar.gz</a></p>
<p>下载后完成后，将代码复制到Ubuntu虚拟机并解压源码。</p>
<h3 id="2-2-配置编译"><a href="#2-2-配置编译" class="headerlink" title="2.2.配置编译#"></a>2.2.配置编译<a href="https://www.cnblogs.com/twzy/p/15355842.html#1.2.%E9%85%8D%E7%BD%AE%E7%BC%96%E8%AF%91">#</a></h3><p>与上一篇中编译u-boot一样，我们也需要配置对Linux编译进行配置：</p>
<ul>
<li>指定架构类型</li>
<li>指定交叉编译工具</li>
<li>项目配置</li>
</ul>
<p>指定架构，就这个很好理解，就是指定CPU类型，就是配置为Arm就行，交叉编译工具即为上一篇已经安装好的编译工具。</p>
<p>用VS打开Linux内核代码，找到<strong>Makefile</strong>文件：</p>
<p>修改如下配置：</p>
<pre class="line-numbers language-none"><code class="language-none">ARCH              ?= arm
CROSS_COMPILE     ?=arm-linux-gnueabi-<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>如果没找到ARCH 或 CROSS_COMPILE字段，自己手动添加也行，如下图所示：</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930151530833-1001068341.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20210930151530833-1001068341.png" alt="img"></a></p>
<blockquote>
<p> 事实上这两个字段可以不用指定，在进行make的时候加上对应的参数就行，这里为了避免麻烦，所以直接放到了makefile文件中</p>
</blockquote>
<p>接下来就是指定项目配置了，这个操作就是让Linux内核认F1C100S/F1C200S这颗soc。</p>
<p>进入内核源码中的<strong>arch/arm/configs</strong>目录中，可以看到有很多开发板的配置文件，其中<strong>sunxi_defconfig</strong>是全志的配置文件，但是该配置文件非常不全，需要额外配置大量的选项，一般选项多大上千个，这里先使用licheepi_nano的配置文件。</p>
<p><a href="https://files.cnblogs.com/files/twzy/linux-licheepi_nano_defconfig.zip"> https://files.cnblogs.com/files/twzy/linux-licheepi_nano_defconfig.zip</a></p>
<p>下载该文件，解压出<strong>linux-licheepi_nano_defconfig</strong>，然后将其放到arch/arm/configs/目录下</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202109/483434-20210930154001937-799886630.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20210930154001937-799886630.png" alt="img"></a></p>
<p> 然后通过终端进入Linux-5.7.1根目录，输入命令：</p>
<pre class="line-numbers language-none"><code class="language-none">make menuconfig<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211005103913552-1730316057.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211005103913552-1730316057.png" alt="img"></a></p>
<p> 进入图形配置界面，如图所示：</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211005104057991-2077580949.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211005104057991-2077580949.png" alt="img"></a></p>
<p>该界面和u-boot配置一样，所以操作方式也是一样的，上下键移动选项，使用空格键进行选中或取消选择，同样通过空格键或回车键，进入子选项配置，通过Tab键选择保存和退出即可返回上级菜单或命令行界面，也可以直接双击Esc键返回上级目录。</p>
<h3 id="3-3-配置TF卡设备树信息"><a href="#3-3-配置TF卡设备树信息" class="headerlink" title="3.3 配置TF卡设备树信息#"></a>3.3 配置TF卡设备树信息<a href="https://www.cnblogs.com/twzy/p/15355842.html#1.3-%E9%85%8D%E7%BD%AEtf%E5%8D%A1%E8%AE%BE%E5%A4%87%E6%A0%91%E4%BF%A1%E6%81%AF">#</a></h3><p>我们在完成内核配置后还需要配置TF卡的设备树配置，否则即便是能正常运行内核，在加载文件系统的时候还是会有问题，在这里配置很简单：</p>
<p>在<strong>linux-5.7.1/arch/arm/boot/dts</strong> 目录下，分别修改<strong>suniv-f1c100s.dtsi</strong>、<strong>suniv-f1c100s-licheepi-nano.dts</strong> 两个文件（记住这两个文件、以后我们修改的地方多了^_^）</p>
<p>修改<strong>suniv-f1c100s.dtsi</strong>文件</p>
<p>首先添加头文件(如果有则忽略)</p>
<pre class="line-numbers language-none"><code class="language-none">#include &lt;dt-bindings/clock/suniv-ccu-f1c100s.h&gt;
#include &lt;dt-bindings/reset/suniv-ccu-f1c100s.h&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>在soc-&gt;pio 下添加如下代码</p>
<pre class="line-numbers language-none"><code class="language-none">mmc0_pins: mmc0-pins {
                pins = "PF0", "PF1", "PF2", "PF3", "PF4", "PF5";
                function = "mmc0";
            };<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>soc下添加如下代码</p>
<pre class="line-numbers language-none"><code class="language-none">mmc0: mmc@1c0f000 {
            compatible = "allwinner,suniv-f1c100s-mmc",
                     "allwinner,sun7i-a20-mmc";
            reg = &lt;0x01c0f000 0x1000&gt;;
            clocks = &lt;&amp;ccu CLK_BUS_MMC0&gt;,
                 &lt;&amp;ccu CLK_MMC0&gt;,
                 &lt;&amp;ccu CLK_MMC0_OUTPUT&gt;,
                 &lt;&amp;ccu CLK_MMC0_SAMPLE&gt;;
            clock-names = "ahb",
                          "mmc",
                          "output",
                          "sample";
            resets = &lt;&amp;ccu RST_BUS_MMC0&gt;;
            reset-names = "ahb";
            interrupts = &lt;23&gt;;
            pinctrl-names = "default";
            pinctrl-0 = &lt;&amp;mmc0_pins&gt;;
            status = "disabled";
            #address-cells = &lt;1&gt;;
            #size-cells = &lt;0&gt;;
        };<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>如图，图中的配置可能与读者实际内容不一致，这是因为我改了很多东西，忽略即可，只需要关注红色框中的内容即可。</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009162310863-1685576565.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211009162310863-1685576565.png" alt="img"></a></p>
<p> 修改<strong>suniv-f1c100s-licheepi-nano.dts</strong>文件，在根节点添加如下代码</p>
<pre class="line-numbers language-none"><code class="language-none">reg_vcc3v3: vcc3v3 {
        compatible = "regulator-fixed";
        regulator-name = "vcc3v3";
        regulator-min-microvolt = &lt;3300000&gt;;
        regulator-max-microvolt = &lt;3300000&gt;;
    };<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>外部添加mmc0使能代码</p>
<pre class="line-numbers language-none"><code class="language-none">&amp;mmc0 {
        vmmc-supply = &lt;&amp;reg_vcc3v3&gt;;
        bus-width = &lt;4&gt;;
        broken-cd;
        status = "okay";
};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>位置如下图</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202201/483434-20220114080223936-810553130.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20220114080223936-810553130.png" alt="img"></a></p>
<p>接下来执行make命令开始编译内核和设备树相关的文件了</p>
<pre class="line-numbers language-none"><code class="language-none">make<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>首次进行编译，通常会需要很长时间，编译完成后，就会在在<strong>arch/arm/boot</strong>目录下生成内核文件：<strong>zImage</strong>，在<strong>arch/arm/boot/dts</strong>目录下设备树文件：<strong>suniv-f1c100s-licheepi-nano.dtb</strong> 。</p>
<p>在编译过程中，因为所配置Ubuntu系统的差异，可能会因缺少某些组件导致编译报错，不要慌，将对应的错误关键信息复制到搜索引擎后安装即可，一下是作者碰到的两个编译报错，如果有必要可以提前安装：</p>
<p> <strong>linux-内核编译配置 lexer.lex.c错误</strong></p>
<pre class="line-numbers language-none"><code class="language-none">wu@ubuntu:~/linux-5.4.8$ make exynos_defconfig
HOSTCC scripts/basic/fixdep
HOSTCC scripts/kconfig/conf.o
HOSTCC scripts/kconfig/confdata.o
HOSTCC scripts/kconfig/expr.o
LEX scripts/kconfig/lexer.lex.c
/bin/sh: 1: flex: not found
scripts/Makefile.host:9: recipe for target ‘scripts/kconfig/lexer.lex.c’ failed
make[1]: * [scripts/kconfig/lexer.lex.c] Error 127
Makefile:567: recipe for target ‘exynos_defconfig’ failed
make: * [exynos_defconfig] Error 2 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解决方法：</p>
<pre class="line-numbers language-none"><code class="language-none">sudo apt-get install bison
sudo apt-get install flex<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>编译Linux内核时遇到：“error : openssl/bio.h :No such file or folder”</strong></p>
<pre class="line-numbers language-none"><code class="language-none">scripts/extract-cert.c:21:25: fatal error: openssl/bio.h: No such file or directory
compilation terminated.
scripts/Makefile.host:90: recipe for target 'scripts/extract-cert' failed
make[1]: * [scripts/extract-cert] Error 1
Makefile:556: recipe for target 'scripts' failed
make: * [scripts] Error 2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>安装openssl：</p>
<pre class="line-numbers language-none"><code class="language-none">sudo apt install libssl-dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="3-4-内核复制与执行"><a href="#3-4-内核复制与执行" class="headerlink" title="3.4 内核复制与执行#"></a>3.4 内核复制与执行<a href="https://www.cnblogs.com/twzy/p/15355842.html#1.5-%E5%86%85%E6%A0%B8%E5%A4%8D%E5%88%B6%E4%B8%8E%E6%89%A7%E8%A1%8C">#</a></h3><p>那么，我们将刚才生成好的zImage和dtb文件复制到TF卡的BOOT分区中</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009082706512-1631849134.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211009082706512-1631849134.png" alt="img"></a></p>
<p>退出TF卡，插入开发板，上电，按重启，我们就可以看到u-boot启动完成后，自动进入了内核启动环节，但是启动后一会就报错了，因为挂载文件系统产生错误。</p>
<pre class="line-numbers language-none"><code class="language-none">U-Boot SPL 2018.01-05679-g013ca457fd-dirty (Sep 28 2021 - 15:29:32)
DRAM: 32 MiB
Trying to boot from MMC1


U-Boot 2018.01-05679-g013ca457fd-dirty (Sep 28 2021 - 15:29:32 +0800) Allwinner Technology

CPU:   Allwinner F Series (SUNIV)
Model: Snail Card
DRAM:  32 MiB
MMC:   SUNXI SD/MMC: 0
*** Warning - bad CRC, using default environment

In:    serial@1c25000
Out:   serial@1c25000
Err:   serial@1c25000
Net:   No ethernet found.
starting USB...
No controllers found
Hit any key to stop autoboot:  0 
reading zImage
4515448 bytes read in 231 ms (18.6 MiB/s)
reading suniv-f1c100s-licheepi-nano.dtb
6105 bytes read in 26 ms (228.5 KiB/s)
## Flattened Device Tree blob at 80c00000
   Booting using the fdt blob at 0x80c00000
   Loading Device Tree to 816fb000, end 816ff7d8 ... OK

Starting kernel ...

[    0.000000] Booting Linux on physical CPU 0x0
[    0.000000] Linux version 5.7.1 (twzy@ubuntu) (gcc version 7.2.1 20171011 (Linaro GCC 7.2-2017.11), GNU ld (Linaro_Binutils-2017.11) 2.28.2.20170706) #55 Tue Sep 28 21:04:24 CST 2021
[    0.000000] CPU: ARM926EJ-S [41069265] revision 5 (ARMv5TEJ), cr=0005317f
[    0.000000] CPU: VIVT data cache, VIVT instruction cache
[    0.000000] OF: fdt: Machine model: LinuxCard by Kevin
[    0.000000] Memory policy: Data cache writeback
[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 8128
[    0.000000] Kernel command line: console=tty0 console=ttyS0,115200 panic=5 rootwait root=/dev/mmcblk0p2  rw
[    0.000000] Dentry cache hash table entries: 4096 (order: 2, 16384 bytes, linear)
[    0.000000] Inode-cache hash table entries: 2048 (order: 1, 8192 bytes, linear)
[    0.000000] mem auto-init: stack:off, heap alloc:off, heap free:off
[    0.000000] Memory: 21496K/32768K available (7168K kernel code, 403K rwdata, 1664K rodata, 1024K init, 246K bss, 11272K reserved, 0K cma-reserved, 0K highmem)
[    0.000000] SLUB: HWalign=32, Order=0-3, MinObjects=0, CPUs=1, Nodes=1

 …………………

[    6.598874] Run /etc/init as init process
[    6.603993] Run /bin/init as init process
[    6.609078] Run /bin/sh as init process
[    6.613763] Kernel panic - not syncing: No working init found.  Try passing init= option to kernel. See Linux Documentation/admin-guide/init.rst for guidance.
[    6.629985] CPU: 0 PID: 1 Comm: swapper Not tainted 5.7.1 #55
[    6.636727] Hardware name: Allwinner suniv Family
[    6.642216] [&lt;c010d604&gt;] (unwind_backtrace) from [&lt;c010ab60&gt;] (show_stack+0x10/0x14)
[    6.651031] [&lt;c010ab60&gt;] (show_stack) from [&lt;c01165a4&gt;] (panic+0xe8/0x2e4)
[    6.658951] [&lt;c01165a4&gt;] (panic) from [&lt;c071d080&gt;] (kernel_init+0xd8/0x110)
[    6.666960] [&lt;c071d080&gt;] (kernel_init) from [&lt;c0100140&gt;] (ret_from_fork+0x14/0x34)
[    6.675547] Exception stack(0xc1835fb0 to 0xc1835ff8)
[    6.681293] 5fa0:                                     00000000 00000000 00000000 00000000
[    6.690714] 5fc0: 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
[    6.700102] 5fe0: 00000000 00000000 00000000 00000000 00000013 00000000
[    6.707633] Rebooting in 5 seconds..
[   12.687513] Reboot failed -- System halted<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>内核移植就基本结束了，要想让小板真正的运行起来，还需要Linux的文件系统，那开始吧。</p>
<h2 id="3-文件系统移植-buildroot"><a href="#3-文件系统移植-buildroot" class="headerlink" title="3.文件系统移植-buildroot"></a>3.<a href="https://www.cnblogs.com/twzy/p/15355842.html#2.%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D">文件系统移植</a>-buildroot</h2><p> 根文件系统(rootfs)是内核启动后挂载的第一个文件系统，如果没有根文件系统，内核将无法开启shell以及其他进程。</p>
<blockquote>
<p>实际上内核启动后会先挂载一个虚拟的文件系统，这个虚拟文件系统是在内存中运行的，其主要运行核心进程，虚拟文件系统挂载之后才挂载硬盘（TF卡或者emmc）上的根文件系统。</p>
</blockquote>
<p>制作文件系统也有很多方式，如通过busyBox、Buildroot等工具制作。</p>
<p>本次使用Buildroot，制作过程相对简单，兼容性好，由于根文件系统制作比较简单。</p>
<p>进入buildroot官网<a href="https://buildroot.org/downloads">https://buildroot.org/downloads</a></p>
<p>这里选择buildroot2018.2.11版本，将下载好软件包传入Ubuntu系统中，然后解压并进入源码目录中，输入清理命令。主要用于初始化一些设置，命令如下：</p>
<pre class="line-numbers language-none"><code class="language-none">make clean<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后输入以下命令进入配置界面</p>
<pre class="line-numbers language-none"><code class="language-none">make menuconfig<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>此时会终端进入图形配置界面，如图：</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009144509521-972063330.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211009144509521-972063330.png" alt="img"></a></p>
<h3 id="3-1-Target-options配置"><a href="#3-1-Target-options配置" class="headerlink" title="3.1 Target options配置#"></a><strong>3.1 Target options配置</strong><a href="https://www.cnblogs.com/twzy/p/15355842.html#2.1-target-options%E9%85%8D%E7%BD%AE">#</a></h3><p>先选择<strong>Target options</strong>选项，进行对应芯片soc相关的配置，如图：</p>
<p> <a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009144541062-504084831.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211009144541062-504084831.png" alt="img"></a></p>
<p>配置如图所示，下面是对其的解释</p>
<ul>
<li>第一个选项为架构选择，这里选择ARM架构小端模式，</li>
<li>第二个为输出的二进制文件格式，这里选择EFL格式，</li>
<li>第三个为架构体系，这里选择arm926t，因为F1C200S/F1C100S的架构就是这个架构，</li>
<li>第四个为矢量浮点处理器，这里不勾选，因为对于F1C200S/F1C100S而言，其内部没有浮点运算单元，只能进行软浮点运算，也就是模拟浮点预运算。</li>
<li>第五个为应用程序二进制接口，这里选择EABI，原因是该格式支持软件浮点和硬件实现浮点功能混用。</li>
<li>第六个为浮点运算规则，这里使用软件浮点</li>
<li>第七个选择指令集，这里选择ARM指令集，因为thumb主要针对Cortex M系列而言的，对于运行操作系统的A系列以及ARM9和ARM11而言，使用的都是32位的ARM指令集。</li>
</ul>
<p>按【Tab键】选择**<save>**进行保存，按【Esc键】回到上一级配置界面。</save></p>
<h3 id="3-2-Build-options配置"><a href="#3-2-Build-options配置" class="headerlink" title="3.2 Build options配置#"></a><strong>3.2 Build options配置</strong><a href="https://www.cnblogs.com/twzy/p/15355842.html#2.2-build-options%E9%85%8D%E7%BD%AE">#</a></h3><p>进入第二个<strong>Build options</strong>选项，配置如图</p>
<p> <a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009150105319-120500590.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211009150105319-120500590.png" alt="img"></a></p>
<p>按T【ab键】选择**<save>**进行保存，按【Esc键】回到上一级配置界面。</save></p>
<h3 id="3-3-Toolchain配置"><a href="#3-3-Toolchain配置" class="headerlink" title="3.3 Toolchain配置#"></a><strong>3.3 Toolchain配置</strong><a href="https://www.cnblogs.com/twzy/p/15355842.html#2.3-toolchain%E9%85%8D%E7%BD%AE">#</a></h3><p>进入第三个<strong>Toolchain</strong>选项，配置如图：</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009150540766-1755147867.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211009150540766-1755147867.png" alt="img"></a></p>
<p>这里我们选择一些C\C++相关的库，这样我们就可以在开发板上直接编译程序了，保存返回。</p>
<h3 id="3-4-System-configuration配置-https-www-cnblogs-com-twzy-p-15355842-html-2-4-system-configuration配置"><a href="#3-4-System-configuration配置-https-www-cnblogs-com-twzy-p-15355842-html-2-4-system-configuration配置" class="headerlink" title="3.4 System configuration配置[#](https://www.cnblogs.com/twzy/p/15355842.html#2.4 system-configuration配置)"></a><strong>3.4 System configuration配置</strong>[#](<a href="https://www.cnblogs.com/twzy/p/15355842.html#2.4">https://www.cnblogs.com/twzy/p/15355842.html#2.4</a> system-configuration配置)</h3><p>对于<strong>System configuration</strong>选项，这里主要是配置一些系统登录时候显示的内容，配置如图</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009151624384-1186247221.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211009151624384-1186247221.png" alt="img"></a></p>
<p>这里主要配置了登录时候显示的内容和root账号登录密码，接下来保存配置并且退回到命令行界面。</p>
<p>然后执行构建文件系统命令：</p>
<pre class="line-numbers language-none"><code class="language-none">make<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>因为是首次编译，而且buildroot在制作文件系统的时候需要联网获取组件，所以会编译很久，那么“去和妲己玩耍吧”</p>
<p>当你终于被别人坑的自闭的时候，文件系统大概也许可能已经编译完毕了。</p>
<h3 id="3-5-文件系统移植与执行"><a href="#3-5-文件系统移植与执行" class="headerlink" title="3.5 文件系统移植与执行#"></a>3.5 文件系统移植与执行<a href="https://www.cnblogs.com/twzy/p/15355842.html#2.5-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D%E4%B8%8E%E6%89%A7%E8%A1%8C">#</a></h3><p>此时在源码的<strong>output/images</strong>目录下有一个rootfs.tar，这个文件就是最终生成的根文件系统镜像，现在只需要将该镜像解压到TF卡的第二分区即可。插入TF卡到电脑端，进入<strong>out/images</strong>目录，然后输入</p>
<pre class="line-numbers language-none"><code class="language-none"># sudo tar -xvf rootfs.tar -C /media/&lt;你的用户名&gt;/rootfs/
# 墨云的账号是twzy
sudo tar -xvf rootfs.tar -C /media/twzy/rootfs/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>此时可以看到TF卡的rootfs分区中有文件系统了</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009172303012-746246639.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211009172303012-746246639.png" alt="img"></a></p>
<p>插入开发板，连接好串口，打开串口助手或者其他串口终端软件，可以看到根文件系统成功挂载，同时进入shell交互，用户名默认为root，密码：123456，进入root账号后</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009172655126-653041256.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211009172655126-653041256.png" alt="img"></a></p>
<p>那么恭喜，你已经拥有了自己的Linux发行版。</p>
<p>至此我们完成了全部的系统移植任务，从下一篇开始我们将会升级我们的硬件设备和做一些更加有意义的东西，期待吗？</p>
<h3 id="3-6-升级逼格-https-www-cnblogs-com-twzy-p-15355842-html-2-6-升级逼格"><a href="#3-6-升级逼格-https-www-cnblogs-com-twzy-p-15355842-html-2-6-升级逼格" class="headerlink" title="3.6 升级逼格[#](https://www.cnblogs.com/twzy/p/15355842.html#2.6 升级逼格)"></a>3.6 升级逼格[#](<a href="https://www.cnblogs.com/twzy/p/15355842.html#2.6">https://www.cnblogs.com/twzy/p/15355842.html#2.6</a> 升级逼格)</h3><p>我们发现登录进自制的Linux系统后，命令行前置无论怎样只显示一个**#**号，逼格略低呀，怎么处理呢？</p>
<p>修改/etc/profile文件</p>
<pre class="line-numbers language-none"><code class="language-none">vi /etc/profile<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>写入</p>
<pre class="line-numbers language-none"><code class="language-none">export PS1='[\u@\h: \w\a\]$'<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009172755348-361576513.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211009172755348-361576513.png" alt="img"></a></p>
<p>重启小板，就可以看到与与常规Linux一样的操作体验了，只是root账号的时候还是显示 <strong>$</strong> 符号</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009173048942-1924983487.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211009173048942-1924983487.png" alt="img"></a></p>
<p>需要注意的是，在开发板运行过程中，如果想要重启，请先执行</p>
<pre class="line-numbers language-none"><code class="language-none">poweroff<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>命令正常关闭系统后，在按重启按钮，否则有很大概率回造成文件系统损坏。</p>
<h2 id="4-Debian文件系统制作-以及WIFI配置、交换分区配置"><a href="#4-Debian文件系统制作-以及WIFI配置、交换分区配置" class="headerlink" title="4. Debian文件系统制作,以及WIFI配置、交换分区配置"></a>4. <a href="https://www.cnblogs.com/twzy/p/15160824.html">Debian文件系统制作,以及WIFI配置、交换分区配置</a></h2><p>该片文章将完整记录一个Debian的最小文件系统的生成，以及自定义配置WIFI组件、网络组件和交换分区配置</p>
<blockquote>
<p>本文章参考：<br><a href="https://whycan.com/t_4236.html">https://whycan.com/t_4236.html</a><br><a href="http://www.leux.cn/doc/debootstrap.html%EF%BC%88%E8%AF%A5%E7%BD%91%E7%AB%99%E5%9C%A8%E5%A4%87%E6%A1%88%E4%B8%AD%EF%BC%8C%E5%8F%AF%E8%83%BD%E6%9A%82%E6%97%B6%E6%97%A0%E6%B3%95%E6%9F%A5%E7%9C%8B%E4%BA%86%EF%BC%89">http://www.leux.cn/doc/debootstrap.html（该网站在备案中，可能暂时无法查看了）</a><br>帖子整理完成。</p>
</blockquote>
<p>构建debian文件系统，作为记录，最小rootfs在180MB左右。</p>
<h3 id="4-1-配置构建环境"><a href="#4-1-配置构建环境" class="headerlink" title="4.1 配置构建环境#"></a>4.1 配置构建环境<a href="https://www.cnblogs.com/twzy/p/15160824.html#1.1-%E9%85%8D%E7%BD%AE%E6%9E%84%E5%BB%BA%E7%8E%AF%E5%A2%83">#</a></h3><p>安装构建文件系统的工具，一个是用来chroot，一个是用来构建文件系统</p>
<pre class="line-numbers language-none"><code class="language-none">sudo apt install qemu-user-static -y
sudo apt install debootstrap -y
mkdir rootfs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>构建文件系统之前，你要知道你想要构建哪个版本的文件系统，我从 <a href="https://www.debian.org/mirror/list.zh-cn.html%E8%BF%99%E9%87%8C%EF%BC%8C">https://www.debian.org/mirror/list.zh-cn.html</a> 这里，选择了我访问速度快的源，并且该源有armel。</p>
<p><code>armhf (支持硬件浮点)</code><br><code>armel (软浮点)</code></p>
<p>我看华为源挺快的，就用这个了mirrors.huaweicloud.com，然后就是debian的版本，我尝试一下最新的，buster</p>
<pre class="line-numbers language-none"><code class="language-none">sudo debootstrap --foreign --arch=armel --verbose \
    trixie \
    rootfs-debian13 \
    http://mirrors.aliyun.com/debian/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>构建完成之后，需要chroot进去修改密码等配置</p>
<pre class="line-numbers language-none"><code class="language-none">cd rootfs-debian13
sudo mount --bind /dev dev/
sudo mount --bind /sys sys/
sudo mount --bind /proc proc/
sudo mount --bind /dev/pts dev/pts/
cd ..
sudo cp /usr/bin/qemu-arm-static rootfs-debian13/usr/bin/
sudo chmod +x rootfs-debian13/usr/bin/qemu-arm-static
sudo LC_ALL=C LANGUAGE=C LANG=C chroot rootfs-debian13 /debootstrap/debootstrap --second-stage --verbose
sudo LC_ALL=C LANGUAGE=C LANG=C chroot rootfs-debian13<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>最后一条命令chroot完成，<br>此时可以先apt-get等给你的文件系统安装你需要的软件包</p>
<p>为了提高下载速度，我们首先修改源</p>
<pre class="line-numbers language-none"><code class="language-none">vi /etc/apt/sources.list<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>改为(注意要换其他源用http方式可以访问的，要不然还得处理https的内容):</p>
<pre class="line-numbers language-none"><code class="language-none">deb http://mirrors.huaweicloud.com/debian buster main<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>改完以后执行：</p>
<pre class="line-numbers language-none"><code class="language-none">apt-get update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>使源生效</p>
<p>安装网络相关的库</p>
<pre class="line-numbers language-none"><code class="language-none">apt-get install wpasupplicant #安装WIFI配置相关的组件
apt-get install net-tools     #安装网络基础组件、如使用ifconfig等
apt-get install udhcpc        #当wifi连接成功后，需要用这个组件去获取IP地址

## 其他组件
apt install gpiod i2c-tools lrzsz net-tools usbutils ssh wireless-tools sudo vim openssh-server htop pciutils usbutils acpid -y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-2-配置账号"><a href="#4-2-配置账号" class="headerlink" title="4.2 配置账号#"></a>4.2 配置账号<a href="https://www.cnblogs.com/twzy/p/15160824.html#1.2-%E9%85%8D%E7%BD%AE%E8%B4%A6%E5%8F%B7">#</a></h3><p>修改root登录密码的方式如下</p>
<pre class="line-numbers language-none"><code class="language-none">passwd root<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>添加用户</p>
<pre class="line-numbers language-none"><code class="language-none">groupadd &lt;用户组&gt;
useradd -m -g &lt;用户组&gt; -s /bin/bash &lt;用户名&gt;
passwd &lt;用户名&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h3 id="4-3-新增账号sudo配置"><a href="#4-3-新增账号sudo配置" class="headerlink" title="4.3 新增账号sudo配置#"></a>4.3 新增账号sudo配置<a href="https://www.cnblogs.com/twzy/p/15160824.html#1.3-%E6%96%B0%E5%A2%9E%E8%B4%A6%E5%8F%B7sudo%E9%85%8D%E7%BD%AE">#</a></h3><p>对于出现</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;用户名&gt; is not in the sudoers file.  This incident will be reported.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>切换到超级用户：</p>
<pre class="line-numbers language-none"><code class="language-none">$ su<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>打开<code>/etc/sudoers</code>文件：</p>
<pre class="line-numbers language-none"><code class="language-none"># vi /etc/sudoers<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>修改文件内容<br><a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211018174205921-1211442453.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211018174205921-1211442453.png" alt="img"></a></p>
<p>保存退出</p>
<p>修改主机名，否则将会以当前编译的系统的主机名进行设置(如：笔者为Ubuntu，相当的尴尬)</p>
<pre class="line-numbers language-none"><code class="language-none">HOSTNAME=&lt;你的主机名&gt;
echo $HOSTNAME &gt; /etc/hostname
echo $HOSTNAME &gt; /proc/sys/kernel/hostname
sed -i '/localhost/s/$/\t'"$HOSTNAME"'/g' /etc/hosts



# 设置主机名
HOSTNAME=NanoLinux
echo $HOSTNAME &gt; /etc/hostname
echo $HOSTNAME &gt; /proc/sys/kernel/hostname

# 更新hosts文件
sed -i '/127.0.0.1\s*localhost/s/$/\t'"$HOSTNAME"'/g' /etc/hosts
sed -i '/::1\s*localhost/s/$/\t'"$HOSTNAME"'/g' /etc/hosts

# 或者更安全的方法，直接编辑hosts文件
cat &gt; /etc/hosts &lt;&lt; 'EOF'
127.0.0.1   localhost NanoLinux
::1         localhost NanoLinux ip6-localhost ip6-loopback

# 如果需要，可以添加其他网络配置
# 192.168.1.100  NanoLinux
EOF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-4-配置时区"><a href="#4-4-配置时区" class="headerlink" title="4.4 配置时区#"></a>4.4 配置时区<a href="https://www.cnblogs.com/twzy/p/15160824.html#1.4-%E9%85%8D%E7%BD%AE%E6%97%B6%E5%8C%BA">#</a></h3><p>修改系统默认时区</p>
<pre class="line-numbers language-none"><code class="language-none">cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="4-5-配置SSH"><a href="#4-5-配置SSH" class="headerlink" title="4.5 配置SSH#"></a>4.5 配置SSH<a href="https://www.cnblogs.com/twzy/p/15160824.html#1.5-%E9%85%8D%E7%BD%AEssh">#</a></h3><p>如果要使用SSH服务，并且允许SSH客户端以root方式登录需要进行一下设置。</p>
<pre class="line-numbers language-none"><code class="language-none">nano /etc/ssh/sshd_config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>添加</p>
<pre class="line-numbers language-none"><code class="language-none">PermitRootLogin yes<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="4-6-其他配置"><a href="#4-6-其他配置" class="headerlink" title="4.6 其他配置"></a>4.6 其他配置</h3><h4 id="4-6-1-增加开机自启脚本"><a href="#4-6-1-增加开机自启脚本" class="headerlink" title="4.6.1 增加开机自启脚本"></a>4.6.1 增加开机自启脚本</h4><p>文件系统中的<code>/etc/init.d</code>负责linux的服务的开启和关闭等，为了能使系统开机自动运行一些脚本和命令，这里介绍如何新添加一个自启动项。</p>
<p>首先我们创建一个文件<code>/etc/init.d/runOnBoot</code>，内容如下：</p>
<pre class="line-numbers language-none"><code class="language-none">#!/bin/sh /etc/init.d/runOnBoot
### BEGIN INIT INFO
# Provides: runOnBoot Required-Start: $local_fs $syslog $network
# Required-Stop: $local_fs $syslog $network Default-Start: 2 3 4 5
# Default-Stop: 0 1 6 Short-Description: runOnBoot startup Description:
# runOnBoot auto startup 1.0
### END INIT INFO

#------------------------------------------------------------------------------
swapon /opt/images/swap

mkdir /sys/kernel/config/usb_gadget/gg
cd /sys/kernel/config/usb_gadget/gg
echo "0x0502" &gt; idVendor
echo "0x3235" &gt; idProduct
mkdir functions/rndis.rn0
mkdir configs/c1.1
ln -s functions/rndis.rn0 configs/c1.1/
echo "musb-hdrc.1.auto" &gt; UDC
ifconfig usb0 192.168.137.2
ifconfig usb0 up
route add default gw 192.168.137.1


# Demo to run a script ↓
# script_path=/home/start.sh
# if [ ! -r ${script_path} ]; then
#     echo ${script_path} not existing;
# fi
# . ${myStart_spaddr}

#------------------------------------------------------------------------------<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>给文件添加可执行权限：</p>
<pre class="line-numbers language-none"><code class="language-none">chmod +x /etc/init.d/runOnBoot<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>最后要添加软链接：</p>
<pre class="line-numbers language-none"><code class="language-none">ln -s /etc/init.d/runOnBoot /etc/rc2.d/S99runOnBoot<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p><code>/etc/rc.d/rc0.d/</code>～<code>/etc/rc.d/rc6.d/</code>文件夹的含义不同，S开头代表是开启时处理的脚本，按照后面紧跟的数字进行按顺序启动，S99则是最后进行启动。</p>
</blockquote>
<p>重启即可看到命令和脚本自动执行了。</p>
<h4 id="4-6-2-解决root-fs分区开机后被挂载为Read-Only的问题"><a href="#4-6-2-解决root-fs分区开机后被挂载为Read-Only的问题" class="headerlink" title="4.6.2 解决root-fs分区开机后被挂载为Read-Only的问题"></a>4.6.2 解决root-fs分区开机后被挂载为<em>Read-Only</em>的问题</h4><p>新配置的文件系统需要添加fstab进行对应分区的自动挂载，修改<code>/etc/fstab</code>文件：</p>
<pre class="line-numbers language-none"><code class="language-none"># &lt;file system&gt;	&lt;mount pt&gt;	&lt;type&gt;	&lt;options&gt;	&lt;dump&gt;	&lt;pass&gt;
/dev/root	/		ext2	rw,noauto	0	1
proc		/proc		proc	defaults	0	0
devpts		/dev/pts	devpts	defaults,gid=5,mode=620,ptmxmode=0666	0	0
tmpfs		/dev/shm	tmpfs	mode=0777	0	0
tmpfs		/tmp		tmpfs	mode=1777	0	0
tmpfs		/run		tmpfs	mode=0755,nosuid,nodev	0	0
sysfs		/sys		sysfs	defaults	0	0
/opt/images/swap swap swap defaults 0 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="4-6-3-添加USB-OTG-Gadget-RNDIS功能"><a href="#4-6-3-添加USB-OTG-Gadget-RNDIS功能" class="headerlink" title="4.6.3 添加USB-OTG &amp; Gadget-RNDIS功能"></a>4.6.3 添加USB-OTG &amp; Gadget-RNDIS功能</h4><blockquote>
<p><strong>参考资料：</strong></p>
<ul>
<li><a href="https://whycan.com/t_6242.html">全志平台上通过configfs(libcomposite)配置RNDIS Gadget(u_ether)及Windows下的驱动</a></li>
<li><a href="https://linux-sunxi.org/USB_Gadget/Ethernet#Mainline_kernel_.28via_configfs.29">USB Gadget/Ethernet - linux-sunxi.org</a></li>
<li><a href="https://www.lotlab.org/2018/07/29/record-of-using-licheepi-part-2-using-linux-gadget/">LicheePi入坑记录2——使用 Linux Gadget 复合设备共享网络与虚拟串口 – LotLab</a></li>
</ul>
</blockquote>
<p><strong>USB Gadget</strong>（小饰品），就是指所开发的电子设备以USB-device的模式通过USB连接到主机，比如手机用USB线插入PC后，手机就是USB Gadget。</p>
<p>在本开发板中，可以利用USB Gadget把USB模拟成虚拟网卡、虚拟串口、MTP设备等等非常方便，下面介绍具体的配置方法。</p>
<p><strong>RNDIS功能开发方法：</strong></p>
<p>首先需要在内核中开启了相关选项：</p>
<pre class="line-numbers language-none"><code class="language-none">Device Drivers  ---&gt;
       [*] USB support  ---&gt;
       &lt;M&gt; Inventra Highspeed Dual Role Controller (TI, ADI, AW, ...)
               MUSB Mode Selection (Dual Role mode)  ---&gt;
               *** Platform Glue Layer ***
           &lt;M&gt; Allwinner (sunxi)
               *** MUSB DMA mode ***
           [*] Disable DMA (always use PIO)
       USB Physical Layer drivers  ---&gt;
           &lt;M&gt; NOP USB Transceiver Driver
       &lt;M&gt;   USB Gadget Support  ---&gt;
           &lt;M&gt;   USB Gadget functions configurable through configfs
           [*]     RNDIS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后在文件系统中添加一些配置文件：</p>
<pre class="line-numbers language-none"><code class="language-none">cd /sys/kernel/config/usb_gadget
mkdir gg
cd gg/
echo "0x0502" &gt; idVendor
echo "0x3235" &gt; idProduct
mkdir functions/rndis.rn0
mkdir configs/c1.1
ln -s functions/rndis.rn0 configs/c1.1/
echo "musb-hdrc.1.auto" &gt; UDC<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>启用usb0网卡并设置一个ip地址：</p>
<pre class="line-numbers language-none"><code class="language-none">ifconfig usb0 192.168.137.2
ifconfig usb0 up<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p>这里使用137网段的原因是希望后面通过Windows的网络共享功能让板卡通过USB连上互联网，而Windows的共享网段固定是<code>192.168.137.1</code> 。</p>
</blockquote>
<p>在Windows端安装驱动，手动选择网络适配器，然后添加下面的驱动：</p>
<p><a href="https://camo.githubusercontent.com/aeed230791de077ccfffea18231ebb213b8635108d9a4d3649da6b283a0887de/68747470733a2f2f70656e677a68696875692d6d61726b646f776e2e6f73732d636e2d7368616e676861692e616c6979756e63732e636f6d2f696d672f32303232303430333139323231302e706e67"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/68747470733a2f2f70656e677a68696875692d6d61726b646f776e2e6f73732d636e2d7368616e676861692e616c6979756e63732e636f6d2f696d672f32303232303430333139323231302e706e67" alt="image-20220403192210458"></a></p>
<p>之后会在网络适配器中发现新的网卡设备，配置固定ip如下：</p>
<p><a href="https://camo.githubusercontent.com/68baa5622b7bdde7696220bfd3728bf1acbefba8db09b10820fb4003aa080cc4/68747470733a2f2f70656e677a68696875692d6d61726b646f776e2e6f73732d636e2d7368616e676861692e616c6979756e63732e636f6d2f696d672f32303232303430333139323333352e706e67"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/68747470733a2f2f70656e677a68696875692d6d61726b646f776e2e6f73732d636e2d7368616e676861692e616c6979756e63732e636f6d2f696d672f32303232303430333139323333352e706e67" alt="image-20220403192335548"></a></p>
<p>此时通过ping命令应该可以相互ping通了，但是在板卡上可能还是无法连接互联网，需要配置一下默认网关和DNS服务器：</p>
<pre class="line-numbers language-none"><code class="language-none">route add default gw 192.168.137.1
#但是这样重启以后就不能用了，需要添加到自启脚本中<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>DNS记录在<code>/etc/resolv.conf</code>这个文件里，可以按<code>resolv.conf</code>文件的格式修改DNS。</p>
<pre class="line-numbers language-none"><code class="language-none">nano /etc/resolv.conf

修改为：
nameserver 8.8.8.8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>如果可以ping通<a href="http://www.baidu.com就说明配置完成了./">www.baidu.com就说明配置完成了。</a></p>
<h4 id="4-6-4-启用swap"><a href="#4-6-4-启用swap" class="headerlink" title="4.6.4 启用swap"></a>4.6.4 启用swap</h4><p>芯片的SiP内存只有64MB，大部分情况下都不够用，所以需要开启swap使用内存卡的一部分空间来作为交换内存。</p>
<p>通过free -m来查看下内存使用状况：</p>
<pre class="line-numbers language-none"><code class="language-none"># free -m
              total        used        free      shared  buff/cache   available
Mem:             54          15           6           0          31          34
Swap:             0           0           0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>创建一个自定义的目录<code>/opt/images/</code>：</p>
<pre class="line-numbers language-none"><code class="language-none">mkdir /opt/images/
rm -rf /opt/images/swap<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>创建一个需要内存大小的文件，如512M：</p>
<pre class="line-numbers language-none"><code class="language-none"># dd if=/dev/zero of=/opt/images/swap bs=1024 count=512000
2048000+0 records in
2048000+0 records out
2097152000 bytes (2.1 GB, 2.0 GiB) copied, 30.3635 s, 69.1 MB/s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>把创建的文件变成SWAP分区并启用：</p>
<pre class="line-numbers language-none"><code class="language-none">mkswap /opt/images/swap
swapon /opt/images/swap<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><code>free -m</code>看看SWAP是否生效，ok的话设置开机自动挂载swap：</p>
<pre class="line-numbers language-none"><code class="language-none">nano /etc/fstab

添加一行：
/opt/images/swap swap swap defaults 0 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>进入文件系统并添加压缩包打包相关文件：</p>
<pre class="line-numbers language-none"><code class="language-none">cd rootfs-debian
tar cvf ../rootfs-debian.tar . <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>生成的<code>rootfs-debian.tar</code>任意解压到SD卡的文件系统分区即可。</p>
<p>或者直接插上SD卡拷贝所有文件（需要在VMware宿主机打开终端操作），在挂载的SD卡root-fs磁盘打开终端，输入：</p>
<pre class="line-numbers language-none"><code class="language-none">sudo cp -Rf path/to/rootfs-debian/* ./<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后插上板卡即可启动。</p>
<p>后续配置，在超级用户权限下执行如下两个命令：</p>
<pre class="line-numbers language-none"><code class="language-none">chown root:root /usr/bin/sudo
chmod 4755 /usr/bin/sudo

nano /etc/hosts 
在localhost后面添加一个自己的用户名如pi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-7-rootfs打包"><a href="#4-7-rootfs打包" class="headerlink" title="4.7 rootfs打包#"></a>4.7 rootfs打包<a href="https://www.cnblogs.com/twzy/p/15160824.html#1.6-rootfs%E6%89%93%E5%8C%85">#</a></h3><p>当所有的内容制作完成，就可以清理缓存，打包之后就可以替换你的文件系统了</p>
<pre class="line-numbers language-none"><code class="language-none">apt clean #删除安装包 
exit  #退出chroot
rm rootfs-debian13/usr/bin/qemu-arm-static<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>卸载刚在挂载的文件夹。</p>
<pre class="line-numbers language-none"><code class="language-none">cd rootfs-debian13
sudo umount   dev/pts/
sudo umount   dev/
sudo umount   sys/
sudo umount   proc/
sudo umount   dev/pts/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>打包文件。</p>
<pre class="line-numbers language-none"><code class="language-none"># cd rootfs-debian13  #进到文件系统目录,如果已经在该文件夹下，可以忽略
tar cvf ../rootfs-debian13.tar .    #要注意那个.  代表当前目录<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>生成的rootfs-debian13.tar任意解压到文件系统即可</p>
<h3 id="4-8-使用wpa-supplicant连接wifi"><a href="#4-8-使用wpa-supplicant连接wifi" class="headerlink" title="4.8. 使用wpa_supplicant连接wifi#"></a>4.8. 使用wpa_supplicant连接wifi<a href="https://www.cnblogs.com/twzy/p/15160824.html#2-%E4%BD%BF%E7%94%A8wpa-supplicant%E8%BF%9E%E6%8E%A5wifi">#</a></h3><p>创建配置文件</p>
<pre class="line-numbers language-none"><code class="language-none">vi /etc/wpa_supplicant.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>输入内容：</p>
<pre class="line-numbers language-none"><code class="language-none">network={
  ssid="我的热点"
  psk="我的密码"
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后执行命令</p>
<pre class="line-numbers language-none"><code class="language-none">wpa_supplicant -B -d -i wlan0 -c /etc/wpa_supplicant.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> 示例如下</p>
<pre class="line-numbers language-none"><code class="language-none">root@dika-pc:~# wpa_supplicant -B -i wlan0 -c /etc/wpa_supplicant.conf
Successfully initialized wpa_supplicant
rfkill: Cannot open RFKILL control device
root@dika-pc:~# [  444.817608] wlan0: authenticate with e4:67:1e:02:33:c0
[  444.843208] wlan0: send auth to e4:67:1e:02:33:c0 (try 1/3)
[  444.900867] wlan0: authenticated
[  444.935561] wlan0: associate with e4:67:1e:02:33:c0 (try 1/3)
[  444.986874] wlan0: RX AssocResp from e4:67:1e:02:33:c0 (capab=0x411 status=0 aid=4)
[  445.033483] wlan0: associated
[  446.047125] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
^C<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>执行dhcp命名，获取IP地址</p>
<pre class="line-numbers language-none"><code class="language-none">root@dika-pc:~# udhcpc -i wlan0
udhcpc: started, v1.30.1
udhcpc: sending discover
udhcpc: sending select for 172.16.1.106
udhcpc: lease of 172.16.1.106 obtained, lease time 43200
root@dika-pc:~# ping www.dika.ren
PING www.dika.ren (149.129.80.46) 56(84) bytes of data.
64 bytes from 149.129.80.46: icmp_seq=3 ttl=45 time=217 ms
64 bytes from 149.129.80.46: icmp_seq=4 ttl=45 time=417 ms
64 bytes from 149.129.80.46: icmp_seq=5 ttl=45 time=102 ms
64 bytes from 149.129.80.46: icmp_seq=6 ttl=45 time=108 ms
^C
--- www.dika.ren ping statistics ---
6 packets transmitted, 4 received, 33.3333% packet loss, time 346ms
rtt min/avg/max/mdev = 102.009/211.020/417.367/127.586 ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-9-增加swap分区"><a href="#4-9-增加swap分区" class="headerlink" title="4.9 增加swap分区#"></a>4.9 增加swap分区<a href="https://www.cnblogs.com/twzy/p/15160824.html#3-%E5%A2%9E%E5%8A%A0swap%E5%88%86%E5%8C%BA">#</a></h3><p>在使用一些软件的过程中，会遇到系统崩溃，尤其是使用 apt-get install 的时候，所以需要加入swap分区，可以简单理解为虚拟内存。</p>
<p>使用</p>
<pre class="line-numbers language-none"><code class="language-none">free<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>查看当前swap大小，<br>使用如下命令创建你想要添加swap分区的大小</p>
<pre class="line-numbers language-none"><code class="language-none">dd if=/dev/zero of=/swap1 bs=1M count=512  #改成你要设置的SWAP大小，512就是512MB<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>设置swap分区文件</p>
<pre class="line-numbers language-none"><code class="language-none">mkswap /swap1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>激活swap分区</p>
<pre class="line-numbers language-none"><code class="language-none">swapon /swap1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>此时使用free命令就能看到创建好的swap分区，但这只是临时性的， 重启会失效，需要配置一下，下次开机时候要开swap</p>
<pre class="line-numbers language-none"><code class="language-none">vi /etc/fstab<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>操作，在最后一行添加 </p>
<pre class="line-numbers language-none"><code class="language-none">/swap1 swap swap defaults 0 0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="5-planck-pi操作"><a href="#5-planck-pi操作" class="headerlink" title="5. planck-pi操作"></a>5. planck-pi操作</h2><p>通过串口连接pc进行操作</p>
<h3 id="5-1-修改主机名"><a href="#5-1-修改主机名" class="headerlink" title="5.1 修改主机名"></a>5.1 修改主机名</h3><pre class="line-numbers language-none"><code class="language-none">HOSTNAME=lycraftpi			#lycraftpi可以换成别的名字
echo $HOSTNAME &gt; /etc/hostname
echo $HOSTNAME &gt; /proc/sys/kernel/hostname
sed -i '/localhost/s/$/\t'"$HOSTNAME"'/g' /etc/hosts
# 查看Debian版本号
cat /etc/os-release<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="5-2-配置永久静态ip"><a href="#5-2-配置永久静态ip" class="headerlink" title="5.2 配置永久静态ip"></a>5.2 配置永久静态ip</h3><pre class="line-numbers language-none"><code class="language-none">vim /etc/network/interfaces

# 添加以下内容
allow-hotplug usb0
auto usb0
iface usb0 inet static
address 192.168.2.100
netmask 255.255.255.0
gateway 192.168.2.1

# 启用网卡
ifup usb0

# 开机自启
vim /etc/init.d/rcS

# 添加以下内容
ifup lo
ifup usb0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>配置DNS</p>
<pre class="line-numbers language-none"><code class="language-none">vim /etc/resolv.conf
# 在nameserver下添加
nameserver 223.5.5.5		#阿里的DNS<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="6-PC上的操作"><a href="#6-PC上的操作" class="headerlink" title="6. PC上的操作"></a>6. PC上的操作</h2><h3 id="6-1-linux虚拟机ssh连接pi"><a href="#6-1-linux虚拟机ssh连接pi" class="headerlink" title="6.1 linux虚拟机ssh连接pi"></a>6.1 linux虚拟机ssh连接pi</h3><pre class="line-numbers language-none"><code class="language-none">sudo vim /etc/network/interfaces

# 添加以下内容
allow-hotplug ens35u1
auto ens35u1
iface ens35u1 inet static
address 192.168.2.1
netmask 255.255.255.0

# 重启下

# 输入以下指令后planckpi就可以上网了
echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward &gt; /dev/null
sudo iptables -P FORWARD ACCEPT
sudo iptables -A POSTROUTING -t nat -j MASQUERADE -s 192.168.2.0/24<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>接下来通过ssh连接到planckpi玩耍吧</p>
<pre class="line-numbers language-none"><code class="language-none">ssh root@192.168.2.100

ping www.baidu.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="6-2-Windows下ssh连接pi"><a href="#6-2-Windows下ssh连接pi" class="headerlink" title="6.2 Windows下ssh连接pi"></a>6.2 Windows下ssh连接pi</h3><p>~待填坑</p>
<h1 id="3-简化命令"><a href="#3-简化命令" class="headerlink" title="3. 简化命令"></a>3. 简化命令</h1><pre class="line-numbers language-none"><code class="language-none">sudo docker pull ubuntu:latest
sudo docker run -it --name F1C200s_env --network host \
-p 8022:22 \
-v /tmp/F1C200s_env/workspace:/workspace \
--privileged \
ubuntu:latest

sed -i 's@//.*archive.ubuntu.com@//mirrors.aliyun.com@g' /etc/apt/sources.list
sed -i 's@//.*security.ubuntu.com@//mirrors.aliyun.com@g' /etc/apt/sources.list

apt update
apt install sudo wget git unzip -y
apt install libncurses-dev gcc gcc-arm-linux-gnueabi make bison flex bc libssl-dev python3 python3-setuptools python3-dev swig bzip2 file g++ cpio rsync -y

workspace_path=/workspace
cd ~/

export ARCH=arm CROSS_COMPILE=arm-linux-gnueabi-<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


<h2 id="3-1-uboot"><a href="#3-1-uboot" class="headerlink" title="3.1.uboot"></a>3.1.uboot</h2><pre class="line-numbers language-none"><code class="language-none">git clone --depth=1 https://github.com/u-boot/u-boot.git
cd u-boot
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- licheepi_nano_defconfig
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- menuconfig
#load mmc 0:1 0x80008000 zImage;load mmc 0:1 0x80c08000 suniv-f1c100s-licheepi-nano.dtb;bootz 0x80008000 - 0x80c08000;
#console=ttyS0,115200 panic=5 rootwait root=/dev/mmcblk0p2 earlyprintk rw
make -j $(nproc)
cp u-boot-sunxi-with-spl.bin  ${workspace_path}/
sudo dd if=/tmp/F1C200s_env/workspace/u-boot-sunxi-with-spl.bin of=/dev/sdb bs=1024 seek=8<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3-2-linux"><a href="#3-2-linux" class="headerlink" title="3.2.linux"></a>3.2.linux</h2><pre class="line-numbers language-none"><code class="language-none">git clone --depth=1 https://mirrors.tuna.tsinghua.edu.cn/git/linux.git

wget https://files.cnblogs.com/files/twzy/linux-licheepi_nano_defconfig.zip
unzip linux-licheepi_nano_defconfig.zip
cp linux-licheepi_nano_defconfig linux/arch/arm/configs/
cd linux 

make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- linux-licheepi_nano_defconfig
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- menuconfig
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- -j $(nproc)

cp arch/arm/boot/zImage ${workspace_path}/
cp arch/arm/boot/dts/allwinner/suniv-f1c100s-licheepi-nano.dtb ${workspace_path}/
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3-3-1-busybox"><a href="#3-3-1-busybox" class="headerlink" title="3.3.1 busybox"></a>3.3.1 busybox</h2><pre class="line-numbers language-none"><code class="language-none">git clone --depth=1 git://busybox.net/busybox.git
cd busybox
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- menuconfig

#Settings ----&gt;
	Build Options      [*]Build static binary(no shared libs)
	
	
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- -j $(nproc)
make install
cd _install

mkdir etc dev mnt tmp sys proc root

cat &gt;etc/fstab &lt;&lt;EOF
proc        /proc           proc        defaults        0        0
tmpfs       /tmp            tmpfs       defaults        0        0
sysfs       /sys            sysfs       defaults        0        0
EOF

mkdir -p etc/init.d/

cat &gt;etc/init.d/rcS &lt;&lt;EOF
echo -e "Welcome to nanoLinux"
/bin/mount -a
echo -e "Remounting the root filesystem"
mount  -o  remount,rw  /
mkdir -p /dev/pts
mount -t devpts devpts /dev/pts
echo /sbin/mdev &gt; /proc/sys/kernel/hotplug
mdev -s
EOF
chmod 755 etc/init.d/rcS 

cat &gt;etc/inittab &lt;&lt;EOF
::sysinit:/etc/init.d/rcS
::respawn:-/bin/sh
::askfirst:-/bin/sh
::ctrlaltdel:/bin/umount -a -r
EOF
chmod 755 etc/inittab

mknod dev/console c 5 1
mknod dev/null c 1 3
mknod dev/tty1 c 4 1 

dd if=/dev/zero of=root/swap bs=1M count=512
mkswap root/swap
swapon root/swap

echo "/root/swap swap swap defaults 0 0" &gt;&gt; etc/fstab


cd /home/hhhh/Downloads/Planck-Pi/buildroot/linux
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- modules_install INSTALL_MOD_PATH=${workspace_path}/

tar -czvf rootfs.tar.gz *
mv rootfs.tar.gz ${workspace_path}/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="3-3-2-buildroot"><a href="#3-3-2-buildroot" class="headerlink" title="3.3.2 buildroot"></a>3.3.2 buildroot</h2><pre class="line-numbers language-none"><code class="language-none">git clone --depth=1 https://github.com/buildroot/buildroot.git
cd buildroot
cat &gt;configs/nano_linux_defconfig &lt;&lt;EOF
BR2_arm=y
BR2_PACKAGE_GLIBC_UTILS=y
BR2_TOOLCHAIN_BUILDROOT_CXX=y
BR2_PACKAGE_HOST_GDB=y
BR2_CCACHE=y
BR2_ENABLE_LTO=y
BR2_TARGET_GENERIC_HOSTNAME="nanoLinux"
BR2_TARGET_GENERIC_ISSUE="Welcome to Buildroot for the NanoLinux"
BR2_TARGET_GENERIC_GETTY_PORT="ttyS0"
BR2_TARGET_GENERIC_GETTY_BAUDRATE_115200=y
BR2_SYSTEM_ENABLE_NLS=y
BR2_TARGET_TZ_INFO=y
BR2_PACKAGE_BZIP2=y
BR2_PACKAGE_ZIP=y
BR2_PACKAGE_LIBGPIOD=y
BR2_PACKAGE_LIBGPIOD_TOOLS=y
BR2_PACKAGE_LIBEVENT=y
BR2_PACKAGE_LRZSZ=y
BR2_PACKAGE_OPENSSH=y
BR2_PACKAGE_RSYNC=y
BR2_PACKAGE_SUDO=y
BR2_PACKAGE_NANO=y
EOF
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- nano_linux_defconfig
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- -j $(nproc)
cp output/images/rootfs.tar ${workspace_path}/


modprobe sunxi
modprobe configfs
modprobe libcomposite
modprobe u_ether
modprobe usb_f_rndis
mount -t configfs none /sys/kernel/config/

cd /sys/kernel/config/usb_gadget
mkdir g1
cd g1
echo "0x1d6b" &gt; idVendor
echo "0x0104" &gt; idProduct
mkdir functions/rndis.rn0
mkdir configs/c1.1
ln -s functions/rndis.rn0 configs/c1.1/
echo "musb-hdrc.1.auto" &gt; UDC

ifconfig usb0 up
ifconfig usb0 192.168.137.2 netmask 255.255.255.0
route add default gw 192.168.137.1
mkdir /uboot
mount /dev/mmcblk0p1 /uboot

#include &lt;dt-bindings/gpio/gpio.h&gt;
#include &lt;dt-bindings/leds/common.h&gt;
leds {
    compatible = "gpio-leds";

    led-0 {
        function = LED_FUNCTION_STATUS;
        color = &lt;LED_COLOR_ID_GREEN&gt;;
        gpios = &lt;&amp;pio 4 6 GPIO_ACTIVE_LOW&gt;; /* PE6 */
        linux,default-trigger = "heartbeat";
    };

};<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="3-4-Debian"><a href="#3-4-Debian" class="headerlink" title="3.4 Debian"></a>3.4 Debian</h2><pre class="line-numbers language-none"><code class="language-none">apt update
apt install debootstrap qemu-user-static 
mkdir rootfs

debootstrap --foreign --verbose --arch=armel bookworm rootfs http://mirrors.huaweicloud.com/debian/
cd rootfs
mount --bind /dev dev/
mount --bind /sys sys/
mount --bind /proc proc/
mount --bind /dev/pts dev/pts/
cd ..
cp /usr/bin/qemu-arm-static rootfs/usr/bin/
chmod +x rootfs/usr/bin/qemu-arm-static
LC_ALL=C LANGUAGE=C LANG=C chroot rootfs /debootstrap/debootstrap --second-stage --verbose
LC_ALL=C LANGUAGE=C LANG=C chroot rootfs

apt install gpiod i2c-tools lrzsz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="4-点个灯吧"><a href="#4-点个灯吧" class="headerlink" title="4. 点个灯吧#"></a>4. 点个灯吧<a href="https://www.cnblogs.com/twzy/p/15355842.html#3.-%E7%82%B9%E4%B8%AA%E7%81%AF%E5%90%A7">#</a></h1><p>还记得我们在第一篇中提到过的我们自制小开发板的唯一的那个外设——LED灯吗？</p>
<p>那我们就利用Linux提供的GPIO系统通过shell命令进行点灯实验吧。</p>
<p>我们首先需要回到文件系统制作菜单</p>
<pre class="line-numbers language-none"><code class="language-none">Device Drivers -&gt; 
        GPIO Support -&gt;
                /sys/class/gpio/… (sysfs interface)。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>按如下方式进行配置，然后编译完rootfs，重新写入小板</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009173731029-1575334130.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211009173731029-1575334130.png" alt="img"></a></p>
<p> <a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009163731073-1479927383.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211009163731073-1479927383.png" alt="img"></a></p>
<p>通过硬件可知LED灯连接的是<strong>PE6</strong>接口，低电平亮灯</p>
<p>这里我们先要了解一下GPIO编号和值的计算方式</p>
<blockquote>
<p>引脚编号 = 控制引脚的寄存器基数 + 控制引脚寄存器位数<br>批注：<br>引脚编号是gpiochipxxx下的base + 第几个GPIO，也就是base加偏移，偏移的是位数。<br>例如gpiochip34 下的第1个GPIO那么编号就是34 + 1 = 35</p>
</blockquote>
<p>对于F1C200S/F1C100S这里：A=0、B=1、C=2D=3、E=4 ……、32是固定值、6就是偏移量</p>
<p>举个栗子（如果使想用 PE6，那么引脚编号就可能等于 4 x 32 + 6 = 134。</p>
<p>这是一些参考命令</p>
<pre class="line-numbers language-none"><code class="language-none"># 1、导出
echo 134 &gt; /sys/class/gpio/export
# 2、设置方向
echo out &gt; /sys/class/gpio/gpio134/direction
# 3、查看方向
cat /sys/class/gpio/gpio134/direction
# 4、设置输出（对于LED 设置1 为高电平即LED灯灭，设置0 为低电平，LED灯亮）
echo 1 &gt; /sys/class/gpio/gpio134/value
# 5、查看输出值
cat /sys/class/gpio/gpio134/value
# 6、取消导出
echo 134 &gt; /sys/class/gpio/unexport<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输入如下命令：</p>
<pre class="line-numbers language-none"><code class="language-none">echo 134 &gt; /sys/class/gpio/export
echo out &gt; /sys/class/gpio/gpio134/direction # 灯亮 （默认设置为高电平）
echo 0 &gt; /sys/class/gpio/gpio134/value        # 灯灭 
echo 1 &gt; /sys/class/gpio/gpio134/value        # 灯亮

echo 134 &gt; /sys/class/gpio/unexport<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>效果如下：</p>
<p><a href="https://img2020.cnblogs.com/blog/483434/202110/483434-20211009173632837-1965450968.png"><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/483434-20211009173632837-1965450968.png" alt="img"></a></p>
<p> 我们这里借助Linux内建的GPIO子系统进行了电灯实验，但是真正Linux灵魂点灯是要通过驱动方式来实现的，但是谁让我是小白呢，以后再说吧。</p>
<h1 id="5-OLED屏"><a href="#5-OLED屏" class="headerlink" title="5. OLED屏"></a>5. OLED屏</h1><pre><code>i2cset -y 0 0x3c 0x00 0xae
i2cset -y 0 0x3c 0x00 0x00
i2cset -y 0 0x3c 0x00 0x10
i2cset -y 0 0x3c 0x00 0x20
i2cset -y 0 0x3c 0x00 0x81
i2cset -y 0 0x3c 0x00 0x6f
i2cset -y 0 0x3c 0x00 0xa0
i2cset -y 0 0x3c 0x00 0xc0
i2cset -y 0 0x3c 0x00 0xa4
i2cset -y 0 0x3c 0x00 0xa6
i2cset -y 0 0x3c 0x00 0xd5
i2cset -y 0 0x3c 0x00 0x91
i2cset -y 0 0x3c 0x00 0xd9
i2cset -y 0 0x3c 0x00 0x22
i2cset -y 0 0x3c 0x00 0xdb
i2cset -y 0 0x3c 0x00 0x3f
i2cset -y 0 0x3c 0x00 0xa8
i2cset -y 0 0x3c 0x00 0x4f
i2cset -y 0 0x3c 0x00 0xd3
i2cset -y 0 0x3c 0x00 0x68
i2cset -y 0 0x3c 0x00 0xdc
i2cset -y 0 0x3c 0x00 0x00
i2cset -y 0 0x3c 0x00 0xad
i2cset -y 0 0x3c 0x00 0x8a
i2cset -y 0 0x3c 0x00 0xaf
i2cset -y 0 0x3c 0x00 0xaf
</code></pre>
<pre><code>OLED_WR_Byte(0xAE,OLED_CMD); /*display off*/
OLED_WR_Byte(0x00,OLED_CMD); /*set lower column address*/
OLED_WR_Byte(0x10,OLED_CMD); /*set higher column address*/
OLED_WR_Byte(0x20,OLED_CMD); /* Set Memory addressing mode (0x20/0x21) */
OLED_WR_Byte(0x81,OLED_CMD); /*contract control*/
OLED_WR_Byte(0x6f,OLED_CMD); /*b0*/
OLED_WR_Byte(0xA0,OLED_CMD); /*set segment remap*/
OLED_WR_Byte(0xC0,OLED_CMD); /*Com scan direction*/
OLED_WR_Byte(0xA4,OLED_CMD); /*Disable Entire Display On (0xA4/0xA5)*/
OLED_WR_Byte(0xA6,OLED_CMD); /*normal / reverse*/
OLED_WR_Byte(0xD5,OLED_CMD); /*set osc division*/
OLED_WR_Byte(0x91,OLED_CMD);
OLED_WR_Byte(0xD9,OLED_CMD); /*set pre-charge period*/
OLED_WR_Byte(0x22,OLED_CMD);
OLED_WR_Byte(0xdb,OLED_CMD); /*set vcomh*/
OLED_WR_Byte(0x3f,OLED_CMD);
OLED_WR_Byte(0xA8,OLED_CMD); /*multiplex ratio*/
OLED_WR_Byte(0x4F,OLED_CMD); /*duty = 1/80*/
OLED_WR_Byte(0xD3,OLED_CMD); /*set display offset*/
OLED_WR_Byte(0x68,OLED_CMD); /*18*/
OLED_WR_Byte(0xdc,OLED_CMD); /*Set Display Start Line*/
OLED_WR_Byte(0x00,OLED_CMD);
OLED_WR_Byte(0xad,OLED_CMD); /*set charge pump enable*/
OLED_WR_Byte(0x8a,OLED_CMD); /*Set DC-DC enable (a=0:disable; a=1:enable) */
OLED_WR_Byte(0xAF,OLED_CMD); /*display ON*/ 
</code></pre>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
  <entry>
    <title>Rosetta全面使用指南</title>
    <url>/2025/11/06/rosetta/</url>
    <content><![CDATA[<h2 id="Rosetta全面使用指南"><a href="#Rosetta全面使用指南" class="headerlink" title="Rosetta全面使用指南"></a>Rosetta全面使用指南</h2><blockquote>
<p>转载自：<a href="https://www.jianshu.com/p/d96a72d06e26">https://www.jianshu.com/p/d96a72d06e26</a></p>
</blockquote>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Rosetta是由华盛顿大学Baker实验室开发的一套用于计算蛋白质结构建模和设计的软件套件。</p>
<p>Rosetta软件套件包括用于蛋白质结构计算建模和分析的算法。它使计算生物学取得了显著的科学进步，包括从头蛋白质设计、酶设计、配体对接以及生物大分子和大分子复合物的结构预测。</p>
<p>RoeTeta开发始于华盛顿大学David Baker博士的实验室，作为结构预测工具，但此后已经适应于解决常见的计算大分子问题。</p>
<p>Rosetta的重要作用如下所示：</p>
<p>理解大分子相互作用; 设计定制分子; 寻找构象和序列空间的有效方法; 为各种生物分子表示寻找广泛有用的能量函数</p>
<h2 id="安装准备"><a href="#安装准备" class="headerlink" title="安装准备"></a>安装准备</h2><h3 id="1-获取许可证"><a href="#1-获取许可证" class="headerlink" title="1. 获取许可证"></a>1. 获取许可证</h3><ul>
<li><strong>学术许可证</strong>:<ul>
<li>访问 <a href="https://rosettacommons.org/software/download/">Rosetta Commons官网</a></li>
<li>填写学术许可申请表格</li>
<li>等待审核邮件，通常1-3个工作日</li>
</ul>
</li>
<li><strong>商业许可证</strong>:<ul>
<li>联系 <a href="https://www.rosettacommons.org/commercial">Rosetta Design Group</a></li>
<li>了解定价和协议条款</li>
</ul>
</li>
</ul>
<h3 id="2-系统要求"><a href="#2-系统要求" class="headerlink" title="2. 系统要求"></a>2. 系统要求</h3><ul>
<li>计算机配置推荐<ul>
<li>处理器: 至少Intel i5以上或AMD同等性能</li>
<li>内存: 最低8GB，推荐16GB以上</li>
<li>存储空间: 至少20GB可用空间</li>
<li>操作系统: Windows 10/11 (64位)</li>
</ul>
</li>
</ul>
<h3 id="3-Linux系统准备"><a href="#3-Linux系统准备" class="headerlink" title="3. Linux系统准备"></a>3. Linux系统准备</h3><p>Rosetta主要设计用于Unix/Linux环境。</p>
<h2 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h2><p>以下步骤基于Ubuntu环境:</p>
<h3 id="1-安装依赖项"><a href="#1-安装依赖项" class="headerlink" title="1. 安装依赖项"></a>1. 安装依赖项</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 更新软件源</span>
<span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> upgrade <span class="token parameter variable">-y</span>

<span class="token comment"># 安装编译工具和依赖库</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> build-essential scons zlib1g-dev libxml2-dev python-is-python3 python3-dev python3-pip <span class="token function">git</span> cmake<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-下载并解压Rosetta"><a href="#2-下载并解压Rosetta" class="headerlink" title="2. 下载并解压Rosetta"></a>2. 下载并解压Rosetta</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 将下载的源代码包移至主目录</span>
<span class="token function">cp</span> /mnt/c/Users/YourUsername/Downloads/rosetta_src_20XX.XX.XXXXX.tgz ~/

<span class="token comment"># 解压源代码包</span>
<span class="token function">tar</span> <span class="token parameter variable">-xvzf</span> rosetta_src_20XX.XX.XXXXX.tgz

<span class="token comment"># 创建符号链接(可选)</span>
<span class="token function">ln</span> <span class="token parameter variable">-s</span> rosetta_src_20XX.XX.XXXXX rosetta<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-编译Rosetta"><a href="#3-编译Rosetta" class="headerlink" title="3. 编译Rosetta"></a>3. 编译Rosetta</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 进入源代码目录</span>
<span class="token builtin class-name">cd</span> ~/rosetta/main/source

<span class="token comment"># 使用scons编译(使用4个线程，可根据CPU核心数调整)</span>
./scons.py <span class="token parameter variable">-j4</span> <span class="token assign-left variable">mode</span><span class="token operator">=</span>release bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>编译过程通常需要1-2小时，取决于计算机性能。</p>
<h3 id="4-设置环境变量"><a href="#4-设置环境变量" class="headerlink" title="4. 设置环境变量"></a>4. 设置环境变量</h3><p>编辑<code>~/.bashrc</code>文件:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nano</span> ~/.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>添加以下内容:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Rosetta环境变量</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ROSETTA3</span><span class="token operator">=~</span>/rosetta
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:~/rosetta/main/source/bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ROSETTA_DB</span><span class="token operator">=~</span>/rosetta/main/database<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>应用更改:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> ~/.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="5-测试安装"><a href="#5-测试安装" class="headerlink" title="5. 测试安装"></a>5. 测试安装</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 检查版本</span>
~/rosetta/main/source/bin/score_jd2.default.linuxgccrelease <span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token parameter variable">-help</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>如果输出Rosetta版本信息和帮助文档，说明安装成功。</p>
<h2 id="基础功能"><a href="#基础功能" class="headerlink" title="基础功能"></a>基础功能</h2><h3 id="1-文件系统结构"><a href="#1-文件系统结构" class="headerlink" title="1. 文件系统结构"></a>1. 文件系统结构</h3><p>Rosetta的主要目录结构:</p>
<ul>
<li><strong>bin/</strong>: 编译后的可执行程序</li>
<li><strong>database/</strong>: 包含评分函数、旋转异构体库和其他数据</li>
<li><strong>demo/</strong>: 演示程序和示例</li>
<li><strong>scripts/</strong>: 实用脚本</li>
<li><strong>src/</strong>: 源代码</li>
</ul>
<h3 id="2-命令行结构"><a href="#2-命令行结构" class="headerlink" title="2. 命令行结构"></a>2. 命令行结构</h3><p>Rosetta命令通常遵循以下格式:</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css">application_name.executable_type.platform -database path_to_database [options]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>例如:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">score_jd2.default.linuxgccrelease <span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token parameter variable">-s</span> input.pdb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>其中:</p>
<ul>
<li><code>score_jd2</code> - 应用程序名称</li>
<li><code>default</code> - 编译选项</li>
<li><code>linuxgccrelease</code> - 平台</li>
<li><code>-database</code> - 指定数据库路径的标志</li>
<li><code>-s</code> - 指定输入结构的标志</li>
</ul>
<h3 id="3-常用命令行选项"><a href="#3-常用命令行选项" class="headerlink" title="3. 常用命令行选项"></a>3. 常用命令行选项</h3><ul>
<li><code>-database</code>: 指定Rosetta数据库路径</li>
<li><code>-s</code>: 指定输入结构文件</li>
<li><code>-in:file:fasta</code>: 指定输入序列文件</li>
<li><code>-nstruct</code>: 生成的结构数量</li>
<li><code>-out:file:scorefile</code>: 输出得分文件名</li>
<li><code>-out:path</code>: 输出目录</li>
<li><code>-out:pdb</code>: 输出PDB文件</li>
<li><code>-ex1</code>, <code>-ex2</code>: 使用额外的旋转异构体构象</li>
<li><code>-use_input_sc</code>: 使用输入结构的侧链构象</li>
<li><code>-relax:fast</code>: 使用快速弛豫算法</li>
<li><code>-overwrite</code>: 覆盖现有输出文件</li>
</ul>
<h2 id="核心应用程序"><a href="#核心应用程序" class="headerlink" title="核心应用程序"></a>核心应用程序</h2><h3 id="Structure-Prediction-结构预测"><a href="#Structure-Prediction-结构预测" class="headerlink" title="Structure Prediction (结构预测)"></a>Structure Prediction (结构预测)</h3><h4 id="1-Ab-initio结构预测"><a href="#1-Ab-initio结构预测" class="headerlink" title="1. Ab initio结构预测"></a>1. Ab initio结构预测</h4><p>从氨基酸序列预测蛋白质三维结构:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 准备fasta文件 (example.fasta)</span>
<span class="token builtin class-name">echo</span> <span class="token string">"&gt;target_protein"</span> <span class="token operator">&gt;</span> example.fasta
<span class="token builtin class-name">echo</span> <span class="token string">"MKVSHPLLMGMAFAYDIILCLTIFMGPDLLNSA"</span> <span class="token operator">&gt;&gt;</span> example.fasta

<span class="token comment"># 运行Ab initio预测</span>
~/rosetta/main/source/bin/AbinitioRelax.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
-in:file:fasta example.fasta <span class="token punctuation">\</span>
<span class="token parameter variable">-abinitio:relax</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">5</span> <span class="token punctuation">\</span>
-out:file:silent abinitio_results.out<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>选项说明:</p>
<ul>
<li><code>-abinitio:relax</code>: 在预测后进行弛豫优化</li>
<li><code>-nstruct 5</code>: 生成5个预测结构</li>
<li><code>-out:file:silent</code>: 以二进制格式保存结果</li>
</ul>
<h4 id="2-片段组装"><a href="#2-片段组装" class="headerlink" title="2. 片段组装"></a>2. 片段组装</h4><p>Ab initio预测需要片段库，可以使用Robetta服务器或本地生成:</p>
<p><strong>使用Robetta服务器</strong>:</p>
<ol>
<li>访问<a href="https://links.jianshu.com/go?to=http://robetta.bakerlab.org/">Robetta服务器</a></li>
<li>提交序列并下载片段库</li>
<li>将片段库(3mer和9mer)放在工作目录中</li>
</ol>
<p><strong>本地生成片段</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/fragment_picker.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
-in:file:fasta example.fasta <span class="token punctuation">\</span>
<span class="token parameter variable">-frags:n_frags</span> <span class="token number">200</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-frags:n_candidates</span> <span class="token number">2000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3-同源建模-Comparative-Modeling"><a href="#3-同源建模-Comparative-Modeling" class="headerlink" title="3. 同源建模 (Comparative Modeling)"></a>3. 同源建模 (Comparative Modeling)</h4><p>当有同源模板时，可以使用比较建模:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/comparative_modeling.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
-in:file:fasta target.fasta <span class="token punctuation">\</span>
-in:file:alignment alignment.aln <span class="token punctuation">\</span>
-in:file:template_pdb template.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-loops:build_terminal_loops</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="4-混合建模-Hybrid-Modeling"><a href="#4-混合建模-Hybrid-Modeling" class="headerlink" title="4. 混合建模 (Hybrid Modeling)"></a>4. 混合建模 (Hybrid Modeling)</h4><p>当有部分结构信息时:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/RosettaCM.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-cm:aln</span> alignment.aln <span class="token punctuation">\</span>
<span class="token parameter variable">-cm:align_formats</span> grishin <span class="token punctuation">\</span>
-in:file:fasta target.fasta <span class="token punctuation">\</span>
<span class="token parameter variable">-out:nstruct</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Protein-Design-蛋白质设计"><a href="#Protein-Design-蛋白质设计" class="headerlink" title="Protein Design (蛋白质设计)"></a>Protein Design (蛋白质设计)</h3><h4 id="1-固定骨架设计-Fixed-Backbone-Design"><a href="#1-固定骨架设计-Fixed-Backbone-Design" class="headerlink" title="1. 固定骨架设计 (Fixed Backbone Design)"></a>1. 固定骨架设计 (Fixed Backbone Design)</h4><p>保持骨架不变，优化侧链:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建resfile指定设计位点</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> design.resfile <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
NATAA
start
10 A ALLAA
11 A PIKAA YFWL
12 A NATRO
EOF</span>

<span class="token comment"># 运行设计</span>
~/rosetta/main/source/bin/fixbb.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> input.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-resfile</span> design.resfile <span class="token punctuation">\</span>
<span class="token parameter variable">-ex1</span> <span class="token parameter variable">-ex2</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>resfile说明:</p>
<ul>
<li><code>NATAA</code>: 默认保持原始氨基酸</li>
<li><code>ALLAA</code>: 允许所有20种氨基酸</li>
<li><code>PIKAA YFWL</code>: 仅允许Y,F,W,L四种氨基酸</li>
<li><code>NATRO</code>: 不重新打包，保持原始构象</li>
</ul>
<h4 id="2-侧链重打包-Side-chain-Repacking"><a href="#2-侧链重打包-Side-chain-Repacking" class="headerlink" title="2. 侧链重打包 (Side-chain Repacking)"></a>2. 侧链重打包 (Side-chain Repacking)</h4><p>优化侧链构象而不改变氨基酸类型:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/fixbb.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> input.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-suffix</span> _repacked <span class="token punctuation">\</span>
<span class="token parameter variable">-packing:ex1</span> <span class="token parameter variable">-packing:ex2</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-packing:repack_only</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3-弛豫-Relax"><a href="#3-弛豫-Relax" class="headerlink" title="3. 弛豫 (Relax)"></a>3. 弛豫 (Relax)</h4><p>对结构进行能量最小化:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/relax.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> input.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-relax:fast</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-out:suffix</span> _relaxed <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Docking-分子对接"><a href="#Docking-分子对接" class="headerlink" title="Docking (分子对接)"></a>Docking (分子对接)</h3><h4 id="1-蛋白质-蛋白质对接"><a href="#1-蛋白质-蛋白质对接" class="headerlink" title="1. 蛋白质-蛋白质对接"></a>1. 蛋白质-蛋白质对接</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/docking_protocol.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> complex.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-partners</span> A_B <span class="token punctuation">\</span>
<span class="token parameter variable">-dock_ppk</span> <span class="token punctuation">\</span>
-out:file:scorefile docking_scores.sc <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>选项说明:</p>
<ul>
<li><code>-partners A_B</code>: 指定对接的链</li>
<li><code>-dock_ppk</code>: 使用预打包的蛋白质</li>
<li><code>-nstruct 100</code>: 生成100个对接构象</li>
</ul>
<h4 id="2-局部对接-Local-Docking"><a href="#2-局部对接-Local-Docking" class="headerlink" title="2. 局部对接 (Local Docking)"></a>2. 局部对接 (Local Docking)</h4><p>当已知大致结合位置:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/docking_protocol.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> complex.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-partners</span> A_B <span class="token punctuation">\</span>
<span class="token parameter variable">-docking:local_refine</span> <span class="token punctuation">\</span>
-out:file:scorefile local_docking.sc <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">50</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3-蛋白质-配体对接"><a href="#3-蛋白质-配体对接" class="headerlink" title="3. 蛋白质-配体对接"></a>3. 蛋白质-配体对接</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 首先准备配体文件</span>
~/rosetta/main/source/scripts/python/public/molfile_to_params.py <span class="token punctuation">\</span>
<span class="token parameter variable">-n</span> LIG <span class="token parameter variable">-p</span> LIG --conformers-in-one-file ligand.mol2

<span class="token comment"># 运行对接</span>
~/rosetta/main/source/bin/ligand_docking.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> protein_with_ligand.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-extra_res_fa</span> LIG.params <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">100</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-out:suffix</span> _dock<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Loop-Modeling-环建模"><a href="#Loop-Modeling-环建模" class="headerlink" title="Loop Modeling (环建模)"></a>Loop Modeling (环建模)</h3><h4 id="1-基础环建模"><a href="#1-基础环建模" class="headerlink" title="1. 基础环建模"></a>1. 基础环建模</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建loops文件指定要重建的环区域</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> loops.txt <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
LOOP 25 35 0 0 0
LOOP 78 86 0 0 0
EOF</span>

<span class="token comment"># 运行环建模</span>
~/rosetta/main/source/bin/loopmodel.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> input.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-loops:input_loops</span> loops.txt <span class="token punctuation">\</span>
<span class="token parameter variable">-loops:remodel</span> quick_ccd <span class="token punctuation">\</span>
<span class="token parameter variable">-loops:refine</span> refine_ccd <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>loops文件格式说明:</p>
<ul>
<li>第一列: LOOP关键字</li>
<li>第二列: 环起始残基号</li>
<li>第三列: 环终止残基号</li>
<li>后三列: 环的切割点，闭合点和构象设置（一般为0）</li>
</ul>
<h4 id="2-环优化-Loop-Refinement"><a href="#2-环优化-Loop-Refinement" class="headerlink" title="2. 环优化 (Loop Refinement)"></a>2. 环优化 (Loop Refinement)</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/loopmodel.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> input.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-loops:input_loops</span> loops.txt <span class="token punctuation">\</span>
<span class="token parameter variable">-loops:refine</span> refine_kic <span class="token punctuation">\</span>
<span class="token parameter variable">-ex1</span> <span class="token parameter variable">-ex2</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">20</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3-无模板环建模"><a href="#3-无模板环建模" class="headerlink" title="3. 无模板环建模"></a>3. 无模板环建模</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/loopmodel.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> input.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-loops:input_loops</span> loops.txt <span class="token punctuation">\</span>
<span class="token parameter variable">-loops:extended</span> <span class="token boolean">true</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-loops:build_initial</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-loops:remodel</span> perturb_ccd <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">50</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Membrane-Proteins-膜蛋白"><a href="#Membrane-Proteins-膜蛋白" class="headerlink" title="Membrane Proteins (膜蛋白)"></a>Membrane Proteins (膜蛋白)</h3><h4 id="1-膜蛋白弛豫"><a href="#1-膜蛋白弛豫" class="headerlink" title="1. 膜蛋白弛豫"></a>1. 膜蛋白弛豫</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建span文件定义跨膜区域</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> membrane.span <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
TM region 10 30
TM region 50 70
TM region 90 110
EOF</span>

<span class="token comment"># 运行膜蛋白弛豫</span>
~/rosetta/main/source/bin/mp_relax.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> membrane_protein.pdb <span class="token punctuation">\</span>
-mp:setup:spanfiles membrane.span <span class="token punctuation">\</span>
-mp:scoring:hbond <span class="token punctuation">\</span>
<span class="token parameter variable">-relax:fast</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-膜蛋白设计"><a href="#2-膜蛋白设计" class="headerlink" title="2. 膜蛋白设计"></a>2. 膜蛋白设计</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/mp_design.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> membrane_protein.pdb <span class="token punctuation">\</span>
-mp:setup:spanfiles membrane.span <span class="token punctuation">\</span>
<span class="token parameter variable">-resfile</span> design.resfile <span class="token punctuation">\</span>
-mp:lipids:composition DLPC <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3-膜蛋白组装"><a href="#3-膜蛋白组装" class="headerlink" title="3. 膜蛋白组装"></a>3. 膜蛋白组装</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/mp_fold.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
-in:file:fasta membrane_protein.fasta <span class="token punctuation">\</span>
-mp:setup:spans_from_file membrane.span <span class="token punctuation">\</span>
-mp:assembly:num_components <span class="token number">2</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">50</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Antibody-Design-抗体设计"><a href="#Antibody-Design-抗体设计" class="headerlink" title="Antibody Design (抗体设计)"></a>Antibody Design (抗体设计)</h3><h4 id="1-抗体建模"><a href="#1-抗体建模" class="headerlink" title="1. 抗体建模"></a>1. 抗体建模</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建抗体序列和模板文件</span>
<span class="token comment"># ...</span>

<span class="token comment"># 运行抗体建模</span>
~/rosetta/main/source/bin/antibody.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-fasta</span> antibody.fasta <span class="token punctuation">\</span>
<span class="token parameter variable">-antibody:numbering_scheme</span> kabat <span class="token punctuation">\</span>
<span class="token parameter variable">-antibody:auto_generate_kink_constraint</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-CDR环优化"><a href="#2-CDR环优化" class="headerlink" title="2. CDR环优化"></a>2. CDR环优化</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/antibody.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> antibody.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-antibody:refine_cdr</span> h3 <span class="token punctuation">\</span>
<span class="token parameter variable">-antibody:cdr_dihedral_constraints</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3-抗原-抗体对接"><a href="#3-抗原-抗体对接" class="headerlink" title="3. 抗原-抗体对接"></a>3. 抗原-抗体对接</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/snugdock.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> antibody_antigen_complex.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-antibody:snug_loops</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-partners</span> A_BC <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">50</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="De-novo-Protein-Design-从头设计"><a href="#De-novo-Protein-Design-从头设计" class="headerlink" title="De novo Protein Design (从头设计)"></a>De novo Protein Design (从头设计)</h3><h4 id="1-骨架生成"><a href="#1-骨架生成" class="headerlink" title="1. 骨架生成"></a>1. 骨架生成</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/rosetta_scripts.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-parser:protocol</span> denovo_design.xml <span class="token punctuation">\</span>
-out:file:silent denovo_backbones.silent <span class="token punctuation">\</span>
<span class="token parameter variable">-out:nstruct</span> <span class="token number">1000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>denovo_design.xml示例:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ROSETTASCRIPTS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MOVERS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BackboneGenerator</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bb_gen<span class="token punctuation">"</span></span> <span class="token attr-name">ss</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>LHEELLLEEE<span class="token punctuation">"</span></span> 
            <span class="token attr-name">legacy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">n_samples</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token attr-name">n_tries</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token attr-name">rmsd</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ScoreFilter</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>score_filter<span class="token punctuation">"</span></span> <span class="token attr-name">scorefxn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref2015<span class="token punctuation">"</span></span> <span class="token attr-name">threshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MOVERS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PROTOCOLS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">mover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bb_gen<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>score_filter<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PROTOCOLS</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ROSETTASCRIPTS</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-序列设计"><a href="#2-序列设计" class="headerlink" title="2. 序列设计"></a>2. 序列设计</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/fixbb.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> denovo_backbone.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-design</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-ex1</span> <span class="token parameter variable">-ex2</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-use_input_sc</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3-完整从头设计流程"><a href="#3-完整从头设计流程" class="headerlink" title="3. 完整从头设计流程"></a>3. 完整从头设计流程</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/rosetta_scripts.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-parser:protocol</span> full_denovo.xml <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="RNA-Modeling-RNA建模"><a href="#RNA-Modeling-RNA建模" class="headerlink" title="RNA Modeling (RNA建模)"></a>RNA Modeling (RNA建模)</h3><h4 id="1-RNA折叠"><a href="#1-RNA折叠" class="headerlink" title="1. RNA折叠"></a>1. RNA折叠</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/rna_denovo.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-fasta</span> rna.fasta <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">100</span> <span class="token punctuation">\</span>
-out:file:silent rna_folded.out<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-RNA设计"><a href="#2-RNA设计" class="headerlink" title="2. RNA设计"></a>2. RNA设计</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/rna_design.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> rna_structure.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-rna_design:sequence_constraints</span> sequence.constraints <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3-RNA-蛋白质对接"><a href="#3-RNA-蛋白质对接" class="headerlink" title="3. RNA-蛋白质对接"></a>3. RNA-蛋白质对接</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/rna_protein_dock.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> rna_protein_complex.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-partners</span> P_R <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="高级功能"><a href="#高级功能" class="headerlink" title="高级功能"></a>高级功能</h2><h3 id="Rosetta-Scripts"><a href="#Rosetta-Scripts" class="headerlink" title="Rosetta Scripts"></a>Rosetta Scripts</h3><p>Rosetta Scripts是一个基于XML的接口，允许用户创建自定义Rosetta协议:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/rosetta_scripts.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> input.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-parser:protocol</span> my_protocol.xml <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>示例脚本(my_protocol.xml):</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ROSETTASCRIPTS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SCOREFXNS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ScoreFunction</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref15<span class="token punctuation">"</span></span> <span class="token attr-name">weights</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref2015<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ScoreFunction</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref15_soft<span class="token punctuation">"</span></span> <span class="token attr-name">weights</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref2015_soft<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SCOREFXNS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RESIDUE_SELECTORS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chainA<span class="token punctuation">"</span></span> <span class="token attr-name">chains</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>A<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chainB<span class="token punctuation">"</span></span> <span class="token attr-name">chains</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>B<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Interface</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>interface<span class="token punctuation">"</span></span> <span class="token attr-name">chain1</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chainA<span class="token punctuation">"</span></span> <span class="token attr-name">chain2</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chainB<span class="token punctuation">"</span></span> <span class="token attr-name">cutoff</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8.0<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RESIDUE_SELECTORS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TASKOPERATIONS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>InitializeFromCommandline</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>init<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RestrictToRepacking</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>repack_only<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ReadResfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>design_interface<span class="token punctuation">"</span></span> <span class="token attr-name">filename</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>interface_design.resfile<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TASKOPERATIONS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FILTERS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Ddg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ddg<span class="token punctuation">"</span></span> <span class="token attr-name">scorefxn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref15<span class="token punctuation">"</span></span> <span class="token attr-name">threshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-15<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Sasa</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sasa<span class="token punctuation">"</span></span> <span class="token attr-name">threshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>800<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FILTERS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MOVERS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Docking</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dock<span class="token punctuation">"</span></span> <span class="token attr-name">score_high</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref15<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackRotamersMover</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>design<span class="token punctuation">"</span></span> <span class="token attr-name">scorefxn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref15<span class="token punctuation">"</span></span> <span class="token attr-name">task_operations</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>init,design_interface<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MinMover</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>minimize<span class="token punctuation">"</span></span> <span class="token attr-name">scorefxn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref15<span class="token punctuation">"</span></span> <span class="token attr-name">chi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">bb</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MOVERS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PROTOCOLS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">mover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dock<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">mover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>design<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">mover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>minimize<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ddg<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sasa<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PROTOCOLS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>OUTPUT</span> <span class="token attr-name">scorefxn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref15<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ROSETTASCRIPTS</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="PyRosetta"><a href="#PyRosetta" class="headerlink" title="PyRosetta"></a>PyRosetta</h3><p>PyRosetta是Rosetta的Python接口，让用户能够通过Python脚本使用Rosetta功能:</p>
<h4 id="1-安装PyRosetta"><a href="#1-安装PyRosetta" class="headerlink" title="1. 安装PyRosetta"></a>1. 安装PyRosetta</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 在WSL中安装</span>
pip <span class="token function">install</span> pyrosetta <span class="token parameter variable">-f</span> https://username:password@graylab.jhu.edu/download/PyRosetta4/latest/repository/linux/release/PyRosetta-4.subset.all.linux.wheel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>注意:用自己的许可证用户名和密码替换username和password。</p>
<h4 id="2-基本PyRosetta脚本示例"><a href="#2-基本PyRosetta脚本示例" class="headerlink" title="2. 基本PyRosetta脚本示例"></a>2. 基本PyRosetta脚本示例</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># save as simple_pyrosetta.py</span>
<span class="token keyword">import</span> pyrosetta
<span class="token keyword">from</span> pyrosetta <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> pyrosetta<span class="token punctuation">.</span>toolbox <span class="token keyword">import</span> <span class="token operator">*</span>

<span class="token comment"># 初始化PyRosetta</span>
pyrosetta<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 加载蛋白质</span>
pose <span class="token operator">=</span> pyrosetta<span class="token punctuation">.</span>pose_from_pdb<span class="token punctuation">(</span><span class="token string">"input.pdb"</span><span class="token punctuation">)</span>

<span class="token comment"># 创建评分函数</span>
scorefxn <span class="token operator">=</span> pyrosetta<span class="token punctuation">.</span>get_fa_scorefxn<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 评分</span>
score <span class="token operator">=</span> scorefxn<span class="token punctuation">(</span>pose<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Initial score: </span><span class="token interpolation"><span class="token punctuation">{</span>score<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 创建PackerTask </span>
task <span class="token operator">=</span> pyrosetta<span class="token punctuation">.</span>standard_packer_task<span class="token punctuation">(</span>pose<span class="token punctuation">)</span>
task<span class="token punctuation">.</span>restrict_to_repacking<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 打包侧链</span>
packer <span class="token operator">=</span> pyrosetta<span class="token punctuation">.</span>protocols<span class="token punctuation">.</span>PackRotamersMover<span class="token punctuation">(</span>scorefxn<span class="token punctuation">,</span> task<span class="token punctuation">)</span>
packer<span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span>pose<span class="token punctuation">)</span>

<span class="token comment"># 重新评分</span>
score <span class="token operator">=</span> scorefxn<span class="token punctuation">(</span>pose<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"After repacking score: </span><span class="token interpolation"><span class="token punctuation">{</span>score<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 保存结果</span>
pose<span class="token punctuation">.</span>dump_pdb<span class="token punctuation">(</span><span class="token string">"output_repacked.pdb"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行脚本:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python simple_pyrosetta.py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="3-高级PyRosetta脚本示例"><a href="#3-高级PyRosetta脚本示例" class="headerlink" title="3. 高级PyRosetta脚本示例"></a>3. 高级PyRosetta脚本示例</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># save as advanced_pyrosetta.py</span>
<span class="token keyword">import</span> pyrosetta
<span class="token keyword">from</span> pyrosetta <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> pyrosetta<span class="token punctuation">.</span>toolbox <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> pyrosetta<span class="token punctuation">.</span>distributed<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span>rosetta_scripts <span class="token keyword">as</span> rs

<span class="token comment"># 初始化</span>
pyrosetta<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 加载蛋白质</span>
pose <span class="token operator">=</span> pyrosetta<span class="token punctuation">.</span>pose_from_pdb<span class="token punctuation">(</span><span class="token string">"input.pdb"</span><span class="token punctuation">)</span>

<span class="token comment"># 定义XML脚本</span>
xml_script <span class="token operator">=</span> <span class="token triple-quoted-string string">"""
&lt;ROSETTASCRIPTS&gt;
    &lt;SCOREFXNS&gt;
        &lt;ScoreFunction name="ref15" weights="ref2015"/&gt;
    &lt;/SCOREFXNS&gt;
    &lt;MOVERS&gt;
        &lt;FastRelax name="relax" scorefxn="ref15"/&gt;
    &lt;/MOVERS&gt;
    &lt;PROTOCOLS&gt;
        &lt;Add mover="relax"/&gt;
    &lt;/PROTOCOLS&gt;
&lt;/ROSETTASCRIPTS&gt;
"""</span>

<span class="token comment"># 运行XML脚本</span>
rs<span class="token punctuation">.</span>rosetta_scripts_task<span class="token punctuation">(</span>pose<span class="token punctuation">,</span> xml_script<span class="token punctuation">)</span>

<span class="token comment"># 保存结果</span>
pose<span class="token punctuation">.</span>dump_pdb<span class="token punctuation">(</span><span class="token string">"output_relaxed.pdb"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Fold-and-Dock"><a href="#Fold-and-Dock" class="headerlink" title="Fold and Dock"></a>Fold and Dock</h3><p>用于同时预测多亚基蛋白质复合物结构:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/fold_and_dock.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
-in:file:fasta complex.fasta <span class="token punctuation">\</span>
-in:file:native native.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-fold_and_dock:symmetry</span> symm.def <span class="token punctuation">\</span>
<span class="token parameter variable">-out:nstruct</span> <span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>symm.def示例(二聚体C2对称):</p>
<pre class="line-numbers language-undefined" data-language="undefined"><code class="language-undefined">symmetry_name C2
subunits 2
number_of_interfaces 1
E = 2*VRT0001 + 1*(VRT0001:VRT0002)
anchor_residue 1
virtual_coordinates_start
xyz VRT0001 0,0,0 0,0,1 0,1,0
xyz VRT0002 0,0,0 0,0,-1 0,-1,0
virtual_coordinates_stop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Enzyme-Design"><a href="#Enzyme-Design" class="headerlink" title="Enzyme Design"></a>Enzyme Design</h3><p>设计具有特定催化功能的酶:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">~/rosetta/main/source/bin/enzyme_design.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> scaffold.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-enzdes:cstfile</span> constraints.cst <span class="token punctuation">\</span>
<span class="token parameter variable">-enzdes:design_min_cycles</span> <span class="token number">2</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-ex1</span> <span class="token parameter variable">-ex2</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">50</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>constraints.cst示例:</p>
<pre class="line-numbers language-css" data-language="css"><code class="language-css"># 约束基质与活性位点氨基酸的相互作用
<span class="token property">CST</span><span class="token punctuation">:</span><span class="token punctuation">:</span>BEGIN
<span class="token property">TEMPLATE</span><span class="token punctuation">:</span><span class="token punctuation">:</span>   <span class="token property">ATOM_MAP</span><span class="token punctuation">:</span> 1 <span class="token property">atom_name</span><span class="token punctuation">:</span> C1 C2 O1
<span class="token property">TEMPLATE</span><span class="token punctuation">:</span><span class="token punctuation">:</span>   <span class="token property">ATOM_MAP</span><span class="token punctuation">:</span> 2 <span class="token property">atom_name</span><span class="token punctuation">:</span> OG CB CA
<span class="token property">CONSTRAINT</span><span class="token punctuation">:</span><span class="token punctuation">:</span> <span class="token property">distanceAB</span><span class="token punctuation">:</span>    3.0   0.2  100.0  0
<span class="token property">CONSTRAINT</span><span class="token punctuation">:</span><span class="token punctuation">:</span> <span class="token property">angle_A</span><span class="token punctuation">:</span>     109.5   5.0  100.0  360.0
<span class="token property">CONSTRAINT</span><span class="token punctuation">:</span><span class="token punctuation">:</span> <span class="token property">angle_B</span><span class="token punctuation">:</span>     109.5   5.0  100.0  360.0
<span class="token property">CONSTRAINT</span><span class="token punctuation">:</span><span class="token punctuation">:</span> <span class="token property">torsion_A</span><span class="token punctuation">:</span>   180.0  15.0  100.0  360.0
<span class="token property">CONSTRAINT</span><span class="token punctuation">:</span><span class="token punctuation">:</span> <span class="token property">torsion_AB</span><span class="token punctuation">:</span>  180.0  15.0  100.0  360.0
<span class="token property">CONSTRAINT</span><span class="token punctuation">:</span><span class="token punctuation">:</span> <span class="token property">torsion_B</span><span class="token punctuation">:</span>   180.0  15.0  100.0  360.0
<span class="token property">CST</span><span class="token punctuation">:</span><span class="token punctuation">:</span>END<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="Symmetry-Modeling"><a href="#Symmetry-Modeling" class="headerlink" title="Symmetry Modeling"></a>Symmetry Modeling</h3><p>对称蛋白设计:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建对称定义文件</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> C3.symm <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
symmetry_name C3
subunits 3
number_of_interfaces 1
E = 3*VRT0001 + 3*(VRT0001:VRT0001)
anchor_residue 1
virtual_coordinates_start
xyz VRT0001 0,0,0 0,0,1 1,0,0
virtual_coordinates_stop
EOF</span>

<span class="token comment"># 运行对称蛋白设计</span>
~/rosetta/main/source/bin/rosetta_scripts.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> monomer.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-parser:protocol</span> symmetry_design.xml <span class="token punctuation">\</span>
<span class="token parameter variable">-symmetry:symmet</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">50</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>symmetry_design.xml示例:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ROSETTASCRIPTS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SCOREFXNS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ScoreFunction</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref15<span class="token punctuation">"</span></span> <span class="token attr-name">weights</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref2015<span class="token punctuation">"</span></span> <span class="token attr-name">symmetric</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SCOREFXNS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MOVERS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SetupForSymmetry</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>setupsymm<span class="token punctuation">"</span></span> <span class="token attr-name">definition</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>C3.symm<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SymPackRotamersMover</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>symdes<span class="token punctuation">"</span></span> <span class="token attr-name">scorefxn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref15<span class="token punctuation">"</span></span> <span class="token attr-name">task_operations</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>init,ifcdes<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SymMinMover</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>symmin<span class="token punctuation">"</span></span> <span class="token attr-name">scorefxn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref15<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MOVERS</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TASKOPERATIONS</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>InitializeFromCommandline</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>init<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DesignInterfaceOperation</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ifcdes<span class="token punctuation">"</span></span> <span class="token attr-name">interface_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.0<span class="token punctuation">"</span></span> <span class="token attr-name">design_chain1</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">design_chain2</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TASKOPERATIONS</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PROTOCOLS</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">mover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>setupsymm<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">mover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>symdes<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">mover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>symmin<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PROTOCOLS</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>OUTPUT</span> <span class="token attr-name">scorefxn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref15<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ROSETTASCRIPTS</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="输入文件格式"><a href="#输入文件格式" class="headerlink" title="输入文件格式"></a>输入文件格式</h2><h3 id="1-PDB文件"><a href="#1-PDB文件" class="headerlink" title="1. PDB文件"></a>1. PDB文件</h3><p>标准蛋白质数据库格式文件，包含原子坐标和结构信息:</p>
<pre class="line-numbers language-none"><code class="language-none">ATOM 1 N MET A 1 27.340 24.430 2.614 1.00 19.66 A N
ATOM 2 CA MET A 1 26.266 25.413 2.842 1.00 18.57 A C<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>


<h3 id="2-FASTA文件"><a href="#2-FASTA文件" class="headerlink" title="2. FASTA文件"></a>2. FASTA文件</h3><p>氨基酸或核苷酸序列文件:</p>
<blockquote>
<p>protein_name<br>MVLSPADKTNVKAAWGKVGAHAGEYGAEALERMFLSFPTTKTYFPHFDLSHGSAQVKGHGKKVADALTNAVAHVDDMPNALSALSDLHAHKLRVDPVNFKLLSHCLLVTLAAHLPAEFTPAVHASLDKFLASVSTVLTSKYR</p>
</blockquote>
<h3 id="3-Resfile"><a href="#3-Resfile" class="headerlink" title="3. Resfile"></a>3. Resfile</h3><p>指定设计或重打包的残基文件:</p>
<pre class="line-numbers language-none"><code class="language-none">
NATAA # 默认重新打包为相同氨基酸类型
start
10 A ALLAA # 10号位点允许任何氨基酸
11 A PIKAA YFWL # 11号位点只允许这四种氨基酸
12 A NATRO # 12号位点保持不变
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-Constraint-Files-cst"><a href="#4-Constraint-Files-cst" class="headerlink" title="4. Constraint Files (.cst)"></a>4. Constraint Files (.cst)</h3><p>定义结构约束:</p>
<pre class="line-numbers language-none"><code class="language-none">
AtomPair CA 10 CA 20 HARMONIC 10.0 0.5 # 残基10和20的CA原子之间距离约束为10Å
Angle CA 10 CA 15 CA 20 CIRCULARHARMONIC 120.0 5.0 # 角度约束
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="5-Fragments文件"><a href="#5-Fragments文件" class="headerlink" title="5. Fragments文件"></a>5. Fragments文件</h3><p>用于结构预测的片段库(.200.9mers, .200.3mers):</p>
<pre class="line-numbers language-none"><code class="language-none">
position: 1 neighbors: 200
1 A1 PHE 1c3y_A 56 A 56 0.479 147.000 -127.000 175.000 -77.000 144.000 ...
...
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="6-Loops文件"><a href="#6-Loops文件" class="headerlink" title="6. Loops文件"></a>6. Loops文件</h3><p>指定要建模的蛋白质环区域:</p>
<pre class="line-numbers language-none"><code class="language-none">
LOOP 25 35 0 0 0
LOOP 78 86 0 0 0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="7-Blueprint文件"><a href="#7-Blueprint文件" class="headerlink" title="7. Blueprint文件"></a>7. Blueprint文件</h3><p>用于从头设计骨架:</p>
<pre class="line-numbers language-none"><code class="language-none">
1 A . ABEGO
2 A . ABEGO
3 A . ABEGO
...
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="输出分析"><a href="#输出分析" class="headerlink" title="输出分析"></a>输出分析</h2><h3 id="1-评分文件-sc"><a href="#1-评分文件-sc" class="headerlink" title="1. 评分文件(.sc)"></a>1. 评分文件(.sc)</h3><p>包含所有输出模型的能量分数和各项能量指标:</p>
<pre class="line-numbers language-none"><code class="language-none">
SCORE: score fa_atr fa_rep fa_sol fa_intra_rep fa_elec pro_close hbond_sr_bb hbond_lr_bb hbond_bb_sc hbond_sc dslf_fa13 rama omega fa_dun p_aa_pp yhh_planarity ref allatom_rms gdtmm gdtmm1.0 gdtmm2.0 gdtmm3.0 gdtmm4.0 gdtmm5.0 gdtmm0.5 gdtmm1_hires gdtmm0.5_hires gdthc irms maxsub maxsub2.0 rms sc_value time description
SCORE: -93.451 -367.213 58.402 195.307 0.402 -35.582 0.030 -22.613 -9.633 -9.059 -9.053 0.000 -4.066 -0.756 124.442 -8.748 0.000 -5.312 0.000 1.000 1.000 1.000 1.000 1.000 1.000 1.000 1.000 1.000 1.000 0.000 125 125 0.000 0.000 9.12 S_00000001
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>分析评分文件:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 提取总分</span>
<span class="token function">grep</span> <span class="token string">"^SCORE:"</span> scores.sc <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">"SCORE: score"</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nk2</span> <span class="token operator">&gt;</span> sorted_scores.txt

<span class="token comment"># 提取特定能量项(如界面能量)</span>
<span class="token function">awk</span> <span class="token string">'{print $2, $7}'</span> sorted_scores.txt <span class="token operator">&gt;</span> interface_energy.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-结构分析"><a href="#2-结构分析" class="headerlink" title="2. 结构分析"></a>2. 结构分析</h3><h4 id="使用PyMOL进行可视化"><a href="#使用PyMOL进行可视化" class="headerlink" title="使用PyMOL进行可视化"></a>使用PyMOL进行可视化</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 启动PyMOL并加载结构</span>
pymol output_*.pdb

<span class="token comment"># 在PyMOL中运行命令</span>
align all, model_1
rms_cur model_*, model_1
spectrum b, rainbow
cartoon putty
show sticks, resn ALA+GLU+<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="使用PyRosetta进行分析"><a href="#使用PyRosetta进行分析" class="headerlink" title="使用PyRosetta进行分析"></a>使用PyRosetta进行分析</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># save as analyze_structures.py</span>
<span class="token keyword">import</span> pyrosetta
<span class="token keyword">from</span> pyrosetta <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> pyrosetta<span class="token punctuation">.</span>toolbox <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># 初始化</span>
pyrosetta<span class="token punctuation">.</span>init<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 加载结构</span>
pose1 <span class="token operator">=</span> pyrosetta<span class="token punctuation">.</span>pose_from_pdb<span class="token punctuation">(</span><span class="token string">"model_1.pdb"</span><span class="token punctuation">)</span>
pose2 <span class="token operator">=</span> pyrosetta<span class="token punctuation">.</span>pose_from_pdb<span class="token punctuation">(</span><span class="token string">"model_2.pdb"</span><span class="token punctuation">)</span>

<span class="token comment"># 计算RMSD</span>
rmsd <span class="token operator">=</span> pyrosetta<span class="token punctuation">.</span>rosetta<span class="token punctuation">.</span>core<span class="token punctuation">.</span>scoring<span class="token punctuation">.</span>CA_rmsd<span class="token punctuation">(</span>pose1<span class="token punctuation">,</span> pose2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"CA RMSD: </span><span class="token interpolation"><span class="token punctuation">{</span>rmsd<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">}</span></span><span class="token string"> Å"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 计算每个残基的SASA</span>
sasa_calc <span class="token operator">=</span> pyrosetta<span class="token punctuation">.</span>rosetta<span class="token punctuation">.</span>core<span class="token punctuation">.</span>scoring<span class="token punctuation">.</span>sasa<span class="token punctuation">.</span>SasaCalc<span class="token punctuation">(</span><span class="token punctuation">)</span>
sasa_calc<span class="token punctuation">.</span>calculate<span class="token punctuation">(</span>pose1<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> pose1<span class="token punctuation">.</span>total_residue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sasa <span class="token operator">=</span> sasa_calc<span class="token punctuation">.</span>get_residue_sasa<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Residue </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{</span>sasa<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string"> Å²"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 分析氢键网络</span>
hbonds <span class="token operator">=</span> pyrosetta<span class="token punctuation">.</span>rosetta<span class="token punctuation">.</span>core<span class="token punctuation">.</span>scoring<span class="token punctuation">.</span>hbonds<span class="token punctuation">.</span>HBondSet<span class="token punctuation">(</span><span class="token punctuation">)</span>
pyrosetta<span class="token punctuation">.</span>rosetta<span class="token punctuation">.</span>core<span class="token punctuation">.</span>scoring<span class="token punctuation">.</span>hbonds<span class="token punctuation">.</span>fill_hbond_set<span class="token punctuation">(</span>pose1<span class="token punctuation">,</span> hbonds<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> hbonds<span class="token punctuation">.</span>nhbonds<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    hb <span class="token operator">=</span> hbonds<span class="token punctuation">.</span>hbond<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    don_res <span class="token operator">=</span> hb<span class="token punctuation">.</span>don_res<span class="token punctuation">(</span><span class="token punctuation">)</span>
    acc_res <span class="token operator">=</span> hb<span class="token punctuation">.</span>acc_res<span class="token punctuation">(</span><span class="token punctuation">)</span>
    energy <span class="token operator">=</span> hb<span class="token punctuation">.</span>energy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"H-bond </span><span class="token interpolation"><span class="token punctuation">{</span>i<span class="token punctuation">}</span></span><span class="token string">: Donor </span><span class="token interpolation"><span class="token punctuation">{</span>don_res<span class="token punctuation">}</span></span><span class="token string"> - Acceptor </span><span class="token interpolation"><span class="token punctuation">{</span>acc_res<span class="token punctuation">}</span></span><span class="token string">, Energy: </span><span class="token interpolation"><span class="token punctuation">{</span>energy<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="批量分析多个结构"><a href="#批量分析多个结构" class="headerlink" title="批量分析多个结构"></a>批量分析多个结构</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 使用Rosetta工具分析多个结构</span>
~/rosetta/main/source/bin/score_jd2.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
-in:file:s model_*.pdb <span class="token punctuation">\</span>
-out:file:scorefile all_scores.sc

<span class="token comment"># 计算RMSD矩阵</span>
~/rosetta/main/source/bin/rms_analysis.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
-in:file:s model_*.pdb <span class="token punctuation">\</span>
-out:file:o rmsd_matrix.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-聚类分析"><a href="#3-聚类分析" class="headerlink" title="3. 聚类分析"></a>3. 聚类分析</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 使用Rosetta进行聚类</span>
~/rosetta/main/source/bin/cluster.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
-in:file:s model_*.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-cluster:radius</span> <span class="token number">2.0</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-out:prefix</span> clustered_<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="常见问题解决"><a href="#常见问题解决" class="headerlink" title="常见问题解决"></a>常见问题解决</h2><h3 id="1-编译错误"><a href="#1-编译错误" class="headerlink" title="1. 编译错误"></a>1. 编译错误</h3><p><strong>问题</strong>: scons编译失败，显示缺少依赖项<br><strong>解决方案</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装所有必要的依赖项</span>
<span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token parameter variable">-y</span> build-essential scons python3-dev zlib1g-dev libboost-all-dev libxml2-dev libxslt1-dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p><strong>问题</strong>: 编译中内存不足<br><strong>解决方案</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 减少并行编译线程数</span>
./scons.py <span class="token parameter variable">-j2</span> <span class="token assign-left variable">mode</span><span class="token operator">=</span>release bin

<span class="token comment"># 或增加交换空间</span>
<span class="token function">sudo</span> fallocate <span class="token parameter variable">-l</span> 4G /swapfile
<span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">600</span> /swapfile
<span class="token function">sudo</span> <span class="token function">mkswap</span> /swapfile
<span class="token function">sudo</span> <span class="token function">swapon</span> /swapfile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-运行时错误"><a href="#2-运行时错误" class="headerlink" title="2. 运行时错误"></a>2. 运行时错误</h3><p><strong>问题</strong>: 找不到数据库<br><strong>解决方案</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 确保正确指定数据库路径</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>问题</strong>: “core dumped”错误<br><strong>解决方案</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 检查内存使用情况</span>
<span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-a</span>
<span class="token comment"># 增加可用内存限制</span>
<span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-v</span> unlimited<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>问题</strong>: 输入文件格式错误<br><strong>解决方案</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 检查PDB文件格式</span>
~/rosetta/main/source/bin/check_pdb_file.default.linuxgccrelease <span class="token parameter variable">-s</span> input.pdb
<span class="token comment"># 修复PDB文件</span>
~/rosetta/main/source/bin/clean_pdb.py input.pdb A<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-性能优化"><a href="#3-性能优化" class="headerlink" title="3. 性能优化"></a>3. 性能优化</h3><p><strong>问题</strong>: 运行速度慢<br><strong>解决方案</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 并行运行多个独立任务</span>
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token function">mkdir</span> run_<span class="token variable">$i</span>
  <span class="token builtin class-name">cd</span> run_<span class="token variable">$i</span>
  ~/rosetta/main/source/bin/AbinitioRelax.default.linuxgccrelease <span class="token punctuation">\</span>
  <span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
  -in:file:fasta <span class="token punctuation">..</span>/protein.fasta <span class="token punctuation">\</span>
  <span class="token parameter variable">-nstruct</span> <span class="token number">10</span> <span class="token punctuation">\</span>
  -out:file:silent abinit_<span class="token variable">$i</span>.out <span class="token operator">&amp;</span>
  <span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>
<span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>问题</strong>: 磁盘空间不足<br><strong>解决方案</strong>:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 使用二进制静默文件而非PDB文件</span>
-out:file:silent results.out

<span class="token comment"># 提取特定模型</span>
~/rosetta/main/source/bin/extract_pdbs.default.linuxgccrelease <span class="token punctuation">\</span>
-in:file:silent results.out <span class="token punctuation">\</span>
-in:file:tags S_00001 S_00002<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="资源与社区"><a href="#资源与社区" class="headerlink" title="资源与社区"></a>资源与社区</h2><h3 id="1-官方资源"><a href="#1-官方资源" class="headerlink" title="1. 官方资源"></a>1. 官方资源</h3><ul>
<li><strong>Rosetta Commons官网</strong>: <a href="https://links.jianshu.com/go?to=https://www.rosettacommons.org/">https://www.rosettacommons.org/</a></li>
<li><strong>文档</strong>: <a href="https://links.jianshu.com/go?to=https://www.rosettacommons.org/docs/latest/Home">https://www.rosettacommons.org/docs/latest/Home</a></li>
<li><strong>教程</strong>: <a href="https://links.jianshu.com/go?to=https://www.rosettacommons.org/demos/latest/Home">https://www.rosettacommons.org/demos/latest/Home</a></li>
<li><strong>RosettaCon</strong>: 年度Rosetta用户与开发者会议</li>
</ul>
<h3 id="2-社区支持"><a href="#2-社区支持" class="headerlink" title="2. 社区支持"></a>2. 社区支持</h3><ul>
<li><strong>Rosetta Forums</strong>: <a href="https://links.jianshu.com/go?to=https://www.rosettacommons.org/forums">https://www.rosettacommons.org/forums</a></li>
<li><strong>Rosetta3 User Guide</strong>: <a href="https://links.jianshu.com/go?to=https://www.rosettacommons.org/manuals/latest/rosetta3_user_guide/">https://www.rosettacommons.org/manuals/latest/rosetta3_user_guide/</a></li>
<li><strong>GitHub</strong>: <a href="https://links.jianshu.com/go?to=https://github.com/RosettaCommons">https://github.com/RosettaCommons</a></li>
</ul>
<h3 id="3-学习资源"><a href="#3-学习资源" class="headerlink" title="3. 学习资源"></a>3. 学习资源</h3><ul>
<li><strong>Online Courses</strong>:<ul>
<li>Coursera: Computational Methods for Protein Structure Prediction</li>
<li>edX: Protein Design and Ligand Design with Rosetta</li>
</ul>
</li>
<li><strong>推荐书籍</strong>:<ul>
<li>“Protein Structure Prediction: A Practical Approach” by M.J.E. Sternberg</li>
<li>“Computational Protein Design” by Gert-Jan Bekker</li>
</ul>
</li>
</ul>
<h3 id="4-常用第三方工具"><a href="#4-常用第三方工具" class="headerlink" title="4. 常用第三方工具"></a>4. 常用第三方工具</h3><ul>
<li><strong>结构可视化</strong>:<ul>
<li>PyMOL: <a href="https://links.jianshu.com/go?to=https://pymol.org/">https://pymol.org/</a></li>
<li>UCSF Chimera: <a href="https://links.jianshu.com/go?to=https://www.cgl.ucsf.edu/chimera/">https://www.cgl.ucsf.edu/chimera/</a></li>
<li>VMD: <a href="https://links.jianshu.com/go?to=https://www.ks.uiuc.edu/Research/vmd/">https://www.ks.uiuc.edu/Research/vmd/</a></li>
</ul>
</li>
<li><strong>序列分析</strong>:<ul>
<li>BLAST: <a href="https://links.jianshu.com/go?to=https://blast.ncbi.nlm.nih.gov/">https://blast.ncbi.nlm.nih.gov/</a></li>
<li>HMMER: <a href="https://links.jianshu.com/go?to=http://hmmer.org/">http://hmmer.org/</a></li>
<li>Clustal Omega: <a href="https://links.jianshu.com/go?to=https://www.ebi.ac.uk/Tools/msa/clustalo/">https://www.ebi.ac.uk/Tools/msa/clustalo/</a></li>
</ul>
</li>
<li><strong>结构验证</strong>:<ul>
<li>MolProbity: <a href="https://links.jianshu.com/go?to=http://molprobity.biochem.duke.edu/">http://molprobity.biochem.duke.edu/</a></li>
<li>PROCHECK: <a href="https://links.jianshu.com/go?to=https://www.ebi.ac.uk/thornton-srv/software/PROCHECK/">https://www.ebi.ac.uk/thornton-srv/software/PROCHECK/</a></li>
</ul>
</li>
</ul>
<h2 id="高级应用案例"><a href="#高级应用案例" class="headerlink" title="高级应用案例"></a>高级应用案例</h2><h3 id="1-蛋白质界面优化"><a href="#1-蛋白质界面优化" class="headerlink" title="1. 蛋白质界面优化"></a>1. 蛋白质界面优化</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 首先使用界面分析器</span>
~/rosetta/main/source/bin/InterfaceAnalyzer.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> complex.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-interface</span> A_B <span class="token punctuation">\</span>
<span class="token parameter variable">-pack_input</span> <span class="token boolean">true</span> <span class="token punctuation">\</span>
-out:file:score_only interface_analysis.sc

<span class="token comment"># 2. 创建界面设计resfile</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> interface_design.resfile <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
NATAA
start
# 基于界面分析的结果选择残基
45 A ALLAA
46 A ALLAA
72 B PIKAA DEHKR
73 B PIKAA DEHKR
EOF</span>

<span class="token comment"># 3. 运行界面设计</span>
~/rosetta/main/source/bin/rosetta_scripts.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> complex.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-parser:protocol</span> interface_design.xml <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>interface_design.xml示例:</p>
<pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ROSETTASCRIPTS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SCOREFXNS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ScoreFunction</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref15<span class="token punctuation">"</span></span> <span class="token attr-name">weights</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref2015<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ScoreFunction</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>soft_rep<span class="token punctuation">"</span></span> <span class="token attr-name">weights</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref2015<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Reweight</span> <span class="token attr-name">scoretype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fa_rep<span class="token punctuation">"</span></span> <span class="token attr-name">weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.5<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ScoreFunction</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SCOREFXNS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RESIDUE_SELECTORS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chainA<span class="token punctuation">"</span></span> <span class="token attr-name">chains</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>A<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Chain</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chainB<span class="token punctuation">"</span></span> <span class="token attr-name">chains</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>B<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Interface</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>interface<span class="token punctuation">"</span></span> <span class="token attr-name">chain1</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chainA<span class="token punctuation">"</span></span> <span class="token attr-name">chain2</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>chainB<span class="token punctuation">"</span></span> <span class="token attr-name">cutoff</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8.0<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Neighborhood</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neighbor<span class="token punctuation">"</span></span> <span class="token attr-name">selector</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>interface<span class="token punctuation">"</span></span> <span class="token attr-name">distance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4.0<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Union</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>design_residues<span class="token punctuation">"</span></span> <span class="token attr-name">selectors</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>interface,neighbor<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>RESIDUE_SELECTORS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TASKOPERATIONS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>InitializeFromCommandline</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>init<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ReadResfile</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>res_file<span class="token punctuation">"</span></span> <span class="token attr-name">filename</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>interface_design.resfile<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>OperateOnResidueSubset</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>restrict_to_interface<span class="token punctuation">"</span></span> <span class="token attr-name">selector</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>design_residues<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>RestrictToRepackingRLT</span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>OperateOnResidueSubset</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TASKOPERATIONS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FILTERS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>InterfaceHoles</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>holes<span class="token punctuation">"</span></span> <span class="token attr-name">jump</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">threshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Ddg</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ddg_filter<span class="token punctuation">"</span></span> <span class="token attr-name">scorefxn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref15<span class="token punctuation">"</span></span> <span class="token attr-name">threshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-15<span class="token punctuation">"</span></span> <span class="token attr-name">jump</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ShapeComplementarity</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sc<span class="token punctuation">"</span></span> <span class="token attr-name">jump</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">verbose</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token attr-name">min_sc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.65<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackStat</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pstat<span class="token punctuation">"</span></span> <span class="token attr-name">threshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.58<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FILTERS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MOVERS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackRotamersMover</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>design<span class="token punctuation">"</span></span> <span class="token attr-name">scorefxn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>soft_rep<span class="token punctuation">"</span></span> <span class="token attr-name">task_operations</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>init,res_file,restrict_to_interface<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MinMover</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>minimize<span class="token punctuation">"</span></span> <span class="token attr-name">scorefxn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref15<span class="token punctuation">"</span></span> <span class="token attr-name">chi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">bb</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FilterReportAsPDBInfo</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>report_sc<span class="token punctuation">"</span></span> <span class="token attr-name">filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sc<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FilterReportAsPDBInfo</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>report_ddg<span class="token punctuation">"</span></span> <span class="token attr-name">filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ddg_filter<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MOVERS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PROTOCOLS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">mover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>design<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">mover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>minimize<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>holes<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ddg_filter<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sc<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">filter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pstat<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">mover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>report_sc<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Add</span> <span class="token attr-name">mover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>report_ddg<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PROTOCOLS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>OUTPUT</span> <span class="token attr-name">scorefxn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ref15<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ROSETTASCRIPTS</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2-稳定性改进设计"><a href="#2-稳定性改进设计" class="headerlink" title="2. 稳定性改进设计"></a>2. 稳定性改进设计</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 首先运行Rosetta弛豫和稳定性分析</span>
~/rosetta/main/source/bin/relax.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> protein.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-relax:fast</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-out:suffix</span> _relaxed

<span class="token comment"># 2. 创建稳定性设计XML脚本</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> stability_design.xml <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
&lt;ROSETTASCRIPTS&gt;
    &lt;SCOREFXNS&gt;
        &lt;ScoreFunction name="ref15" weights="ref2015"/&gt;
    &lt;/SCOREFXNS&gt;
    &lt;RESIDUE_SELECTORS&gt;
        &lt;SecondaryStructure name="sheet" ss="E" /&gt;
        &lt;SecondaryStructure name="helix" ss="H" /&gt;
        &lt;Not name="loop" selector="sheet"&gt;
            &lt;SecondaryStructure ss="H"/&gt;
        &lt;/Not&gt;
        &lt;Layer name="surface" select_core="false" select_boundary="false" select_surface="true" core_cutoff="2.0" surface_cutoff="1.0"/&gt;
        &lt;Layer name="boundary" select_core="false" select_boundary="true" select_surface="false"/&gt;
        &lt;Layer name="core" select_core="true" select_boundary="false" select_surface="false"/&gt;
    &lt;/RESIDUE_SELECTORS&gt;
    &lt;TASKOPERATIONS&gt;
        &lt;InitializeFromCommandline name="init"/&gt;
        &lt;RestrictToRepacking name="rtrp"/&gt;
        &lt;OperateOnResidueSubset name="design_hydrophobic_core" selector="core"&gt;
            &lt;RestrictAbsentCanonicalAASRLT aas="ACFGILMPVWY"/&gt;
        &lt;/OperateOnResidueSubset&gt;
        &lt;OperateOnResidueSubset name="design_boundary" selector="boundary"&gt;
            &lt;RestrictAbsentCanonicalAASRLT aas="ADEFGHIKLMNPQRSTVWY"/&gt;
        &lt;/OperateOnResidueSubset&gt;
        &lt;OperateOnResidueSubset name="design_surface" selector="surface"&gt;
            &lt;RestrictAbsentCanonicalAASRLT aas="DEHKNPQRST"/&gt;
        &lt;/OperateOnResidueSubset&gt;
        &lt;DesignRestrictions name="turn_glycine"&gt;
            &lt;Action residue_selector="loop" aas="G"/&gt;
        &lt;/DesignRestrictions&gt;
        &lt;DesignRestrictions name="helix_favoring"&gt;
            &lt;Action residue_selector="helix" aas="AEKLMQR"/&gt;
        &lt;/DesignRestrictions&gt;
        &lt;DesignRestrictions name="sheet_favoring"&gt;
            &lt;Action residue_selector="sheet" aas="FILVWY"/&gt;
        &lt;/DesignRestrictions&gt;
    &lt;/TASKOPERATIONS&gt;
    &lt;FILTERS&gt;
        &lt;PackStat name="packstat" threshold="0.58"/&gt;
        &lt;BuriedUnsatHbonds name="buried_unsat_hbonds" cutoff="5"/&gt;
        &lt;CavityVolume name="cavity" threshold="10"/&gt;
        &lt;SSPrediction name="ss_prediction" threshold="0.8" use_svm="1"/&gt;
        &lt;EnergyCutoff name="score_cut" scorefxn="ref15" cutoff="0" energy_type="total_score"/&gt;
    &lt;/FILTERS&gt;
    &lt;MOVERS&gt;
        &lt;FastDesign name="fast_design" scorefxn="ref15" task_operations="init,design_hydrophobic_core,design_boundary,design_surface,turn_glycine,helix_favoring,sheet_favoring" repeats="5"/&gt;
        &lt;MinMover name="minimize" scorefxn="ref15" chi="1" bb="1"/&gt;
    &lt;/MOVERS&gt;
    &lt;PROTOCOLS&gt;
        &lt;Add mover="fast_design"/&gt;
        &lt;Add mover="minimize"/&gt;
        &lt;Add filter="packstat"/&gt;
        &lt;Add filter="buried_unsat_hbonds"/&gt;
        &lt;Add filter="cavity"/&gt;
        &lt;Add filter="ss_prediction"/&gt;
        &lt;Add filter="score_cut"/&gt;
    &lt;/PROTOCOLS&gt;
    &lt;OUTPUT scorefxn="ref15"/&gt;
&lt;/ROSETTASCRIPTS&gt;
EOF</span>

<span class="token comment"># 3. 运行稳定性设计</span>
~/rosetta/main/source/bin/rosetta_scripts.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> protein_relaxed.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-parser:protocol</span> stability_design.xml <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="3-多状态设计"><a href="#3-多状态设计" class="headerlink" title="3. 多状态设计"></a>3. 多状态设计</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 创建多状态设计XML脚本</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> multistate_design.xml <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
&lt;ROSETTASCRIPTS&gt;
    &lt;SCOREFXNS&gt;
        &lt;ScoreFunction name="ref15" weights="ref2015"/&gt;
    &lt;/SCOREFXNS&gt;
    &lt;RESIDUE_SELECTORS&gt;
        &lt;Chain name="chainA" chains="A"/&gt;
        &lt;Chain name="chainB" chains="B"/&gt;
        &lt;Chain name="chainC" chains="C"/&gt;
        &lt;Interface name="AB_interface" chain1="chainA" chain2="chainB" cutoff="8.0"/&gt;
        &lt;Interface name="AC_interface" chain1="chainA" chain2="chainC" cutoff="8.0"/&gt;
        &lt;Union name="design_residues" selectors="AB_interface,AC_interface"/&gt;
    &lt;/RESIDUE_SELECTORS&gt;
    &lt;TASKOPERATIONS&gt;
        &lt;InitializeFromCommandline name="init"/&gt;
        &lt;OperateOnResidueSubset name="design_interfaces" selector="design_residues"&gt;
            &lt;RestrictToRepackingRLT/&gt;
        &lt;/OperateOnResidueSubset&gt;
        &lt;DisallowIfNonnative name="native_aa" disallow_aas="ACDEFGHIKLMNPQRSTVWY"/&gt;
    &lt;/TASKOPERATIONS&gt;
    &lt;FILTERS&gt;
        &lt;Ddg name="ddg_AB" scorefxn="ref15" threshold="-15" jump="1"/&gt;
        &lt;Ddg name="ddg_AC" scorefxn="ref15" threshold="-15" jump="2"/&gt;
    &lt;/FILTERS&gt;
    &lt;MOVERS&gt;
        &lt;MakeMultimerMover name="make_multimer" states="2"&gt;
            &lt;State filename="AB_complex.pdb"/&gt;
            &lt;State filename="AC_complex.pdb"/&gt;
        &lt;/MakeMultimerMover&gt;
        &lt;MutateResidue name="mutate1" target="10" new_res="ALA"/&gt;
        &lt;MultiStateDesign name="msd" scorefxn="ref15" task_operations="init,design_interfaces,native_aa"&gt;
            &lt;States&gt;
                &lt;State state_name="AB" reference="true"/&gt;
                &lt;State state_name="AC"/&gt;
            &lt;/States&gt;
        &lt;/MultiStateDesign&gt;
    &lt;/MOVERS&gt;
    &lt;PROTOCOLS&gt;
        &lt;Add mover="make_multimer"/&gt;
        &lt;Add mover="msd"/&gt;
        &lt;Add filter="ddg_AB"/&gt;
        &lt;Add filter="ddg_AC"/&gt;
    &lt;/PROTOCOLS&gt;
    &lt;OUTPUT scorefxn="ref15"/&gt;
&lt;/ROSETTASCRIPTS&gt;
EOF</span>

<span class="token comment"># 运行多状态设计</span>
~/rosetta/main/source/bin/rosetta_scripts.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-parser:protocol</span> multistate_design.xml <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">50</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-设计金属结合位点"><a href="#4-设计金属结合位点" class="headerlink" title="4. 设计金属结合位点"></a>4. 设计金属结合位点</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 创建金属结合位点设计XML脚本</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> metal_site_design.xml <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
&lt;ROSETTASCRIPTS&gt;
    &lt;SCOREFXNS&gt;
        &lt;ScoreFunction name="ref15" weights="ref2015"/&gt;
        &lt;ScoreFunction name="metal_score" weights="ref2015"&gt;
            &lt;Reweight scoretype="coordinate_constraint" weight="1.0"/&gt;
            &lt;Reweight scoretype="atom_pair_constraint" weight="1.0"/&gt;
            &lt;Reweight scoretype="angle_constraint" weight="1.0"/&gt;
            &lt;Reweight scoretype="dihedral_constraint" weight="1.0"/&gt;
        &lt;/ScoreFunction&gt;
    &lt;/SCOREFXNS&gt;
    &lt;RESIDUE_SELECTORS&gt;
        &lt;ResiduePDBInfoHasLabel name="catalytic_residues" property="METAL_BINDING"/&gt;
        &lt;Neighborhood name="shell1" selector="catalytic_residues" distance="8.0"/&gt;
        &lt;Neighborhood name="shell2" selector="shell1" distance="8.0"/&gt;
    &lt;/RESIDUE_SELECTORS&gt;
    &lt;TASKOPERATIONS&gt;
        &lt;InitializeFromCommandline name="init"/&gt;
        &lt;OperateOnResidueSubset name="design_catalytic" selector="catalytic_residues"&gt;
            &lt;RestrictAbsentCanonicalAASRLT aas="DEHKYCST"/&gt;
        &lt;/OperateOnResidueSubset&gt;
        &lt;OperateOnResidueSubset name="design_shell1" selector="shell1"&gt;
            &lt;RestrictToRepackingRLT/&gt;
        &lt;/OperateOnResidueSubset&gt;
        &lt;OperateOnResidueSubset name="design_shell2" selector="shell2"&gt;
            &lt;PreventRepackingRLT/&gt;
        &lt;/OperateOnResidueSubset&gt;
    &lt;/TASKOPERATIONS&gt;
    &lt;FILTERS&gt;
        &lt;MetalContact name="metal_contact" confidence="0.8" catalytic_residues="catalytic_residues"/&gt;
        &lt;BuriedUnsatHbonds name="buried_unsat" jump_number="0" cutoff="5" residue_surface_cutoff="20.0" ignore_surface_res="true"/&gt;
    &lt;/FILTERS&gt;
    &lt;MOVERS&gt;
        &lt;AddConstraints name="add_cst"&gt;
            &lt;AddZincCoordinationConstraints name="zinc_cst" coordinating_residues="10,14,54,78" metal_id="1000" CA_distance_cutoff="6.0" coordinators="NE2 OE1 OE2 ND1"/&gt;
        &lt;/AddConstraints&gt;
        &lt;PackRotamersMover name="design" scorefxn="metal_score" task_operations="init,design_catalytic,design_shell1,design_shell2"/&gt;
        &lt;MinMover name="minimize" scorefxn="metal_score" chi="1" bb="1"/&gt;
    &lt;/MOVERS&gt;
    &lt;PROTOCOLS&gt;
        &lt;Add mover="add_cst"/&gt;
        &lt;Add mover="design"/&gt;
        &lt;Add mover="minimize"/&gt;
        &lt;Add filter="metal_contact"/&gt;
        &lt;Add filter="buried_unsat"/&gt;
    &lt;/PROTOCOLS&gt;
    &lt;OUTPUT scorefxn="ref15"/&gt;
&lt;/ROSETTASCRIPTS&gt;
EOF</span>

<span class="token comment"># 2. 运行金属结合位点设计</span>
~/rosetta/main/source/bin/rosetta_scripts.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> protein.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-parser:protocol</span> metal_site_design.xml <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">50</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5-非天然氨基酸整合设计"><a href="#5-非天然氨基酸整合设计" class="headerlink" title="5. 非天然氨基酸整合设计"></a>5. 非天然氨基酸整合设计</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 准备非天然氨基酸参数文件</span>
~/rosetta/main/source/scripts/python/public/ncaa_to_params.py <span class="token punctuation">\</span>
<span class="token parameter variable">-n</span> UAA <span class="token punctuation">\</span>
--no-pdb <span class="token punctuation">\</span>
<span class="token parameter variable">--clobber</span> <span class="token punctuation">\</span>
uaa.mol2

<span class="token comment"># 2. 创建包含非天然氨基酸的设计XML脚本</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> ncaa_design.xml <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
&lt;ROSETTASCRIPTS&gt;
    &lt;SCOREFXNS&gt;
        &lt;ScoreFunction name="ref15" weights="ref2015"/&gt;
    &lt;/SCOREFXNS&gt;
    &lt;RESIDUE_SELECTORS&gt;
        &lt;Index name="target_res" resnums="10,25,42"/&gt;
        &lt;Neighborhood name="nbr" selector="target_res" distance="8.0"/&gt;
    &lt;/RESIDUE_SELECTORS&gt;
    &lt;TASKOPERATIONS&gt;
        &lt;InitializeFromCommandline name="init"/&gt;
        &lt;IncludeCurrent name="include_current"/&gt;
        &lt;ExtraRotamersGeneric name="ex_rot" ex1="1" ex2="1" extrachi_cutoff="0"/&gt;
        &lt;LimitAromaChi2 name="limit_aro" include_trp="true"/&gt;
        &lt;OperateOnResidueSubset name="design_target" selector="target_res"&gt;
            &lt;RestrictAbsentCanonicalAASRLT aas="X"/&gt;
        &lt;/OperateOnResidueSubset&gt;
        &lt;OperateOnResidueSubset name="repack_nbr" selector="nbr"&gt;
            &lt;RestrictToRepackingRLT/&gt;
        &lt;/OperateOnResidueSubset&gt;
    &lt;/TASKOPERATIONS&gt;
    &lt;MOVERS&gt;
        &lt;PackRotamersMover name="design" scorefxn="ref15" task_operations="init,include_current,ex_rot,limit_aro,design_target,repack_nbr"/&gt;
        &lt;MinMover name="minimize" scorefxn="ref15" chi="1" bb="1"/&gt;
    &lt;/MOVERS&gt;
    &lt;PROTOCOLS&gt;
        &lt;Add mover="design"/&gt;
        &lt;Add mover="minimize"/&gt;
    &lt;/PROTOCOLS&gt;
    &lt;OUTPUT scorefxn="ref15"/&gt;
&lt;/ROSETTASCRIPTS&gt;
EOF</span>

<span class="token comment"># 3. 运行非天然氨基酸设计</span>
~/rosetta/main/source/bin/rosetta_scripts.default.linuxgccrelease <span class="token punctuation">\</span>
<span class="token parameter variable">-database</span> ~/rosetta/main/database <span class="token punctuation">\</span>
<span class="token parameter variable">-s</span> protein.pdb <span class="token punctuation">\</span>
<span class="token parameter variable">-parser:protocol</span> ncaa_design.xml <span class="token punctuation">\</span>
<span class="token parameter variable">-extra_res_fa</span> UAA.params <span class="token punctuation">\</span>
<span class="token parameter variable">-nstruct</span> <span class="token number">50</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      <categories>
        <category>蛋白互作</category>
        <category>PyMOL</category>
      </categories>
  </entry>
  <entry>
    <title>训练您自己的模型——长牡蛎</title>
    <url>/2025/10/22/train-openspliceai/</url>
    <content><![CDATA[<h1 id="训练您自己的模型——长牡蛎"><a href="#训练您自己的模型——长牡蛎" class="headerlink" title="训练您自己的模型——长牡蛎"></a>训练您自己的模型——长牡蛎</h1><p>本指南提供了一个详细、逐步的教程，用于在长牡蛎数据上训练一个 OpenSpliceAI 模型。使用物种特异性的基因组和注释文件，您可以生成训练和测试数据集，然后训练一个专为牡蛎定制的剪接位点预测模型。该流程与人类 MANE 工作流程类似，但根据需要对输入文件和参数进行了调整。</p>
<h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><p>在开始之前，请确保您已经：</p>
<ol>
<li><strong>安装了 OpenSpliceAI</strong>：请按照安装页面的说明进行操作。</li>
<li><strong>克隆了代码库</strong>：从 LiftOn OpenSpliceAI 代码库克隆 OpenSpliceAI 代码库。</li>
<li><strong>下载了长牡蛎的输入文件</strong>：<ul>
<li><strong>参考基因组</strong>：例如，长牡蛎基因组组装可以从这里获取 <code>GCA_902806645.1_cgigas_uk_roslin_v1_genomic.fna</code></li>
<li><strong>注释文件</strong>：长牡蛎基因注释文件 <code>GCF_902806645.1_cgigas_uk_roslin_v1_genomic.gff</code></li>
</ul>
</li>
</ol>
<h2 id="步骤-1：检查输入文件"><a href="#步骤-1：检查输入文件" class="headerlink" title="步骤 1：检查输入文件"></a>步骤 1：检查输入文件</h2><p>转换基因组名字，使其与注释gff文件中名字一致：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 变量配置</span>
<span class="token assign-left variable">FLANKING_SIZE</span><span class="token operator">=</span><span class="token number">400</span>
<span class="token assign-left variable">EXPERIMENT_NAME</span><span class="token operator">=</span><span class="token string">"oyster_full_dataset"</span>
<span class="token assign-left variable">TRAIN_DATASET</span><span class="token operator">=</span><span class="token string">"/home/hhhh/OpenSpliceAI/OpenSpliceAI/spliciai/train_test_dataset/dataset_train.h5"</span>
<span class="token assign-left variable">TEST_DATASET</span><span class="token operator">=</span><span class="token string">"/home/hhhh/OpenSpliceAI/OpenSpliceAI/spliciai/train_test_dataset/dataset_test.h5"</span>
<span class="token assign-left variable">OUTPUT_DIR</span><span class="token operator">=</span><span class="token string">"/home/hhhh/OpenSpliceAI/OpenSpliceAI/spliciai/oyster_model_train_outdir"</span>
<span class="token assign-left variable">PROJECT_NAME</span><span class="token operator">=</span><span class="token string">"OpenSpliceAI-Oyster"</span>
<span class="token assign-left variable">RANDOM_SEED</span><span class="token operator">=</span><span class="token number">42</span>
<span class="token assign-left variable">MODEL</span><span class="token operator">=</span><span class="token string">"SpliceAI"</span>
<span class="token assign-left variable">LOSS</span><span class="token operator">=</span><span class="token string">"cross_entropy_loss"</span>
<span class="token assign-left variable">EPOCHS</span><span class="token operator">=</span><span class="token number">20</span>
<span class="token assign-left variable">PATIENCE</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">SCHEDULER</span><span class="token operator">=</span><span class="token string">"MultiStepLR"</span>

<span class="token comment"># 创建输出目录（如果不存在）</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token string">"<span class="token variable">$OUTPUT_DIR</span>"</span>

<span class="token comment"># 执行训练命令</span>
openspliceai train <span class="token punctuation">\</span>
   --flanking-size <span class="token variable">$FLANKING_SIZE</span> <span class="token punctuation">\</span>
   --exp-num <span class="token variable">$EXPERIMENT_NAME</span> <span class="token punctuation">\</span>
   --train-dataset <span class="token variable">$TRAIN_DATASET</span> <span class="token punctuation">\</span>
   --test-dataset <span class="token variable">$TEST_DATASET</span> <span class="token punctuation">\</span>
   --output-dir <span class="token variable">$OUTPUT_DIR</span> <span class="token punctuation">\</span>
   --project-name <span class="token variable">$PROJECT_NAME</span> <span class="token punctuation">\</span>
   --random-seed <span class="token variable">$RANDOM_SEED</span> <span class="token punctuation">\</span>
   <span class="token parameter variable">--model</span> <span class="token variable">$MODEL</span> <span class="token punctuation">\</span>
   <span class="token parameter variable">--loss</span> <span class="token variable">$LOSS</span> <span class="token punctuation">\</span>
   <span class="token parameter variable">--epochs</span> <span class="token variable">$EPOCHS</span> <span class="token punctuation">\</span>
   <span class="token parameter variable">--patience</span> <span class="token variable">$PATIENCE</span> <span class="token punctuation">\</span>
   <span class="token parameter variable">--scheduler</span> <span class="token variable">$SCHEDULER</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Training completed. Model and logs saved to <span class="token variable">$OUTPUT_DIR</span>."</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>命名为<code>1.n2n.sh</code>，<code>chmod +x 1.n2n.sh</code>，<code>./1.n2n.sh</code> 运行命令。</p>
<h2 id="步骤-2：创建训练和测试数据集"><a href="#步骤-2：创建训练和测试数据集" class="headerlink" title="步骤 2：创建训练和测试数据集"></a>步骤 2：创建训练和测试数据集</h2><p>使用 <code>create-data</code> 子命令处理小鼠参考基因组和注释文件，将其转换为 HDF5 格式的数据集。此步骤提取基因序列，选择典型转录本（通常是蛋白质编码的），并对序列和剪接位点标签进行独热编码。</p>
<p>运行以下命令（请根据需要更新文件名）：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">GENOME</span><span class="token operator">=</span><span class="token string">"GCA_902806645.1_cgigas_uk_roslin_v1_genomic_fixed.fna"</span>
<span class="token assign-left variable">ANNOTATION</span><span class="token operator">=</span><span class="token string">"GCF_902806645.1_cgigas_uk_roslin_v1_genomic.gff"</span>
<span class="token assign-left variable">OUTPUT_DIR</span><span class="token operator">=</span><span class="token string">"train_test_dataset/"</span>

<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">${OUTPUT_DIR}</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Starting accurate data processing at <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span><span class="token variable">)</span></span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"This may take several hours for a complete genome..."</span>

openspliceai create-data <span class="token punctuation">\</span>
    --genome-fasta <span class="token string">"<span class="token variable">$GENOME</span>"</span> <span class="token punctuation">\</span>
    --annotation-gff <span class="token string">"<span class="token variable">$ANNOTATION</span>"</span> <span class="token punctuation">\</span>
    --output-dir <span class="token string">"<span class="token variable">$OUTPUT_DIR</span>"</span> <span class="token punctuation">\</span>
    --parse-type canonical <span class="token punctuation">\</span>
    --split-method random <span class="token punctuation">\</span>
    --remove-paralogs <span class="token punctuation">\</span>
    --min-identity <span class="token number">0.8</span> <span class="token punctuation">\</span>
    --min-coverage <span class="token number">0.8</span> <span class="token punctuation">\</span>
    --canonical-only <span class="token punctuation">\</span>
    <span class="token parameter variable">--biotype</span> protein-coding <span class="token punctuation">\</span>
    --write-fasta <span class="token punctuation">\</span>
    <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">tee</span> <span class="token string">"<span class="token variable">$OUTPUT_DIR</span>/processing.log"</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Completed at <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span><span class="token variable">)</span></span>"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"Check <span class="token variable">$OUTPUT_DIR</span> for output files"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>关键选项解释</strong>：</p>
<ul>
<li><code>--remove-paralogs</code>：过滤掉旁系同源序列以避免数据泄露。</li>
<li><code>--min-identity 0.8</code> 和 <code>--min-coverage 0.8</code>：设置过滤阈值。</li>
<li><code>--parse-type canonical</code>：选择每个基因最长的典型转录本。</li>
<li><code>--split-method mouse</code>：应用小鼠特定的规则将数据分割成训练集和测试集。</li>
<li><code>--canonical-only</code>：将标记限制在保守的剪接位点模体。</li>
</ul>
<p>运行此命令后，检查输出目录中的两个主要文件：</p>
<ul>
<li><code>dataset_train.h5</code>（训练数据集）</li>
<li><code>dataset_test.h5</code>（测试数据集）</li>
</ul>
<p>命名为<code>2.create-data_cg.sh</code>，<code>chmod +x 2.create-data_cg.sh</code>，<code>./2.create-data_cg.sh</code> 运行命令。</p>
<h2 id="步骤-3：训练长牡蛎模型"><a href="#步骤-3：训练长牡蛎模型" class="headerlink" title="步骤 3：训练长牡蛎模型"></a>步骤 3：训练长牡蛎模型</h2><p>数据集准备好后，使用 <code>train</code> 子命令训练您的小鼠剪接位点预测模型。您可以根据应用选择合适的两侧侧翼序列长度；在此示例中，我们使用 10,000 个核苷酸的侧翼大小，这在先前的研究中已被证明是有效的。</p>
<p>运行以下命令（根据需要调整文件路径和参数）：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># 变量配置</span>
<span class="token assign-left variable">FLANKING_SIZE</span><span class="token operator">=</span><span class="token number">400</span>
<span class="token assign-left variable">EXPERIMENT_NAME</span><span class="token operator">=</span><span class="token string">"oyster_full_dataset"</span>
<span class="token assign-left variable">TRAIN_DATASET</span><span class="token operator">=</span><span class="token string">"/home/hhhh/OpenSpliceAI/OpenSpliceAI/spliciai/train_test_dataset/dataset_train.h5"</span>
<span class="token assign-left variable">TEST_DATASET</span><span class="token operator">=</span><span class="token string">"/home/hhhh/OpenSpliceAI/OpenSpliceAI/spliciai/train_test_dataset/dataset_test.h5"</span>
<span class="token assign-left variable">OUTPUT_DIR</span><span class="token operator">=</span><span class="token string">"/home/hhhh/OpenSpliceAI/OpenSpliceAI/spliciai/oyster_model_train_outdir"</span>
<span class="token assign-left variable">PROJECT_NAME</span><span class="token operator">=</span><span class="token string">"OpenSpliceAI-Oyster"</span>
<span class="token assign-left variable">RANDOM_SEED</span><span class="token operator">=</span><span class="token number">42</span>
<span class="token assign-left variable">MODEL</span><span class="token operator">=</span><span class="token string">"SpliceAI"</span>
<span class="token assign-left variable">LOSS</span><span class="token operator">=</span><span class="token string">"cross_entropy_loss"</span>
<span class="token assign-left variable">EPOCHS</span><span class="token operator">=</span><span class="token number">20</span>
<span class="token assign-left variable">PATIENCE</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">SCHEDULER</span><span class="token operator">=</span><span class="token string">"MultiStepLR"</span>

<span class="token comment"># 创建输出目录（如果不存在）</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token string">"<span class="token variable">$OUTPUT_DIR</span>"</span>

<span class="token comment"># 执行训练命令</span>
openspliceai train <span class="token punctuation">\</span>
   --flanking-size <span class="token variable">$FLANKING_SIZE</span> <span class="token punctuation">\</span>
   --exp-num <span class="token variable">$EXPERIMENT_NAME</span> <span class="token punctuation">\</span>
   --train-dataset <span class="token variable">$TRAIN_DATASET</span> <span class="token punctuation">\</span>
   --test-dataset <span class="token variable">$TEST_DATASET</span> <span class="token punctuation">\</span>
   --output-dir <span class="token variable">$OUTPUT_DIR</span> <span class="token punctuation">\</span>
   --project-name <span class="token variable">$PROJECT_NAME</span> <span class="token punctuation">\</span>
   --random-seed <span class="token variable">$RANDOM_SEED</span> <span class="token punctuation">\</span>
   <span class="token parameter variable">--model</span> <span class="token variable">$MODEL</span> <span class="token punctuation">\</span>
   <span class="token parameter variable">--loss</span> <span class="token variable">$LOSS</span> <span class="token punctuation">\</span>
   <span class="token parameter variable">--epochs</span> <span class="token variable">$EPOCHS</span> <span class="token punctuation">\</span>
   <span class="token parameter variable">--patience</span> <span class="token variable">$PATIENCE</span> <span class="token punctuation">\</span>
   <span class="token parameter variable">--scheduler</span> <span class="token variable">$SCHEDULER</span>

<span class="token builtin class-name">echo</span> <span class="token string">"Training completed. Model and logs saved to <span class="token variable">$OUTPUT_DIR</span>."</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>选项解释</strong>：</p>
<ul>
<li><code>--flanking-size 10000</code>：将侧翼区域设置为 10,000 个核苷酸。</li>
<li><code>--exp-num mouse_full_dataset</code>：此实验的标签。</li>
<li><code>--random-seed 42</code>：确保结果可重现。</li>
<li><code>--model SpliceAI</code>：使用 SpliceAI 模型架构。</li>
<li><code>--loss cross_entropy_loss</code>：指定损失函数。</li>
<li>模型检查点（例如 <code>model_best.pt</code>）和训练日志将保存在指定的输出目录中。</li>
</ul>
<p>命名为<code>3.train_model.sh</code>，<code>chmod +x 3.train_model.sh</code>，<code>./3.train_model.sh</code> 运行命令。</p>
<h2 id="步骤-4（可选）：转移模型"><a href="#步骤-4（可选）：转移模型" class="headerlink" title="步骤 4（可选）：转移模型"></a>步骤 4（可选）：转移模型</h2><p>下面可以不运行，前面模型训练使用的fz == 400，机器不行，没跑大的，所以下面使用<code>transfer</code>训练2000的。</p>
<p>运行以下命令（根据需要调整文件路径和参数）：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">openspliceai transfer <span class="token punctuation">\</span>
   --train-dataset /home/hhhh/OpenSpliceAI/OpenSpliceAI/spliciai/train_test_dataset/dataset_train.h5 <span class="token punctuation">\</span>
   --test-dataset /home/hhhh/OpenSpliceAI/OpenSpliceAI/spliciai/train_test_dataset/dataset_test.h5 <span class="token punctuation">\</span>
   --pretrained-model /home/hhhh/OpenSpliceAI/OpenSpliceAI/spliciai/oyster_model_train_outdir/SpliceAI_OpenSpliceAI-Oyster_400_oyster_full_dataset_rs42/oyster_full_dataset/models/model_best.pt <span class="token punctuation">\</span>
   --flanking-size <span class="token number">2000</span> <span class="token punctuation">\</span>
   <span class="token parameter variable">--unfreeze</span> <span class="token number">2</span> <span class="token punctuation">\</span>
   <span class="token parameter variable">--scheduler</span> CosineAnnealingWarmRestarts <span class="token punctuation">\</span>
   <span class="token parameter variable">--loss</span> focal_loss <span class="token punctuation">\</span>
   <span class="token parameter variable">--epochs</span> <span class="token number">10</span> <span class="token punctuation">\</span>
   <span class="token parameter variable">--patience</span> <span class="token number">3</span> <span class="token punctuation">\</span>
   --early-stopping <span class="token punctuation">\</span>
   --project-name OpenSpliceAI-Oyster_2000_transfer <span class="token punctuation">\</span>
   --output-dir /home/hhhh/OpenSpliceAI/OpenSpliceAI/spliciai/oyster_model_train_outdir<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>命名为<code>4.transfer_model.sh</code>，<code>chmod +x 4.transfer_model.sh</code>，<code>./4.transfer_model.sh</code> 运行命令。</p>
<h2 id="步骤-5（可选）：校准长牡蛎模型"><a href="#步骤-5（可选）：校准长牡蛎模型" class="headerlink" title="步骤 5（可选）：校准长牡蛎模型"></a>步骤 5（可选）：校准长牡蛎模型</h2><p>校准可以优化模型的输出概率，使其更能反映经验上的剪接位点可能性。如果需要，可以使用 <code>calibrate</code> 子命令运行校准步骤。</p>
<p>执行：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 强制使用CPU避免内存问题</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CUDA_VISIBLE_DEVICES</span><span class="token operator">=</span><span class="token string">""</span>

openspliceai calibrate <span class="token punctuation">\</span>
   --flanking-size <span class="token number">2000</span> <span class="token punctuation">\</span>
   --train-dataset train_test_dataset/dataset_train.h5 <span class="token punctuation">\</span>
   --test-dataset train_test_dataset/dataset_test.h5 <span class="token punctuation">\</span>
   --output-dir model_calibrate_outdir_oyster/ <span class="token punctuation">\</span>
   --project-name OpenSpliceAI-oyster-calibrate <span class="token punctuation">\</span>
   --random-seed <span class="token number">42</span> <span class="token punctuation">\</span>
   --pretrained-model oyster_model_train_outdir/SpliceAI_OpenSpliceAI-Oyster_2000_transfer_2000_0_rs42/0/models/model_best.pt <span class="token punctuation">\</span>
   <span class="token parameter variable">--loss</span> cross_entropy_loss<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>此命令：</p>
<ul>
<li>从您的长牡蛎训练运行中加载最佳模型检查点。</li>
<li>优化用于校准的温度参数。</li>
<li>将校准输出（例如，温度参数、可靠性曲线）保存在指定目录中。</li>
</ul>
<h2 id="步骤-6：部署您训练好的长牡蛎模型"><a href="#步骤-6：部署您训练好的长牡蛎模型" class="headerlink" title="步骤 6：部署您训练好的长牡蛎模型"></a>步骤 6：部署您训练好的长牡蛎模型</h2><p>训练（以及可选的校准）完成后，您的小鼠模型就可以使用了。您现在可以：</p>
<ul>
<li><strong>预测剪接位点</strong>：使用 <code>predict</code> 子命令对新的长牡蛎 FASTA 序列进行推理。</li>
<li><strong>分析变异效应</strong>：使用 <code>variant</code> 子命令评估特定突变如何影响长牡蛎基因组中的剪接。</li>
</ul>
<h3 id="测试1："><a href="#测试1：" class="headerlink" title="测试1："></a>测试1：</h3><p>执行：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token builtin class-name">cd</span> /home/hhhh/OpenSpliceAI/OpenSpliceAI/spliciai

<span class="token builtin class-name">echo</span> <span class="token string">"=== 使用绝对路径测试 ==="</span>

<span class="token comment"># 使用绝对路径</span>
<span class="token assign-left variable">MODEL_PATH</span><span class="token operator">=</span><span class="token string">"/home/hhhh/OpenSpliceAI/OpenSpliceAI/spliciai/oyster_model_train_outdir/SpliceAI_OpenSpliceAI-Oyster_2000_transfer_2000_0_rs42/0/models/model_best.pt"</span>

<span class="token builtin class-name">echo</span> <span class="token string">"模型路径: <span class="token variable">$MODEL_PATH</span>"</span>
<span class="token function">ls</span> <span class="token parameter variable">-la</span> <span class="token string">"<span class="token variable">$MODEL_PATH</span>"</span>

<span class="token comment"># 创建测试序列</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> test_snp.fasta <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
&gt;reference_sequence
$(python3 -c "import random; random.seed(42); print(''.join(random.choices(['A','C','G','T'], k=1000)))")
&gt;mutant_sequence  
$(python3 -c "import random; random.seed(42); s=''.join(random.choices(['A','C','G','T'], k=1000)); print(s[:500] + 'A' + s[501:])")
EOF</span>

<span class="token builtin class-name">echo</span> <span class="token string">"测试序列已创建"</span>

<span class="token comment"># 运行预测</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CUDA_VISIBLE_DEVICES</span><span class="token operator">=</span><span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"开始剪接位点预测..."</span>
openspliceai predict <span class="token punctuation">\</span>
    --input-sequence <span class="token string">"test_snp.fasta"</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--model</span> <span class="token string">"<span class="token variable">$MODEL_PATH</span>"</span> <span class="token punctuation">\</span>
    --flanking-size <span class="token number">2000</span> <span class="token punctuation">\</span>
    --output-dir <span class="token string">"snp_prediction_results"</span>

<span class="token builtin class-name">echo</span> <span class="token string">"=== 预测完成 ==="</span>
<span class="token builtin class-name">echo</span> <span class="token string">"结果文件:"</span>
<span class="token function">find</span> snp_prediction_results <span class="token parameter variable">-type</span> f <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>命名为<code>6.single_snp_test.sh</code>，<code>chmod +x 6.single_snp_test.sh</code>，<code>./6.single_snp_test.sh</code> 运行命令。</p>
<h3 id="测试2："><a href="#测试2：" class="headerlink" title="测试2："></a>测试2：</h3><p>执行：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># OpenSpliceAI 自动提取染色体长度版本</span>

<span class="token builtin class-name">echo</span> <span class="token string">"========================================"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"OpenSpliceAI - 自动提取染色体长度"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"========================================"</span>

<span class="token comment"># 设置变量</span>
<span class="token assign-left variable">INPUT_TSV</span><span class="token operator">=</span><span class="token string">"filtered_three2one.tsv"</span>
<span class="token assign-left variable">MODEL_PATH</span><span class="token operator">=</span><span class="token string">"/home/hhhh/OpenSpliceAI/OpenSpliceAI/spliciai/oyster_model_train_outdir/SpliceAI_OpenSpliceAI-Oyster_2000_transfer_2000_0_rs42/0/models/model_best.pt"</span>
<span class="token assign-left variable">REF_GENOME</span><span class="token operator">=</span><span class="token string">"GCA_902806645.1_cgigas_uk_roslin_v1_genomic_fixed.fna"</span>
<span class="token assign-left variable">OUTPUT_DIR</span><span class="token operator">=</span><span class="token string">"./final_fix_results_auto"</span>
<span class="token assign-left variable">INPUT_GFF</span><span class="token operator">=</span><span class="token string">"GCF_902806645.1_cgigas_uk_roslin_v1_genomic.gff"</span>
<span class="token assign-left variable">OUTPUT_TXT</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/oyster_annotation_clean.txt"</span>
<span class="token assign-left variable">ANNOTATION</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${OUTPUT_TXT}</span>"</span>

<span class="token comment"># 创建输出目录</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">${OUTPUT_DIR}</span>

<span class="token comment"># 1. 自动从FASTA文件提取染色体长度</span>
<span class="token builtin class-name">echo</span> <span class="token string">"[1/6] 从FASTA文件提取染色体长度..."</span>

<span class="token comment"># 创建提取染色体长度的Python脚本</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> <span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/extract_chrom_lengths.py"</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
import re
import sys

def extract_chromosome_lengths(fasta_file, output_file):
    print(f"从FASTA文件提取染色体长度: {fasta_file}")
    
    chrom_lengths = {}
    current_chrom = None
    current_length = 0
    
    with open(fasta_file, 'r') as f:
        for line in f:
            if line.startswith('&gt;'):
                # 保存前一个染色体的长度
                if current_chrom and current_length &gt; 0:
                    chrom_lengths[current_chrom] = current_length
                
                # 解析新的染色体头
                header = line[1:].strip()
                # 提取染色体名称（通常是第一个空格前的部分）
                chrom_name = header.split()[0]
                current_chrom = chrom_name
                current_length = 0
                
                print(f"找到染色体: {chrom_name}")
            else:
                # 计算序列长度
                current_length += len(line.strip())
        
        # 保存最后一个染色体
        if current_chrom and current_length &gt; 0:
            chrom_lengths[current_chrom] = current_length
    
    print(f"\n📊 染色体长度统计:")
    for chrom, length in chrom_lengths.items():
        print(f"  {chrom}: {length:,} bp")
    
    # 写入VCF头文件
    with open(output_file, 'w') as out:
        out.write("##fileformat=VCFv4.2\n")
        out.write('##INFO=&lt;ID=SpliceAI,Number=.,Type=String,Description="OpenSpliceAI annotation"&gt;\n')
        
        # 写入准确的contig定义
        for chrom, length in chrom_lengths.items():
            out.write(f'##contig=&lt;ID={chrom},length={length}&gt;\n')
        
        out.write("#CHROM\tPOS\tID\tREF\tALT\tQUAL\tFILTER\tINFO\n")
    
    print(f"✅ VCF头文件已生成: {output_file}")
    return chrom_lengths

if __name__ == "__main__":
    if len(sys.argv) != 3:
        print("用法: python extract_chrom_lengths.py input.fasta output.vcf_header")
        sys.exit(1)
    
    chrom_lengths = extract_chromosome_lengths(sys.argv[1], sys.argv[2])
EOF</span>

<span class="token comment"># 运行染色体长度提取</span>
python3 <span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/extract_chrom_lengths.py"</span> <span class="token string">"<span class="token variable">${REF_GENOME}</span>"</span> <span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/vcf_header.txt"</span>

<span class="token comment"># 2. 创建过滤后的GFF注释文件</span>
<span class="token builtin class-name">echo</span> <span class="token string">"[2/6] 创建过滤后的GFF注释文件..."</span>

<span class="token function">cat</span> <span class="token operator">&gt;</span> <span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/fix_gff_with_filter.py"</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
import pandas as pd
import re
import sys

def extract_gene_info_with_filter(gff_file, output_file):
    print("读取GFF文件并提取完整基因信息（过滤无外显子基因）...")
    
    genes = {}
    mrnas = {}
    exons = []
    
    with open(gff_file, 'r') as f:
        for line in f:
            if line.startswith('#'):
                continue
            
            fields = line.strip().split('\t')
            if len(fields) &lt; 9:
                continue
            
            chrom, source, feature_type, start, end, score, strand, phase, attributes = fields
            
            if feature_type == 'gene':
                gene_id = 'Unknown'
                gene_name = 'Unknown'
                
                if 'ID=' in attributes:
                    gene_id = attributes.split('ID=')[1].split(';')[0]
                if 'gene=' in attributes:
                    gene_name = attributes.split('gene=')[1].split(';')[0]
                elif 'Name=' in attributes:
                    gene_name = attributes.split('Name=')[1].split(';')[0]
                elif gene_id != 'Unknown':
                    gene_name = gene_id
                
                genes[gene_id] = {
                    'name': gene_name,
                    'chrom': chrom,
                    'strand': strand,
                    'start': int(start),
                    'end': int(end),
                    'mrnas': []
                }
            
            elif feature_type == 'mRNA':
                mrna_id = 'Unknown'
                parent_gene = 'Unknown'
                
                if 'ID=' in attributes:
                    mrna_id = attributes.split('ID=')[1].split(';')[0]
                if 'Parent=' in attributes:
                    parent_gene = attributes.split('Parent=')[1].split(';')[0]
                
                mrnas[mrna_id] = {
                    'parent': parent_gene,
                    'chrom': chrom,
                    'strand': strand,
                    'start': int(start),
                    'end': int(end),
                    'exons': []
                }
                
                if parent_gene in genes:
                    genes[parent_gene]['mrnas'].append(mrna_id)
            
            elif feature_type == 'exon':
                parent_mrna = 'Unknown'
                
                if 'Parent=' in attributes:
                    parent_mrna = attributes.split('Parent=')[1].split(';')[0]
                
                exons.append({
                    'parent': parent_mrna,
                    'chrom': chrom,
                    'start': int(start),
                    'end': int(end)
                })
    
    print(f"找到 {len(genes)} 个基因, {len(mrnas)} 个mRNA, {len(exons)} 个外显子")
    
    # 关联外显子到mRNA
    for exon in exons:
        parent = exon['parent']
        if parent in mrnas:
            mrnas[parent]['exons'].append((exon['start'], exon['end']))
    
    # 为每个基因选择最长的mRNA作为代表，并过滤无外显子的基因
    print("处理基因和转录本（过滤无外显子基因）...")
    gene_records = []
    skipped_genes = 0
    
    for gene_id, gene_info in genes.items():
        if not gene_info['mrnas']:
            skipped_genes += 1
            continue
        else:
            longest_mrna = None
            max_length = 0
            
            for mrna_id in gene_info['mrnas']:
                if mrna_id in mrnas:
                    mrna = mrnas[mrna_id]
                    length = mrna['end'] - mrna['start']
                    if length &gt; max_length:
                        max_length = length
                        longest_mrna = mrna
            
            if longest_mrna and longest_mrna['exons']:
                sorted_exons = sorted(longest_mrna['exons'], key=lambda x: x[0])
                exon_starts = [exon[0] for exon in sorted_exons]
                exon_ends = [exon[1] for exon in sorted_exons]
                
                gene_records.append({
                    'name': gene_info['name'],
                    'chrom': gene_info['chrom'],
                    'strand': gene_info['strand'],
                    'tx_start': longest_mrna['start'],
                    'tx_end': longest_mrna['end'],
                    'exon_starts': exon_starts,
                    'exon_ends': exon_ends
                })
            else:
                skipped_genes += 1
    
    print(f"生成 {len(gene_records)} 个基因记录")
    print(f"跳过 {skipped_genes} 个无外显子信息的基因")
    
    # 写入输出文件
    print("写入输出文件...")
    with open(output_file, 'w') as out:
        out.write("#NAME\tCHROM\tSTRAND\tTX_START\tTX_END\tEXON_START\tEXON_END\n")
        
        for gene in gene_records:
            exon_start_str = ','.join(map(str, gene['exon_starts'])) + ','
            exon_end_str = ','.join(map(str, gene['exon_ends'])) + ','
            
            out.write(f"{gene['name']}\t{gene['chrom']}\t{gene['strand']}\t")
            out.write(f"{gene['tx_start']}\t{gene['tx_end']}\t")
            out.write(f"{exon_start_str}\t{exon_end_str}\n")
    
    print(f"转换完成: {output_file}")
    
    print(f"\n📊 统计信息:")
    print(f"总基因数: {len(genes)}")
    print(f"有效基因数（有外显子）: {len(gene_records)}")
    print(f"无效基因数（无外显子）: {skipped_genes}")
    print(f"过滤率: {skipped_genes/len(genes)*100:.1f}%")

if __name__ == "__main__":
    if len(sys.argv) != 3:
        print("用法: python fix_gff_with_filter.py input.gff output.txt")
        sys.exit(1)
    
    extract_gene_info_with_filter(sys.argv[1], sys.argv[2])
EOF</span>

python3 <span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/fix_gff_with_filter.py"</span> <span class="token string">"<span class="token variable">${INPUT_GFF}</span>"</span> <span class="token string">"<span class="token variable">${OUTPUT_TXT}</span>"</span>

<span class="token comment"># 3. 创建VCF文件（使用准确的染色体长度）</span>
<span class="token builtin class-name">echo</span> <span class="token string">"[3/6] 创建VCF文件（使用准确染色体长度）..."</span>
<span class="token assign-left variable">INPUT_VCF</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/input_variants.vcf"</span>

<span class="token comment"># 使用提取的VCF头</span>
<span class="token function">cat</span> <span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/vcf_header.txt"</span> <span class="token operator">&gt;</span> <span class="token string">"<span class="token variable">${INPUT_VCF}</span>"</span>

<span class="token comment"># 添加变异数据</span>
<span class="token function">awk</span> -F<span class="token string">'\t'</span> <span class="token string">'
NR==1 { next }
{
    chrom = $1;
    pos = $2;
    ref = $3;
    alt = $4;
    if (length(ref) == 1 &amp;&amp; length(alt) == 1) {
        print chrom "\t" pos "\t.\t" ref "\t" alt "\t.\tPASS\t."
    }
}'</span> <span class="token string">"<span class="token variable">${INPUT_TSV}</span>"</span> <span class="token operator">&gt;&gt;</span> <span class="token string">"<span class="token variable">${INPUT_VCF}</span>"</span>

<span class="token assign-left variable">VARIANT_COUNT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token string">'^#'</span> <span class="token string">"<span class="token variable">${INPUT_VCF}</span>"</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"✅ VCF创建完成: <span class="token variable">${VARIANT_COUNT}</span> 个变异"</span>

<span class="token comment"># 4. 运行预测</span>
<span class="token builtin class-name">echo</span> <span class="token string">"[4/6] 运行OpenSpliceAI预测..."</span>
<span class="token assign-left variable">OUTPUT_VCF</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/output.vcf"</span>

<span class="token builtin class-name">echo</span> <span class="token string">"使用准确的染色体长度和过滤后的注释文件..."</span>
openspliceai variant <span class="token punctuation">\</span>
    <span class="token parameter variable">-I</span> <span class="token string">"<span class="token variable">${INPUT_VCF}</span>"</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">-R</span> <span class="token string">"<span class="token variable">${REF_GENOME}</span>"</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">-A</span> <span class="token string">"<span class="token variable">${ANNOTATION}</span>"</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">-m</span> <span class="token string">"<span class="token variable">${MODEL_PATH}</span>"</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">-f</span> <span class="token number">2000</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">-D</span> <span class="token number">50</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">-O</span> <span class="token string">"<span class="token variable">${OUTPUT_VCF}</span>"</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">tee</span> <span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/prediction.log"</span>

<span class="token comment"># 检查预测结果</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">${OUTPUT_VCF}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">ANNOTATED_COUNT</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">grep</span> <span class="token parameter variable">-c</span> <span class="token string">'SpliceAI'</span> <span class="token string">"<span class="token variable">${OUTPUT_VCF}</span>"</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null <span class="token operator">||</span> <span class="token builtin class-name">echo</span> <span class="token string">"0"</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">echo</span> <span class="token string">"✅ 预测完成: <span class="token variable">${ANNOTATED_COUNT}</span> 个变异被注释"</span>
<span class="token keyword">else</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"❌ 预测失败"</span>
    <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token keyword">fi</span>

<span class="token comment"># 5. 提取结果</span>
<span class="token builtin class-name">echo</span> <span class="token string">"[5/6] 提取预测结果..."</span>
<span class="token assign-left variable">FINAL_RESULTS</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/final_results.tsv"</span>

<span class="token function">cat</span> <span class="token operator">&gt;</span> <span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/extract_results.py"</span> <span class="token operator">&lt;&lt;</span> <span class="token string">'EOF'
import sys
import re

vcf_file = sys.argv[1]
output_file = sys.argv[2]

with open(vcf_file, 'r') as f, open(output_file, 'w') as out:
    out.write("Chromosome\tPosition\tRef\tAlt\tGene\tDS_AG\tDS_AL\tDS_DG\tDS_DL\tMax_Score\tImpact\n")
    
    count = 0
    for line in f:
        if line.startswith('#'):
            continue
        
        fields = line.strip().split('\t')
        if len(fields) &lt; 8:
            continue
        
        chrom, pos, _, ref, alt, _, _, info = fields
        
        if 'SpliceAI=' in info:
            match = re.search(r'SpliceAI=([^;]+)', info)
            if match:
                data = match.group(1).split('|')
                if len(data) &gt;= 7:
                    gene = data[1]
                    try:
                        ds_ag = float(data[2]) if data[2] != '.' else 0.0
                        ds_al = float(data[3]) if data[3] != '.' else 0.0
                        ds_dg = float(data[4]) if data[4] != '.' else 0.0
                        ds_dl = float(data[5]) if data[5] != '.' else 0.0
                        
                        max_score = max(ds_ag, ds_al, ds_dg, ds_dl)
                        
                        if max_score &gt; 0.8:
                            impact = "VERY_HIGH"
                        elif max_score &gt; 0.5:
                            impact = "HIGH"
                        elif max_score &gt; 0.2:
                            impact = "MEDIUM"
                        else:
                            impact = "LOW"
                        
                        out.write(f"{chrom}\t{pos}\t{ref}\t{alt}\t{gene}\t{ds_ag:.6f}\t{ds_al:.6f}\t{ds_dg:.6f}\t{ds_dl:.6f}\t{max_score:.6f}\t{impact}\n")
                        count += 1
                    except ValueError:
                        continue

print(f"提取了 {count} 个变异的结果")
EOF</span>

python3 <span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/extract_results.py"</span> <span class="token string">"<span class="token variable">${OUTPUT_VCF}</span>"</span> <span class="token string">"<span class="token variable">${FINAL_RESULTS}</span>"</span>

<span class="token comment"># 6. 清理和报告</span>
<span class="token builtin class-name">echo</span> <span class="token string">"[6/6] 清理和生成报告..."</span>
<span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/extract_chrom_lengths.py"</span> <span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/fix_gff_with_filter.py"</span> <span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/extract_results.py"</span> <span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/vcf_header.txt"</span>

<span class="token comment"># 显示染色体长度信息</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"📏 使用的准确染色体长度:"</span>
python3 <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
import re

with open("<span class="token variable">${REF_GENOME}</span>", 'r') as f:
    chrom_lengths = {}
    current_chrom = None
    current_length = 0
    
    for line in f:
        if line.startswith('&gt;'):
            if current_chrom and current_length &gt; 0:
                chrom_lengths[current_chrom] = current_length
            
            header = line[1:].strip()
            chrom_name = header.split()[0]
            current_chrom = chrom_name
            current_length = 0
        else:
            current_length += len(line.strip())
    
    if current_chrom and current_length &gt; 0:
        chrom_lengths[current_chrom] = current_length

print("染色体长度统计:")
for chrom, length in sorted(chrom_lengths.items()):
    print(f"  {chrom}: {length:,} bp")
EOF</span>

<span class="token comment"># 最终报告</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"========================================"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"🎉 使用准确染色体长度完成！"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"========================================"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"📊 结果统计:"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"  - 输入变异: <span class="token variable">${VARIANT_COUNT}</span> 个"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"  - 成功注释: <span class="token variable">${ANNOTATED_COUNT}</span> 个"</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">${VARIANT_COUNT}</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">SUCCESS_RATE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"scale=2; <span class="token variable">${ANNOTATED_COUNT}</span> * 100 / <span class="token variable">${VARIANT_COUNT}</span>"</span> <span class="token operator">|</span> <span class="token function">bc</span><span class="token variable">)</span></span>
    <span class="token builtin class-name">echo</span> <span class="token string">"  - 成功率: <span class="token variable">${SUCCESS_RATE}</span>%"</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"🔧 改进内容:"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"  ✅ 自动从FASTA提取准确染色体长度"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"  ✅ 过滤无外显子信息的基因"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"  ✅ 使用真实的基因组坐标"</span>

<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"📁 输出文件:"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"  📋 <span class="token variable">${FINAL_RESULTS}</span> (主要结果)"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"  🧬 <span class="token variable">${OUTPUT_TXT}</span> (过滤后的基因注释)"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"  🧬 <span class="token variable">${OUTPUT_VCF}</span> (预测结果VCF)"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>命名为<code>7.run_openspliceai_predict.sh</code>，<code>chmod +x 7.run_openspliceai_predict.sh</code>，<code>./7.run_openspliceai_predict.sh</code> 运行命令。</p>
<h3 id="结果展示："><a href="#结果展示：" class="headerlink" title="结果展示："></a>结果展示：</h3><p>执行：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

<span class="token comment"># OpenSpliceAI 最终结果详细分析报告</span>

<span class="token builtin class-name">echo</span> <span class="token string">"========================================"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"🎊 OpenSpliceAI 最终成果报告"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"========================================"</span>

<span class="token assign-left variable">OUTPUT_DIR</span><span class="token operator">=</span><span class="token string">"./final_fix_results_auto"</span>
<span class="token assign-left variable">FINAL_RESULTS</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${OUTPUT_DIR}</span>/final_results.tsv"</span>

<span class="token comment"># 详细结果分析</span>
python3 <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
import pandas as pd
import numpy as np
from datetime import datetime

# 读取结果文件
df = pd.read_csv("<span class="token variable">${FINAL_RESULTS}</span>", sep='<span class="token entity" title="\t">\t</span>')

print("🚀 重大性能提升!")
print("=" * 50)
print("优化前后对比:")
print("  🔴 初始版本:  4/358 (1.11%)")
print("  🟡 中间版本: 50/358 (13.96%)") 
print("  🟢 最终版本: 235/358 (65.64%)")
print("")
print(f"📈 性能提升: +64.53个百分点!")

print(f"<span class="token entity" title="\n">\n</span>📊 详细结果分析 - {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
print("=" * 60)

# 基本统计
total_variants = len(df)
print(f"总注释变异数: {total_variants}")

# 影响级别统计
impact_counts = df['Impact'].value_counts()
print(f"<span class="token entity" title="\n">\n</span>🎯 影响级别分布:")
for impact in ['VERY_HIGH', 'HIGH', 'MEDIUM', 'LOW']:
    count = impact_counts.get(impact, 0)
    percentage = (count / total_variants) * 100
    icon = "🔴" if impact == "VERY_HIGH" else "🟠" if impact == "HIGH" else "🟡" if impact == "MEDIUM" else "🟢"
    print(f"  {icon} {impact:&lt;9}: {count:3d} 个 ({percentage:5.1f}%)")

# 高影响变异详细分析
high_impact = df[df['Impact'].isin(['HIGH', 'VERY_HIGH'])]
if len(high_impact) &gt; 0:
    print(f"<span class="token entity" title="\n">\n</span>🚨 高影响变异详情 ({len(high_impact)} 个):")
    print("-" * 80)
    for idx, row in high_impact.sort_values('Max_Score', ascending=False).iterrows():
        icon = "🔴" if row['Impact'] == "VERY_HIGH" else "🟠"
        print(f"{icon} {row['Chromosome']}:{row['Position']} {row['Ref']}-&gt;{row['Alt']}")
        print(f"  基因: {row['Gene']}")
        print(f"  最大分数: {row['Max_Score']:.4f} ({row['Impact']})")
        print(f"  详细分数: AG={row['DS_AG']:.4f}, AL={row['DS_AL']:.4f}, DG={row['DS_DG']:.4f}, DL={row['DS_DL']:.4f}")
        print()
else:
    print("<span class="token entity" title="\n">\n</span>✅ 未发现高影响变异")

# 分数分布统计
print(f"<span class="token entity" title="\n">\n</span>📈 分数分布统计:")
score_stats = {}
for score_col in ['DS_AG', 'DS_AL', 'DS_DG', 'DS_DL']:
    scores = df[score_col]
    score_stats[score_col] = {
        'max': scores.max(),
        'mean': scores.mean(),
        '&gt;0.2': len(scores[scores &gt; 0.2]),
        '&gt;0.5': len(scores[scores &gt; 0.5]),
        '&gt;0.8': len(scores[scores &gt; 0.8])
    }

score_names = {
    'DS_AG': 'Acceptor Gain',
    'DS_AL': 'Acceptor Loss', 
    'DS_DG': 'Donor Gain',
    'DS_DL': 'Donor Loss'
}

for score_col, stats in score_stats.items():
    name = score_names[score_col]
    print(f"  {name}:")
    print(f"    🔺 最高分: {stats['max']:.4f}")
    print(f"    📊 平均分: {stats['mean']:.4f}")
    print(f"    🟡 &gt;0.2: {stats['&gt;0.2']:3d} 个")
    print(f"    🟠 &gt;0.5: {stats['&gt;0.5']:3d} 个") 
    print(f"    🔴 &gt;0.8: {stats['&gt;0.8']:3d} 个")

# 基因分布统计
print(f"<span class="token entity" title="\n">\n</span>🧬 基因分布统计 (前15个):")
gene_counts = df['Gene'].value_counts().head(15)
for gene, count in gene_counts.items():
    percentage = (count / total_variants) * 100
    print(f"  {gene}: {count:2d} 个变异 ({percentage:4.1f}%)")

# 染色体分布
print(f"<span class="token entity" title="\n">\n</span>🔬 染色体分布:")
chrom_counts = df['Chromosome'].value_counts()
for chrom, count in chrom_counts.items():
    percentage = (count / total_variants) * 100
    print(f"  {chrom}: {count:3d} 个变异 ({percentage:5.1f}%)")

# 保存详细报告
report_file = "<span class="token variable">${OUTPUT_DIR}</span>/final_detailed_report.txt"
with open(report_file, 'w') as f:
    f.write("OpenSpliceAI 最终详细分析报告<span class="token entity" title="\\">\\</span>n")
    f.write("=" * 60 + "<span class="token entity" title="\\">\\</span>n<span class="token entity" title="\\">\\</span>n")
    
    f.write("性能提升总结:<span class="token entity" title="\\">\\</span>n")
    f.write("- 初始版本: 4/358 (1.11%)<span class="token entity" title="\\">\\</span>n")
    f.write("- 中间版本: 50/358 (13.96%)<span class="token entity" title="\\">\\</span>n")
    f.write("- 最终版本: 235/358 (65.64%)<span class="token entity" title="\\">\\</span>n")
    f.write("- 总提升: +64.53个百分点<span class="token entity" title="\\">\\</span>n<span class="token entity" title="\\">\\</span>n")
    
    f.write(f"总注释变异数: {total_variants}<span class="token entity" title="\\">\\</span>n<span class="token entity" title="\\">\\</span>n")
    
    f.write("影响级别分布:<span class="token entity" title="\\">\\</span>n")
    for impact in ['VERY_HIGH', 'HIGH', 'MEDIUM', 'LOW']:
        count = impact_counts.get(impact, 0)
        percentage = (count / total_variants) * 100
        f.write(f"  {impact}: {count} 个 ({percentage:.1f}%)<span class="token entity" title="\\">\\</span>n")
    
    if len(high_impact) &gt; 0:
        f.write(f"<span class="token entity" title="\\">\\</span>n高影响变异 ({len(high_impact)} 个):<span class="token entity" title="\\">\\</span>n")
        for idx, row in high_impact.sort_values('Max_Score', ascending=False).iterrows():
            f.write(f"{row['Chromosome']}:{row['Position']} {row['Ref']}-&gt;{row['Alt']}<span class="token entity" title="\\">\\</span>n")
            f.write(f"  基因: {row['Gene']}, 最大分数: {row['Max_Score']:.4f} ({row['Impact']})<span class="token entity" title="\\">\\</span>n")
            f.write(f"  AG={row['DS_AG']:.4f}, AL={row['DS_AL']:.4f}, DG={row['DS_DG']:.4f}, DL={row['DS_DL']:.4f}<span class="token entity" title="\\">\\</span>n<span class="token entity" title="\\">\\</span>n")
    
    f.write("所有注释变异:<span class="token entity" title="\\">\\</span>n")
    for idx, row in df.iterrows():
        f.write(f"{row['Chromosome']}:{row['Position']} {row['Ref']}-&gt;{row['Alt']}<span class="token entity" title="\\">\\</span>n")
        f.write(f"  基因: {row['Gene']}, 最大分数: {row['Max_Score']:.4f} ({row['Impact']})<span class="token entity" title="\\">\\</span>n<span class="token entity" title="\\">\\</span>n")

print(f"<span class="token entity" title="\\">\\</span>n📄 详细报告已保存: {report_file}")
EOF</span>

<span class="token comment"># 创建优化总结</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"========================================"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"💡 优化关键因素总结"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"========================================"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"1. 🔧 准确的染色体长度"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   - 从FASTA文件自动提取真实长度"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   - 避免坐标越界和计算错误"</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"2. 🧬 有效的基因注释"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   - 过滤无外显子信息的基因 (6,837个)"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   - 只保留有完整结构的基因 (31,371个)"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   - 避免空序列错误"</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"3. 📍 真实的基因组坐标"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   - 使用准确的基因组位置信息"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   - 提高剪接位点预测的准确性"</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"========================================"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"🎯 下一步研究建议"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"========================================"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"1. 🔍 验证高影响变异"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   - 检查分数 &gt;0.5的变异"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   - 与已知剪接变异数据库对比"</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"2. 🧪 实验验证"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   - 对高影响变异进行RT-PCR验证"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   - 检查剪接异构体的变化"</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"3. 📚 功能分析"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   - 分析受影响基因的生物学功能"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   - 研究剪接改变对蛋白质功能的影响"</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"4. 🎯 临床意义"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   - 评估高影响变异的致病潜力"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"   - 与疾病数据库进行关联分析"</span>

<span class="token comment"># 显示最重要的高影响变异</span>
<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"========================================"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"🏆 最重要的发现"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"========================================"</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-f</span> <span class="token string">"<span class="token variable">${FINAL_RESULTS}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span> <span class="token string">"前5个最高分数变异:"</span>
    python3 <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
import pandas as pd

df = pd.read_csv("<span class="token variable">${FINAL_RESULTS}</span>", sep='<span class="token entity" title="\t">\t</span>')
top_variants = df.nlargest(5, 'Max_Score')

for idx, row in top_variants.iterrows():
    icon = "🏆" if row['Max_Score'] &gt; 0.8 else "🥇" if row['Max_Score'] &gt; 0.5 else "🥈"
    print(f"{icon} {row['Chromosome']}:{row['Position']} {row['Ref']}-&gt;{row['Alt']}")
    print(f"   基因: {row['Gene']}")
    print(f"   分数: {row['Max_Score']:.4f} ({row['Impact']})")
    print(f"   AG: {row['DS_AG']:.4f}, AL: {row['DS_AL']:.4f}, DG: {row['DS_DG']:.4f}, DL: {row['DS_DL']:.4f}")
    print()
EOF</span>
<span class="token keyword">fi</span>

<span class="token builtin class-name">echo</span> <span class="token string">""</span>
<span class="token builtin class-name">echo</span> <span class="token string">"========================================"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"✅ 分析完全成功！"</span>
<span class="token builtin class-name">echo</span> <span class="token string">"========================================"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>命名为<code>8.show_result.sh</code>，<code>chmod +x 8.show_result.sh</code>，<code>./8.show_result.sh</code> 运行命令。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>通过遵循这些步骤，您已经成功地使用物种特异性的基因组和注释文件，在长牡蛎数据上训练了一个 OpenSpliceAI 模型。该模型现在可用于预测长牡蛎的剪接位点和分析遗传变异的影响，从而将 OpenSpliceAI 的实用性扩展到非人类基因组学领域。</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
  <entry>
    <title>基于 OpenSpliceAI 的 INDEL 可变剪接影响筛选流程</title>
    <url>/2025/12/24/indel/</url>
    <content><![CDATA[<h1 id="基于-OpenSpliceAI-的-INDEL-可变剪接影响筛选流程"><a href="#基于-OpenSpliceAI-的-INDEL-可变剪接影响筛选流程" class="headerlink" title="基于 OpenSpliceAI 的 INDEL 可变剪接影响筛选流程"></a>基于 OpenSpliceAI 的 INDEL 可变剪接影响筛选流程</h1><h2 id="背景与目的"><a href="#背景与目的" class="headerlink" title="背景与目的"></a>背景与目的</h2><p>在全基因组 INDEL 分析中，大多数变异并不直接影响基因功能。<br>本流程的目标是：</p>
<blockquote>
<p><strong>从全基因组 INDEL 出发，逐步筛选出可能影响可变剪接（alternative splicing）的高可信 INDEL 位点。</strong></p>
</blockquote>
<p>核心思想包括三点：</p>
<ol>
<li>仅保留功能相关区域（exonic / splicing / UTR / 近端调控区）</li>
<li>聚焦具有一定结构效应的 <strong>中等以上长度 INDEL（≥10 bp）</strong></li>
<li>使用 <strong>OpenSpliceAI（牡蛎模型）</strong> 对 INDEL 的剪接影响进行定量预测</li>
</ol>
<p>最终输出的是一个 <strong>明确标注是否影响剪接（YES / NO）</strong> 的 INDEL 列表。</p>
<hr>
<h2 id="一、原始-INDEL-注释文件准备"><a href="#一、原始-INDEL-注释文件准备" class="headerlink" title="一、原始 INDEL 注释文件准备"></a>一、原始 INDEL 注释文件准备</h2><h3 id="1-原始文件说明"><a href="#1-原始文件说明" class="headerlink" title="1. 原始文件说明"></a>1. 原始文件说明</h3><ul>
<li>文件名：<code>indel.annotation.xls</code></li>
<li>实际格式：<strong>ASCII 文本（TSV）</strong></li>
<li>分隔符：<code>\t</code></li>
</ul>
<h3 id="2-文件检查"><a href="#2-文件检查" class="headerlink" title="2. 文件检查"></a>2. 文件检查</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">5</span> indel.annotation.xls
```<span class="token variable"><span class="token variable">`</span>

<span class="token variable">`</span></span>``bash
<span class="token function">sed</span> <span class="token parameter variable">-n</span> <span class="token string">'1p'</span> indel.annotation.xls <span class="token operator">|</span> <span class="token function">cat</span> <span class="token parameter variable">-A</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>确认：</p>
<ul>
<li>不是 Excel 二进制格式</li>
<li>字段之间为制表符分隔</li>
</ul>
<h3 id="3-重命名为-TSV"><a href="#3-重命名为-TSV" class="headerlink" title="3. 重命名为 TSV"></a>3. 重命名为 TSV</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mv</span> indel.annotation.xls indel.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h2 id="二、Step-1：去除-intergenic-INDEL"><a href="#二、Step-1：去除-intergenic-INDEL" class="headerlink" title="二、Step 1：去除 intergenic INDEL"></a>二、Step 1：去除 intergenic INDEL</h2><p><strong>目的</strong>：剔除功能解释价值较低的基因间区变异。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> -F<span class="token string">'\t'</span> <span class="token string">'NR==1 || $6!="intergenic"'</span> indel.tsv <span class="token operator">&gt;</span> indel.step1.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wc</span> <span class="token parameter variable">-l</span> indel.step1.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li><code>$6</code>：功能注释列</li>
<li>保留表头（NR==1）</li>
</ul>
<hr>
<h2 id="三、Step-2：筛选功能相关区域-INDEL"><a href="#三、Step-2：筛选功能相关区域-INDEL" class="headerlink" title="三、Step 2：筛选功能相关区域 INDEL"></a>三、Step 2：筛选功能相关区域 INDEL</h2><p><strong>保留以下类型：</strong></p>
<ul>
<li>exonic</li>
<li>splicing</li>
<li>UTR3 / UTR5</li>
<li>upstream / downstream 且距离 ≤ 2000 bp</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> -F<span class="token string">'\t'</span> <span class="token string">'
$6=="upstream" || $6=="downstream" {
  if ($8 ~ /dist=([0-9]+)/) {
    match($8,/dist=([0-9]+)/,a)
    if (a[1] &lt;= 2000) print
  }
}
$6=="exonic" || $6=="splicing" || $6=="UTR3" || $6=="UTR5"
'</span> indel.step1.tsv <span class="token operator">&gt;</span> indel.step2.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wc</span> <span class="token parameter variable">-l</span> indel.step2.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h2 id="四、Step-3：筛选真正具有结构效应的-INDEL（≥10-bp）"><a href="#四、Step-3：筛选真正具有结构效应的-INDEL（≥10-bp）" class="headerlink" title="四、Step 3：筛选真正具有结构效应的 INDEL（≥10 bp）"></a>四、Step 3：筛选真正具有结构效应的 INDEL（≥10 bp）</h2><p><strong>思想</strong>：<br>过短的插入/缺失（1–2 bp）往往功能影响有限，这一步聚焦中等以上长度 INDEL。</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> -F<span class="token string">'\t'</span> <span class="token string">'{
  if (NR==1) { print; next }
  ref_len = length($4)
  alt_len = length($5)
  len = (ref_len &gt; alt_len) ? (ref_len - alt_len) : (alt_len - ref_len)
  if (len &gt;= 10) print
}'</span> indel.step2.tsv <span class="token operator">&gt;</span> indel.step3.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wc</span> <span class="token parameter variable">-l</span> indel.step3.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h2 id="五、Step-4：限定在候选基因集合中"><a href="#五、Step-4：限定在候选基因集合中" class="headerlink" title="五、Step 4：限定在候选基因集合中"></a>五、Step 4：限定在候选基因集合中</h2><h3 id="1-构建候选基因列表"><a href="#1-构建候选基因列表" class="headerlink" title="1. 构建候选基因列表"></a>1. 构建候选基因列表</h3><p>基于 INDEL 在多个样本中重复出现的统计结果：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> <span class="token string">'$1&gt;=2{print $2}'</span> gene.indel.count.txt <span class="token operator">&gt;</span> candidate.genes.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>含义：</p>
<ul>
<li>至少在 2 个样本中出现</li>
<li>提高与表型相关的可能性</li>
</ul>
<hr>
<h3 id="2-提取候选基因中的-INDEL"><a href="#2-提取候选基因中的-INDEL" class="headerlink" title="2. 提取候选基因中的 INDEL"></a>2. 提取候选基因中的 INDEL</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">grep</span> <span class="token parameter variable">-F</span> <span class="token parameter variable">-f</span> candidate.genes.txt indel.step3.tsv <span class="token operator">&gt;</span> indel.step4.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wc</span> <span class="token parameter variable">-l</span> indel.step4.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h2 id="六、OpenSpliceAI：预测-INDEL-对剪接的影响"><a href="#六、OpenSpliceAI：预测-INDEL-对剪接的影响" class="headerlink" title="六、OpenSpliceAI：预测 INDEL 对剪接的影响"></a>六、OpenSpliceAI：预测 INDEL 对剪接的影响</h2><h3 id="1-运行-OpenSpliceAI（INDEL-模式）"><a href="#1-运行-OpenSpliceAI（INDEL-模式）" class="headerlink" title="1. 运行 OpenSpliceAI（INDEL 模式）"></a>1. 运行 OpenSpliceAI（INDEL 模式）</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">openspliceai variant <span class="token punctuation">\</span>
  <span class="token parameter variable">-I</span> Filter.indel.vcf.gz <span class="token punctuation">\</span>
  <span class="token parameter variable">-R</span> GCA_902806645.1_cgigas_uk_roslin_v1_genomic_fixed.fna <span class="token punctuation">\</span>
  <span class="token parameter variable">-A</span> oyster_annotation_clean.txt <span class="token punctuation">\</span>
  <span class="token parameter variable">-m</span> model_best.pt <span class="token punctuation">\</span>
  <span class="token parameter variable">-f</span> <span class="token number">2000</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">-D</span> <span class="token number">50</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">-O</span> indel.spliceai.vcf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="2-从-VCF-中提取-SpliceAI-分数"><a href="#2-从-VCF-中提取-SpliceAI-分数" class="headerlink" title="2. 从 VCF 中提取 SpliceAI 分数"></a>2. 从 VCF 中提取 SpliceAI 分数</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> -F<span class="token string">'\t'</span> <span class="token string">'
BEGIN{
  OFS="\t";
  print "CHR","POS","REF","ALT","GENE","DS_AG","DS_AL","DS_DG","DS_DL","MAX"
}
!/^#/ &amp;&amp; $8~"SpliceAI="{
  match($8,/SpliceAI=([^;]+)/,a)
  split(a[1],b,"\\|")
  ds_ag=b[3]+0
  ds_al=b[4]+0
  ds_dg=b[5]+0
  ds_dl=b[6]+0
  max=ds_ag
  if(ds_al&gt;max)max=ds_al
  if(ds_dg&gt;max)max=ds_dg
  if(ds_dl&gt;max)max=ds_dl
  print $1,$2,$4,$5,b[1],ds_ag,ds_al,ds_dg,ds_dl,max
}'</span> indel.spliceai.vcf <span class="token operator">&gt;</span> indel.spliceai.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="3-高可信剪接影响位点（MAX-≥-0-5）"><a href="#3-高可信剪接影响位点（MAX-≥-0-5）" class="headerlink" title="3. 高可信剪接影响位点（MAX ≥ 0.5）"></a>3. 高可信剪接影响位点（MAX ≥ 0.5）</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> <span class="token string">'NR==1 || $10&gt;=0.5'</span> indel.spliceai.tsv <span class="token operator">&gt;</span> indel.spliceai.high.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h3 id="4-提取明确影响剪接的-INDEL-位置"><a href="#4-提取明确影响剪接的-INDEL-位置" class="headerlink" title="4. 提取明确影响剪接的 INDEL 位置"></a>4. 提取明确影响剪接的 INDEL 位置</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> <span class="token string">'NR&gt;1 &amp;&amp; ($6&gt;=0.5 || $7&gt;=0.5 || $8&gt;=0.5 || $9&gt;=0.5)'</span> <span class="token punctuation">\</span>
indel.spliceai.high.tsv <span class="token punctuation">\</span>
<span class="token operator">|</span> <span class="token function">cut</span> -f1,2 <span class="token punctuation">\</span>
<span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-u</span> <span class="token operator">&gt;</span> splice_affect.indel.pos<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="七、回注释到功能筛选后的-INDEL-集合"><a href="#七、回注释到功能筛选后的-INDEL-集合" class="headerlink" title="七、回注释到功能筛选后的 INDEL 集合"></a>七、回注释到功能筛选后的 INDEL 集合</h2><h3 id="1-标注是否影响剪接（YES-NO）"><a href="#1-标注是否影响剪接（YES-NO）" class="headerlink" title="1. 标注是否影响剪接（YES / NO）"></a>1. 标注是否影响剪接（YES / NO）</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> <span class="token string">'NR==FNR{a[$1":"$2]=1;next}
     {
       key=$1":"$2;
       if(key in a) print $0"\tYES";
       else print $0"\tNO"
     }'</span> <span class="token punctuation">\</span>
splice_affect.indel.pos indel.step4.tsv <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> indel.step4.splice_annotated.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h3 id="2-只保留影响可变剪接的-INDEL"><a href="#2-只保留影响可变剪接的-INDEL" class="headerlink" title="2. 只保留影响可变剪接的 INDEL"></a>2. 只保留影响可变剪接的 INDEL</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> <span class="token string">'NR==1 || $NF=="YES"'</span> indel.step4.splice_annotated.tsv <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> indel.step4.splice_only.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">wc</span> <span class="token parameter variable">-l</span> indel.step4.splice_only.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<hr>
<h2 id="八、最终输出文件说明"><a href="#八、最终输出文件说明" class="headerlink" title="八、最终输出文件说明"></a>八、最终输出文件说明</h2><table>
<thead>
<tr>
<th>文件名</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>indel.step4.tsv</code></td>
<td>功能 + 长度 + 候选基因筛选后的 INDEL</td>
</tr>
<tr>
<td><code>indel.step4.splice_annotated.tsv</code></td>
<td>是否影响剪接（YES / NO）</td>
</tr>
<tr>
<td><strong><code>indel.step4.splice_only.tsv</code></strong></td>
<td>最终高可信剪接影响 INDEL</td>
</tr>
</tbody></table>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>该流程通过 <strong>功能注释筛选 + 结构效应筛选 + 剪接模型预测</strong> 三层过滤：</p>
<ul>
<li><p>显著降低背景噪音</p>
</li>
<li><p>保留生物学解释性强的 INDEL</p>
</li>
<li><p>结果可直接用于：</p>
<ul>
<li>RNA-seq 剪接验证</li>
<li>候选基因机制分析</li>
<li>论文或专利的变异筛选方法描述</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>GWAS</category>
        <category>INDEL</category>
      </categories>
  </entry>
  <entry>
    <title>从基因到结构：用PyMOL可视化理解分子对接与突变效应</title>
    <url>/2025/11/09/fen-zi-dui-jie/</url>
    <content><![CDATA[<h2 id="从基因到结构：用PyMOL可视化理解分子对接与突变效应"><a href="#从基因到结构：用PyMOL可视化理解分子对接与突变效应" class="headerlink" title="从基因到结构：用PyMOL可视化理解分子对接与突变效应"></a><strong>从基因到结构：用PyMOL可视化理解分子对接与突变效应</strong></h2><p>亲爱的同学们，当我们谈论“结构生物学”或“计算药物设计”时，分子对接和蛋白质突变是两个核心概念。它们一个关乎<strong>预测</strong>，一个关乎<strong>解释</strong>。今天，我们将不仅从原理上理解它们，更将借助强大的分子可视化软件<strong>PyMOL</strong>，将抽象的概念转化为可见的3D结构。</p>
<h3 id="第一部分：分子对接——当传统“钥匙配锁”遇上AI“神助攻”"><a href="#第一部分：分子对接——当传统“钥匙配锁”遇上AI“神助攻”" class="headerlink" title="第一部分：分子对接——当传统“钥匙配锁”遇上AI“神助攻”"></a><strong>第一部分：分子对接——当传统“钥匙配锁”遇上AI“神助攻”</strong></h3><p>分子对接的本质是<strong>在原子层面预测小分子（配体）与其靶标生物大分子（受体）之间的最优结合模式</strong>。传统的流程我们比作“钥匙配锁”，但现在，我们迎来了一位强大的AI助手——<strong>AlphaFold</strong>——它能为许多我们不知道精确结构的“锁”生成高精度的3D模型。</p>
<p><strong>现代分子对接的增强版流程如下：</strong></p>
<p><strong>1. 结构准备与预处理：获取“锁”和“钥匙”的3D蓝图</strong></p>
<p>这是所有计算的基石。蛋白质受体的三维结构是分子对接的起点。其来源主要分为实验解析和计算预测两大类。</p>
<ul>
<li><strong>a) 传统路径（实验结构）</strong>：从PDB数据库下载通过X射线晶体学、冷冻电镜或核磁共振等技术解析的结构。这是<strong>金标准</strong>，精度最高。然而，并非所有蛋白质，特别是某些膜蛋白或大型复合物，都能被轻易解析出结构。</li>
<li><strong>b) 计算预测路径（当实验结构缺失时）</strong>：在AlphaFold之前，这是一个充满挑战的领域，主要依赖以下方法，其演进历程如下图所示：</li>
</ul>
<pre class="mermaid">graph LR
    A[蛋白质序列] --&gt; B[“同源建模<br>（1990s-）<br>寻找已知结构的同源蛋白”]
    B --&gt; C[“ threading<br>（1990s-）<br>在结构折叠库中匹配”]
    A --&gt; D[“Ab initio折叠<br>（2000s-）<br>基于物理力场从头计算”]
    C &amp; D --&gt; E[“集成方法<br>（如Rosetta<br>将多种方法结合）”]
    E --&gt; F[“AI革命<br>（AlphaFold2等<br>2020s-）”]
    F --&gt; G[精度接近实验水平]
    
    style B fill:#e1f5fe
    style C fill:#f3e5f5
    style D fill:#e8f5e8
    style F fill:#fff3e0
    style G fill:#ffebee</pre>

<ul>
<li><p><strong>i) 同源建模</strong>：</p>
<ul>
<li><strong>原理</strong>：这是AlphaFold之前<strong>最成功、应用最广</strong>的方法。其核心假设是：序列相似的蛋白质，结构也相似。该方法需要一个与目标序列相似度较高（通常&gt;30%）的模板蛋白（已知结构）。</li>
<li><strong>流程</strong>：将目标序列与模板结构进行比对，保守区域直接沿用模板骨架，对于可变区域（尤其是环区）则需要进行建模和优化。</li>
<li><strong>经典工具</strong>：SWISS-MODEL、Modeller。</li>
<li><strong>局限性</strong>：高度依赖于一个高质量的、高相似度的模板。当没有合适模板时，预测结果很差。</li>
</ul>
</li>
<li><p><strong>ii) Threading（折叠识别）</strong>：</p>
<ul>
<li><strong>原理</strong>：当目标序列与任何已知结构的蛋白质相似度都很低时，Threading方法尝试判断目标序列是否可能适配某个已知的蛋白质折叠模式（即“折叠模板”）。</li>
<li><strong>流程</strong>：将目标序列“穿”到不同的结构模板上，通过一个打分函数来评估其兼容性，选择最合适的模板。</li>
<li><strong>经典工具</strong>：I-TASSER（在其流程中整合了Threading）。</li>
<li><strong>局限性</strong>：仍然依赖于已知的折叠库，无法预测全新的折叠类型。</li>
</ul>
</li>
<li><p><strong>iii) Ab initio（从头计算）折叠</strong>：</p>
<ul>
<li><strong>原理</strong>：这是最理想也最困难的方法。它<strong>不依赖任何已知模板</strong>，仅从蛋白质的氨基酸序列出发，基于物理力场（分子力学）和能量最小化原理，通过计算模拟蛋白质的折叠过程。</li>
<li><strong>经典工具</strong>：Rosetta的一个核心功能。</li>
<li><strong>局限性</strong>：计算量极其巨大，且通常只对很小的蛋白质域（&lt;100个氨基酸）有较好的预测效果，精度有限。</li>
</ul>
</li>
<li><p><strong>iv) 集成工具（如I-TASSER, Rosetta）</strong>：</p>
<ul>
<li>在实际应用中，顶尖的预测工具（如CASP竞赛中的佼佼者）通常会将上述多种方法集成起来，取长补短，以产生更可靠的结果。</li>
</ul>
</li>
<li><p><strong>v) AI革命路径（以AlphaFold2为代表）</strong>：</p>
<ul>
<li><strong>原理</strong>：基于深度学习的Transformer架构，AlphaFold2的核心突破在于它能从多序列比对中极其高效地学习氨基酸残基间的空间几何约束，并直接生成精确的原子坐标。它<strong>不是传统意义上的同源建模或ab initio</strong>，而是一种全新的、数据驱动的方法。</li>
<li><strong>变革</strong>：其预测精度<strong>首次达到甚至部分超越实验水平</strong>，解决了困扰生物学界长达半个世纪的“蛋白质结构预测”难题，极大地扩展了分子对接的靶点空间。</li>
</ul>
</li>
</ul>
<p><strong>PyMOL可视化</strong>：在PyMOL中，你可以加载来自任何来源的结构——实验的、同源建模的或AI预测的。对于预测模型，务必注意其置信度指标（如AlphaFold的pLDDT），并批判性地看待低置信度区域。</p>
<ul>
<li><strong>专业预处理</strong>：无论结构来源如何，后续预处理都至关重要。需要使用专业工具（如AutoDock Tools, Schrödinger Maestro）为结构<strong>添加氢原子</strong>、<strong>分配Gasteiger电荷</strong>、<strong>设定可旋转键</strong>。这是因为实验结构和AI预测模型通常不包含氢原子，而氢原子和电荷对于计算分子间相互作用力至关重要。</li>
</ul>
<p><strong>2. 格点计算与结合位点定义：划定“锁眼”</strong></p>
<p>计算机需要知道在哪里进行“搜索”。</p>
<ul>
<li><strong>专业概念</strong>：对接程序会在结合位点周围生成一个三维的“能量格点”。这个格点图预先计算了受体在不同位置的特性（如疏水性、静电势、氢键受体/供体倾向）。</li>
<li><strong>PyMOL可视化</strong>：我们可以将对接软件（如AutoDock）生成的格点文件（.grd）在PyMOL中可视化为一个网格框。这个框直观地定义了构象搜索的空间范围。对于AI预测的结构，尤其需要确保这个网格框覆盖了pLDDT置信度高的潜在活性口袋。</li>
</ul>
<p><strong>3. 构象搜索与优化：疯狂尝试</strong></p>
<p>这是对接的计算核心。</p>
<ul>
<li><strong>专业概念</strong>：算法（如拉马克遗传算法、遗传算法）会在定义的网格内，对配体进行<strong>平移</strong>、<strong>旋转</strong>和<strong>内部可旋转键的扭转</strong>，生成成千上万个可能的“姿势”。</li>
<li><strong>目标</strong>：寻找与受体形状和化学性质<strong>互补性最佳</strong>的构象。</li>
</ul>
<p><strong>4. 打分函数排名：评分</strong></p>
<p>如何判断哪个姿势是最好的？</p>
<ul>
<li><strong>专业概念</strong>：打分函数是一个数学函数，用于估算结合亲和力。它综合评估：<ul>
<li><strong>范德华力</strong>（形状互补性）</li>
<li><strong>静电相互作用</strong></li>
<li><strong>氢键</strong></li>
<li><strong>疏水效应</strong></li>
</ul>
</li>
<li>最终，所有生成的构象会按打分值排序，得分越低（在力场中通常代表能量越低）或越高（在经验打分函数中代表概率越高）的构象越优。</li>
</ul>
<p><strong>5. 结果分析与PyMOL验证：宣布结果</strong></p>
<p>这是将计算结果与结构生物学洞察相结合的关键一步。</p>
<ul>
<li><strong>PyMOL操作</strong>：将排名第一的对接构象与原始的晶体结构中的配体（如果有）或AI预测的结构进行叠合。<ul>
<li>命令：<code>align docking_pose, crystal_ligand</code></li>
</ul>
</li>
<li><strong>专业分析</strong>：我们需要仔细检查计算预测的结合模式是否重现了实验观察到的或理论上合理的<strong>关键相互作用</strong>，例如：<ul>
<li><strong>氢键</strong>：<code>distance hb1, resi X and chain A, resi Y and chain B</code></li>
<li><strong>疏水空腔的填充</strong></li>
</ul>
</li>
<li><strong>特别关注（对于AI结构）</strong>：当使用<strong>AlphaFold预测的结构</strong>进行对接时，需要特别小心。结合位点区域的pLDDT置信度是否足够高？低置信度环区的构象可能不可靠。同时，AI预测的是<strong>天然状态</strong>，而配体结合可能引起局部构象变化（“诱导契合”），刚性对接可能无法捕捉这一点。</li>
</ul>
<p><strong>总结：AI如何改变了分子对接？</strong><br><strong>AlphaFold等工具极大地扩展了分子对接的应用边界。</strong> 过去，对于没有实验结构的靶点，我们往往束手无策。现在，我们可以利用AI生成高质量的结构模型，使得针对这些“难以捉摸”的靶点进行<strong>虚拟筛选</strong>和<strong>理性药物设计</strong>成为可能。这标志着计算结构生物学和药物发现进入了一个全新的时代。</p>
<hr>
<h3 id="第二部分：氨基酸突变如何改变构象——从序列到功能的因果链"><a href="#第二部分：氨基酸突变如何改变构象——从序列到功能的因果链" class="headerlink" title="第二部分：氨基酸突变如何改变构象——从序列到功能的因果链"></a><strong>第二部分：氨基酸突变如何改变构象——从序列到功能的因果链</strong></h3><p>一个点突变如何通过改变一个氨基酸，最终影响整个蛋白质的功能？让我们从结构的角度来剖析。</p>
<p><strong>1. 突变类型的结构后果</strong></p>
<ul>
<li><strong>同义突变</strong>：通常 silent，不改变氨基酸，对结构无影响。</li>
<li><strong>无义突变</strong>：产生截短的蛋白，通常完全破坏结构。</li>
<li><strong>错义突变</strong>：这是影响构象的<strong>主战场</strong>，其效应取决于突变位点和性质。</li>
</ul>
<p><strong>2. 错义突变的结构效应机制（PyMOL视角）</strong></p>
<p>让我们以著名的<strong>镰刀型细胞贫血症</strong>为例（HbS β链 Glu6Val）。</p>
<p><strong>a) 侧链物理化学性质的剧变</strong></p>
<ul>
<li><strong>专业概念</strong>：从带负电荷的<strong>谷氨酸</strong> 突变为非极性的<strong>缬氨酸</strong>。<ul>
<li><strong>电荷丢失</strong>：失去了一个可形成强盐桥（与对侧β链的Lys82）的带负电侧链。</li>
<li><strong>疏水性增加</strong>：引入了一个疏水的“粘性贴片”。</li>
</ul>
</li>
<li><strong>PyMOL可视化</strong>：<ol>
<li>加载野生型血红蛋白（如2HHB）和突变体结构。</li>
<li>使用 <code>show sticks, resi 6</code> 显示第6位残基。</li>
<li>对比 <code>Glu6</code> 的长侧链和 <code>Val6</code> 的短小疏水侧链，直观感受其化学性质的巨大差异。</li>
<li>使用 <code>show surface</code> 观察疏水表面的变化。</li>
</ol>
</li>
</ul>
<p><strong>b) 破坏关键相互作用并诱导新相互作用</strong></p>
<ul>
<li><strong>专业概念</strong>：Val6的疏水侧链无法与Lys82形成盐桥，反而在脱氧状态下，与另一个血红蛋白β链的Phe85和Leu88发生<strong>疏水相互作用</strong>。</li>
<li><strong>PyMOL可视化</strong>：<ol>
<li>在脱氧HbS结构（如2HBS）中，选择Val6及其周围的残基。</li>
<li>使用 <code>show sticks, resi 6+85+88</code> 并上色。</li>
<li>测量它们之间的距离：<code>distance mut_int, resi 6, resi 85</code>。你会发现它们紧密接触，驱动了异常的多聚化。</li>
</ol>
</li>
</ul>
<p><strong>c) 诱导整体构象变化与功能丧失</strong></p>
<ul>
<li><strong>专业概念</strong>：这种异常的疏水相互作用作为“成核点”，驱动血红蛋白形成长的、不溶的纤维，最终导致红细胞扭曲成镰刀形。</li>
<li><strong>PyMOL可视化</strong>：<ol>
<li>叠合野生型和突变体的整体结构：<code>align wild_type, mutant</code>。</li>
<li>观察RMSD值，量化整体结构的偏移。</li>
<li>重点关注突变位点局部区域的主链和侧链的显著位移。</li>
</ol>
</li>
</ul>
<h3 id="总结：当预测遇见解释"><a href="#总结：当预测遇见解释" class="headerlink" title="总结：当预测遇见解释"></a><strong>总结：当预测遇见解释</strong></h3><ul>
<li><strong>分子对接</strong>是我们的<strong>预测工具</strong>。通过计算模拟，我们可以预测一个新设计的抑制剂如何与野生型或突变型靶标结合，从而指导<strong>基于结构的药物设计</strong>。</li>
<li><strong>突变的结构分析</strong>是我们的<strong>解释工具</strong>。它让我们能从原子层面理解疾病的分子病因，并解释为什么对野生型有效的药物可能对突变体失效（<strong>耐药性</strong>）。</li>
</ul>
<p><strong>PyMOL</strong>在其中扮演了不可或-缺的“翻译官”角色，它将抽象的序列信息、计算数据和能量术语，翻译成我们肉眼可见的、直观的3D结构图像。通过将计算（对接）与实验（突变体结构）在PyMOL中进行比对和验证，我们才能真正将生物信息学、计算化学和结构生物学融会贯通，推动生命科学的前沿发展。</p>
<script type="module"> import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';	mermaid.initialize({startOnLoad: true, flowchart: {curve: 'linear'}}); </script>]]></content>
      <categories>
        <category>蛋白互作</category>
        <category>PyMOL</category>
      </categories>
  </entry>
  <entry>
    <title>根据SNP位点进行快速引物设计</title>
    <url>/2025/07/03/kuai-su-yin-wu-she-ji/</url>
    <content><![CDATA[<h1 id="根据SNP位点进行快速引物设计"><a href="#根据SNP位点进行快速引物设计" class="headerlink" title="根据SNP位点进行快速引物设计"></a>根据SNP位点进行快速引物设计</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>这是一个基于Python Tkinter开发的图形化界面工具，专门用于基因突变位点的引物设计。通过输入基因序列和突变位点信息，工具能够自动定位目标碱基并设计出合适的PCR引物对。</p>
<blockquote>
<p>主打一个快速，但设计结果有待验证</p>
</blockquote>
<h2 id="功能特点"><a href="#功能特点" class="headerlink" title="功能特点"></a>功能特点</h2><ul>
<li><strong>用户友好界面</strong>：直观的图形化操作界面</li>
<li><strong>快速定位</strong>：自动识别基因序列中的突变位点</li>
<li><strong>智能设计</strong>：根据参数设置自动生成引物序列</li>
<li><strong>结果导出</strong>：一键复制引物序列到剪贴板</li>
</ul>
<h2 id="系统要求"><a href="#系统要求" class="headerlink" title="系统要求"></a>系统要求</h2><ul>
<li>操作系统：Windows/Linux/macOS</li>
<li>环境：Conda、 Python、 3.12</li>
<li>依赖库：tkinter, scrolledtext, messagebox等</li>
</ul>
<h2 id="安装与启动"><a href="#安装与启动" class="headerlink" title="安装与启动"></a>安装与启动</h2><h3 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1. 环境准备"></a>1. 环境准备</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda activate py312<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="2-进入工作目录"><a href="#2-进入工作目录" class="headerlink" title="2. 进入工作目录"></a>2. 进入工作目录</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> E:<span class="token punctuation">\</span>坚果云<span class="token punctuation">\</span>我的坚果云<span class="token punctuation">\</span>课题<span class="token punctuation">\</span>Python<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="3-启动工具"><a href="#3-启动工具" class="headerlink" title="3. 启动工具"></a>3. 启动工具</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jupyter notebook<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><h3 id="第一步：准备数据"><a href="#第一步：准备数据" class="headerlink" title="第一步：准备数据"></a>第一步：准备数据</h3><ol>
<li>从NCBI获取基因序列（如基因: <a href="https://www.ncbi.nlm.nih.gov/gene/105346934"><strong>LOC105346934</strong></a>），选取对应基因组版本，选取基因，下载基因序列</li>
<li>记录突变位点信息（如：NC_047567.1:<strong>26604856</strong> T-&gt;A）</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251104193021260.png" alt="image-20251104193021260"></p>
<p><strong>基因序列格式如下</strong>：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251104192940724.png" alt="image-20251104192940724"></p>
<p><strong>代码如下</strong>:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> tkinter <span class="token keyword">as</span> tk
<span class="token keyword">from</span> tkinter <span class="token keyword">import</span> ttk<span class="token punctuation">,</span> scrolledtext<span class="token punctuation">,</span> messagebox<span class="token punctuation">,</span> simpledialog<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">DNASequenceViewer</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> root<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>root <span class="token operator">=</span> root
        self<span class="token punctuation">.</span>root<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"DNA序列定位工具"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>root<span class="token punctuation">.</span>configure<span class="token punctuation">(</span>bg<span class="token operator">=</span><span class="token string">'#f9f9f9'</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 设置统一风格</span>
        style <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Style<span class="token punctuation">(</span><span class="token punctuation">)</span>
        style<span class="token punctuation">.</span>theme_use<span class="token punctuation">(</span><span class="token string">'clam'</span><span class="token punctuation">)</span>
        style<span class="token punctuation">.</span>configure<span class="token punctuation">(</span><span class="token string">'TButton'</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Arial'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
        style<span class="token punctuation">.</span>configure<span class="token punctuation">(</span><span class="token string">'TLabel'</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Arial'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        style<span class="token punctuation">.</span>configure<span class="token punctuation">(</span><span class="token string">'TEntry'</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Arial'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        style<span class="token punctuation">.</span>configure<span class="token punctuation">(</span><span class="token string">'TLabelframe'</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Arial'</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'bold'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 序列输入区</span>
        ttk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>root<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"输入FASTA格式序列:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>pady<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>seq_text <span class="token operator">=</span> scrolledtext<span class="token punctuation">.</span>ScrolledText<span class="token punctuation">(</span>root<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">35</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> wrap<span class="token operator">=</span>tk<span class="token punctuation">.</span>WORD<span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Courier New'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>seq_text<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>padx<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

        <span class="token comment"># 坐标输入区</span>
        self<span class="token punctuation">.</span>pos_frame <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span>root<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pos_frame<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>pady<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
        ttk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pos_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"基因组位置:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>tk<span class="token punctuation">.</span>LEFT<span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pos_entry <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Entry<span class="token punctuation">(</span>self<span class="token punctuation">.</span>pos_frame<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pos_entry<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>tk<span class="token punctuation">.</span>LEFT<span class="token punctuation">)</span>

        <span class="token comment"># 参数设置区</span>
        self<span class="token punctuation">.</span>param_frame <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Labelframe<span class="token punctuation">(</span>root<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"参数设置"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>param_frame<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>pady<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>

        <span class="token comment"># 参数输入控件</span>
        <span class="token keyword">for</span> label_text<span class="token punctuation">,</span> attr <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">"理想产物长度:"</span><span class="token punctuation">,</span> <span class="token string">'product_size_entry'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                 <span class="token punctuation">(</span><span class="token string">"大小容差:"</span><span class="token punctuation">,</span> <span class="token string">'tolerance_entry'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                 <span class="token punctuation">(</span><span class="token string">"最小引物长度:"</span><span class="token punctuation">,</span> <span class="token string">'min_len_entry'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                 <span class="token punctuation">(</span><span class="token string">"最大引物长度:"</span><span class="token punctuation">,</span> <span class="token string">'max_len_entry'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            frame <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span>self<span class="token punctuation">.</span>param_frame<span class="token punctuation">)</span>
            frame<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>anchor<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
            ttk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> text<span class="token operator">=</span>label_text<span class="token punctuation">)</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>tk<span class="token punctuation">.</span>LEFT<span class="token punctuation">)</span>
            entry <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Entry<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
            entry<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>tk<span class="token punctuation">.</span>LEFT<span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
            <span class="token builtin">setattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attr<span class="token punctuation">,</span> entry<span class="token punctuation">)</span>

        <span class="token comment"># 设置默认值</span>
        self<span class="token punctuation">.</span>product_size_entry<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"500"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>tolerance_entry<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"200"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>min_len_entry<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"18"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>max_len_entry<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"22"</span><span class="token punctuation">)</span>

        <span class="token comment"># 按钮区</span>
        self<span class="token punctuation">.</span>btn_frame <span class="token operator">=</span> ttk<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span>root<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>btn_frame<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>pady<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
        ttk<span class="token punctuation">.</span>Button<span class="token punctuation">(</span>self<span class="token punctuation">.</span>btn_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"加载示例"</span><span class="token punctuation">,</span> command<span class="token operator">=</span>self<span class="token punctuation">.</span>load_example<span class="token punctuation">)</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>tk<span class="token punctuation">.</span>LEFT<span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
        ttk<span class="token punctuation">.</span>Button<span class="token punctuation">(</span>self<span class="token punctuation">.</span>btn_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"定位碱基"</span><span class="token punctuation">,</span> command<span class="token operator">=</span>self<span class="token punctuation">.</span>locate_base<span class="token punctuation">)</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>tk<span class="token punctuation">.</span>LEFT<span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
        ttk<span class="token punctuation">.</span>Button<span class="token punctuation">(</span>self<span class="token punctuation">.</span>btn_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"设计引物"</span><span class="token punctuation">,</span> command<span class="token operator">=</span>self<span class="token punctuation">.</span>design_primer<span class="token punctuation">)</span><span class="token punctuation">.</span>pack<span class="token punctuation">(</span>side<span class="token operator">=</span>tk<span class="token punctuation">.</span>LEFT<span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 结果显示区</span>
        self<span class="token punctuation">.</span>result_label <span class="token operator">=</span> tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>root<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span> fg<span class="token operator">=</span><span class="token string">"blue"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>result_label<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 反向互补序列显示区</span>
        self<span class="token punctuation">.</span>rev_comp_label <span class="token operator">=</span> tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>root<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"反向互补序列:"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>rev_comp_text <span class="token operator">=</span> scrolledtext<span class="token punctuation">.</span>ScrolledText<span class="token punctuation">(</span>root<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">35</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">,</span> wrap<span class="token operator">=</span>tk<span class="token punctuation">.</span>WORD<span class="token punctuation">,</span> state<span class="token operator">=</span><span class="token string">'disabled'</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 状态变量</span>
        self<span class="token punctuation">.</span>is_reverse <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>original_seq <span class="token operator">=</span> <span class="token string">""</span>
        self<span class="token punctuation">.</span>rev_comp_seq <span class="token operator">=</span> <span class="token string">""</span>
        self<span class="token punctuation">.</span>start_pos <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>end_pos <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">load_example</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        example <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&gt;ref|NC_047567.1|:c31905813-31888694 Crassostrea gigas (反向链示例)
AATGATTAAAAAGTGGATATATAAAAAAGTTATACGTTGAAAGTTATGATAAGATCCTAACAGTTGCTAC
GTAATTAAATCTTTAATGAAGTTCTTTTTTAATGTAATGGTAACTGCAGTATGATAACAATAAAAAAATA
GATAATAATACATGTAATATGCATATCAATTGAAAAATTGACTGCAATTATTACGAACAGCTAATACAGA
AAAAGAATGCTTGTTTGTGTTGAGGGAGGGGGTGAGGTCATAGGGATAATTTTTTATGCCGAAGGGGAAG
GGTGTGGATGGTATTTTCACGATGAAAATTTTATGACTTTGAATTTTCCAGTGGGCCCAGGGCCGACCCC
CCAATCTTGTTCCCAGCCTCTGGATTTTTAATGCGTACTGCGGTATTTGATCCCAAGTAATTTTAAAAAC
AGTTTACTGATTTGCAAGTTTAACAGAAATCATTTTCAGGTTCTTAACTGTAAAGAATTACATATATAAC
TCTCTTGGTAATGAAATTTAAAAGACGAATTGCCTATTACTTGGTACATGTATTTCAAATATTACAGTTT
CTCATTTAATATTGTGATAATGGTAAGATTTGTATGTATGCTGCCATATACATGTATATATGAGTGTTAT
ATAAAATATAAATATTAAAAACATGGATTATGATACATATATGGGTATACAACAGTTTATGTCCGTCTCC
TTACAATTATATTTGGATGGAAACTCTCTTATCATAGACACTGTATTGACGCCGTGCGATTATGGAATCG
ATTGCTGACAATGGAGGACAATCGGCTAACAAAGCGTGTATTTTTGTGGCACTTTAATCAAACTGGTATA
TCTAGATGGACATCACGAATTAAATCACTGTTTGAATCTATGAATCTTTTACATATTTATGATAATTTAT
CAGTCTGTGATGTTAATGAATTTGAAAACAAGCTGTTTCTTACTTATGAAAATGAATGGTTAGGAAAGAT
AAACCAACTACCAAAGTTGCGATTATATAAAGGCGTTAAAACAAATTTTAAAACTGAAAATTACCTTGAA
ATGAACATTTCAAAATCTCAAAGATTTATTTTGGCACAATTCAGATGTGGGATTCTCCCAATTAGAATTG
AAACAGAGCGATATAAGGGGGAACCTCTCGATGAAAGAATATGTAATTTTTGTGTATTAATGAAATAGAA
GACGAGAGTCATTTTCTTTTGAATTGTGCAATGTTATCTGATTTTAGAAGGGAATTATTTAATAATGTAG
GATGTAATCCAACACTAGTAATGTCAAATTTAGACTGTATAATTTTTCTACTGTCAAACTTTCCGAGACA
AAGATCTAAATATTTACTTGAATCTTACCTTTACAGACAATCATTATTGTATAAAATACGCAATGCGTAA
TATGTGTATATATGTTATAATTGTATTTTCAGTGACATATAGGCCCAATAGGCCGGGTGTTTCATTATCT
AATTTGTATAACATTTTGTATTTTGTTATAACACATGTCACTATAATAAATTATTTACTTACTTACTTAT
ATCACTCGTTCCCTCTTGTGTATACTTGTGTTTATTGATAATATTGTGCATGTTGTTTATTTACATAACT
GTACCATATCATCCTGCTGCCCCCTGAGAGTCCCTGATTTGTCAATAAATTGGTTTTTCTTAAAAATTTG
ATTAAGTTAAACTACAAAGTATCCCTCATCCTAAACTATATCTCTCTTGCTGAACTTCTCATAGATTTGT
CATTCACACACTTGATACCTTCGCTAAATACTGTCGATGGACTAGGTCTAGGATTCGGGGAAAAACCTAA
TAGCCAAAGGGATGGTCGTCTTGACCCTAACCTTTACCATGCGATTTTCGGAAAATTGGTTTAAAGATCA
CCACGTGTTTGTTTTGTTTATCAATGATTTTCATTAAAAGTTTTTATCACTAGCCGACTTACTCCCACAG
GTAAACCCGGACCGGTGGTTTTCCCTCCCTATGACTCACTCGATCAATAAAAGTCAAAATGAAAGTAGAA
GATTCTCGGAATAGAATGTTGTACAGGTTGACCTATATTGAGCCTTGAACGTAAGATAGGTGAGGACTGA
TAGAGCTGATGTGACCACAGTCCACGACAGGTGTGTACACTAGTTACTTATGATTGACACATGTTGATAT
TATTGCGATAGTGTGTGTGCCGAATGATAACATATTTCAGATATGACTGATTACGAAACGTAGCGCATAC
GTGCATCTGATAACTTCTGTAAAAAAGAAGATGTGTCTATATTTCGTAACATTTAATTTTTGATACATGT
TTAAAAACAATTAAGTCTGTTAGTAGAAGTAGATTTATAAATGTATGCATAAAACTGGATGTATATGTAT
GTACCGTACCTTTTTAAATTTTATATTTTCGACTACATTTACAAAGAAGTCGGATATTTTGATATGGATA
TAGCAAAAAAGGTAAAAACTGGCCATGGTGTATAAATACTGAAACCCAAACGAGAAAAGAATCCGAATTA
ATTTCATTAAGTTAATGGACGTATGTTAAATTTTGAATAAGCTAGGTGAATCACTGAATGTCAATACAAA
ATTTACGTTATGACATACATGGCACCCTGATAGTAAATTCATGACTTAGTAAAAGCAAAGAGGTGTGATA
TTTTTGTCCATGGAATATTAAATTCTACTTGGACATTGGATGAAAAAATTGCTCATCTCAGATGAAGGTA
AAAACTATAATCAACTTGAAAATGTTAATCCTTTTCATATTCTGGTTTAGGCCATGTGAAAAACATTTTA
TGGGGTTATTTAGGAGGGCCCTATGTGCCCCCGGGCATAGCAAGGACTAGGTAGGTACATGTAGGTTTGG
AGGTTAGCAAAAATATGTTTTTAAAACCATTTTATTCGTGGTAGTAAAATCTCCTACTTCGTAAGTTATG
GTTTCCTAGTTATAAGGATCAACAACATAAATTCAGTAAGTACAGACACTCGGAGGTTTCCGATTACAGG
GCTTAGGCAATGTTGTAAAACCATCGTAGTATGAATAATAGAACATTATCTGGCGAAATATCCATTTAGC
TCAAATTTTGTCTCCTTGTGTCGTATAAAGATATTTGTTAAACTACTTTGTATTATATATTTTCTCAAAA
TAACCAACTACTTTTTTTTTATTCTCGCATACTTCGCACCCGAGAAATAGAGGTAGGAATTAGTTGTTTT
ATGCGTCTTTTCCGTTACTTATATAAATAGTCTTTTAAAAGTTGCATGTAGCACGAGGCAAAATGTTACC
GTGTTACAATATAGCTGTAAGAATGAACAATGCAGCCTCTAGGGAAAACTCAGGTCGATTGACATCTTCC
CTAGCCAAGGGTTTGCGATCCGCTCCTCTCATCTACAGTTGAGGAGTGGATCGTAACCATTGGCTAGCGG
AGATAGTTGATAGATTAGACGAGGAACATTACTGCACAAAATAAAATGCTTAAGTATTGAATTTGCATGA
TTGTATGTTTCATAATTCCTTATTTAATGTATCAATAAAGTGGATTTCAACATGAGTATACTTTCATCGG
ACGCTCTCTCAAGCCTCAGTGCGTTTGTTTATTAGGTAAATTGGTAACACCTGTTAATCGAAAAATTGAT
GGACTTCAAATTTCAACTATTTAAATAAAAAGGCAATATATTAAAGCTTATTTCAAAGTCCATACACTCT
GAGGCCGAAAATGTCACTAAGTACTGCAAATGTATCTTGCATTGACAGTGCACTTACGTTTGAACAAGAC
TTGTTGAAACACTAACCCCACTTTAACATCAATGATAAAAACCAAGCACTTCAGACAAAGCAGACGATAC
TTTTTTCTTCCAGTCGTGAAATCAGCGCGCAAATGTAAAAAAAAAACCCACCAAACTTTAAGGGCGTTAA
GCTTGGTATTTTGTAAAAAATAAAATGAATATTTATTTCTTCAATTGCTGAATAATGAGAGAGCATTCAA
GCAGAAACGTGATGCGTATGTCGATAACAGCTATACTTGCAGCTTTATTTTTATAGAAATAATTCCACTT
ACATTTTTTTAATGAAAAACCTTTGATAGGAAATGACAGAATGGCCTTTGATATTACCAAATTAAATTTG
CCAAATTTTCGTCTCCACTTTCACGCTTACAATGATTTCATACTTTCCTGAAATAATGACATAATTCAAA
TGCAGATAATATGAAATGTCAAAATTAAGTCAAATATCAAGTTATAGGCAAGATACAGGGTTCAGAGTTC
TTTGTTTTGTAAACAAAGCTCGAATATTGTAATTTTTTTTACATATGTGTTTTATTGATGTAAGTTTATA
TCAAATGTAACTTTCTTTTGTTGATTATAGTGTTTATGAAGATATTGAGTTACTTTAAATTGTTTTTTAC
ATATAATTTTGTCTTAGAAATGGTAATTCTCTACATTTCATTTTTTGTAAACAACTATAAGACTCGTCCT
TTGTTTACATACCAATCAACTCTTACCTCTCTATCTCGCTTGTAACTTGATTTTGACATTCAATATTTTG
GTCAATCATTTAAAATGCACGAGAAAACCATTTTATACATAAAAAGTAAAAAGAAAAATTTTGATCTCGA
ATCGTGTCCAAGTCCTTTTGAGGGAGGGGGATTTTTTTTACGGCTGCATGGAACTACATGTATGTATTCT
GTTCAGTATTTCTTCGATTCGGTTATTTTTTGAAAAAAAAAAGTCAGTTCGGAAAGTCTTTCACGCTTAT
TCAATTTTTAAATTAGCCAGTAAACATTTCTGAATACATGTATATGAACTGATACGAACAAATTATATAA
AAACTTTTGATTAAAAAAAAATCTTTGTACTTTTAACTACAGATATTCAAAATAAACCTTAATAGAATAC
TTGTACGTCATATAAACGGTATACGTTATTTCCTAAAACAGAGATAAATGTTAGATGATAAGTATCTCAT
ATGAGGTAACAAAAACATTTGATTGTTTAAGCTGAACAGCACTCCTTGAAACCAAGCGATTTCATGAGTG
CTCGAGGATCTGTCTAAACGTGAACAACTTGTATCAGTAAACCAGGCCCTGTATATCAGTAAATGGCTAC
TGAACGTTCCTTTCAGAAAACTTTAAAATTTGACGTCGTCAATAGCGGTTTGGAGGTAACAGGCGTTTGC
TTGTGAAAAGTGAGCTATCTTTATGTTATCATTTTCTACCTACCTTCATAACATTTAAAAGAAACGTTTA
CGGAGCCCTATTAATGAAATTTTCCAAACATTTATTCTACTTTTGTGCCACTCTGTAAACCAAAGTAACT
ATGTGCGTATTGCATGCATGTTTAAGGATGTTCTTGAATCAAGCATGATGTACAAACTTCCATCAGTCGT
TACTCAGCCTCAAGCCTGAGTATTGACTTCAAATTTTTGAGTTTTTGAGTTGAGGAATAAGTTGAGTGAT
TTGAAAATTTTGATGAAGGCAGGGTCTGACCATAACATAGGTAATCAACTAATCATCGAGTAAATTCAAT
ACAAAATAACTTTTAAAAATGCGCTATATTTCAGGATATCAGCGCTATGGTTTTCAAATGCCCTATTTGT
AAAAGGGACGATTTCCAGAGTGAGGGAGGACTCAGCAGTCACATAACATGGAAACATTCAGGTAGCTCAG
ACGGCAGAGGATCGCGACCATCTACTGGTGGACGTGGCAGGAAAGACGATAGGGTAAGGATAACAATACA
CGCTACACGGCCTCTAGATCAGGACACTCACCGCTGATTAATGCTATTGTAAATGGCGTTTAAAGTTATT
AATCAAAAGAAGTTAAGAGGGCACGATGGTTGTGGTCATTTGCAGACTATATTGATCTTCTTTAGAAGAA
GAGCTCAATATAGAACTACAGAAAAATACCAAAATTTTAAAGGTGAAATATATGGATATTTTTTCTTTCC
TTAATAATAGTTTATAGGCAATCAAATGATATCTCCAAATTTTAGGCAGATCCGATGGTTAATTGGTTGA
CCATCTAGTATCCTTAAAGAATACACGCTATTGAATGTGTAAACACCCAGGATAAAATTATTTAATATGA
TTTGTATTTGGGATAAATAAATTGAAAAACAGTTAGCAAATTATGATTAAATTTTTAGTTGCTATGTTAA
AATATCACTTTTATCGAATATTACTTTTCACTAAGATATAAGTCAAGTAGGGTTAAAAAAAATGTACCAT
TTTTGAAGTTTTACAATATATTTTTTTTTCATTTCAAACATTTGTAGCCGATACACAGTTCGAATACATA
TTGTTTATTGCAACAGAACTATGAGTGCTAAAACTGATACCATTAGTCTAAATATGTTACCAATGGGGAC
ACACGAAATCATAAAAAATTCCAACTAGTAGTTTGGGGAAACAATTTTTTAGCGTTAATCGACTGCTTGT
AAGACCAACTAACTATGTCTACAGACAAAAAGATATTGTTTGTAAATAAACGTAGTATACTTTAATTTGA
AAAGTAAAACATCCCATTTTTGACGAATTCGCCAATTAGGTATAGAGTAGTCAAATGTTGTATAGAATCT
AACCTAAGAAAGAAAGATATAATACATGTAGGTATGATATACAATGTGAATACCTTAATTTTTGTGGATT
TATTTCCCAGGATATCAAAGCCAGGGTTTTCAAATGCCCTATTTGCAAAAGGGACGATTTCCAGAATGAA
AGAGGACTCAGCTGTCATATATCACGAATGCACCTGAGTGGCTCAGACGGCAGAGGATCGCGACCATCCA
GTGGTGCATGTGGCAGGAGTGACGATAGGGTAAGGACAACAATACACGCTACACGGTTTCTAGATCAGGA
CACTCACAGCTAATCAAGGATATAACAAATGACTTACCAAAAAATTAAATAAATCAATTGTTCAATTTTT
TGGGATGGGCAAAAACAAACAACCCCCCCCCCCCCGCCCCCCCAAAAAACAAAGCAAAAGACCCCCCCCC
CCCCCTAAAAAAGAAAAAAACAAAACAAAATCCGATCAAACAAAAATACCAATACATAGCAGATGGAATC
TATAACAAATTTAACAGGAAATAAAGTTTGTAGATCAATCCATAAATAAAAGAACGCAAAAATTCTTTTA
AAATTTTCACTAATTTGTCAGTAACAAAACTAATGAAGTACTGTTTGCAAAAGGGACGAATTCAGTTTTT
GACAGCCACGGTGTGATTATTTCAAACAGTATACATATTTTAATTTTTTTATTCAGGATGTTAACGCTAT
GGTTATCAAATGTCATATTTGCGGTAAGGACGATTTCAAGAGTGAGGGAGGACTGAGCCGTCATATAACG
ACTGTGCACCAAGGTAGCGCAAATGGCAAGGGATCTCGACCGTCTTCTTGTACAAATGGCAAAAGGGACG
ACGGAGCAAGACCAAAAACTCACACGCCACGTCATAGAGACCACGAGAGACACAACAGTGACAGAGATGT
TGTAAGGGGTGTTGCAAGAGTACAGAGGGAATCACCCCAAAGGGGTTCTCTAGACGATTTTCCGTTCAAA
GTAAATATGTTATTTTTATATATGTTTTGCTTCTGAAAAGATTTGCAATGATAACTAATTCGCTTGTATT
AATAAAATAGAATCATCGTTAGTCTATTGTAACGATTAAAATTTTATTTGCATAGTAAAAGTCAGGGAAA
AGTTTTTTAATTTATAATCACCTTCATGATAAATTTGTATATTACATTAATTTTGTAAACATGTTTCCTT
ATTTGAACCTATTGACTAACAAAAGCATTCATTTCTATATATTTACATTTGCAAAATTTCTTCCTAATAT
GAACCTTTAAAATAGCGAAAAGATTTGATTCTTTATGTTAAAATTGCAAAAATGTTTCCTTATATGAACC
TGTAGAATAGCCAAAACGCTAAGTCTATTGTGAACGTTTACGTGACGTGAACATGATAATCACAGGCGAT
TATCGTTTGCATTTTTGTAAACATTAAAATACGGATATGTTAATAACTATGAACGATTTGACTTTAAACG
TAAATATAAGTAATAAATTAAACAAGACGGGATATGAACTTGGTTGTTACGTGATCAAATCTTTTGAGAA
GTCCTACCTGTTTCACGTGACCAACCAAGTTCATATATTTGAGAACTTTTTAAGGTGCTGTTTATTTCTT
GTGTAAACTTTTTAATGACGTCACAATGAATACAACGCCCTCTTATCGTTTGACGGTTGCATTACTGTAA
GTTCATGTTTTAAAACACGATTATGTTAAAAATTATGAACAATTTGCCTTTCTTAAACGTATATATAAGT
AACAAACAACAATGTTATAAAATCAATGGGGATCTGAACTTTTGTTTGTCACATGATCAAATCATATGAA
GCCTTCACAGTATTTAATTACGTGACAAACTAAGTTCATATCCCGTTTAACTTTTATACTTGTTGTTTTT
TTTCTAATATAACTTGTCAATAGTTAGGCCATGGTGTCCCTTAAAGAGTTTTTGCTGATCAAATCTTAAT
GTATAAGATGGTCTTCCATGGCAAGTTAATGATTCCCTTTGATCCTAAAGTCAAATGATAAACGGCATTG
TTATGCCTTTATTAATCTTCCTCTTAATTATTCTACCCAACAAAAAGTCAAATGTTAGTTCAACCGGCCG
CGGTATAACAAACTAGATGTTTGACCGGTCGCTTCGCTACAACTATTTAACCGTTGTTCAATCTTGGCGA
GATAGAAGAAACGGAAAGAATGCAAGTGCTTTGCGACAAGAGTGGCTTGGTGCAACTTGAAATGATCCCT
GCGTCTGCAGTGAAAGATAACACAAAATAGCTATTGGATCGGATTTGGACAACATGTCATCTGTTGGACC
ATCTGACAGAAGTATTGTCTTAGATGTTTAACCTTGGGCAACGTTTGTGTCGTGTCTGTAAAAGTCCAAC
AAATGATATGTTGTCTCATACCCCGGCAATATGTGAATGAGACTGTATTTCAAAAGTTGACCGTACGATA
ACTTGAGAGTTATATTATTACTTATTAGGTTTGTTACTGACTGTTTACAGAAATTTGTGGGGTCGGTAAA
GTCCATAGAAGGCGAGGCGGAGCCGAGCCTTCTGTGGACTTTACTGACACCACCAATTTCTGTAAACAGT
CAGCAACAAACCTAATAAGTGTTTTGTTTTGTCGAGGACCCTAAATTTGATATGTAAACAACAAAAGAGA
ATACATACCAATTAAATTCATAGGCTTATTATCTAATTTTGTACCTTTCTCGTCAGTCGTCTGTGTAAAC
TTGGATGCCATTGTATATAGGATCGTTTTATTACGTCACGGGCAAAGGGGGAGTCACTCTAAATATTTTG
GGGCTTAAAAATTATAGGTATGGTTGAACGTTTGTGTTAAAAATAAGCTCAACTAACGTTACGTCCGCCA
TGTTGCCGTATAAATTTTAACGCACGCCGTGTAAAGAAATTTATAAGGCAATCACGTGACGTGATTCATC
CAATGACGTCGAGACATTCTAGTCCGAGGCAAAACAAATTTACATATAAGTCACCATTCACCATTTCTAT
CAATTACGATTTAACAATTATTGGAGAATCATTTTTAAGACATTTTATCTTATGACACAGGATGGTGCAG
GAGGAGCAACATGGAAATCGAGCTCAGCAAAGTATAAAGGTAACAAGACAGAGTTGTTTTTATAGTCCAA
GCAATCCAGCTTTACGTAGTGTTGGCCATATAATAATATAAGCTATCTCAGAAGAACAATTTCTTCTTTA
TCAAAACCGTTGGACACTCGGCAACTAGATTTATCAAATTTTAAATGGAAAGGCACTAATTTAAAGAAGC
TTTAAATTATTTGTCATTTATTGACCTGTTCCCTGATATTGATAATGAAAATATAGGAAGCATTTGATTT
GTTTCTATTTCATCAATAGAATCTCCAAAACAAAGCAGAAAAACAGAGGAACCTCGTGAAAGACCCTCAT
CATCAGATTTAAGTAAGAACTGTTTTAGTGTGAAATTAGCATCATCTATATGTAAGGGAATGAAACGGTC
ACTTGCAGGTTGTCTATATTCAGTCCTTGTAGTAAAGTTTACTTATATATGACTGAGCCATTCAGTTTGC
TTTTCAGACCTTTTTGTAAATATTCAGTTGACTGAACATCAGAATCTCTTGTGATAATTGTAATTGCTGC
ATCAGGAAGTTGTTAAAGTTAAAAATGCTTTAGTTGATCAAAGGGCAGAACTTCTTGCGATAATTATATT
GGTAAATCAGGAAATAGTTAAAAGTAAAAATTCATTAGGTGACGAAATTGCAGGACCTTTGGGAAAACTT
GTATTGCTCTATTAGGAATTTGTTAAACATTTTTCAGTTGATCAAATGGCAGAACTTCTAATGATAATTG
CAAGGGTGTGTATCAGGAAATAGTAAAAAAGGAAACAATCTTTTGTTGACCAAGTGGCAGGACCTTTTGT
GAAAATTGTAATGATGTATCAGAAAAGGGTAAAAAATGAAAATTCTTTACTTGACCATATAACAGAACGT
CTTGTGGTAATTGTATTGCTGTATACGAAAATTGTTAAAGTTAAGATTTTTTCAGTTGATCCAATGTCAG
AAGCTTTTGCAATAATTGTTTTGGTTTATCAGAAAATAGTAAAAAGGTTAAAAAAACAAAACCTCTTGTG
ATTATCGTATTGATGTACATAGAAACTATTAAAGTAAAAACATATTCAGTAGAATGTCAGAACTTCTTGT
GAAAATCTTTTATTTGTGTATCAGAAAATGGTGAGAAGTAAATTTTCCTTAGTTGATTTAATGGCAAAGG
TTTTGTGAAAACTGTATTGCTGTATCAGAAAATAATTAAACACAGAAAATGATAAAAGTAAAAATTTCTT
ACAGATTTATCGCTGTCGTTCAATGCTCCAAATTTTGAGAAATTTGTGGGAATGATAGAGGGCAGCATTG
TACGTCCGAGGGAAGACAGTACACTTAGGACAGACAGCATAAACAAGTTCATTGATGACTTATTGGTTGT
GATGGATAGGATATCTGATATACCGATAAAGCTCATGAGATCCGGGTCTTACTATGACAGAACGAAGGTA
ACTGTAAAAAGAAAGTGGTACCATGTTAGGCGCCTTGAAAATATGACTTTTATGTTTACATTTATGTATT
TGTCTGTAATAACAGTATGGGTCGTATTTGTAACGTATTCTTCAATGCATTTCATGAATAACGCAATTGA
GATGCCCCTGGAGAGCAAGCGGGGTTTGGGGGGTTGTTGGTCGGTCCTCCCCCCCCCCCCCCCCCAAGCA
CCTGTGTATTCGATTAACTCATAAACTCAAGGAATGGTTCCTTATTCCTAATTCACTGTGAAAAGATGTT
TTTATGAATAAAATCATCTTTAAGGGTCAATCATGAGAAAAAAAAAAAAAACAAGTGTCTCCATTGAGAC
ACTTATTGTTAGATCATAATTAATCACCTAATTGTGTACGGATTTTCCTTTCTTTCCGATTTCGACAAAG
AGCACCCGGGGATGTGACCGGTCAGCAGAGGATGCTTTACTCCTCAACGGCACCTGATTCTACCTCTAAT
TTTTTTTATGAGGTCTTTGTTTGCTCTCCTCCTGACTTGTGATTTTCCTTTTGACTTTTGATGTTTGTTA
TCACCAAATGCCTGTTATTTTAAAGCGAAATATTTAAGAACGAGGAAGAACGTTATAATTCTACCTAGTA
TTTCATACACCTTTCTTTTAATTTCTTTGAACAGATCGACTACAACGATGAATTCGATTTTATGTTTTAT
GCTGACATCAGAATGGAAGCAGATTTTACAAACTGTCCCCCAGGATATTGTAAAATTCGGAAAGGAATGA
CTGTAAAACCGGATCTTGATCCGTTCATCGACAGGAACGGGTACCTTGTTCCTGAAAAGTACAAAGCCCA
TATGTTCGATATATTCGAAAAATGTCGGACTGATTCCAGTTTTAGACAAGGGAGGAGAACCCAAAGTAAG
TGATCTAATTTTAGTTTTTTTTTATTTAGAAGCCTTTTTAAATATTTTGGCATATGGCGTGTTATGCATT
GATATATAACTAATATTGTTTGCTATTCGGCAGATCAGAGGCAGACTAATTTGTTACCAAGTAACTGTAA
ATTTGCATAGAACTAGCACAAAGAGAAAGTCTTCCTCTCCTAAACACTTCAAATAAACTCTAACTAGGCA
TGACGTCGTGTACACGTTATCCTAAAAATGATTATATTACCCTCAGACGCATTTTGTTTATACTTAATTC
AATCATAAATGAATAACTTGAAATCTTATGTTCCAGAACAAGATCGCAAACCTGAGAGCCCAGCATACAC
ATTACTGTTCGATTTAGGAATTTCTGGTAAACCCCCAATCGACATTGATTTAGTTCCTGCAATAAAAATT
GATGGCTGGCCAAAACCTGCAAGAAAAATCGGTCCTAGTAAATGGATAGAAAAAAGCATGGCTGAGAGAG
CTATGCAATGCTTCCACGTCGTTACCAAGAAGTTTCAAGAAGGTATACTTTTGTTCATTACATTTTAAGT
CATCTGTTAGAAAAGAAACATTTAAAATGATTTGGATAAAAAAAATGAGAATTGTTTGATCACATCATTA
ATTTCATACGGTTTTGTAGTATACAATTTTAATCAATATAGTTATAAAAAATAACGCTATTGCATCGTAT
GATACTATACAATATCGTGCCATATGATATATCATCTGATACAGGAAATTGAAGAAAATTAACTTTCTGC
ATATGCATTGTACTGAAATTGTTGGGCAAATACTATCCATAAACTAGATTAATTTAAAAATAAAAATCTT
AAAACTGAGTTCAGTTGCAAACAGTATACAGCAATTAACTTTTATGGTAAACAAAACAAAAAGAAAAATG
CGAAAATGTTTTTCTTTTCTAAAAATGAACATTAACAATGAAATGCGATATGATTCGCCGGAATTTTATT
TTTTTCATATGATTTCATTTATAGCTCACCAAGACAGTCGCCTGCTATGGAGGATTTCCTTCTCGCACGC
AGAAAAAGAACTTATTCTTCACGCTAACATGTCGGACAATGGTTGTCGGAAGGATGTTTTTAAAATTCTG
AAGAGAATTAAGGAAAACATGAAGTCTAAAAACCCAACTGAAATGGACAAGTTCTGTAGTTACCATCTTA
AAATGTTCATTCTAAGGTTTTATGATAAACACGGTGATTTTAGTAAGGAGAGGAAGTTGGACTTGCTTAA
GGAGAGTATAAAGCAGCTCGCGAAATGTGTACGTGAGGGAACCATTGAAAATTACTTCATTCCTAAGGAC
AATGTTCTACAGTCAGTCCCAGAGAAAGAAAGGTTGTCTGTTGTCAGGGAACTAGATGGTCTCTTACAAT
AAATGGTGCTGAAATGTTACATGTTTTCGTTGATATCCATACCAACATATGTTCAAGTTAACTAATTCTT
TTTACAGGTTTCGTGTTCAGGAGATGTTTTATATATTTTTTTTTTATATTTTCAGTATGTCTGGTGCATT
ATTATAAATCATGACACAAGATAGCTTGTAACTTTGTACCAATTAACTTATTGGTCTGTCTTTGTTGCAT
CATCGTTGTGTGTTAAGGTGGTAAGATTTTGTAAGGATACTGAATGAAACGCATAGCTCTTATTAGGTAA
AAGTGTCTCTGCATACACATTTTAAACCAATGACTTTATTTCTAGGCCTGTGCATAATGGTACAATCAGT
ACTTTGTAAATTTGCAAATGTTGATTTTTTTTTAAATAATCGTTTGTTGGATTTTTTGTGAGAAAGAGGA
ACACGGTGTGTGTTTTTAACCTGGCCTCTTTGTTCAGCTTTTGTGCTAAAAAGGTAAAATTGGATGATGA
TTGTTTTAAATAAATATATCATAGACGATAGTATTTTAATATTGAGTTTTACGATCTTGTCATCATTATG
AACTGCTGATTGCGTATAACTGTAATGTAATGTACAAGGTATAATCAAGCATTTGTGAAGTGAATGAAAT
TCTAAATTATCTATTCTTTACAAAACAAGTCTGCTTTATATATTATCTGTAAAATGTGTCGCATATAATT
CGATGTTTGGCTTTAGCATATGAGCAAAACTACTTAACACTGCCATTTAATAACAATATTTTGAATAATA
TCTTTACTTCACATTACTGTCTCCAAGTACATATAATAGTATCTACGTTGTGACGTTTTTATTTGTGAGG
CCATATTTTCTTTATCTTTTATTTTACTTATAATCGATAATTGATCATAAAGTTTGTTAAAAGATTTAAA
GCAATATGAGCTGTAATTTTTAGAATTTTATTTTGCTGCAAAAACCTGCCAGTATGATAAGTCTGCATGT
AACTTAAACTCTTATGATAAATAAAATTTGAAAGAATTATTAATTTCGTCAGATGAAAGATTTCTCTTAT
GAAGAATATATAGCAGATCAATTTTGGTAGAGGACGACAATAATTCAATTTTGCTTCAATTAAGGCTTCT
TTACGGCTTTTAAAATAAACATATGCCTAACAGAACTTTAAAAACCATGATATGTTTGTTAATTTAATAG
AAAATAACATTTTCGTAAAAAAAAAAAATCAGCATGAAAATTGCAGCTCATATTGCTTTAAACTGTATAT
TGATATATGTAAACTATTGATTACAGAGAATAAATAATGTTCAAATTTCAAAACTTTATTTTCAAATACT
TTTATCGTATGATCAAAACTATTGAATGTGATTACCATTTGCACAGTGATCAGGTTTTATAGAAAGATGC
ATAATTTAAAAAAAATATATTGCGGTTGTGCTTTGGTTTTTTTTCTATCTCTAAACATTTACTCTTATTT
TTTTGTTTCATTTGACATGGCATTTTGTATCCATTGTAAAAAAATGTTTTACTAGGATATAGTAATTAGA
ACCCAATAACTGTTGTCAATAATAATACACAGTTCATAATTTTGACGATTACAATTTAGTTATTTGAATA
AAGTTAACAAGTTATTTTCTGGAAAGTAGATTGGTTGTAGCATGATTTGTCAAACACTGTAAGTACCTTT
GCATATAAAAAGATTATTTGATAATCCTTAATTTTTATCATTTAAAGCGTAGATGATGATGATGATACTG
TATGCATAAGCGAATTTCTTCCCATTGGGTAGCATTTAGGAACATCTCGAGTGTATATTGCAGGGGGAAT
TGATGACATAATTTGCGGAATATATCATTAATATACAAAAAATCCAATATCAGCGATATCGGAAAAAAAC
ATCAGAAAAAATTTGAGATCACAGTATTGTGTAATATACGTCGAACACCGAACATTTAAAGGGGCATGGT
CACGATTATGGTCAAAAATCATTCTTCCGAATTCAATGTTAACAATGCTTCAGTAAGGCATTCTTTATAG
GCAACCAAAAATTGAGTGTCATTCATTGAGTTAAAAGCGAGTTACAGAGCTTAAATTTTTTTCTATGTAA
AGAAAGCTTTTGTTTACTTTTTGAATGTAGAAGGGAAAATTCCAGTTTTAGACCTAAAATGAATGTGTTG
AATGTTTAAAAATACTGTTAATTTTATGCTTTAAATGAATAAGAAGATAAACAAATCAGCTTTATATAGT
ATATTTCATCTTTGTAAACAAAAACAGGGCACGAGTCTTGTTTACATTACAAAGAGTTGTGACCCATGTA
TCTTGCTCATAACTCTACGACTGACTCTCAAATTTATTTGAATATAGAAATGCATTTCTAAAGCATTGTA
AATAATAAAAACTGAAGAACTAAATTTGACCAAAATCGTAACCATGCCCTTTATCGCAAACGATATAGGA
AAGTGTTTTGAGAAAAGAAACCAATGAAACACGATACAAAACAGATATATTTAAAAGTTTCACATTTACA
GACGTTACTCTGTGTTAGTTTGTCAAAACATGTACTGCAATAGATCAAGCAGAGACATCGTGGACTTAAA
AACGTGTTGTTAATTTGAAATAAATTTTACCTACTACGTGTATTGTATCCTCGTCTATAGACAACGCTGG
TAAGAGAACGAGGGTATGCAATTATATTGGAAAGTTGAAAAAGCCCCTTTTGATGTGCACTCACAGCGAA
ATTACTCGTTTTGTGCAAGAAAATCCTAATACTTTGTATTCTTCCAATAAATGCAACATTAAAATAAATA
CCGGTATGAAATTTTGCTTAATATTACGAATTCACCATTGCAATTTCATTTATTTTCTGTTCAAATTTGT
TATCTTAAATTGAATTTTGCATGGTCTACTTGTTAGGACCCCGCTCTGCGGGTGACTTATAGTGAGCAGT
CCATCCATCCATTTTTGTTTCTTTCTGTCTGTCCGTCCGTCCGAGATCTCTTGTCAGGAGCATTTTGTCT
CCCCCTTGGCCTATTTTTGCTGTTACTTCCCCAAGTTTTAAGGCGAAATGTGAAGATCATAGCAGATCTC
TTTATAATCCAGTTTTAGAACATACATTTATTCTCAAATGCTTAATTTTGCTCAGATTGAACAAATAAAT
ACATGTAAGTAAGAGTAATGACATTGAATTATTTAAACTTCTATGCCAGCTGGAACATTTTTAAGTCATA
GGTTAAGGTCAAAGCAAATTATCTGAAACACTTTTCATTCTATTGTCCATTATTTGAGTAGGCCCTTTGA
GATGCTTACCTTCTTAATGATGCCTAGATACTGTCAATTTTATATTCCTGTCATGCAAACGTGTATTGCG
CTATGTTGATTTGATAAGGTTGATTTTTTCCCTATGTCTGTCATAATTGTAATTAAAGTGTTCTTTTCAG
GAGGAGAGGGTTACTCAAGGAAGCTATACTATCCTATTTAAAGTAATAGGCAGTAGACCCTTTTTCATAT
AACTTGATAAATGCCTTTTAAACTTAATTTTAAAAAGATTAAATTGTACACAAATTTGTCAGTTTAAAGG
TAAATACTCACGAGTATGAAAGGTAGTTAATCCAAAATCAATAAATGATAAAACGAATAAAGGGTCCATT
TTGTATTAATCAACAAATAACATTTCATTTTGATTAAATT"""</span>
        self<span class="token punctuation">.</span>seq_text<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> tk<span class="token punctuation">.</span>END<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>seq_text<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>tk<span class="token punctuation">.</span>END<span class="token punctuation">,</span> example<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pos_entry<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> tk<span class="token punctuation">.</span>END<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>pos_entry<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"31898289"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>hide_rev_comp<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get_clean_sequence</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""提取并清理序列"""</span>
        lines <span class="token operator">=</span> self<span class="token punctuation">.</span>seq_text<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> tk<span class="token punctuation">.</span>END<span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
        header <span class="token operator">=</span> lines<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        seq <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">if</span> line <span class="token keyword">and</span> <span class="token keyword">not</span> line<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> header<span class="token punctuation">,</span> seq<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
        
    <span class="token keyword">def</span> <span class="token function">parse_coordinates</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> header<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""智能解析基因组坐标（兼容正/反链表示法）
        
        支持的格式：
        - 正链："&gt;ref|NC_001234|:100-200" 
        - 反链："&gt;ref|NC_001234|:c200-100" 或 "&gt;ref|NC_001234|:complement(100-200)"
        """</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 处理标准反向链表示法（带c前缀）</span>
            <span class="token keyword">if</span> <span class="token string">':c'</span> <span class="token keyword">in</span> header<span class="token punctuation">:</span>
                coord_part <span class="token operator">=</span> header<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':c'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                start<span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> coord_part<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 返回元组，第三个参数表示是否反向</span>
            
            <span class="token comment"># 处理complement表示法</span>
            <span class="token keyword">elif</span> <span class="token string">'complement('</span> <span class="token keyword">in</span> header<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                coord_part <span class="token operator">=</span> header<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'('</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                start<span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> coord_part<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 默认正向链</span>
            <span class="token keyword">elif</span> <span class="token string">':'</span> <span class="token keyword">in</span> header<span class="token punctuation">:</span>
                coord_part <span class="token operator">=</span> header<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                <span class="token keyword">if</span> <span class="token string">'-'</span> <span class="token keyword">in</span> coord_part<span class="token punctuation">:</span>  <span class="token comment"># 标准范围表示</span>
                    start<span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> coord_part<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>  <span class="token comment"># 单点位置</span>
                    pos <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>coord_part<span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token punctuation">(</span>pos<span class="token punctuation">,</span> pos<span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">)</span>
            
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"无法解析坐标信息"</span><span class="token punctuation">)</span>
        
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"坐标解析错误: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">reverse_complement</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seq<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""生成反向互补序列"""</span>
        comp <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'A'</span><span class="token punctuation">:</span> <span class="token string">'T'</span><span class="token punctuation">,</span> <span class="token string">'T'</span><span class="token punctuation">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">:</span> <span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'G'</span><span class="token punctuation">:</span> <span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token string">'N'</span><span class="token punctuation">:</span> <span class="token string">'N'</span><span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>comp<span class="token punctuation">.</span>get<span class="token punctuation">(</span>base<span class="token punctuation">,</span> <span class="token string">'N'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> base <span class="token keyword">in</span> seq<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">locate_base</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            header<span class="token punctuation">,</span> seq <span class="token operator">=</span> self<span class="token punctuation">.</span>get_clean_sequence<span class="token punctuation">(</span><span class="token punctuation">)</span>
            start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> is_reverse <span class="token operator">=</span> self<span class="token punctuation">.</span>parse_coordinates<span class="token punctuation">(</span>header<span class="token punctuation">)</span>
            target_pos <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>pos_entry<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>is_reverse <span class="token operator">=</span> is_reverse
            self<span class="token punctuation">.</span>original_seq <span class="token operator">=</span> seq
            seq_length <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>start <span class="token operator">-</span> end<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
            
            <span class="token comment"># 验证位置范围</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token builtin">min</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> target_pos <span class="token operator">&lt;=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"位点 </span><span class="token interpolation"><span class="token punctuation">{</span>target_pos<span class="token punctuation">}</span></span><span class="token string"> 不在序列范围内 (</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">min</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">max</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
            
            <span class="token comment"># 计算相对位置</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>is_reverse<span class="token punctuation">:</span>
                distance_from_end <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span> <span class="token operator">-</span> target_pos
                rel_pos <span class="token operator">=</span> seq_length <span class="token operator">-</span> distance_from_end <span class="token operator">-</span> <span class="token number">1</span>
                self<span class="token punctuation">.</span>rev_comp_seq <span class="token operator">=</span> self<span class="token punctuation">.</span>reverse_complement<span class="token punctuation">(</span>seq<span class="token punctuation">)</span>
                working_seq <span class="token operator">=</span> self<span class="token punctuation">.</span>rev_comp_seq
                display_text <span class="token operator">=</span> self<span class="token punctuation">.</span>rev_comp_text
                strand <span class="token operator">=</span> <span class="token string">"负链"</span>
                self<span class="token punctuation">.</span>show_rev_comp<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                rel_pos <span class="token operator">=</span> target_pos <span class="token operator">-</span> <span class="token builtin">min</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span>
                working_seq <span class="token operator">=</span> seq
                display_text <span class="token operator">=</span> self<span class="token punctuation">.</span>seq_text
                strand <span class="token operator">=</span> <span class="token string">"正链"</span>
                self<span class="token punctuation">.</span>hide_rev_comp<span class="token punctuation">(</span><span class="token punctuation">)</span>
                     
            <span class="token keyword">if</span> rel_pos <span class="token operator">&gt;=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>working_seq<span class="token punctuation">)</span> <span class="token keyword">or</span> rel_pos <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"计算错误：相对位置超出序列长度"</span><span class="token punctuation">)</span>
            
            base <span class="token operator">=</span> working_seq<span class="token punctuation">[</span>rel_pos<span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>result_label<span class="token punctuation">.</span>config<span class="token punctuation">(</span>
                text<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"位点 </span><span class="token interpolation"><span class="token punctuation">{</span>target_pos<span class="token punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token punctuation">{</span>strand<span class="token punctuation">}</span></span><span class="token string">): 位置 </span><span class="token interpolation"><span class="token punctuation">{</span>rel_pos<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>working_seq<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> | 碱基 = </span><span class="token interpolation"><span class="token punctuation">{</span>base<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>
                fg<span class="token operator">=</span><span class="token string">"blue"</span>
            <span class="token punctuation">)</span>
            
            self<span class="token punctuation">.</span>highlight_position<span class="token punctuation">(</span>rel_pos<span class="token punctuation">,</span> display_text<span class="token punctuation">)</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>result_label<span class="token punctuation">.</span>config<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"错误: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> fg<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">highlight_position</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> rel_pos<span class="token punctuation">,</span> text_widget<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""精确定位高亮位置（考虑实际行长度）"""</span>
        text_widget<span class="token punctuation">.</span>tag_remove<span class="token punctuation">(</span><span class="token string">"highlight"</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> tk<span class="token punctuation">.</span>END<span class="token punctuation">)</span>
        
        <span class="token comment"># 获取文本内容（包含换行符）</span>
        content <span class="token operator">=</span> text_widget<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">,</span> <span class="token string">"end-1c"</span><span class="token punctuation">)</span>
        lines <span class="token operator">=</span> content<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 跳过标题行（以&gt;开头的行）</span>
        data_lines <span class="token operator">=</span> <span class="token punctuation">[</span>line <span class="token keyword">for</span> line <span class="token keyword">in</span> lines <span class="token keyword">if</span> line <span class="token keyword">and</span> <span class="token keyword">not</span> line<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        
        <span class="token comment"># 计算实际字符位置</span>
        cumulative_len <span class="token operator">=</span> <span class="token number">0</span>
        found_line <span class="token operator">=</span> <span class="token number">0</span>
        found_col <span class="token operator">=</span> <span class="token number">0</span>
        
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> line <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>data_lines<span class="token punctuation">)</span><span class="token punctuation">:</span>
            line_len <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
            <span class="token keyword">if</span> cumulative_len <span class="token operator">+</span> line_len <span class="token operator">&gt;</span> rel_pos<span class="token punctuation">:</span>
                found_line <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment"># +1因为前面跳过了标题行</span>
                found_col <span class="token operator">=</span> rel_pos <span class="token operator">-</span> cumulative_len
                <span class="token keyword">break</span>
            cumulative_len <span class="token operator">+=</span> line_len
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"无法定位位置：超出序列范围"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 高亮定位</span>
        start_index <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>found_line <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token punctuation">{</span>found_col<span class="token punctuation">}</span></span><span class="token string">"</span></span>  <span class="token comment"># +1因为tkinter行号从1开始</span>
        end_index <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>found_line <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token punctuation">{</span>found_col <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
        
        text_widget<span class="token punctuation">.</span>tag_add<span class="token punctuation">(</span><span class="token string">"highlight"</span><span class="token punctuation">,</span> start_index<span class="token punctuation">,</span> end_index<span class="token punctuation">)</span>
        text_widget<span class="token punctuation">.</span>tag_config<span class="token punctuation">(</span><span class="token string">"highlight"</span><span class="token punctuation">,</span> background<span class="token operator">=</span><span class="token string">"yellow"</span><span class="token punctuation">)</span>
        text_widget<span class="token punctuation">.</span>see<span class="token punctuation">(</span>start_index<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">show_rev_comp</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""显示反向互补序列"""</span>
        header <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"&gt;反向互补链 (基因组位置 </span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>start_pos<span class="token punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>end_pos<span class="token punctuation">}</span></span><span class="token string">)"</span></span>
        self<span class="token punctuation">.</span>rev_comp_text<span class="token punctuation">.</span>config<span class="token punctuation">(</span>state<span class="token operator">=</span><span class="token string">'normal'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>rev_comp_text<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> tk<span class="token punctuation">.</span>END<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>rev_comp_text<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>tk<span class="token punctuation">.</span>END<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>header<span class="token punctuation">}</span></span><span class="token string">\n</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>format_sequence<span class="token punctuation">(</span>self<span class="token punctuation">.</span>rev_comp_seq<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>rev_comp_text<span class="token punctuation">.</span>config<span class="token punctuation">(</span>state<span class="token operator">=</span><span class="token string">'disabled'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>rev_comp_label<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>rev_comp_text<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">hide_rev_comp</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""隐藏反向互补序列"""</span>
        self<span class="token punctuation">.</span>rev_comp_label<span class="token punctuation">.</span>pack_forget<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>rev_comp_text<span class="token punctuation">.</span>pack_forget<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">format_sequence</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seq<span class="token punctuation">,</span> chars_per_line<span class="token operator">=</span><span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""格式化序列为多行显示"""</span>
        <span class="token keyword">return</span> <span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>seq<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span>chars_per_line<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>seq<span class="token punctuation">)</span><span class="token punctuation">,</span> chars_per_line<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">design_primer</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""智能引物设计（自动选择最佳产物长度）"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 参数设置</span>
            IDEAL_PRODUCT_SIZE <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>product_size_entry<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 理想产物大小</span>
            SIZE_TOLERANCE <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>tolerance_entry<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment"># 产物大小允许波动范围</span>
            MIN_PRIMER_LEN <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>min_len_entry<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            MAX_PRIMER_LEN <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>max_len_entry<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
            messagebox<span class="token punctuation">.</span>showerror<span class="token punctuation">(</span><span class="token string">"错误"</span><span class="token punctuation">,</span> <span class="token string">"参数设置中存在非法数值！"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
    
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[调试] 获取参数成功：理想产物大小=</span><span class="token interpolation"><span class="token punctuation">{</span>IDEAL_PRODUCT_SIZE<span class="token punctuation">}</span></span><span class="token string">, 容差=</span><span class="token interpolation"><span class="token punctuation">{</span>SIZE_TOLERANCE<span class="token punctuation">}</span></span><span class="token string">, 引物长度=</span><span class="token interpolation"><span class="token punctuation">{</span>MIN_PRIMER_LEN<span class="token punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token punctuation">{</span>MAX_PRIMER_LEN<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
        
        <span class="token comment"># 调用实际引物设计函数或逻辑</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>original_seq<span class="token punctuation">:</span>
            messagebox<span class="token punctuation">.</span>showwarning<span class="token punctuation">(</span><span class="token string">"警告"</span><span class="token punctuation">,</span> <span class="token string">"请先定位碱基后再设计引物。"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token comment"># 获取序列信息</span>
            header<span class="token punctuation">,</span> seq <span class="token operator">=</span> self<span class="token punctuation">.</span>get_clean_sequence<span class="token punctuation">(</span><span class="token punctuation">)</span>
            start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> is_reverse <span class="token operator">=</span> self<span class="token punctuation">.</span>parse_coordinates<span class="token punctuation">(</span>header<span class="token punctuation">)</span>
            target_pos <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>pos_entry<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            
            <span class="token comment"># 计算相对位置</span>
            <span class="token keyword">if</span> is_reverse<span class="token punctuation">:</span>
                working_seq <span class="token operator">=</span> self<span class="token punctuation">.</span>reverse_complement<span class="token punctuation">(</span>seq<span class="token punctuation">)</span>
                rel_pos <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>working_seq<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>start <span class="token operator">-</span> target_pos<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                working_seq <span class="token operator">=</span> seq
                rel_pos <span class="token operator">=</span> target_pos <span class="token operator">-</span> start
            
            <span class="token comment"># 动态设计引物区域</span>
            best_result <span class="token operator">=</span> <span class="token boolean">None</span>
            best_score <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
            
            <span class="token comment"># 尝试不同产物大小（300-700bp范围）</span>
            <span class="token keyword">for</span> product_size <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>IDEAL_PRODUCT_SIZE <span class="token operator">-</span> SIZE_TOLERANCE<span class="token punctuation">,</span> 
                                    IDEAL_PRODUCT_SIZE <span class="token operator">+</span> SIZE_TOLERANCE <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                
                half_size <span class="token operator">=</span> product_size <span class="token operator">//</span> <span class="token number">2</span>
                region_start <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> rel_pos <span class="token operator">-</span> half_size<span class="token punctuation">)</span>
                region_end <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>working_seq<span class="token punctuation">)</span><span class="token punctuation">,</span> rel_pos <span class="token operator">+</span> half_size<span class="token punctuation">)</span>
                
                <span class="token comment"># 跳过无效范围</span>
                <span class="token keyword">if</span> region_start <span class="token operator">&gt;=</span> region_end<span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                    
                <span class="token comment"># 生成候选引物</span>
                fwd_candidates <span class="token operator">=</span> self<span class="token punctuation">.</span>get_primer_candidates<span class="token punctuation">(</span>
                    working_seq<span class="token punctuation">,</span> region_start<span class="token punctuation">,</span> rel_pos<span class="token punctuation">,</span> 
                    min_len<span class="token operator">=</span>MIN_PRIMER_LEN<span class="token punctuation">,</span> max_len<span class="token operator">=</span>MAX_PRIMER_LEN
                <span class="token punctuation">)</span>
                rev_candidates <span class="token operator">=</span> self<span class="token punctuation">.</span>get_primer_candidates<span class="token punctuation">(</span>
                    working_seq<span class="token punctuation">,</span> rel_pos<span class="token punctuation">,</span> region_end<span class="token punctuation">,</span>
                    min_len<span class="token operator">=</span>MIN_PRIMER_LEN<span class="token punctuation">,</span> max_len<span class="token operator">=</span>MAX_PRIMER_LEN<span class="token punctuation">,</span>
                    is_forward<span class="token operator">=</span><span class="token boolean">False</span>
                <span class="token punctuation">)</span>
                
                <span class="token comment"># 评估最佳引物对</span>
                current_result <span class="token operator">=</span> self<span class="token punctuation">.</span>evaluate_primer_pairs<span class="token punctuation">(</span>
                    fwd_candidates<span class="token punctuation">,</span> rev_candidates<span class="token punctuation">,</span> 
                    ideal_size<span class="token operator">=</span>IDEAL_PRODUCT_SIZE
                <span class="token punctuation">)</span>
                
                <span class="token comment"># 保留最优结果</span>
                <span class="token keyword">if</span> current_result <span class="token keyword">and</span> current_result<span class="token punctuation">[</span><span class="token string">"score"</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> best_score<span class="token punctuation">:</span>
                    best_result <span class="token operator">=</span> current_result
                    best_score <span class="token operator">=</span> current_result<span class="token punctuation">[</span><span class="token string">"score"</span><span class="token punctuation">]</span>
            
            <span class="token keyword">if</span> <span class="token keyword">not</span> best_result<span class="token punctuation">:</span>
                <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"未找到符合条件的引物，请尝试调整参数"</span><span class="token punctuation">)</span>
                
            <span class="token comment"># 补充：生成产物序列并加入 result</span>
            f_start <span class="token operator">=</span> best_result<span class="token punctuation">[</span><span class="token string">"forward"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"pos"</span><span class="token punctuation">]</span>
            r_end <span class="token operator">=</span> best_result<span class="token punctuation">[</span><span class="token string">"reverse"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"pos"</span><span class="token punctuation">]</span> <span class="token operator">+</span> best_result<span class="token punctuation">[</span><span class="token string">"reverse"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"len"</span><span class="token punctuation">]</span>
            template_seq <span class="token operator">=</span> self<span class="token punctuation">.</span>reverse_complement<span class="token punctuation">(</span>seq<span class="token punctuation">)</span> <span class="token keyword">if</span> is_reverse <span class="token keyword">else</span> seq
            
            <span class="token comment"># 防止越界</span>
            r_end <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>r_end<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>template_seq<span class="token punctuation">)</span><span class="token punctuation">)</span>
            f_start <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> f_start<span class="token punctuation">)</span>
            
            <span class="token comment"># 生成产物序列</span>
            product_seq <span class="token operator">=</span> template_seq<span class="token punctuation">[</span>f_start<span class="token punctuation">:</span>r_end<span class="token punctuation">]</span>
            best_result<span class="token punctuation">[</span><span class="token string">"product_seq"</span><span class="token punctuation">]</span> <span class="token operator">=</span> product_seq
                    
            <span class="token comment"># 显示结果</span>
            self<span class="token punctuation">.</span>show_primer_result<span class="token punctuation">(</span>best_result<span class="token punctuation">)</span>
            
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>result_label<span class="token punctuation">.</span>config<span class="token punctuation">(</span>text<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"引物设计错误: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> fg<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">calculate_gc</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seq<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""计算GC含量，返回百分比整数"""</span>
        gc_count <span class="token operator">=</span> seq<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">'G'</span><span class="token punctuation">)</span> <span class="token operator">+</span> seq<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">round</span><span class="token punctuation">(</span><span class="token number">100</span> <span class="token operator">*</span> gc_count <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>seq<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">calculate_tm</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seq<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""计算引物的Tm值（简单公式：Wallace规则）"""</span>
        seq <span class="token operator">=</span> seq<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>
        a <span class="token operator">=</span> seq<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span>
        t <span class="token operator">=</span> seq<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">'T'</span><span class="token punctuation">)</span>
        g <span class="token operator">=</span> seq<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">'G'</span><span class="token punctuation">)</span>
        c <span class="token operator">=</span> seq<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">)</span>
        tm <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> t<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">(</span>g <span class="token operator">+</span> c<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">round</span><span class="token punctuation">(</span>tm<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">has_homopolymer</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seq<span class="token punctuation">,</span> max_repeat<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        检查是否存在连续重复碱基（如AAAA、CCCC）
        max_repeat: 允许的最大重复次数
        """</span>
        <span class="token keyword">for</span> base <span class="token keyword">in</span> <span class="token string">"ATCG"</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> base <span class="token operator">*</span> <span class="token punctuation">(</span>max_repeat <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">in</span> seq<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    
    <span class="token keyword">def</span> <span class="token function">get_primer_candidates</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seq<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> min_len<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">,</span> max_len<span class="token operator">=</span><span class="token number">22</span><span class="token punctuation">,</span> is_forward<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""生成候选引物（可变长度）"""</span>
        candidates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        
        <span class="token keyword">for</span> length <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>min_len<span class="token punctuation">,</span> max_len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> end <span class="token operator">-</span> length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                primer <span class="token operator">=</span> seq<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span>length<span class="token punctuation">]</span> <span class="token keyword">if</span> is_forward \
                        <span class="token keyword">else</span> self<span class="token punctuation">.</span>reverse_complement<span class="token punctuation">(</span>seq<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span>length<span class="token punctuation">]</span><span class="token punctuation">)</span>
                
                <span class="token comment"># 跳过无效引物</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>primer<span class="token punctuation">)</span> <span class="token operator">!=</span> length<span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                    
                <span class="token comment"># 计算引物参数</span>
                gc <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_gc<span class="token punctuation">(</span>primer<span class="token punctuation">)</span>
                tm <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_tm<span class="token punctuation">(</span>primer<span class="token punctuation">)</span>
                
                <span class="token comment"># 基础筛选</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">40</span> <span class="token operator">&lt;=</span> gc <span class="token operator">&lt;=</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token punctuation">(</span><span class="token number">55</span> <span class="token operator">&lt;=</span> tm <span class="token operator">&lt;=</span> <span class="token number">65</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>has_homopolymer<span class="token punctuation">(</span>primer<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                    
                candidates<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token string">"seq"</span><span class="token punctuation">:</span> primer<span class="token punctuation">,</span>
                    <span class="token string">"pos"</span><span class="token punctuation">:</span> i<span class="token punctuation">,</span>
                    <span class="token string">"len"</span><span class="token punctuation">:</span> length<span class="token punctuation">,</span>
                    <span class="token string">"gc"</span><span class="token punctuation">:</span> gc<span class="token punctuation">,</span>
                    <span class="token string">"tm"</span><span class="token punctuation">:</span> tm<span class="token punctuation">,</span>
                    <span class="token string">"end3"</span><span class="token punctuation">:</span> primer<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token punctuation">]</span>  <span class="token comment"># 3'端序列（用于二聚体检查）</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
        
        <span class="token keyword">return</span> candidates

    <span class="token keyword">def</span> <span class="token function">has_dimer</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seq1<span class="token punctuation">,</span> seq2<span class="token punctuation">,</span> min_match<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        检查两个引物是否可能形成二聚体（简单3'端互补检查）
        min_match：最小连续碱基配对数
        """</span>
        <span class="token comment"># 构建反向互补序列</span>
        rc2 <span class="token operator">=</span> self<span class="token punctuation">.</span>reverse_complement<span class="token punctuation">(</span>seq2<span class="token punctuation">)</span>
    
        <span class="token comment"># 检查是否存在3'端配对</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>seq1<span class="token punctuation">)</span> <span class="token operator">-</span> min_match <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            tail <span class="token operator">=</span> seq1<span class="token punctuation">[</span><span class="token operator">-</span><span class="token punctuation">(</span>i <span class="token operator">+</span> min_match<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> tail <span class="token keyword">in</span> rc2<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
    
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>rc2<span class="token punctuation">)</span> <span class="token operator">-</span> min_match <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            tail <span class="token operator">=</span> rc2<span class="token punctuation">[</span><span class="token operator">-</span><span class="token punctuation">(</span>i <span class="token operator">+</span> min_match<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> tail <span class="token keyword">in</span> seq1<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
    
        <span class="token keyword">return</span> <span class="token boolean">False</span>


    <span class="token keyword">def</span> <span class="token function">evaluate_primer_pairs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fwd_candidates<span class="token punctuation">,</span> rev_candidates<span class="token punctuation">,</span> ideal_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""评估并选择最佳引物对"""</span>
        best_pair <span class="token operator">=</span> <span class="token boolean">None</span>
        best_score <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
        
        <span class="token keyword">for</span> fwd <span class="token keyword">in</span> fwd_candidates<span class="token punctuation">:</span>
            <span class="token keyword">for</span> rev <span class="token keyword">in</span> rev_candidates<span class="token punctuation">:</span>
                <span class="token comment"># 计算实际产物大小</span>
                product_size <span class="token operator">=</span> rev<span class="token punctuation">[</span><span class="token string">"pos"</span><span class="token punctuation">]</span> <span class="token operator">-</span> fwd<span class="token punctuation">[</span><span class="token string">"pos"</span><span class="token punctuation">]</span> <span class="token operator">+</span> fwd<span class="token punctuation">[</span><span class="token string">"len"</span><span class="token punctuation">]</span>
                
                <span class="token comment"># 基本筛选</span>
                <span class="token keyword">if</span> product_size <span class="token operator">&lt;</span> <span class="token number">200</span> <span class="token keyword">or</span> product_size <span class="token operator">&gt;</span> <span class="token number">800</span><span class="token punctuation">:</span>  <span class="token comment"># 放宽产物大小限制</span>
                    <span class="token keyword">continue</span>
                    
                <span class="token comment"># 检查二聚体</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>has_dimer<span class="token punctuation">(</span>fwd<span class="token punctuation">[</span><span class="token string">"seq"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> rev<span class="token punctuation">[</span><span class="token string">"seq"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                    
                <span class="token comment"># 综合评分</span>
                size_diff <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>product_size <span class="token operator">-</span> ideal_size<span class="token punctuation">)</span>
                tm_diff <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>fwd<span class="token punctuation">[</span><span class="token string">"tm"</span><span class="token punctuation">]</span> <span class="token operator">-</span> rev<span class="token punctuation">[</span><span class="token string">"tm"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                gc_diff <span class="token operator">=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>fwd<span class="token punctuation">[</span><span class="token string">"gc"</span><span class="token punctuation">]</span> <span class="token operator">-</span> rev<span class="token punctuation">[</span><span class="token string">"gc"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                
                <span class="token comment"># 评分标准（分值越高越好）</span>
                score <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">-</span> <span class="token number">0.2</span><span class="token operator">*</span>size_diff <span class="token operator">-</span> <span class="token number">2</span><span class="token operator">*</span>tm_diff <span class="token operator">-</span> gc_diff
                
                <span class="token comment"># 更新最佳引物对</span>
                <span class="token keyword">if</span> score <span class="token operator">&gt;</span> best_score<span class="token punctuation">:</span>
                    best_pair <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token string">"forward"</span><span class="token punctuation">:</span> fwd<span class="token punctuation">,</span>
                        <span class="token string">"reverse"</span><span class="token punctuation">:</span> rev<span class="token punctuation">,</span>
                        <span class="token string">"product_size"</span><span class="token punctuation">:</span> product_size<span class="token punctuation">,</span>
                        <span class="token string">"score"</span><span class="token punctuation">:</span> score
                    <span class="token punctuation">}</span>
                    best_score <span class="token operator">=</span> score
                    
        <span class="token keyword">return</span> best_pair

    <span class="token keyword">def</span> <span class="token function">copy_primers</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> fwd_seq<span class="token punctuation">,</span> rev_seq<span class="token punctuation">,</span> seq<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""将引物序列复制到剪贴板"""</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            combined_text <span class="token operator">=</span> <span class="token punctuation">(</span>
                <span class="token string-interpolation"><span class="token string">f"正向引物 (Forward Primer):\n</span><span class="token interpolation"><span class="token punctuation">{</span>fwd_seq<span class="token punctuation">}</span></span><span class="token string">\n\n"</span></span>
                <span class="token string-interpolation"><span class="token string">f"反向引物 (Reverse Primer):\n</span><span class="token interpolation"><span class="token punctuation">{</span>rev_seq<span class="token punctuation">}</span></span><span class="token string">\n\n"</span></span>
                <span class="token string-interpolation"><span class="token string">f"产物序列 :\n</span><span class="token interpolation"><span class="token punctuation">{</span>seq<span class="token punctuation">}</span></span><span class="token string">"</span></span>
            <span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>root<span class="token punctuation">.</span>clipboard_clear<span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token comment"># 清除剪贴板内容</span>
            self<span class="token punctuation">.</span>root<span class="token punctuation">.</span>clipboard_append<span class="token punctuation">(</span>combined_text<span class="token punctuation">)</span>  <span class="token comment"># 添加文本</span>
            self<span class="token punctuation">.</span>root<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token comment"># 更新剪贴板状态</span>
            <span class="token comment"># messagebox.showinfo("复制成功", "引物序列已复制到剪贴板！")</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            messagebox<span class="token punctuation">.</span>showerror<span class="token punctuation">(</span><span class="token string">"错误"</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"复制失败：</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">show_primer_result</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""显示智能引物设计结果（美观版）"""</span>
        win <span class="token operator">=</span> tk<span class="token punctuation">.</span>Toplevel<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">)</span>
        win<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">"智能引物设计结果"</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 主框架</span>
        main_frame <span class="token operator">=</span> tk<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span>win<span class="token punctuation">)</span>
        main_frame<span class="token punctuation">.</span>pack<span class="token punctuation">(</span>padx<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 产物信息</span>
        tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>main_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"◆ 产物信息"</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Arial'</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'bold'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        info_frame <span class="token operator">=</span> tk<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span>main_frame<span class="token punctuation">)</span>
        info_frame<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span>
        
        tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>info_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"产物大小:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'e'</span><span class="token punctuation">)</span>
        tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>info_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'product_size'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> bp"</span></span><span class="token punctuation">,</span> fg<span class="token operator">=</span><span class="token string">"blue"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span>
        
        tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>info_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"综合评分:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'e'</span><span class="token punctuation">)</span>
        tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>info_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'score'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">/100"</span></span><span class="token punctuation">,</span> fg<span class="token operator">=</span><span class="token string">"blue"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span>
        
        tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>info_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"Tm差异:"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'e'</span><span class="token punctuation">)</span>
        tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>info_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">abs</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'forward'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tm'</span><span class="token punctuation">]</span> <span class="token operator">-</span> result<span class="token punctuation">[</span><span class="token string">'reverse'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tm'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.1f</span><span class="token punctuation">}</span></span><span class="token string">°C"</span></span><span class="token punctuation">,</span> fg<span class="token operator">=</span><span class="token string">"blue"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span>
    
        <span class="token comment"># 引物序列</span>
        tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>main_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"◆ 引物序列"</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Arial'</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'bold'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        primer_frame <span class="token operator">=</span> tk<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span>main_frame<span class="token punctuation">)</span>
        primer_frame<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span>
        
        <span class="token comment"># 正向引物</span>
        tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>primer_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"正向引物 (5'→3'):"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'e'</span><span class="token punctuation">)</span>
        fwd_entry <span class="token operator">=</span> tk<span class="token punctuation">.</span>Entry<span class="token punctuation">(</span>primer_frame<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Courier'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        fwd_entry<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token string">"forward"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"seq"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        fwd_entry<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span>
        fwd_entry<span class="token punctuation">.</span>config<span class="token punctuation">(</span>fg<span class="token operator">=</span><span class="token string">"blue"</span><span class="token punctuation">,</span> state<span class="token operator">=</span><span class="token string">'readonly'</span><span class="token punctuation">)</span>
        
        tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>primer_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"GC: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'forward'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'gc'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">%    Tm: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'forward'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tm'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">°C"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
    
        <span class="token comment"># 反向引物</span>
        tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>primer_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"反向引物 (5'→3'):"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'e'</span><span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        rev_entry <span class="token operator">=</span> tk<span class="token punctuation">.</span>Entry<span class="token punctuation">(</span>primer_frame<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Courier'</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        rev_entry<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token string">"reverse"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"seq"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        rev_entry<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        rev_entry<span class="token punctuation">.</span>config<span class="token punctuation">(</span>fg<span class="token operator">=</span><span class="token string">"blue"</span><span class="token punctuation">,</span> state<span class="token operator">=</span><span class="token string">'readonly'</span><span class="token punctuation">)</span>
        
        tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>primer_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"GC: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'reverse'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'gc'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">%    Tm: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'reverse'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tm'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">°C"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> padx<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
    
        <span class="token comment"># PCR产物序列</span>
        tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>main_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"◆ PCR产物序列"</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Arial'</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'bold'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        product_frame <span class="token operator">=</span> tk<span class="token punctuation">.</span>Frame<span class="token punctuation">(</span>main_frame<span class="token punctuation">)</span>
        product_frame<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span>
        
        tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>product_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"序列 (5'→3'):"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'e'</span><span class="token punctuation">)</span>

        product_text <span class="token operator">=</span> tk<span class="token punctuation">.</span>Text<span class="token punctuation">(</span>product_frame<span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Courier'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> wrap<span class="token operator">=</span><span class="token string">'word'</span><span class="token punctuation">)</span>
        product_text<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token string">'1.0'</span><span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token string">"product_seq"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        product_text<span class="token punctuation">.</span>config<span class="token punctuation">(</span>fg<span class="token operator">=</span><span class="token string">"blue"</span><span class="token punctuation">,</span> state<span class="token operator">=</span><span class="token string">'disabled'</span><span class="token punctuation">)</span>
        product_text<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span>
    
        <span class="token comment"># 复制按钮</span>
        copy_btn <span class="token operator">=</span> tk<span class="token punctuation">.</span>Button<span class="token punctuation">(</span>
            main_frame<span class="token punctuation">,</span>
            text<span class="token operator">=</span><span class="token string">"复制引物序列"</span><span class="token punctuation">,</span>
            command<span class="token operator">=</span><span class="token keyword">lambda</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>copy_primers<span class="token punctuation">(</span>
                fwd_entry<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                rev_entry<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                product_text<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">,</span> <span class="token string">"end-1c"</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            bg<span class="token operator">=</span><span class="token string">"#4CAF50"</span><span class="token punctuation">,</span>
            fg<span class="token operator">=</span><span class="token string">"white"</span><span class="token punctuation">,</span>
            font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"Arial"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">"bold"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            padx<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>
            pady<span class="token operator">=</span><span class="token number">5</span>
        <span class="token punctuation">)</span>
        copy_btn<span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span>
    
        <span class="token comment"># 注意事项</span>
        tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>main_frame<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">"◆ 注意事项"</span><span class="token punctuation">,</span> fg<span class="token operator">=</span><span class="token string">"red"</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'Arial'</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">'bold'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>
            row<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">,</span> pady<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    
        tips <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">"1. 最佳引物长度18-22bp，GC含量40-60%"</span><span class="token punctuation">,</span>
            <span class="token string">"2. 退火温度(Tm)应在55-65°C之间"</span><span class="token punctuation">,</span>
            <span class="token string">"3. 避免连续4个以上相同碱基"</span><span class="token punctuation">,</span>
            <span class="token string">"4. 建议使用Primer-BLAST验证引物特异性"</span>
        <span class="token punctuation">]</span>
    
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> tip <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>tips<span class="token punctuation">)</span><span class="token punctuation">:</span>
            tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>main_frame<span class="token punctuation">,</span> text<span class="token operator">=</span>tip<span class="token punctuation">,</span> anchor<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>grid<span class="token punctuation">(</span>row<span class="token operator">=</span><span class="token number">8</span><span class="token operator">+</span>i<span class="token punctuation">,</span> column<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> sticky<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    root <span class="token operator">=</span> tk<span class="token punctuation">.</span>Tk<span class="token punctuation">(</span><span class="token punctuation">)</span>
    app <span class="token operator">=</span> DNASequenceViewer<span class="token punctuation">(</span>root<span class="token punctuation">)</span>
    root<span class="token punctuation">.</span>mainloop<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>界面如下：</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251104193407291.png" alt="image-20251104193407291"></p>
<h3 id="第二步：输入数据"><a href="#第二步：输入数据" class="headerlink" title="第二步：输入数据"></a>第二步：输入数据</h3><ol>
<li><strong>粘贴基因序列</strong>：将下载的FASTA格式基因序列粘贴到上方文本区域</li>
<li><strong>输入突变位点</strong>：在指定位置输入突变信息</li>
<li><strong>设置参数</strong>：根据需要调整引物设计参数</li>
</ol>
<h3 id="第三步：执行操作"><a href="#第三步：执行操作" class="headerlink" title="第三步：执行操作"></a>第三步：执行操作</h3><ol>
<li><p><strong>定位碱基</strong>：点击”<code>定位碱基</code>“按钮确认突变位置</p>
<blockquote>
<p>程序会自动识别基因的方向，并显示再序列中的位置</p>
</blockquote>
</li>
<li><p><strong>设计引物</strong>：点击”<code>设计引物</code>“按钮生成引物序列</p>
</li>
</ol>
<h3 id="第四步：获取结果"><a href="#第四步：获取结果" class="headerlink" title="第四步：获取结果"></a>第四步：获取结果</h3><p>点击”<code>复制引物序列</code>“按钮，所有引物信息将复制到剪贴板</p>
<p><img src="https://cdn.jsdelivr.net/gh/0HHHHHH0/Image@master/blog/image-20251104193838633.png" alt="image-20251104193838633"></p>
<h2 id="示例结果"><a href="#示例结果" class="headerlink" title="示例结果"></a>示例结果</h2><p><strong>正向引物 (Forward Primer):</strong></p>
<pre class="line-numbers language-none"><code class="language-none">GGATGTAATCAGCTTGTAACTG<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>反向引物 (Reverse Primer):</strong></p>
<pre class="line-numbers language-none"><code class="language-none">TATTAACATAGGGAACAGCACG<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><strong>产物序列 :</strong></p>
<pre class="line-numbers language-none"><code class="language-none">GGATGTAATCAGCTTGTAACTGTAATTTAATCAATATATTTTTTAAAGTAATCGACCCAATCCCTGTTTACTATGAAAGTGAACTCATTTATAACAGTCTTACCATCACTTGTAGCTTGGTTCTGAACAGTATGTTCATTAGCAGATGTAATTAATGTGGTTTCGAATGTTTCTGTTGATGACAAGGTCGTACTTTCACCTACGTTTATAAACATTAACGTATGTAGCTGACATAATATTATAAATCAAATAAATATTGGATATTCAATTAGAAAGTTTATTGCCTACAATAAAAAAAAATAGCTTTGAATTAAGTATAAAATATATCATTTAACTCTTCACGTATTACCACTTTGTATTTTTTAACCATTAAAGTGAACATATTGATAACAGTTTAACCACATGGAGCTTGATTCTGAAAATTGTGTCCATTAGAAGCTGTAATAAATGTGCTCCTGGGTTTTTCTGTGGATGATAAGGTCGTGCTGTTCCCTATGTTAATA<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      <categories>
        <category>分子实验</category>
        <category>Python</category>
      </categories>
  </entry>
  <entry>
    <title>文件处理与数据筛选-终端</title>
    <url>/2025/10/31/wen-jian-chu-li-yu-shu-ju-shai-xuan-liu-cheng/</url>
    <content><![CDATA[<h1 id="文件处理与数据筛选流程"><a href="#文件处理与数据筛选流程" class="headerlink" title="文件处理与数据筛选流程"></a>文件处理与数据筛选流程</h1><h2 id="流程概述"><a href="#流程概述" class="headerlink" title="流程概述"></a>流程概述</h2><p>从两个基因组数据文件中筛选共有基因位点，生成TSV格式结果。</p>
<h2 id="处理步骤"><a href="#处理步骤" class="headerlink" title="处理步骤"></a>处理步骤</h2><h3 id="1-文件格式标准化"><a href="#1-文件格式标准化" class="headerlink" title="1. 文件格式标准化"></a>1. 文件格式标准化</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">dos2unix color_GWAS.anno.xls<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>作用：</strong> Windows转Unix换行符</p>
<h3 id="2-CSV转TSV格式"><a href="#2-CSV转TSV格式" class="headerlink" title="2. CSV转TSV格式"></a>2. CSV转TSV格式</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sed</span> <span class="token string">'1s/^\xEF\xBB\xBF//'</span> 红标0.7与黄标与GWAS共有.csv <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">','</span> <span class="token string">'\t'</span> <span class="token operator">&gt;</span> 红标0.7与黄标与GWAS共有.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>作用：</strong> 去除BOM头，逗号转制表符</p>
<h3 id="3-数据筛选"><a href="#3-数据筛选" class="headerlink" title="3. 数据筛选"></a>3. 数据筛选</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">awk</span> <span class="token string">'BEGIN {OFS="\t"} 
     NR==FNR {if(FNR&gt;1) start_values[$2] = 1; next} 
     FNR==1 {print; next} 
     $2 in start_values'</span> color_GWAS.anno.xls 红标0.7与黄标与GWAS共有.tsv <span class="token operator">&gt;</span> filtered_three2one.tsv<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>逻辑：</strong></p>
<ul>
<li>读取第一个文件的<code>第二列</code>作为筛选依据</li>
<li><code>保留</code>第二个文件中<code>匹配</code>的数据行</li>
<li><code>输出</code>制表符分隔的结果</li>
</ul>
<h2 id="文件说明"><a href="#文件说明" class="headerlink" title="文件说明"></a>文件说明</h2><ul>
<li><strong>输入：</strong> color_GWAS.anno.xls, 红标0.7与黄标与GWAS共有.csv</li>
<li><strong>输出：</strong> filtered_three2one.tsv（共有位点数据）</li>
</ul>
<h2 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h2><p>数据整合筛选、多源数据筛选、文件格式标准化。</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
  <entry>
    <title>从可视化到设计：深入理解蛋白-配体相互作用的分子世界</title>
    <url>/2025/11/03/dan-bai-pei-ti-xiang-hu-zuo-yong/</url>
    <content><![CDATA[<h2 id="从可视化到设计：深入理解蛋白-配体相互作用的分子世界"><a href="#从可视化到设计：深入理解蛋白-配体相互作用的分子世界" class="headerlink" title="从可视化到设计：深入理解蛋白-配体相互作用的分子世界"></a><strong>从可视化到设计：深入理解蛋白-配体相互作用的分子世界</strong></h2><blockquote>
<p>当你用PyMOL绘制出第一张漂亮的蛋白-配体相互作用图后，是否曾思考：这静态图片背后，隐藏着怎样动态的分子世界？本文将带你从简单的看图，走向深刻的理解。</p>
</blockquote>
<h3 id="第一章：基石篇-我们必须厘清的核心概念"><a href="#第一章：基石篇-我们必须厘清的核心概念" class="headerlink" title="第一章：基石篇 - 我们必须厘清的核心概念"></a><strong>第一章：基石篇 - 我们必须厘清的核心概念</strong></h3><p>在深入探索之前，我们必须建立正确的世界观。几个基本概念构成了我们理解这一切的基石。</p>
<h4 id="1-1-受体与配体：锁与钥匙的现代诠释"><a href="#1-1-受体与配体：锁与钥匙的现代诠释" class="headerlink" title="1.1 受体与配体：锁与钥匙的现代诠释"></a><strong>1.1 受体与配体：锁与钥匙的现代诠释</strong></h4><ul>
<li><p><strong>受体</strong>：通常是蛋白质大分子，它是结合的“平台”或“锁”。</p>
<ul>
<li><em>在我们的项目中</em>：流感病毒的<strong>PB2蛋白</strong>就是受体。</li>
<li><em>在PyMOL中</em>：通常是那个庞大的、显示为<code>cartoon</code>或<code>surface</code>的对象。</li>
</ul>
</li>
<li><p><strong>配体</strong>：通常是小分子化合物，它是结合的“客体”或“钥匙”。  </p>
<ul>
<li><em>在我们的项目中</em>：<strong>D715-2441化合物</strong>就是配体。</li>
<li><em>在PyMOL中</em>：通常是那些用<code>sticks</code>显示的、相对较小的分子。</li>
</ul>
</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 在PyMOL中的实际体现</span>
create receptor<span class="token punctuation">,</span> 4cb4 <span class="token keyword">and</span> polymer  <span class="token comment"># 定义受体</span>
create ligand<span class="token punctuation">,</span> d715_2441           <span class="token comment"># 定义配体</span>
show cartoon<span class="token punctuation">,</span> receptor             <span class="token comment"># 受体显示为卡通图</span>
show sticks<span class="token punctuation">,</span> ligand                <span class="token comment"># 配体显示为棒状图</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>简单比喻</strong>：🔒 <strong>锁=受体</strong>， 🔑 <strong>钥匙=配体</strong>， 🎯 <strong>锁眼=结合口袋</strong></p>
<h4 id="1-2-PyMOL的真实身份：分子的“Photoshop”"><a href="#1-2-PyMOL的真实身份：分子的“Photoshop”" class="headerlink" title="1.2 PyMOL的真实身份：分子的“Photoshop”"></a><strong>1.2 PyMOL的真实身份：分子的“Photoshop”</strong></h4><p>这是最关键的认识：<strong>PyMOL是一个顶级的可视化与分析工具，而不是预测工具</strong>。</p>
<p><strong>PyMOL能做什么</strong>：</p>
<ul>
<li>✅ <strong>可视化</strong>：将三维结构变成我们能理解的图像</li>
<li>✅ <strong>测量</strong>：测量原子间的距离、角度、二面角</li>
<li>✅ <strong>分析</strong>：分析相互作用的几何关系</li>
<li>✅ <strong>渲染</strong>：生成发表质量的图片和动画</li>
</ul>
<p><strong>PyMOL不能做什么</strong>：</p>
<ul>
<li>❌ <strong>预测</strong>配体如何与蛋白结合</li>
<li>❌ <strong>模拟</strong>分子在结合过程中的运动</li>
<li>❌ <strong>计算</strong>结合强度（自由能）</li>
</ul>
<p><strong>记住</strong>：PyMOL让你<strong>观察和理解</strong>已有的结构，但不能<strong>预测</strong>新的情况。</p>
<h3 id="第二章：机理篇-分子相互作用的动态本质"><a href="#第二章：机理篇-分子相互作用的动态本质" class="headerlink" title="第二章：机理篇 - 分子相互作用的动态本质"></a><strong>第二章：机理篇 - 分子相互作用的动态本质</strong></h3><p>当我们看到文献中“H357咪唑环旋转”、“K376侧链伸展”这样的描述时，这些结论是如何得出的？</p>
<h4 id="2-1-什么在变化？如何变化？"><a href="#2-1-什么在变化？如何变化？" class="headerlink" title="2.1 什么在变化？如何变化？"></a><strong>2.1 什么在变化？如何变化？</strong></h4><p>在结合过程中，蛋白和配体都不是僵硬的积木，而是动态调整的舞伴：</p>
<p><strong>配体的变化</strong>：</p>
<ul>
<li><strong>构象变化</strong>：化学键旋转，分子呈现不同的三维形状</li>
<li><strong>官能团取向</strong>：羟基、羧基等极性基团调整方向以形成最佳氢键</li>
<li><strong>电荷分布</strong>：电子云重新分布以适应蛋白的静电环境</li>
</ul>
<p><strong>蛋白的变化</strong>：</p>
<ul>
<li><strong>侧链重排</strong>：氨基酸侧链旋转到有利位置<ul>
<li><em>示例</em>：H357的咪唑环旋转以形成π-π堆积</li>
<li><em>示例</em>：F404的苯环调整角度与配体芳环平行</li>
</ul>
</li>
<li><strong>主链微调</strong>：蛋白质骨架发生微小移动</li>
<li><strong>结合口袋形状变化</strong>：整个口袋可能“收缩”或“扩张”</li>
</ul>
<h4 id="2-2-为什么会发生这些变化？"><a href="#2-2-为什么会发生这些变化？" class="headerlink" title="2.2 为什么会发生这些变化？"></a><strong>2.2 为什么会发生这些变化？</strong></h4><p>这些变化不是随意的，而是由基本的物理化学原理驱动：</p>
<ol>
<li><strong>能量优化原则</strong>：系统总是趋向于能量最低的状态</li>
<li><strong>空间互补性</strong>：避免原子碰撞，寻求最大接触面积</li>
<li><strong>电子互补性</strong>：正负电荷区域相互吸引</li>
<li><strong>疏水效应</strong>：疏水区域聚集，排出水分子</li>
</ol>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 在PyMOL中验证这些变化的证据</span>
distance pi_pi_dist<span class="token punctuation">,</span> his357<span class="token operator">//</span>CE1<span class="token punctuation">,</span> ligand<span class="token operator">//</span>C4    <span class="token comment"># 测量π-π堆积距离（应为3.4-3.8Å）</span>
angle stacking_angle<span class="token punctuation">,</span> his357<span class="token operator">//</span>CG<span class="token operator">-</span>CD2<span class="token punctuation">,</span> ligand<span class="token operator">//</span>C1<span class="token operator">-</span>C4  <span class="token comment"># 测量芳环平面夹角（应&lt;30°）</span>
distance h_bond<span class="token punctuation">,</span> k376<span class="token operator">//</span>NZ<span class="token punctuation">,</span> ligand<span class="token operator">//</span>O1          <span class="token comment"># 测量氢键距离（应为2.6-3.2Å）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="第三章：工具篇-揭开预测软件的神秘面纱"><a href="#第三章：工具篇-揭开预测软件的神秘面纱" class="headerlink" title="第三章：工具篇 - 揭开预测软件的神秘面纱"></a><strong>第三章：工具篇 - 揭开预测软件的神秘面纱</strong></h3><p>既然PyMOL不能预测，那么“H357咪唑环旋转”这样的结论从何而来？</p>
<h4 id="3-1-分子对接软件：预测结合模式的“预言家”"><a href="#3-1-分子对接软件：预测结合模式的“预言家”" class="headerlink" title="3.1 分子对接软件：预测结合模式的“预言家”"></a><strong>3.1 分子对接软件：预测结合模式的“预言家”</strong></h4><p><strong>代表性工具</strong>：</p>
<ul>
<li><strong>AutoDock Vina</strong>：免费、快速、易用</li>
<li><strong>DOCK6</strong>：学术免费、精度高（我们文献中使用）</li>
<li><strong>Schrödinger Glide</strong>：商业软件、工业标准</li>
</ul>
<p><strong>工作原理</strong>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 简化的对接流程</span>
<span class="token number">1</span>. 准备蛋白结构 → protein.pdbqt
<span class="token number">2</span>. 准备配体结构 → ligand.pdbqt  
<span class="token number">3</span>. 定义结合口袋 → config.txt
<span class="token number">4</span>. 运行对接计算 → vina <span class="token parameter variable">--receptor</span> protein.pdbqt <span class="token parameter variable">--ligand</span> ligand.pdbqt
<span class="token number">5</span>. 获得预测结果 → out.pdbqt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>预测过程</strong>：</p>
<ol>
<li><strong>构象搜索</strong>：系统旋转配体的可旋转键</li>
<li><strong>位置采样</strong>：在口袋中尝试数百万个位置和朝向</li>
<li><strong>打分评估</strong>：用打分函数评估每个构象的结合能力</li>
<li><strong>结果排序</strong>：输出能量最优的结合模式</li>
</ol>
<h4 id="3-2-分子动力学软件：验证稳定性的“时间机器”"><a href="#3-2-分子动力学软件：验证稳定性的“时间机器”" class="headerlink" title="3.2 分子动力学软件：验证稳定性的“时间机器”"></a><strong>3.2 分子动力学软件：验证稳定性的“时间机器”</strong></h4><p><strong>代表性工具</strong>：</p>
<ul>
<li><strong>GROMACS</strong>：免费、高性能、社区强大</li>
<li><strong>AMBER</strong>：学术界常用、力场精度高</li>
<li><strong>NAMD</strong>：擅长大体系模拟</li>
</ul>
<p><strong>工作原理</strong>：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 分子动力学模拟流程</span>
gmx pdb2gmx <span class="token parameter variable">-f</span> complex.pdb <span class="token parameter variable">-o</span> processed.gro    <span class="token comment"># 结构准备</span>
gmx mdrun <span class="token parameter variable">-s</span> simulation.tpr <span class="token parameter variable">-deffnm</span> md_results <span class="token comment"># 运行模拟</span>
gmx energy <span class="token parameter variable">-f</span> md_results.edr <span class="token parameter variable">-o</span> energy.xvg     <span class="token comment"># 能量分析</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>能告诉我们什么</strong>：</p>
<ul>
<li>预测的结合模式在生理条件下是否稳定？</li>
<li>蛋白-配体复合物如何随时间波动？</li>
<li>相互作用的持续时间是多少？</li>
</ul>
<h2 id="第四章：AI-PyMOL：智能化的分子可视化新工作流"><a href="#第四章：AI-PyMOL：智能化的分子可视化新工作流" class="headerlink" title="第四章：AI + PyMOL：智能化的分子可视化新工作流"></a><strong>第四章：AI + PyMOL：智能化的分子可视化新工作流</strong></h2><h3 id="4-1-传统流程-vs-AI增强流程"><a href="#4-1-传统流程-vs-AI增强流程" class="headerlink" title="4.1 传统流程 vs AI增强流程"></a><strong>4.1 传统流程 vs AI增强流程</strong></h3><p><strong>传统PyMOL工作流</strong>：</p>
<pre class="line-numbers language-none"><code class="language-none">准备结构 → 手动分析 → 绘制相互作用 → 美化出图
（耗时：数小时至数天，依赖个人经验）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p><strong>AI增强的PyMOL工作流</strong>：</p>
<pre class="line-numbers language-none"><code class="language-none">AI预测结构 → AI分析相互作用 → PyMOL验证美化 → 智能出图
（耗时：分钟级，结果更准确）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="4-2-具体应用场景"><a href="#4-2-具体应用场景" class="headerlink" title="4.2 具体应用场景"></a><strong>4.2 具体应用场景</strong></h3><h4 id="1-当没有晶体结构时：用AI预测"><a href="#1-当没有晶体结构时：用AI预测" class="headerlink" title="1. 当没有晶体结构时：用AI预测"></a><strong>1. 当没有晶体结构时：用AI预测</strong></h4><pre class="line-numbers language-none"><code class="language-none"># 传统：无法处理
# AI方案：使用AlphaFold2预测结构
# 然后在PyMOL中直接使用预测结果
load alphafold_predicted_structure.pdb
show cartoon
color blue<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2-当不知道关键残基时：AI自动识别"><a href="#2-当不知道关键残基时：AI自动识别" class="headerlink" title="2. 当不知道关键残基时：AI自动识别"></a><strong>2. 当不知道关键残基时：AI自动识别</strong></h4><pre class="line-numbers language-none"><code class="language-none"># 传统：手动查看、猜测哪些残基重要
# AI方案：运行结合位点预测算法
# PyMOL中直接显示AI识别的重要残基
create important_residues, resi 157+204+338+357
show sticks, important_residues
color red, important_residues<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3-当配体结合模式未知时：AI快速对接"><a href="#3-当配体结合模式未知时：AI快速对接" class="headerlink" title="3. 当配体结合模式未知时：AI快速对接"></a><strong>3. 当配体结合模式未知时：AI快速对接</strong></h4><pre class="line-numbers language-none"><code class="language-none"># 传统：手动对接或依赖服务器
# AI方案：使用DiffDock或EquiBind秒级预测
load ai_docked_pose.pdb  # AI预测的结合模式
show sticks, organic
color green, organic<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-3-实际工作流程示例"><a href="#4-3-实际工作流程示例" class="headerlink" title="4.3 实际工作流程示例"></a><strong>4.3 实际工作流程示例</strong></h3><p><strong>场景：分析D715-2441与PB2蛋白的相互作用</strong></p>
<pre class="line-numbers language-none"><code class="language-none"># 第一步：AI预测（在外部完成）
# 使用AlphaFold2预测PB2结构（如果需要）
# 使用DiffDock预测D715-2441结合模式

# 第二步：PyMOL中加载AI结果
load pb2_alphafold.pdb
load d715_dockresult.pdb

# 第三步：AI辅助的分析
create key_sites, resi 339+357+361+404  # AI识别的重要残基
show sticks, key_sites
show sticks, d715_dockresult

# 第四步：传统PyMOL美化
color gray, pb2_alphafold
color marine, key_sites  
color orange, d715_dockresult
bg_color white<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="4-4-可用的AI工具推荐"><a href="#4-4-可用的AI工具推荐" class="headerlink" title="4.4 可用的AI工具推荐"></a><strong>4.4 可用的AI工具推荐</strong></h3><table>
<thead>
<tr>
<th align="left">工具类型</th>
<th align="left">推荐工具</th>
<th align="left">与PyMOL配合方式</th>
</tr>
</thead>
<tbody><tr>
<td align="left">结构预测</td>
<td align="left">AlphaFold2, RoseTTAFold</td>
<td align="left">预测后导入PyMOL查看</td>
</tr>
<tr>
<td align="left">分子对接</td>
<td align="left">DiffDock, EquiBind</td>
<td align="left">快速得到结合模式后导入</td>
</tr>
<tr>
<td align="left">结合位点</td>
<td align="left">DeepSite, P2Rank</td>
<td align="left">识别重要残基，在PyMOL中标记</td>
</tr>
<tr>
<td align="left">相互作用</td>
<td align="left">各种AI分析工具</td>
<td align="left">生成相互作用列表，在PyMOL中绘制</td>
</tr>
</tbody></table>
<h3 id="4-5-优势总结"><a href="#4-5-优势总结" class="headerlink" title="4.5 优势总结"></a><strong>4.5 优势总结</strong></h3><ol>
<li><strong>速度极快</strong>：从小时级到分钟级</li>
<li><strong>准确性高</strong>：AI在很多任务上超越传统方法</li>
<li><strong>自动化强</strong>：减少手动操作和主观判断</li>
<li><strong>结果可靠</strong>：基于大数据训练，避免个人经验偏差</li>
</ol>
<h3 id="4-6-注意事项"><a href="#4-6-注意事项" class="headerlink" title="4.6 注意事项"></a><strong>4.6 注意事项</strong></h3><ul>
<li><strong>AI不是万能</strong>：仍需用PyMOL人工验证合理性</li>
<li><strong>数据质量</strong>：垃圾进，垃圾出</li>
<li><strong>理解原理</strong>：不要盲目相信AI结果</li>
<li><strong>结合使用</strong>：AI提供候选，人工最终确认</li>
</ul>
<p><strong>核心思想</strong>：让AI做它擅长的预测和筛选，让PyMOL做它擅长的可视化和验证，两者结合，效率倍增。</p>
<h3 id="第五章：整合篇-现代科研的真实工作流"><a href="#第五章：整合篇-现代科研的真实工作流" class="headerlink" title="第五章：整合篇 - 现代科研的真实工作流"></a><strong>第五章：整合篇 - 现代科研的真实工作流</strong></h3><p>了解了各个工具后，让我们看看它们如何在现代科研中协同工作。</p>
<h4 id="5-1-传统科研工作流"><a href="#5-1-传统科研工作流" class="headerlink" title="5.1 传统科研工作流"></a><strong>5.1 传统科研工作流</strong></h4><pre class="line-numbers language-none"><code class="language-none">蛋白准备 → 分子对接 → 动力学验证 → PyMOL分析 → 实验验证<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="5-2-AI增强工作流"><a href="#5-2-AI增强工作流" class="headerlink" title="5.2 AI增强工作流"></a><strong>5.2 AI增强工作流</strong></h4><pre class="line-numbers language-none"><code class="language-none">AI结构预测 → AI快速对接 → 传统方法验证 → AI结果分析 → 实验验证<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h4 id="5-3-在PyMOL中的完整实践"><a href="#5-3-在PyMOL中的完整实践" class="headerlink" title="5.3 在PyMOL中的完整实践"></a><strong>5.3 在PyMOL中的完整实践</strong></h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 阶段1：准备工作</span>
fetch 4cb4                          <span class="token comment"># 获取蛋白结构</span>
load d715_2441_ai_docked<span class="token punctuation">.</span>pdb        <span class="token comment"># 加载AI预测的结合模式</span>

<span class="token comment"># 阶段2：基础分析</span>
create receptor<span class="token punctuation">,</span> 4cb4
create ligand<span class="token punctuation">,</span> d715_2441
show cartoon<span class="token punctuation">,</span> receptor
show sticks<span class="token punctuation">,</span> ligand
show sticks<span class="token punctuation">,</span> resi <span class="token number">357</span><span class="token operator">+</span><span class="token number">361</span><span class="token operator">+</span><span class="token number">376</span><span class="token operator">+</span><span class="token number">404</span>   <span class="token comment"># 显示关键残基</span>

<span class="token comment"># 阶段3：相互作用分析</span>
distance h_bond1<span class="token punctuation">,</span> <span class="token punctuation">(</span>resi <span class="token number">361</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ligand<span class="token punctuation">)</span>  <span class="token comment"># 氢键</span>
distance pi_pi<span class="token punctuation">,</span> <span class="token punctuation">(</span>resi <span class="token number">357</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>ligand<span class="token punctuation">)</span>    <span class="token comment"># π-π堆积</span>
<span class="token builtin">set</span> dash_radius<span class="token punctuation">,</span> <span class="token number">0.08</span>                  <span class="token comment"># 美化虚线</span>

<span class="token comment"># 阶段4：结果呈现</span>
bg_color white
<span class="token builtin">set</span> cartoon_transparency<span class="token punctuation">,</span> <span class="token number">0.3</span>
ray <span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">2000</span>
png publication_figure<span class="token punctuation">.</span>png<span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="总结与展望"><a href="#总结与展望" class="headerlink" title="总结与展望"></a><strong>总结与展望</strong></h3><p>通过这次从概念到实践的探索，我们应该认识到：</p>
<ol>
<li><strong>明确工具边界</strong>：PyMOL是卓越的可视化工具，但不是预测工具</li>
<li><strong>理解动态本质</strong>：蛋白-配体结合是动态调整的过程</li>
<li><strong>善用计算生态</strong>：根据不同需求选择合适的计算工具</li>
<li><strong>拥抱技术革命</strong>：AI正在重塑药物发现的每一个环节</li>
</ol>
<p><strong>未来的研究方向</strong>：</p>
<ul>
<li>AI预测与物理模型的深度融合</li>
<li>自动化、一体化的药物发现平台</li>
<li>多尺度建模从量子到细胞水平的贯通</li>
</ul>
<p>当我们下次再看到一张漂亮的蛋白-配体相互作用图时，我们看到的不再只是一张静态图片，而是一个动态分子世界的精彩瞬间，以及背后一整套强大的计算生物学方法学支撑。</p>
]]></content>
      <categories>
        <category>Linux</category>
        <category>PyMOL</category>
      </categories>
  </entry>
  <entry>
    <title>重测序下机数据处理</title>
    <url>/2025/10/31/chong-ce-xu-xia-ji-shu-ju-chu-li/</url>
    <content><![CDATA[<h1 id="🧬-重测序数据标准处理流程详解"><a href="#🧬-重测序数据标准处理流程详解" class="headerlink" title="🧬 重测序数据标准处理流程详解"></a>🧬 重测序数据标准处理流程详解</h1><p>本篇博客详细解析从 <strong>下机 FastQ 数据</strong> 到 <strong>变异检测输入文件（gVCF）</strong> 的完整流程。<br>流程基于 Linux 环境与 GATK 推荐实践，并结合并行优化与磁盘空间节省策略。<br>适合刚接触重测序分析的新手，也适用于需要高效自动化处理的研究人员。</p>
<hr>
<p>环境：<code>conda activate py310</code></p>
<h2 id="一、Fastp-质控与过滤（run-fastpl-sh）"><a href="#一、Fastp-质控与过滤（run-fastpl-sh）" class="headerlink" title="一、Fastp 质控与过滤（run_fastpl.sh）"></a>一、Fastp 质控与过滤（<code>run_fastpl.sh</code>）</h2><pre class="line-numbers language-none"><code class="language-none">#!/bin/bash
# =========================================
# Fastp 并行质控脚本（最终版本 + 已完成计数修正）
# Author: Carl Hansen
# Date: $(date +"%Y-%m-%d")
# =========================================

INPUT_DIR="/home/wanglab/Ywh/adductor_muscle_scar/ReSeq_Data/DZQD2023092909-b1/Raw_data"
OUTPUT_DIR="/home/wanglab/Ywh/adductor_muscle_scar/ReSeq_Data/DZQD2023092909-b1/Clean_data"
REPORT_DIR="${OUTPUT_DIR}/reports"
LOG_DIR="${OUTPUT_DIR}/logs"

THREADS_PER_JOB=6   # 每个样本 fastp 线程数
JOBS=2              # 同时并行样本数

mkdir -p "$OUTPUT_DIR" "$REPORT_DIR" "$LOG_DIR"

echo "====================================="
echo " Fastp 并行质控开始: $(date)"
echo " 输入目录: $INPUT_DIR"
echo " 输出目录: $OUTPUT_DIR"
echo " 每任务线程: $THREADS_PER_JOB"
echo " 并行样本数: $JOBS"
echo "====================================="

# 获取所有 R1 文件
samples=($(find "$INPUT_DIR" -name "*.R1.fastq.gz" | sort))
total=${#samples[@]}

if [[ $total -eq 0 ]]; then
    echo "[错误] 未找到任何 R1.fastq.gz 文件，请检查输入目录"
    exit 1
fi

# 计数文件 + 初始化为已完成样本数
COUNT_FILE="${LOG_DIR}/progress_count.tmp"
completed=$(find "$REPORT_DIR" -name "*_fastp.json" -size +0 | wc -l)
echo $completed &gt; "$COUNT_FILE"

# fastp 处理函数
run_fastp() {
    fq1=$1
    sample=$(basename "$(dirname "$fq1")")
    fq2="${fq1/.R1.fastq.gz/.R2.fastq.gz}"

    out1="${OUTPUT_DIR}/${sample}_clean.R1.fastq.gz"
    out2="${OUTPUT_DIR}/${sample}_clean.R2.fastq.gz"
    report="${REPORT_DIR}/${sample}_fastp.json"
    
    # 检查 JSON 是否存在且非空
    if [[ -s "$report" ]]; then
        echo "[跳过] $sample 已完成 ✅"
        return 0
    fi
    
    # ⚡ 更新进度计数（并行安全）
    count=$( ( flock 9
        c=$(cat "$COUNT_FILE")
        c=$((c+1))
        echo $c &gt; "$COUNT_FILE"
        echo $c
    ) 9&gt;"$COUNT_FILE.lock" )
    
    echo "[进度] $count/$total 样本: $sample"
    echo "[启动] $sample 开始处理..."
    
    fastp \
        -i "$fq1" \
        -I "$fq2" \
        -o "$out1" \
        -O "$out2" \
        -h "${REPORT_DIR}/${sample}_fastp.html" \
        -j "$report" \
        -w $THREADS_PER_JOB \
        &gt; "${LOG_DIR}/${sample}.log" 2&gt;&amp;1
    
    if [[ $? -eq 0 &amp;&amp; -s "$report" ]]; then
        echo "[完成] $sample ✅"
    else
        echo "[失败] $sample ❌，请检查 ${LOG_DIR}/${sample}.log"
    fi
}

export -f run_fastp
export OUTPUT_DIR REPORT_DIR LOG_DIR THREADS_PER_JOB total COUNT_FILE

# 并行执行
printf "%s\n" "${samples[@]}" | parallel --line-buffer -j $JOBS run_fastp {}

# 清理计数文件
rm -f "$COUNT_FILE" "$COUNT_FILE.lock"

echo "====================================="
echo " Fastp 质控全部完成: $(date)"
echo "报告目录: $REPORT_DIR"
echo "日志目录: $LOG_DIR"
echo "====================================="
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="1-📘-脚本功能概述"><a href="#1-📘-脚本功能概述" class="headerlink" title="1.📘 脚本功能概述"></a>1.📘 脚本功能概述</h3><p>该脚本使用 <strong>Fastp</strong> 对原始下机数据（Raw_data）进行 <strong>质量控制（QC）与过滤</strong>，并利用 GNU Parallel 实现多样本并行。</p>
<blockquote>
<p><strong>主要目的：</strong></p>
<ul>
<li>清除低质量 reads、含接头序列的 reads；</li>
<li>生成交互式 HTML 报告；</li>
<li>并行加速多样本处理；</li>
<li>避免重复运行，自动跳过已完成样本。</li>
</ul>
</blockquote>
<h3 id="2-📂-输入与输出目录"><a href="#2-📂-输入与输出目录" class="headerlink" title="2.📂 输入与输出目录"></a>2.📂 输入与输出目录</h3><table>
<thead>
<tr>
<th>路径</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>/Raw_data/</code></td>
<td>原始下机数据，包含 <code>R1</code>、<code>R2</code> 文件</td>
</tr>
<tr>
<td><code>/Clean_data/</code></td>
<td>输出的过滤后数据</td>
</tr>
<tr>
<td><code>/reports/</code></td>
<td>Fastp 的 HTML + JSON 报告</td>
</tr>
<tr>
<td><code>/logs/</code></td>
<td>每个样本的运行日志</td>
</tr>
</tbody></table>
<h3 id="3-⚙️-核心流程解析"><a href="#3-⚙️-核心流程解析" class="headerlink" title="3.⚙️ 核心流程解析"></a>3.⚙️ 核心流程解析</h3><ol>
<li><p><strong>样本自动检测</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">samples</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable"><span class="token variable">$(</span><span class="token function">find</span> <span class="token string">"<span class="token variable">$INPUT_DIR</span>"</span> <span class="token parameter variable">-name</span> <span class="token string">"*.R1.fastq.gz"</span><span class="token variable">)</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ol>
<p>自动扫描所有 R1 文件，自动识别配对的 R2。</p>
<ol start="2">
<li><p><strong>并行质控</strong></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">parallel --line-buffer <span class="token parameter variable">-j</span> <span class="token variable">$JOBS</span> run_fastp <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>使用 <code>parallel</code> 控制同时处理的样本数量（默认 2 个）。</p>
</li>
<li><p><strong>进度追踪机制</strong><br> 每完成一个样本，进度计数自动更新，例如：</p>
<pre class="line-numbers language-none"><code class="language-none">[进度] 3/24 样本: BM_S_3
[完成] BM_S_3 ✅<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p><strong>结果检查</strong><br> 若 JSON 报告存在且非空，则自动跳过该样本，节省时间。</p>
</li>
</ol>
<h3 id="4-✅-运行结果"><a href="#4-✅-运行结果" class="headerlink" title="4.✅ 运行结果"></a>4.✅ 运行结果</h3><ul>
<li><p>输出文件示例：</p>
<pre class="line-numbers language-none"><code class="language-none">Clean_data/BM_S_1_clean.R1.fastq.gz
Clean_data/BM_S_1_clean.R2.fastq.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li><p>质控报告（浏览器查看）：</p>
<pre class="line-numbers language-none"><code class="language-none">Clean_data/reports/BM_S_1_fastp.html<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<hr>
<h2 id="二、比对与-gVCF-生成（run-bwa-vcf-sh）"><a href="#二、比对与-gVCF-生成（run-bwa-vcf-sh）" class="headerlink" title="二、比对与 gVCF 生成（run_bwa_vcf.sh）"></a>二、比对与 gVCF 生成（<code>run_bwa_vcf.sh</code>）</h2><pre class="line-numbers language-none"><code class="language-none">#!/bin/bash
# =========================================
# 节省空间的全量样本处理脚本 - 并行生成gVCF
# =========================================

CLEAN_DIR="/home/wanglab/Ywh/adductor_muscle_scar/ReSeq_Data/DZQD2023092909-b1/Clean_data"
REF="/home/wanglab/Ywh/adductor_muscle_scar/Genome/GCF_963853765.1_xbMagGiga1.1_genomic.fna"
OUT_DIR="/home/wanglab/Ywh/adductor_muscle_scar/ReSeq_Data/DZQD2023092909-b1/Align"
LOG_DIR="${OUT_DIR}/logs"

THREADS=12
BATCH_GVCF=12

mkdir -p "$OUT_DIR" "$LOG_DIR"

echo "[INFO] 节省空间版全量样本流程开始: $(date)"
echo "[INFO] gVCF将并行生成（每批12个同时运行）"
echo "====================================="

# 索引检查
[[ ! -f "${REF}.bwt" ]] &amp;&amp; echo "[INFO] 生成BWA索引..." &amp;&amp; bwa index $REF
[[ ! -f "${REF}.fai" ]] &amp;&amp; echo "[INFO] 生成samtools faidx..." &amp;&amp; samtools faidx $REF
DICT_FILE="${REF%.*}.dict"
[[ ! -f "$DICT_FILE" ]] &amp;&amp; echo "[INFO] 生成GATK序列字典..." &amp;&amp; gatk CreateSequenceDictionary -R $REF -O $DICT_FILE

# 获取样本列表
samples=($(find "$CLEAN_DIR" -name "*_clean.R1.fastq.gz" | sort))
total=${#samples[@]}
if [[ $total -eq 0 ]]; then
    echo "[ERROR] 未找到任何 clean fastq 文件"
    exit 1
fi
echo "[INFO] 总样本数: $total"

# 获取已存在的BAM和gVCF文件
existing_bams=($(find "$OUT_DIR" -name "*.sorted.bam" | sort))
processed_gvcfs=($(find "$OUT_DIR" -name "*.g.vcf.gz" | sort))

echo "[INFO] 已存在BAM文件: ${#existing_bams[@]} 个"
echo "[INFO] 已生成gVCF文件: ${#processed_gvcfs[@]} 个"

# -------------------------------
# 单样本比对函数（输出未去重BAM）
# -------------------------------
run_alignment() {
    fq1=$1
    fq2=${fq1/.R1/.R2}
    sample=$(basename "$fq1" | sed 's/_clean.R1.fastq.gz//')
    bam="$OUT_DIR/${sample}.sorted.bam"
    log="$LOG_DIR/${sample}.bwa.log"

    # 添加跳过已存在BAM的逻辑
    if [[ -s "$bam" ]]; then
        echo "[INFO] $sample BAM已存在，跳过比对 ✅"
        return 0
    fi
    
    echo "====================================="
    echo "[INFO $(date '+%Y-%m-%d %H:%M:%S')] [$sample] BWA MEM 比对开始..."
    
    if [[ ! -s "$fq1" ]]; then
        echo "[ERROR] $sample 的 R1 文件不存在: $fq1" | tee -a "$log"
        exit 1
    fi
    
    if [[ -s "$fq2" ]]; then
        echo "[INFO] 检测到双端测序: $fq1 + $fq2" | tee -a "$log"
        bwa mem -t $THREADS -M \
            -R "@RG\tID:${sample}\tSM:${sample}\tPL:ILLUMINA" \
            $REF $fq1 $fq2 \
            2&gt; &gt;(tee -a "$log" &gt;&amp;2) \
        | samtools sort -@ 4 -o "$bam" -
    else
        echo "[WARN] 未检测到 R2，仅单端比对: $fq1" | tee -a "$log"
        bwa mem -t $THREADS -M \
            -R "@RG\tID:${sample}\tSM:${sample}\tPL:ILLUMINA" \
            $REF $fq1 \
            2&gt; &gt;(tee -a "$log" &gt;&amp;2) \
        | samtools sort -@ 4 -o "$bam" -
    fi
    
    if [[ $? -ne 0 || ! -s "$bam" ]]; then
        echo "[ERROR] $sample 比对失败!" | tee -a "$log"
        exit 1
    fi
    
    echo "[INFO $(date '+%Y-%m-%d %H:%M:%S')] [$sample] 比对完成 ✅ 输出: $bam"
}


# -------------------------------
# gVCF生成函数（独立可执行）
# -------------------------------
generate_gvcf() {
    local bam="$1"
    local sample=$(basename "$bam" .sorted.bam)
    local bam_markdup="${OUT_DIR}/${sample}.sorted.markdup.bam"
    local metrics="${OUT_DIR}/${sample}.markdup.metrics.txt"
    local gvcf="${OUT_DIR}/${sample}.g.vcf.gz"
    local log_file="${LOG_DIR}/${sample}.gvcf.log"

    if [[ -s "$gvcf" ]]; then
        echo "[INFO] $sample gVCF已存在，跳过 ✅"
        return 0
    fi
    
    echo "[INFO] [$sample] MarkDuplicates + gVCF 开始: $(date)" | tee -a "$log_file"
    local start=$(date +%s)
    
    # 1️⃣ MarkDuplicates
    gatk MarkDuplicates \
        -I "$bam" \
        -O "$bam_markdup" \
        --METRICS_FILE "$metrics" \
        --CREATE_INDEX true \
        --VALIDATION_STRINGENCY LENIENT \
        --TMP_DIR "${OUT_DIR}/tmp" \
        2&gt;&gt; "$log_file"
    
    if [[ $? -eq 0 ]]; then
        rm -f "$bam" "${bam}.bai"
    fi
    
    # 2️⃣ gVCF生成（单线程）
    gatk HaplotypeCaller \
        -R "$REF" \
        -I "$bam_markdup" \
        -O "$gvcf" \
        -ERC GVCF \
        --native-pair-hmm-threads 1 \
        2&gt;&gt; "$log_file"
    
    if [[ $? -eq 0 ]]; then
        gatk IndexFeatureFile -I "$gvcf" 2&gt;&gt; "$log_file"
        rm -f "$bam_markdup" "${bam_markdup}.bai"
    fi
    
    local end=$(date +%s)
    local runtime=$((end-start))
    echo "[INFO] [$sample] gVCF完成 ✅ (耗时: $runtime 秒)" | tee -a "$log_file"
}

# 导出函数和环境变量供parallel使用
export -f generate_gvcf
export OUT_DIR REF LOG_DIR

# -------------------------------
# 1️⃣ 先处理已存在的BAM文件（并行生成gVCF）
# -------------------------------
if [[ ${#existing_bams[@]} -gt 0 ]]; then
    echo "[INFO] 开始处理已存在的 ${#existing_bams[@]} 个BAM文件..."
    
    # 过滤掉已有gVCF的BAM文件
    need_process_bams=()
    for bam in "${existing_bams[@]}"; do
        sample=$(basename "$bam" .sorted.bam)
        gvcf="${OUT_DIR}/${sample}.g.vcf.gz"
        if [[ ! -s "$gvcf" ]]; then
            need_process_bams+=("$bam")
        fi
    done
    
    echo "[INFO] 需要处理gVCF的BAM文件: ${#need_process_bams[@]} 个"
    
    # 分批并行处理
    i=0
    while [[ $i -lt ${#need_process_bams[@]} ]]; do
        batch=("${need_process_bams[@]:$i:$BATCH_GVCF}")
        batch_num=$((i/BATCH_GVCF+1))
        echo "[INFO] 并行生成gVCF批次 ${batch_num}: ${#batch[@]} 个样本"
        
        # 使用parallel同时运行12个gVCF生成任务
        printf "%s\n" "${batch[@]}" | parallel -j $BATCH_GVCF --eta \
            "generate_gvcf {}"
        
        i=$((i + BATCH_GVCF))
    done
else
    echo "[INFO] 没有已存在的BAM文件需要处理"
fi

# -------------------------------
# 2️⃣ 获取未比对的样本列表
# -------------------------------
processed_samples=()
for bam in "${existing_bams[@]}"; do
    sample=$(basename "$bam" .sorted.bam)
    processed_samples+=("$sample")
done

need_align_samples=()
for fq1 in "${samples[@]}"; do
    sample=$(basename "$fq1" | sed 's/_clean.R1.fastq.gz//')
    if [[ ! " ${processed_samples[@]} " =~ " ${sample} " ]]; then
        need_align_samples+=("$fq1")
    fi
done

echo "[INFO] 需要比对新样本: ${#need_align_samples[@]} 个"

# -------------------------------
# 3️⃣ 比对新的样本并分批并行生成gVCF
# -------------------------------
if [[ ${#need_align_samples[@]} -gt 0 ]]; then
    count=0
    batch_count=0
    current_batch_bams=()
    
    for fq1 in "${need_align_samples[@]}"; do
        # 比对单个样本
        run_alignment "$fq1"
        
        sample=$(basename "$fq1" | sed 's/_clean.R1.fastq.gz//')
        current_batch_bams+=("$OUT_DIR/${sample}.sorted.bam")
        count=$((count+1))
        
        # 每比对完BATCH_GVCF个样本，并行生成一批gVCF
        if [[ $count -ge $BATCH_GVCF ]]; then
            batch_count=$((batch_count+1))
            echo "[INFO] 并行生成新样本gVCF批次 ${batch_count}: ${#current_batch_bams[@]} 个样本"
            
            # 使用parallel同时运行12个gVCF生成任务
            printf "%s\n" "${current_batch_bams[@]}" | parallel -j $BATCH_GVCF --eta \
                "generate_gvcf {}"
            
            count=0
            current_batch_bams=()
        fi
    done
    
    # 处理剩余的新样本
    if [[ $count -gt 0 ]]; then
        echo "[INFO] 并行处理剩余新样本gVCF: ${#current_batch_bams[@]} 个"
        printf "%s\n" "${current_batch_bams[@]}" | parallel -j $BATCH_GVCF --eta \
            "generate_gvcf {}"
    fi
else
    echo "[INFO] 没有需要比对的新样本"
fi

# 清理临时目录
rm -rf "${OUT_DIR}/tmp" 2&gt;/dev/null

echo "[INFO] 全部样本处理完成: $(date)"
echo "[INFO] 最终gVCF文件数: $(find "$OUT_DIR" -name "*.g.vcf.gz" | wc -l)"
echo "[INFO] 输出目录: $OUT_DIR"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="📘-功能概述"><a href="#📘-功能概述" class="headerlink" title="📘 功能概述"></a>📘 功能概述</h3><p>该脚本从 <strong>Clean FastQ</strong> 文件出发，自动完成以下步骤：</p>
<ol>
<li>参考基因组索引检查；</li>
<li>BWA 比对生成 BAM 文件；</li>
<li>GATK 去重（MarkDuplicates）；</li>
<li>生成每个样本的 gVCF；</li>
<li>自动跳过已完成步骤；</li>
<li>并行分批执行以节省内存与磁盘。</li>
</ol>
<h3 id="📂-输入与输出目录"><a href="#📂-输入与输出目录" class="headerlink" title="📂 输入与输出目录"></a>📂 输入与输出目录</h3><table>
<thead>
<tr>
<th>路径</th>
<th>内容</th>
</tr>
</thead>
<tbody><tr>
<td><code>/Clean_data/</code></td>
<td>fastp 过滤后的 reads</td>
</tr>
<tr>
<td><code>/Align/</code></td>
<td>比对与 gVCF 输出目录</td>
</tr>
<tr>
<td><code>/Align/logs/</code></td>
<td>每个阶段日志</td>
</tr>
</tbody></table>
<h3 id="⚙️-步骤解析"><a href="#⚙️-步骤解析" class="headerlink" title="⚙️ 步骤解析"></a>⚙️ 步骤解析</h3><h4 id="1️⃣-参考基因组准备"><a href="#1️⃣-参考基因组准备" class="headerlink" title="1️⃣ 参考基因组准备"></a>1️⃣ 参考基因组准备</h4><p>脚本自动检测并生成：</p>
<ul>
<li><code>.bwt</code> → BWA 比对索引</li>
<li><code>.fai</code> → samtools 索引</li>
<li><code>.dict</code> → GATK 序列字典</li>
</ul>
<h4 id="2️⃣-样本比对（BWA-MEM）"><a href="#2️⃣-样本比对（BWA-MEM）" class="headerlink" title="2️⃣ 样本比对（BWA MEM）"></a>2️⃣ 样本比对（BWA MEM）</h4><ul>
<li>对每个样本进行比对；</li>
<li>自动识别单双端；</li>
<li>输出排序 BAM；</li>
<li>生成日志文件记录耗时与状态。</li>
</ul>
<p>示例输出：</p>
<pre class="line-numbers language-none"><code class="language-none">BM_S_1.sorted.bam
logs/BM_S_1.bwa.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h4 id="3️⃣-去重与-gVCF-生成"><a href="#3️⃣-去重与-gVCF-生成" class="headerlink" title="3️⃣ 去重与 gVCF 生成"></a>3️⃣ <del>去重与 gVCF 生成</del></h4><blockquote>
<p>去重速度过慢，影响整体运行事件，放到下一步多线程运行</p>
</blockquote>
<p>每个 BAM 文件通过 GATK 处理：</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gatk MarkDuplicates
gatk HaplotypeCaller <span class="token parameter variable">-ERC</span> GVCF<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<blockquote>
<p><strong>说明：</strong></p>
<ul>
<li>MarkDuplicates 去除 PCR 重复；</li>
<li>HaplotypeCaller 输出每个样本的 <code>g.vcf.gz</code>；</li>
<li>自动生成索引 <code>.tbi</code>。</li>
</ul>
</blockquote>
<h4 id="4️⃣-并行控制与容错机制"><a href="#4️⃣-并行控制与容错机制" class="headerlink" title="4️⃣ 并行控制与容错机制"></a>4️⃣ 并行控制与容错机制</h4><ul>
<li>每批最多同时处理 12 个样本；</li>
<li>自动检测哪些样本已完成；</li>
<li>失败样本记录日志但不阻塞后续运行；</li>
<li>自动清理中间文件，节省磁盘空间。</li>
</ul>
<h3 id="✅-运行结果"><a href="#✅-运行结果" class="headerlink" title="✅ 运行结果"></a>✅ 运行结果</h3><p>输出结构：</p>
<pre class="line-numbers language-none"><code class="language-none">Align/
├── BM_S_1.g.vcf.gz
├── BM_S_2.g.vcf.gz
└── logs/
    ├── BM_S_1.gvcf.log
    └── BM_S_2.bwa.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行结束后统计输出：</p>
<pre class="line-numbers language-none"><code class="language-none">[INFO] 最终gVCF文件数: 36
[INFO] 输出目录: Align/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<hr>
<h2 id="三、分染色体批量-gVCF-生成（batch-gvcf-sh）"><a href="#三、分染色体批量-gVCF-生成（batch-gvcf-sh）" class="headerlink" title="三、分染色体批量 gVCF 生成（batch_gvcf.sh）"></a>三、分染色体批量 gVCF 生成（<code>batch_gvcf.sh</code>）</h2><pre class="line-numbers language-none"><code class="language-none">#!/bin/bash
# =========================================
# 12CPU服务器安全版分阶段处理脚本（按染色体批量并发，自动计算并发）
# 输出结构: /mnt/disk2/Align/gvcf/chr*/sample.g.vcf.gz
# 保留 MarkDuplicates 阶段 / 日志 / 负载检查 / TMP 清理
# =========================================

set -o pipefail
umask 002

REF="/home/wanglab/Ywh/adductor_muscle_scar/Genome/GCF_963853765.1_xbMagGiga1.1_genomic.fna"
SOURCE_DIR="/home/wanglab/Ywh/adductor_muscle_scar/ReSeq_Data/DZQD2023092909-b1/Align"
OUT_DIR="/mnt/disk2/Align"
GVCF_DIR="${OUT_DIR}/gvcf"
LOG_DIR="${OUT_DIR}/logs"
TMP_DIR="/mnt/disk2/tmp"

# --------- 用户可调参数 ----------
# 并发/线程设置（按需修改）
STAGE1_CONCURRENT=5      # MarkDuplicates 并发数（I/O密集）
STAGE2_CONCURRENT=5      # 最大染色体并行任务上限（逻辑上再受可用CPU约束）
GVCF_THREADS=2           # 每个 HaplotypeCaller 任务线程数

# 系统预留与阈值
RESERVED_CPUS=2          # 预留给系统的 CPU 数
MAX_LOAD=10.0            # 系统平均负载阈值（超过则等待）
MIN_FREE_MEM_GB=4        # 最低可用内存 (GB)
# ---------------------------------

mkdir -p "$OUT_DIR" "$GVCF_DIR" "$LOG_DIR" "$TMP_DIR"

echo "[INFO] 启动时间: $(date)"
echo "[INFO] REF: $REF"
echo "[INFO] SOURCE_DIR: $SOURCE_DIR"
echo "[INFO] OUT_DIR: $OUT_DIR"
echo "[INFO] GVCF_DIR: $GVCF_DIR"
echo "[INFO] STAGE1_CONCURRENT: $STAGE1_CONCURRENT"
echo "[INFO] STAGE2_CONCURRENT (user cap): $STAGE2_CONCURRENT"
echo "[INFO] GVCF_THREADS (per task): $GVCF_THREADS"
echo "[INFO] RESERVED_CPUS: $RESERVED_CPUS"
echo "====================================="

# -------------------------------
# 系统/资源 检查函数
# -------------------------------
check_system_health() {
    # return 0 = ok, 1 = not ok (caller should sleep &amp; retry)
    local current_load
    current_load=$(uptime | awk -F'load average:' '{print $2}' | cut -d, -f1 | tr -d ' ')
    local available_mem
    available_mem=$(free -g | awk 'NR==2{print $7}')
    echo "[SYSTEM] 当前负载: $current_load, 可用内存: ${available_mem}G"
    # load threshold
    if (( $(echo "$current_load &gt; $MAX_LOAD" | bc -l) )); then
        echo "[WARN] 系统负载过高 ($current_load &gt; $MAX_LOAD)"
        return 1
    fi
    # memory threshold
    if [[ $available_mem -lt $MIN_FREE_MEM_GB ]]; then
        echo "[WARN] 可用内存不足 (${available_mem}G &lt; ${MIN_FREE_MEM_GB}G)"
        return 1
    fi
    return 0
}

# -------------------------------
# 参考基因组索引检查
# -------------------------------
if [[ ! -f "${REF}" ]]; then
    echo "[ERROR] 参考基因组文件不存在: $REF"
    exit 1
fi
[[ ! -f "${REF}.fai" ]] &amp;&amp; echo "[INFO] 生成 samtools faidx..." &amp;&amp; samtools faidx "$REF"
DICT_FILE="${REF%.*}.dict"
[[ ! -f "$DICT_FILE" ]] &amp;&amp; echo "[INFO] 生成 GATK 序列字典..." &amp;&amp; gatk CreateSequenceDictionary -R "$REF" -O "$DICT_FILE"

# -------------------------------
# 磁盘空间检查
# -------------------------------
disk_usage=$(df -h "$OUT_DIR" | awk 'NR==2 {print $5}' | sed 's/%//')
echo "[INFO] $OUT_DIR 磁盘使用率: ${disk_usage}%"
if [[ $disk_usage -gt 90 ]]; then
    echo "[ERROR] 磁盘使用率 &gt; 90%，请清理后再运行"
    exit 1
fi

# -------------------------------
# 发现 BAM 列表（已排序 BAM）
# -------------------------------
bam_files=($(find "$SOURCE_DIR" -type f -name "*.sorted.bam" | sort))
total_bam=${#bam_files[@]}
if [[ $total_bam -eq 0 ]]; then
    echo "[ERROR] 未找到任何已排序的BAM文件（pattern: *.sorted.bam） in $SOURCE_DIR"
    exit 1
fi
echo "[INFO] 找到 $total_bam 个已排序BAM文件"

# -------------------------------
# 计算实际可并发染色体数（受CPU与用户上限双重约束）
# -------------------------------
TOTAL_CPUS=$(nproc --all 2&gt;/dev/null || echo 12)
USABLE_CPUS=$(( TOTAL_CPUS - RESERVED_CPUS ))
if [[ $USABLE_CPUS -lt 1 ]]; then
    echo "[ERROR] 可用 CPU 太少: $USABLE_CPUS"
    exit 1
fi
# 理论上最大同时运行的 HaplotypeCaller 任务数 = floor(USABLE_CPUS / GVCF_THREADS)
AUTO_STAGE2_MAX=$(( USABLE_CPUS / GVCF_THREADS ))
if [[ $AUTO_STAGE2_MAX -lt 1 ]]; then AUTO_STAGE2_MAX=1; fi
# 最终并发取 min(user cap, auto cap)
if [[ $STAGE2_CONCURRENT -gt $AUTO_STAGE2_MAX ]]; then
    EFFECTIVE_STAGE2_CONCURRENT=$AUTO_STAGE2_MAX
else
    EFFECTIVE_STAGE2_CONCURRENT=$STAGE2_CONCURRENT
fi

echo "[INFO] 总 CPU: $TOTAL_CPUS, 可用 CPU (扣除 reserved): $USABLE_CPUS"
echo "[INFO] 按每任务 $GVCF_THREADS 线程计算，自动可并发数: $AUTO_STAGE2_MAX"
echo "[INFO] 最终 STAGE2 并发数（生效）: $EFFECTIVE_STAGE2_CONCURRENT"

# -------------------------------
# MarkDuplicates 函数
# -------------------------------
run_markduplicates() {
    local bam="$1"
    local sample
    sample=$(basename "$bam" .sorted.bam)
    local bam_markdup="${OUT_DIR}/${sample}.sorted.markdup.bam"
    local metrics="${OUT_DIR}/${sample}.markdup.metrics.txt"
    local log_file="${LOG_DIR}/${sample}.markdup.log"

    if [[ -s "$bam_markdup" ]]; then
        echo "[INFO] [$sample] MarkDuplicates 已存在，跳过"
        return 0
    fi
    
    echo "[INFO] [$sample] MarkDuplicates 开始: $(date)" | tee -a "$log_file"
    local start=$(date +%s)
    # run MarkDuplicates (taskset 可视需求调整)
    gatk MarkDuplicates \
        -I "$bam" \
        -O "$bam_markdup" \
        --METRICS_FILE "$metrics" \
        --CREATE_INDEX true \
        --VALIDATION_STRINGENCY LENIENT \
        --TMP_DIR "$TMP_DIR" \
        --ASSUME_SORTED true \
        2&gt;&gt; "$log_file"
    local rc=$?
    if [[ $rc -ne 0 || ! -s "$bam_markdup" ]]; then
        echo "[ERROR] [$sample] MarkDuplicates 失败 (rc=$rc)" | tee -a "$log_file"
        return 1
    fi
    local end=$(date +%s)
    echo "[INFO] [$sample] MarkDuplicates 完成 ✅ (耗时 $((end-start))s)" | tee -a "$log_file"
    return 0
}

# -------------------------------
# 按染色体为单位，处理单个染色体：对该染色体并行处理所有样本（受全局并发限制）
# run_chr_task chr bam1 bam2 bam3 ...
# -------------------------------
run_chr_task() {
    local chr="$1"; shift
    local bam_list=("$@")
    local chr_dir="${GVCF_DIR}/${chr}"
    mkdir -p "$chr_dir"
    echo "[INFO] [chr=$chr] 处理 ${#bam_list[@]} 个样本开始: $(date)"

    for bam in "${bam_list[@]}"; do
        sample=$(basename "$bam" .sorted.markdup.bam)
        gvcf="${chr_dir}/${sample}.g.vcf.gz"
        logf="${LOG_DIR}/${sample}.${chr}.gvcf.log"
    
        if [[ -s "$gvcf" ]]; then
            echo "[INFO] [$sample $chr] 已存在，跳过"
            continue
        fi
    
        # 等待系统健康
        while ! check_system_health; do
            sleep 20
        done
    
        echo "[INFO] [$sample $chr] 开始 HaplotypeCaller (threads=$GVCF_THREADS)" | tee -a "$logf"
        start_t=$(date +%s)
        gatk HaplotypeCaller \
            -R "$REF" \
            -I "$bam" \
            -O "$gvcf" \
            -L "$chr" \
            -ERC GVCF \
            --native-pair-hmm-threads $GVCF_THREADS \
            --tmp-dir "$TMP_DIR" \
            2&gt;&gt; "$logf"
        rc=$?
        if [[ $rc -ne 0 || ! -s "$gvcf" ]]; then
            echo "[ERROR] [$sample $chr] HaplotypeCaller 失败 (rc=$rc)" | tee -a "$logf"
            # 失败不终止批次，继续后面的样本
        else
            end_t=$(date +%s)
            echo "[INFO] [$sample $chr] 完成 ✅ (耗时 $((end_t-start_t))s)" | tee -a "$logf"
        fi
    done
    
    echo "[INFO] [chr=$chr] 全部样本处理完成: $(date)"
}

# -------------------------------
# 并发启动函数（用于阶段1和阶段2的并发控制）
#   调用约定:
#     run_parallel func arg1 arg2 ... --max N --name "desc"
#   或者为兼容旧调用，下面也提供基于 positional 参数的封装
# -------------------------------
run_parallel() {
    # 简单的 positional parsing: 参数中包含 --max 和 --name
    local args=("$@")
    local max=1
    local name="parallel"
    # parse from end
    for (( i=${#args[@]}-1; i&gt;=0; i-- )); do
        if [[ "${args[i]}" == --max ]]; then
            max="${args[i+1]}"
            unset 'args[i]' 'args[i+1]'
            break
        fi
    done
    for (( i=${#args[@]}-1; i&gt;=0; i-- )); do
        if [[ "${args[i]}" == --name ]]; then
            name="${args[i+1]}"
            unset 'args[i]' 'args[i+1]'
            break
        fi
    done

    local func="${args[0]}"
    shift
    # remaining args are the payload for invocation; if more than one payload, treat as array items
    local payloads=("${args[@]}")
    
    # If func is run_chr_task and first payload is a chr + list, we want to spawn functions by payload elements.
    # For our usage, we'll call run_parallel with payloads each being a string token representing a job invocation:
    # e.g. run_parallel run_markduplicates "$bam1" "$bam2" ... --max 4 --name "MarkDuplicates"
    # Simpler approach: launch each payload as separate background call to func with that payload as single arg.
    local total=${#payloads[@]}
    local idx=0
    echo "[INFO] [${name}] 并行启动: total=$total, max=$max"
    while [[ $idx -lt $total ]]; do
        # spawn while respecting max
        while [[ $(jobs -r | wc -l) -ge $max ]]; do
            sleep 5
        done
        item="${payloads[idx]}"
        # For run_markduplicates style: item is a path; call func "$item" &amp;
        # For run_chr_task batch invocation we will call it differently below.
        $func "$item" &amp;
        idx=$((idx+1))
        sleep 0.5
    done
    wait
    echo "[INFO] [${name}] 并行任务全部完成"
}

# -------------------------------
# MAIN: 阶段1 MarkDuplicates（并行）
# -------------------------------
echo "========================"
echo "[MAIN] 阶段1: MarkDuplicates"
echo "========================"

need_markdup=()
for bam in "${bam_files[@]}"; do
    sample=$(basename "$bam" .sorted.bam)
    target="${OUT_DIR}/${sample}.sorted.markdup.bam"
    if [[ ! -s "$target" ]]; then
        need_markdup+=("$bam")
    else
        echo "[INFO] $sample MarkDuplicates 已存在，跳过"
    fi
done

if [[ ${#need_markdup[@]} -gt 0 ]]; then
    echo "[INFO] 需要 MarkDuplicates 的样本数: ${#need_markdup[@]}"
    # 使用 GNU parallel 若系统安装也行，但此处我们用 shell job 控制：
    max_conc=$STAGE1_CONCURRENT
    for bam in "${need_markdup[@]}"; do
        while [[ $(jobs -r | wc -l) -ge $max_conc ]]; do
            sleep 5
        done
        run_markduplicates "$bam" &amp;
        sleep 0.5
    done
    wait
else
    echo "[INFO] 所有样本已完成 MarkDuplicates"
fi

# -------------------------------
# MAIN: 阶段2 按染色体批量并发生成 gVCF
#   - 我们将每个染色体作为一个并行任务（处理所有样本的该 chr）
#   - 控制并发数为 EFFECTIVE_STAGE2_CONCURRENT
# -------------------------------
echo "========================"
echo "[MAIN] 阶段2: 按染色体批量并发生成 gVCF"
echo "========================"

# 重新列出已经准备好的 markdup BAM（只取存在的）
markdup_bams=()
for bm in "${bam_files[@]}"; do
    sample=$(basename "$bm" .sorted.bam)
    md="${OUT_DIR}/${sample}.sorted.markdup.bam"
    if [[ -s "$md" ]]; then
        markdup_bams+=("$md")
    else
        echo "[WARN] $sample 的 markdup BAM 不存在，跳过该样本" 
    fi
done

if [[ ${#markdup_bams[@]} -eq 0 ]]; then
    echo "[ERROR] 无可用 markdup BAM，退出"
    exit 1
fi

# 获取染色体/contig 列表（使用 .fai 第一列）
chromosomes=($(cut -f1 "${REF}.fai"))
echo "[INFO] 染色体计数: ${#chromosomes[@]}"

# 并行启动每个染色体任务，但限制并发为 EFFECTIVE_STAGE2_CONCURRENT
chr_count=${#chromosomes[@]}
started=0
for chr in "${chromosomes[@]}"; do
    # wait until running jobs &lt; limit and system healthy
    while [[ $(jobs -r | wc -l) -ge $EFFECTIVE_STAGE2_CONCURRENT ]]; do
        echo "[WAIT] 当前 Chr 并发: $(jobs -r | wc -l)/$EFFECTIVE_STAGE2_CONCURRENT，检查系统..."
        sleep 8
    done
    while ! check_system_health; do
        echo "[WAIT] 系统资源紧张，等待..."
        sleep 15
    done
    echo "[INFO] 启动 chr=$chr 的批量任务（处理 ${#markdup_bams[@]} 个样本）"
    run_chr_task "$chr" "${markdup_bams[@]}" &amp;
    started=$((started+1))
    sleep 1
done

# 等待所有染色体任务完成
wait

# -------------------------------
# 完成 &amp; 清理
# -------------------------------
echo "[INFO] 所有染色体批量任务完成，开始统计"
final_gvcf_count=$(find "$GVCF_DIR" -type f -name "*.g.vcf.gz" | wc -l || echo 0)
echo "[INFO] 生成 gVCF 总数: $final_gvcf_count"
echo "[INFO] 清理 TMP..."
rm -rf "${TMP_DIR}"/* 2&gt;/dev/null || true

echo "[INFO] 全流程完成: $(date)"
echo "[INFO] 输出目录: $GVCF_DIR"
echo "====================================="<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="📘-功能概述-1"><a href="#📘-功能概述-1" class="headerlink" title="📘 功能概述"></a>📘 功能概述</h3><p>当样本数较多或服务器资源有限时，推荐使用本脚本。<br> 它支持 <strong>按染色体分批并行</strong>，自动计算系统负载，防止过载。</p>
<blockquote>
<p>特点：</p>
<ul>
<li>动态 CPU / 内存检测；</li>
<li>自动暂停与恢复；</li>
<li>MarkDuplicates + HaplotypeCaller 分阶段；</li>
<li>输出结构按染色体分类存储。</li>
</ul>
</blockquote>
<h3 id="⚙️-主要参数"><a href="#⚙️-主要参数" class="headerlink" title="⚙️ 主要参数"></a>⚙️ 主要参数</h3><table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td><code>STAGE1_CONCURRENT</code></td>
<td>同时运行的 MarkDuplicates 数量</td>
<td>5</td>
</tr>
<tr>
<td><code>STAGE2_CONCURRENT</code></td>
<td>每次运行的染色体任务上限</td>
<td>5</td>
</tr>
<tr>
<td><code>GVCF_THREADS</code></td>
<td>每个样本的 HaplotypeCaller 线程数</td>
<td>2</td>
</tr>
<tr>
<td><code>MAX_LOAD</code></td>
<td>系统平均负载阈值</td>
<td>10.0</td>
</tr>
<tr>
<td><code>MIN_FREE_MEM_GB</code></td>
<td>最低剩余内存阈值</td>
<td>4 GB</td>
</tr>
</tbody></table>
<h3 id="⚙️-核心逻辑"><a href="#⚙️-核心逻辑" class="headerlink" title="⚙️ 核心逻辑"></a>⚙️ 核心逻辑</h3><ol>
<li><p><strong>系统监测</strong></p>
<ul>
<li>实时监控 CPU 负载与内存；</li>
<li>若超过阈值则暂停任务，确保稳定。</li>
</ul>
</li>
<li><p><strong>按染色体划分任务</strong></p>
<ul>
<li><p>每个样本的 BAM 文件按染色体调用 GATK；</p>
</li>
<li><p>输出路径：</p>
<pre class="line-numbers language-none"><code class="language-none">gvcf/chr1/BM_S_1.g.vcf.gz
gvcf/chr2/BM_S_1.g.vcf.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li>
</ul>
</li>
<li><p><strong>自动错误跳过</strong></p>
<ul>
<li>单个样本失败不会中断整个批次；</li>
<li>所有日志保存以便复查。</li>
</ul>
</li>
<li><p><strong>MarkDuplicates 阶段保留</strong></p>
<ul>
<li>提前处理可加快后续染色体分批；</li>
<li>可灵活重启中断任务。</li>
</ul>
</li>
</ol>
<h3 id="✅-输出示例"><a href="#✅-输出示例" class="headerlink" title="✅ 输出示例"></a>✅ 输出示例</h3><pre class="line-numbers language-none"><code class="language-none">/mnt/disk2/Align/
├── gvcf/
│   ├── chr1/
│   │   ├── BM_S_1.g.vcf.gz
│   │   └── BM_S_2.g.vcf.gz
│   ├── chr2/
│   │   ├── BM_S_1.g.vcf.gz
│   │   └── BM_S_2.g.vcf.gz
└── logs/
    ├── BM_S_1.markdup.log
    ├── BM_S_1.chr1.gvcf.log
    └── BM_S_2.chr2.gvcf.log<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<hr>
<h2 id="💡-流程总结"><a href="#💡-流程总结" class="headerlink" title="💡 流程总结"></a>💡 流程总结</h2><table>
<thead>
<tr>
<th>阶段</th>
<th>脚本</th>
<th>核心工具</th>
<th>主要任务</th>
<th>输出</th>
</tr>
</thead>
<tbody><tr>
<td>1️⃣</td>
<td>run_fastpl.sh</td>
<td>fastp</td>
<td>质控过滤</td>
<td>Clean FastQ</td>
</tr>
<tr>
<td>2️⃣</td>
<td>run_bwa_vcf.sh</td>
<td>BWA + GATK</td>
<td>比对 + gVCF</td>
<td>Align/g.vcf.gz</td>
</tr>
<tr>
<td>3️⃣</td>
<td>batch_gvcf.sh</td>
<td>GATK + Parallel</td>
<td>染色体分批</td>
<td>gvcf/chr*/</td>
</tr>
</tbody></table>
<hr>
<h2 id="🚀-新手建议"><a href="#🚀-新手建议" class="headerlink" title="🚀 新手建议"></a>🚀 新手建议</h2><ol>
<li><strong>先小规模测试</strong><br> 用 1–2 个样本验证路径与结果；</li>
<li><strong>监控资源</strong><br> 使用 <code>htop</code> 或 <code>nmon</code> 查看系统负载；</li>
<li><strong>定期清理中间文件</strong><br> 删除 <code>.bam</code>、<code>.bai</code> 可节省大量空间；</li>
<li><strong>保持日志</strong><br> 日志是排查错误的关键，不要删除。</li>
</ol>
<hr>
<h2 id="📎-后续方向"><a href="#📎-后续方向" class="headerlink" title="📎 后续方向"></a>📎 后续方向</h2><p>后续可继续进行：</p>
<ul>
<li>多样本联合变异检测（<code>GenotypeGVCFs</code>）；</li>
<li>SNP / INDEL 注释；</li>
<li>群体结构分析（PCA、ADMIXTURE）；</li>
<li>连锁不平衡与选择分析。</li>
</ul>
<hr>
<blockquote>
<p> <strong>说明：</strong> 本流程在 Ubuntu 22.04 + GATK 4.4 + BWA MEM 环境下测试通过。<br> 如需多节点或超大样本优化，请考虑基于 SLURM 的任务调度版本。</p>
</blockquote>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
  </entry>
</search>
